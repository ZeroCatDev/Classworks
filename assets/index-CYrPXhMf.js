import{V as Mt,a as Lt,_ as lt}from"./ExamConfigEditor-xc1du_ob.js";import{_ as O,k as C,s as se,j as b,o as c,w as n,d as s,l as _,q as $,t as d,v as D,x as U,y,z as N,i as r,A as v,B as w,C as g,D as rt,F as E,E as Be,T as Fe,G as A,e as le,H,I as te,n as re,J as he,K as ce,L as ke,M as q,N as We,O as $e,P as pe,Q as ve,R as Oe,S as ge,U as Pt,W as Ft,X as Ce,Y as dt,Z as z,$ as Ge,a0 as G,a1 as je,a2 as $t,a3 as Ee,a4 as Ve,a5 as Rt,a6 as Bt,a7 as Ot,a8 as ut,a9 as ct,aa as mt,ab as ze,ac as He,ad as Ne,ae as jt,af as Qe,ag as be,ah as Se,ai as Ht,aj as we}from"./index-COWAAttX.js";import{V as xe}from"./VTextField-BcnC8sd1.js";import{V as Ke,a as Kt}from"./VTooltip-DxR288wI.js";import{V as P}from"./VChip-haqxNVQU.js";import{s as qt,g as ft,j as Re,o as oe,a as Wt,l as Gt}from"./socketClient-BMYV-65p.js";import{f as Qt,s as Jt,c as ht}from"./deviceEvents-SzPn7wm3.js";import{V as ae,a as X}from"./VRow-Dv2_KSrB.js";import{V as Yt,a as Je}from"./VPagination-mWl21fW0.js";import{V as _e}from"./VTextarea-BBqaTjHp.js";import{d as Z,a as Me,g as gt,b as fe,k as Xt}from"./dataProvider-DYPLOAnV.js";import{V as Ye,a as Xe,b as Zt,c as es}from"./VAppBarTitle-CSub4Od_.js";import{V as pt}from"./VContainer-Bw1ja8CY.js";import{V as Ze}from"./VForm-BdZmuHju.js";import{V as et}from"./VSwitch-CZ9zkN2n.js";import{V as ts}from"./filter-DENl7bWb.js";import{p as tt,_ as vt}from"./index-Bzi09gTg.js";import{V as ye}from"./VAlert-Das7lZqe.js";import{V as ss,a as st,b as nt,c as it}from"./VExpansionPanels-CTe_pgiH.js";import"./VSkeletonLoader-C1PtStyO.js";import"./VCheckboxBtn-CglGnX_o.js";import"./VSheet-LvcKMKPS.js";const ns={name:"RandomPicker",props:{studentList:{type:Array,required:!0},attendance:{type:Object,required:!0,default:()=>({absent:[],late:[],exclude:[]})}},data(){return{dialog:!1,count:C("randomPicker.defaultCount"),isPickingStarted:!1,isAnimating:!1,pickedStudents:[],animationStudents:[],highlightedIndices:[],animationTimer:null,getSetting:C,tempFilters:{excludeAbsent:C("randomPicker.excludeAbsent"),excludeLate:C("randomPicker.excludeLate"),excludeExcluded:C("randomPicker.excludeExcluded")},pickerMode:C("randomPicker.mode"),minNumber:C("randomPicker.minNumber"),maxNumber:C("randomPicker.maxNumber")}},computed:{absentCount(){return this.attendance.absent?this.attendance.absent.length:0},lateCount(){return this.attendance.late?this.attendance.late.length:0},excludedCount(){return this.attendance.exclude?this.attendance.exclude.length:0},numberModeStudents(){if(this.pickerMode!=="number")return[];const t=[];for(let e=this.minNumber;e<=this.maxNumber;e++)t.push(e.toString().padStart(2,"0")+"Âè∑");return t},filteredStudents(){return this.pickerMode==="number"?this.numberModeStudents:!this.studentList||!this.studentList.length?[]:this.studentList.filter(t=>!(this.tempFilters.excludeAbsent&&this.attendance.absent.includes(t)||this.tempFilters.excludeLate&&this.attendance.late.includes(t)||this.tempFilters.excludeExcluded&&this.attendance.exclude.includes(t)))},availableStudents(){return this.filteredStudents},maxAllowedCount(){return Math.min(10,this.filteredStudents.length)},remainingStudents(){return this.filteredStudents.filter(t=>!this.pickedStudents.includes(t))}},watch:{dialog(t){t?(this.count=C("randomPicker.defaultCount"),this.isPickingStarted=!1,this.isAnimating=!1,this.pickedStudents=[],this.tempFilters={excludeAbsent:C("randomPicker.excludeAbsent"),excludeLate:C("randomPicker.excludeLate"),excludeExcluded:C("randomPicker.excludeExcluded")}):this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=null)},tempFilters:{handler(){this.count>this.maxAllowedCount&&(this.count=Math.max(1,this.maxAllowedCount))},deep:!0},pickerMode:{handler(t){se("randomPicker.mode",t)}},minNumber:{handler(t){t>this.maxNumber&&(this.minNumber=this.maxNumber),t<1&&(this.minNumber=1),se("randomPicker.minNumber",this.minNumber)}},maxNumber:{handler(t){t<this.minNumber&&(this.maxNumber=this.minNumber),t>100&&(this.maxNumber=100),se("randomPicker.maxNumber",this.maxNumber)}}},methods:{open(){this.dialog=!0},incrementCount(){this.count<this.maxAllowedCount&&this.count++},decrementCount(){this.count>1&&this.count--},startPicking(){this.filteredStudents.length!==0&&(this.isPickingStarted=!0,C("randomPicker.animation")?this.startAnimation():this.finishPicking())},startAnimation(){this.isAnimating=!0,this.animationStudents=this.filteredStudents.map((t,e)=>({id:`student-${e}`,name:t})),this.animateHighlight()},animateHighlight(){let e=0;const a=50,l=()=>{this.highlightedIndices=[];const i=[];for(let u=0;u<this.count;u++){let m;do m=Math.floor(Math.random()*this.animationStudents.length);while(i.includes(m));i.push(m)}this.highlightedIndices=i,e++;const o=a+e*20;e<5?this.animationTimer=setTimeout(l,o):setTimeout(()=>{this.finishPicking()},500)};l()},finishPicking(){this.isAnimating=!1;const t=[...this.filteredStudents].sort(()=>.5-Math.random());this.pickedStudents=t.slice(0,this.count)},resetPicker(){this.isPickingStarted=!1,this.isAnimating=!1,this.pickedStudents=[],this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=null)},refreshSingleStudent(t){if(this.remainingStudents.length===0)return;const e=Math.floor(Math.random()*this.remainingStudents.length),a=this.remainingStudents[e];this.pickedStudents[t]=a;const l=document.querySelectorAll(".result-card");l[t]&&(l[t].classList.add("refresh-animation"),setTimeout(()=>{l[t].classList.remove("refresh-animation")},500))}}},is={class:"d-flex justify-center align-center counter-container"},as={class:"count-display mx-8"},os={class:"text-h2 font-weight-bold"},ls={class:"mode-switch-container mt-6"},rs={key:0,class:"number-range-container mt-4"},ds={class:"d-flex justify-center align-center gap-4"},us={class:"mt-4"},cs={key:1,class:"mt-4 text-error"},ms={class:"mt-4 text-caption"},fs={class:"pa-2"},hs={key:0},gs={key:1},ps={key:2},vs={key:1,class:"d-flex flex-wrap justify-center gap-2 mt-4"},ys={key:0,class:"animation-container"},ks={class:"animation-wrapper"},xs={key:1,class:"result-container"},bs={class:"mt-8 d-flex justify-center"};function ws(t,e,a,l,i,o){return c(),b(H,{modelValue:i.dialog,"onUpdate:modelValue":e[8]||(e[8]=u=>i.dialog=u),"fullscreen-breakpoint":"sm","max-width":"600",persistent:""},{default:n(()=>[s(_,{border:"",class:"random-picker-card",rounded:"xl"},{default:n(()=>[s($,{class:"text-h5 d-flex align-center"},{default:n(()=>[s(D,{class:"mr-2",icon:"mdi-account-question"}),e[9]||(e[9]=d(" ÈöèÊú∫ÁÇπÂêç ",-1)),s(U),s(y,{icon:"mdi-close",variant:"text",onClick:e[0]||(e[0]=u=>i.dialog=!1)})]),_:1}),i.isPickingStarted?(c(),b(N,{key:1,class:"text-center py-6"},{default:n(()=>[i.isAnimating?(c(),v("div",ys,[r("div",ks,[s(Fe,{class:"shuffle-container",name:"shuffle",tag:"div"},{default:n(()=>[(c(!0),v(E,null,A(i.animationStudents,(u,m)=>(c(),v("div",{key:u.id,class:le([{highlighted:i.highlightedIndices.includes(m)},"student-item"])},g(u.name),3))),128))]),_:1})])])):(c(),v("div",xs,[e[19]||(e[19]=r("div",{class:"text-h6 mb-4"},"ÊäΩÂèñÁªìÊûú",-1)),(c(!0),v(E,null,A(i.pickedStudents,(u,m)=>(c(),b(_,{key:m,class:"mb-2 result-card",color:"primary",variant:"outlined"},{default:n(()=>[s(N,{class:"text-h4 text-center py-4 d-flex align-center justify-center"},{default:n(()=>[d(g(u)+" ",1),s(y,{disabled:o.remainingStudents.length===0,title:o.remainingStudents.length===0?"Ê≤°ÊúâÊõ¥Â§öÂèØÁî®Â≠¶Áîü":"ÈáçÊñ∞ÊäΩÂèñÊ≠§Â≠¶Áîü",class:"ml-2 refresh-btn",icon:"mdi-refresh",size:"small",variant:"text",onClick:f=>o.refreshSingleStudent(m)},null,8,["disabled","title","onClick"])]),_:2},1024)]),_:2},1024))),128)),r("div",bs,[s(y,{class:"mx-2",color:"primary","prepend-icon":"mdi-refresh",size:"large",onClick:o.resetPicker},{default:n(()=>[...e[17]||(e[17]=[d(" ÈáçÊñ∞ÊäΩÂèñ ",-1)])]),_:1},8,["onClick"]),s(y,{class:"mx-2",color:"grey",size:"large",variant:"outlined",onClick:e[7]||(e[7]=u=>i.dialog=!1)},{default:n(()=>[...e[18]||(e[18]=[d(" ÂÖ≥Èó≠ ",-1)])]),_:1})])]))]),_:1})):(c(),b(N,{key:0,class:"text-center py-6"},{default:n(()=>[e[16]||(e[16]=r("div",{class:"text-h6 mb-4"},"ËØ∑ÈÄâÊã©ÊäΩÂèñ‰∫∫Êï∞",-1)),r("div",is,[s(y,{disabled:i.count<=1,class:"counter-btn",color:"primary",icon:"mdi-minus",size:"x-large",variant:"tonal",onClick:o.decrementCount},null,8,["disabled","onClick"]),r("div",as,[r("span",os,g(i.count),1),e[10]||(e[10]=r("span",{class:"text-subtitle-1 ml-2"},"‰∫∫",-1))]),s(y,{disabled:i.count>=o.maxAllowedCount,class:"counter-btn",color:"primary",icon:"mdi-plus",size:"x-large",variant:"tonal",onClick:o.incrementCount},null,8,["disabled","onClick"])]),r("div",ls,[s(rt,{modelValue:i.pickerMode,"onUpdate:modelValue":e[1]||(e[1]=u=>i.pickerMode=u),class:"mode-toggle",color:"primary",mandatory:"",rounded:"pill"},{default:n(()=>[s(y,{"prepend-icon":"mdi-account",value:"name"},{default:n(()=>[...e[11]||(e[11]=[d("ÂßìÂêçÊ®°Âºè",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-numeric",value:"number"},{default:n(()=>[...e[12]||(e[12]=[d("Â≠¶Âè∑Ê®°Âºè",-1)])]),_:1})]),_:1},8,["modelValue"])]),i.pickerMode==="number"?(c(),v("div",rs,[e[14]||(e[14]=r("div",{class:"text-subtitle-1 mb-2"},"Â≠¶Âè∑ËåÉÂõ¥ËÆæÁΩÆ",-1)),r("div",ds,[s(xe,{modelValue:i.minNumber,"onUpdate:modelValue":e[2]||(e[2]=u=>i.minNumber=u),modelModifiers:{number:!0},class:"number-input",density:"compact","hide-details":"",label:"ÊúÄÂ∞èÂÄº",max:"100",min:"1",type:"number"},null,8,["modelValue"]),e[13]||(e[13]=r("span",{class:"mx-2"},"Ëá≥",-1)),s(xe,{modelValue:i.maxNumber,"onUpdate:modelValue":e[3]||(e[3]=u=>i.maxNumber=u),modelModifiers:{number:!0},class:"number-input",density:"compact","hide-details":"",label:"ÊúÄÂ§ßÂÄº",max:"100",min:"1",type:"number"},null,8,["modelValue"])])])):w("",!0),r("div",us,[s(y,{disabled:o.filteredStudents.length===0,class:"start-btn",color:"primary","prepend-icon":"mdi-dice-multiple",size:"x-large",onClick:o.startPicking},{default:n(()=>[...e[15]||(e[15]=[d(" ÂºÄÂßãÊäΩÂèñ ",-1)])]),_:1},8,["disabled","onClick"])]),o.filteredStudents.length===0?(c(),v("div",cs,[i.pickerMode==="name"?(c(),v(E,{key:0},[d(" Ê≤°ÊúâÂèØÊäΩÂèñÁöÑÂ≠¶ÁîüÔºåËØ∑Ë∞ÉÊï¥ËøáÊª§ÈÄâÈ°π ")],64)):(c(),v(E,{key:1},[d(" ËØ∑ËÆæÁΩÆÊúâÊïàÁöÑÂ≠¶Âè∑ËåÉÂõ¥ ")],64))])):w("",!0),r("div",ms,[d(" ÂΩìÂâçÂèØÊäΩÂèñÂ≠¶Áîü: "+g(o.filteredStudents.length)+"‰∫∫ ",1),i.pickerMode==="name"?(c(),b(Ke,{key:0,location:"bottom"},{activator:n(({props:u})=>[s(D,Be({class:"ml-1",icon:"mdi-information-outline",size:"small"},u),null,16)]),default:n(()=>[r("div",fs,[i.tempFilters.excludeAbsent?(c(),v("div",hs," ‚Ä¢ Â∑≤ÊéíÈô§ËØ∑ÂÅáÂ≠¶Áîü ("+g(o.absentCount)+"‰∫∫) ",1)):w("",!0),i.tempFilters.excludeLate?(c(),v("div",gs," ‚Ä¢ Â∑≤ÊéíÈô§ËøüÂà∞Â≠¶Áîü ("+g(o.lateCount)+"‰∫∫) ",1)):w("",!0),i.tempFilters.excludeExcluded?(c(),v("div",ps," ‚Ä¢ Â∑≤ÊéíÈô§‰∏çÂèÇ‰∏éÂ≠¶Áîü ("+g(o.excludedCount)+"‰∫∫) ",1)):w("",!0)])]),_:1})):w("",!0),i.pickerMode==="name"?(c(),v("div",vs,[s(P,{color:i.tempFilters.excludeLate?"warning":"default",variant:i.tempFilters.excludeLate?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-clock-alert",onClick:e[4]||(e[4]=u=>i.tempFilters.excludeLate=!i.tempFilters.excludeLate)},{default:n(()=>[d(g(i.tempFilters.excludeLate?"ÊéíÈô§":"ÂåÖÂê´")+"ËøüÂà∞Â≠¶Áîü ",1)]),_:1},8,["color","variant"]),s(P,{color:i.tempFilters.excludeAbsent?"error":"default",variant:i.tempFilters.excludeAbsent?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-account-off",onClick:e[5]||(e[5]=u=>i.tempFilters.excludeAbsent=!i.tempFilters.excludeAbsent)},{default:n(()=>[d(g(i.tempFilters.excludeAbsent?"ÊéíÈô§":"ÂåÖÂê´")+"ËØ∑ÂÅáÂ≠¶Áîü ",1)]),_:1},8,["color","variant"]),s(P,{color:i.tempFilters.excludeExcluded?"grey":"default",variant:i.tempFilters.excludeExcluded?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-account-cancel",onClick:e[6]||(e[6]=u=>i.tempFilters.excludeExcluded=!i.tempFilters.excludeExcluded)},{default:n(()=>[d(g(i.tempFilters.excludeExcluded?"ÊéíÈô§":"ÂåÖÂê´")+"‰∏çÂèÇ‰∏éÂ≠¶Áîü ",1)]),_:1},8,["color","variant"])])):w("",!0)])]),_:1}))]),_:1})]),_:1},8,["modelValue"])}const yt=O(ns,[["render",ws],["__scopeId","data-v-85e7eea6"]]),Ss={name:"EventSender",emits:["sent","error"],methods:{async sendEvent(t,e={}){try{return qt(t,e),this.$emit("sent",{eventName:t,content:e,timestamp:new Date().toISOString(),success:!0}),{success:!0,eventId:(e==null?void 0:e.eventId)||null,notificationId:(e==null?void 0:e.notificationId)||null}}catch(a){return console.error("ÂèëÈÄÅ‰∫ã‰ª∂Â§±Ë¥•:",a),this.$emit("error",{eventName:t,content:e,error:a.message,timestamp:new Date().toISOString(),success:!1}),{success:!1,error:a.message}}},async sendNotification(t,e=!1,a=[],l={},i=null){const o=`evt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return this.sendEvent("notification",{eventId:o,notificationId:i,message:t,isUrgent:e,targetDevices:a,senderInfo:l})},async sendReceipt(t,e,a={},l=null){const i=`rcpt-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-receipt",{eventId:i,originalEventId:t,notificationId:l,status:e,deviceInfo:a})},async sendDisplayedReceipt(t={},e=null){const a=`disp-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-displayed",{eventId:a,notificationId:e,deviceInfo:t})},async sendReadReceipt(t={},e=null){const a=`read-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-read",{eventId:a,notificationId:e,deviceInfo:t})}}},Cs={style:{display:"none"}};function _s(t,e,a,l,i,o){return c(),v("div",Cs)}const Ae=O(Ss,[["render",_s]]),Ds={name:"UrgentNotification",components:{EventSender:Ae},data(){return{visible:!1,notificationQueue:[],currentIndex:0,autoCloseTimer:null,urgentSoundTimer:null}},computed:{currentNotification(){return this.notificationQueue[this.currentIndex]||null},hasNotifications(){return this.notificationQueue.length>0},hasMultipleNotifications(){return this.notificationQueue.length>1},notificationCountText(){return this.hasMultipleNotifications?`${this.currentIndex+1} / ${this.notificationQueue.length}`:""},isUrgent(){var t,e;return((e=(t=this.currentNotification)==null?void 0:t.content)==null?void 0:e.isUrgent)||!1},urgencyColor(){return this.isUrgent?"red darken-2":"blue darken-2"},iconColor(){return"white"},urgencyIcon(){return this.isUrgent?"mdi-alert-circle-outline":"mdi-information-outline"},urgencyTitle(){return this.isUrgent?"üö® Á¥ßÊÄ•ÈÄöÁü•":"üì¢ ÈÄöÁü•Ê∂àÊÅØ"},senderName(){var e,a,l;const t=((e=this.currentNotification)==null?void 0:e.senderInfo)||((l=(a=this.currentNotification)==null?void 0:a.content)==null?void 0:l.senderInfo);return t?t.deviceName||t.deviceType||"Êú™Áü•ËÆæÂ§á":"Êú™Áü•ÂèëÈÄÅËÄÖ"},deviceType(){var e,a,l;const t=((e=this.currentNotification)==null?void 0:e.senderInfo)||((l=(a=this.currentNotification)==null?void 0:a.content)==null?void 0:l.senderInfo);return(t==null?void 0:t.deviceType)||"Êú™Áü•Á±ªÂûã"},targetDevices(){var t,e;return((e=(t=this.currentNotification)==null?void 0:t.content)==null?void 0:e.targetDevices)||[]}},beforeUnmount(){this.autoCloseTimer&&clearTimeout(this.autoCloseTimer),this.urgentSoundTimer&&clearInterval(this.urgentSoundTimer)},methods:{show(t){var a;if(this.notificationQueue.findIndex(l=>{var i,o;return((i=l.content)==null?void 0:i.notificationId)===((o=t.content)==null?void 0:o.notificationId)})!==-1){console.log("ÈÄöÁü•Â∑≤Â≠òÂú®ÔºåË∑≥ËøáÊ∑ªÂä†");return}this.notificationQueue.push(t),this.visible?(a=t.content)!=null&&a.isUrgent&&!this.isUrgent&&(this.currentIndex=this.notificationQueue.length-1,this.sendDisplayedReceipt(),this.playNotificationSound(),this.startUrgentSound()):(this.currentIndex=this.notificationQueue.length-1,this.visible=!0,this.sendDisplayedReceipt(),this.playNotificationSound(),this.isUrgent&&this.startUrgentSound())},close(){var t,e,a,l;try{this.sendReadReceipt(),console.log("Â∑≤ÂèëÈÄÅÂ∑≤ËØªÂõûÊâß")}catch(i){console.warn("ÂèëÈÄÅÂ∑≤ËØªÂõûÊâßÂ§±Ë¥•:",i)}if((e=(t=this.currentNotification)==null?void 0:t.content)!=null&&e.message){const i=this.isUrgent?"Á¥ßÊÄ•ÈÄöÁü•":"ÈÄöÁü•";this.isUrgent?(a=this.$message)==null||a.error(i,`${this.currentNotification.content.message}`):(l=this.$message)==null||l.info(i,`${this.currentNotification.content.message}`)}this.notificationQueue.length>0&&(this.notificationQueue.splice(this.currentIndex,1),this.currentIndex>=this.notificationQueue.length&&(this.currentIndex=Math.max(0,this.notificationQueue.length-1)),this.notificationQueue.length>0?(this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound()):this.closeWithoutRead())},closeWithoutRead(){this.visible=!1,this.notificationQueue=[],this.currentIndex=0,this.autoCloseTimer&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=null),this.stopUrgentSound()},formatTime(t){if(!t)return"";try{const e=new Date(t);if(new Date-e<24*60*60*1e3){const i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${i}:${o}`}else{const i=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${i}/${o}`}}catch{return"Êó†ÊïàÊó∂Èó¥"}},getDeviceTypeLabel(t){return{classroom:"ÊïôÂÆ§ËÆæÂ§á",student:"Â≠¶ÁîüËÆæÂ§á",teacher:"ÊïôÂ∏àËÆæÂ§á",admin:"ÁÆ°ÁêÜÂëòËÆæÂ§á",system:"Á≥ªÁªüËÆæÂ§á"}[t]||t},playNotificationSound(){try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),a=t.createGain();e.connect(a),a.connect(t.destination),e.frequency.value=1e3,e.type="sine",a.gain.value=.3,e.start(),e.stop(t.currentTime+.3)}catch(t){console.warn("Êó†Ê≥ïÊí≠ÊîæÈÄöÁü•Èü≥Êïà:",t)}},sendDisplayedReceipt(){var t;try{this.$refs.eventSender&&((t=this.currentNotification)!=null&&t.eventId)&&(this.$refs.eventSender.sendDisplayedReceipt({},this.currentNotification.content.notificationId),console.log("Â∑≤ÂèëÈÄÅÊòæÁ§∫ÂõûÊâß:",this.currentNotification.eventId))}catch(e){console.warn("ÂèëÈÄÅÊòæÁ§∫ÂõûÊâßÂ§±Ë¥•:",e)}},sendReadReceipt(){var t;try{this.$refs.eventSender&&((t=this.currentNotification)!=null&&t.eventId)&&(this.$refs.eventSender.sendReadReceipt({},this.currentNotification.content.notificationId),console.log("Â∑≤ÂèëÈÄÅÂ∑≤ËØªÂõûÊâß:",this.currentNotification.eventId))}catch(e){console.warn("ÂèëÈÄÅÂ∑≤ËØªÂõûÊâßÂ§±Ë¥•:",e)}},previousNotification(){this.currentIndex>0&&(this.currentIndex--,this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound())},nextNotification(){this.currentIndex<this.notificationQueue.length-1&&(this.currentIndex++,this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound())},startUrgentSound(){this.stopUrgentSound(),this.urgentSoundTimer=setInterval(()=>{this.visible&&this.isUrgent?this.playNotificationSound():this.stopUrgentSound()},1e3)},stopUrgentSound(){this.urgentSoundTimer&&(clearInterval(this.urgentSoundTimer),this.urgentSoundTimer=null)}}},Ts={class:"urgent-title mb-6"},Is={key:0,class:"navigation-controls mt-6"},Es={class:"notification-counter mb-3"},Vs={class:"navigation-buttons"},Ns={class:"mt-8"};function As(t,e,a,l,i,o){const u=Ae;return c(),v(E,null,[s(H,{modelValue:i.visible,"onUpdate:modelValue":e[0]||(e[0]=m=>i.visible=m),"max-width":"800",persistent:"",transition:"dialog-transition",class:"urgent-notification-dialog"},{default:n(()=>[s(_,{class:"urgent-notification-card",color:o.urgencyColor,elevation:"24"},{default:n(()=>[s(N,null,{default:n(()=>{var m,f;return[r("div",Ts,g(((f=(m=o.currentNotification)==null?void 0:m.content)==null?void 0:f.message)||"Êó†ÂÜÖÂÆπ"),1),s(_,{variant:"flat",color:"white"},{default:n(()=>[s($,null,{default:n(()=>[...e[1]||(e[1]=[d("ÂèëÈÄÅËÄÖ‰ø°ÊÅØ",-1)])]),_:1}),s(N,null,{default:n(()=>[s(P,{class:"mr-2 mb-2",color:"primary",variant:"outlined",size:"small"},{default:n(()=>[s(D,{left:"",size:"16"},{default:n(()=>[...e[2]||(e[2]=[d(" mdi-account ",-1)])]),_:1}),d(" "+g(o.senderName),1)]),_:1}),s(P,{class:"mr-2 mb-2",color:"info",variant:"outlined",size:"small"},{default:n(()=>[s(D,{left:"",size:"16"},{default:n(()=>[...e[3]||(e[3]=[d(" mdi-devices ",-1)])]),_:1}),d(" "+g(o.deviceType),1)]),_:1}),s(P,{class:"mb-2",color:"success",variant:"outlined",size:"small"},{default:n(()=>{var h;return[s(D,{left:"",size:"16"},{default:n(()=>[...e[4]||(e[4]=[d(" mdi-clock ",-1)])]),_:1}),d(" "+g(o.formatTime((h=o.currentNotification)==null?void 0:h.timestamp)),1)]}),_:1})]),_:1})]),_:1}),o.hasMultipleNotifications?(c(),v("div",Is,[s(_,{variant:"flat",color:"rgba(255,255,255,0.1)"},{default:n(()=>[s(N,{class:"text-center"},{default:n(()=>[r("div",Es,[s(P,{color:"white",variant:"flat",size:"small"},{default:n(()=>[d(g(o.notificationCountText),1)]),_:1})]),r("div",Vs,[s(y,{disabled:i.currentIndex===0,color:"white",variant:"outlined",size:"small",onClick:o.previousNotification},{default:n(()=>[s(D,null,{default:n(()=>[...e[5]||(e[5]=[d(" mdi-chevron-left ",-1)])]),_:1}),e[6]||(e[6]=d(" ‰∏ä‰∏Ä‰∏™ ",-1))]),_:1},8,["disabled","onClick"]),s(y,{disabled:i.currentIndex===i.notificationQueue.length-1,color:"white",variant:"outlined",size:"small",class:"ml-2",onClick:o.nextNotification},{default:n(()=>[e[8]||(e[8]=d(" ‰∏ã‰∏Ä‰∏™ ",-1)),s(D,null,{default:n(()=>[...e[7]||(e[7]=[d(" mdi-chevron-right ",-1)])]),_:1})]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1})])):w("",!0),r("div",Ns,[s(y,{color:"white",size:"large",variant:"flat",onClick:o.close},{default:n(()=>[s(D,{left:""},{default:n(()=>[...e[9]||(e[9]=[d(" mdi-check ",-1)])]),_:1}),e[10]||(e[10]=d(" ÊàëÁü•ÈÅì‰∫Ü ",-1))]),_:1},8,["onClick"])])]}),_:1})]),_:1},8,["color"])]),_:1},8,["modelValue"]),s(u,{ref:"eventSender"},null,512)],64)}const kt=O(Ds,[["render",As],["__scopeId","data-v-e250350b"]]),Us={name:"ChatWidget",components:{UrgentNotification:kt},props:{modelValue:{type:Boolean,default:!1},showButton:{type:Boolean,default:!0},offset:{type:Number,default:16},width:{type:Number,default:380},height:{type:Number,default:520}},emits:["update:modelValue"],data(){return{visible:this.modelValue,text:"",messages:[],allEvents:[],lastVisit:null,unreadCount:0,connected:!1,socketId:"",currentMode:"chat",currentPage:1,itemsPerPage:20,loading:!1,isDestroying:!1,eventStats:{chat:0,kvChanged:0,other:0},cleanupFunctions:[]}},computed:{panelStyle(){return{right:this.offset+"px",bottom:this.offset+"px",width:this.width+"px",height:this.height+"px"}},toggleStyle(){return{right:this.offset+"px",bottom:this.offset+"px"}},canSend(){return!!(C("server.kvToken")&&this.text.trim())},showToggleButton(){return this.$props.showButton&&!this.visible},decoratedMessages(){if(!this.lastVisit)return this.messages;const t=this.messages.findIndex(l=>l.at&&new Date(l.at).getTime()>=new Date(this.lastVisit).getTime());if(t<=0)return this.messages;const e=this.messages.slice(0,t),a=this.messages.slice(t);return[...e,{_id:"divider",_type:"divider"},...a]},currentDisplayItems(){return this.currentMode==="chat"?this.decoratedMessages:this.paginatedEvents},paginatedEvents(){if(this.isDestroying||!this.allEvents)return[];const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.allEvents.slice(t,e)},totalPages(){return this.isDestroying||!this.allEvents?1:Math.ceil(this.allEvents.length/this.itemsPerPage)},modeTitle(){return this.currentMode==="chat"?"ËÆæÂ§áËÅäÂ§©ÂÆ§":"ÊâÄÊúâ‰∫ã‰ª∂"}},watch:{modelValue(t){this.visible=t,t&&this.onOpen()}},mounted(){try{const h=localStorage.getItem("chat.lastVisit");h&&(this.lastVisit=h)}catch{}const t=ft();this.connected=!!t.connected,this.socketId=t.id||"",t.on("connect",()=>{this.connected=!0,this.socketId=t.id||""}),t.on("disconnect",()=>{this.connected=!1});const e=C("server.kvToken");e&&Re(e);const a=h=>(...x)=>{if(!this.isDestroying)try{h(...x)}catch(V){console.error("ChatWidget ‰∫ã‰ª∂Â§ÑÁêÜÈîôËØØ:",V)}},l=oe("chat:message",a(h=>{this.pushMessage(h),this.addEvent({_id:`legacy-chat-${Date.now()}-${Math.random()}`,type:"chat:message",content:h,timestamp:h.at||new Date().toISOString(),senderId:h.senderId,uuid:h.uuid,senderInfo:h.senderInfo})})),i=oe("chat",a(h=>{if(h&&h.content&&h.content.text){const x={text:h.content.text,senderId:h.senderId,at:h.timestamp,uuid:h.senderId,senderInfo:h.senderInfo};this.pushMessage(x),this.addEvent({_id:h.eventId||`chat-${Date.now()}-${Math.random()}`,type:"chat",content:h.content,timestamp:h.timestamp,eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo})}}));this.deviceEventHandler=ht({onChat:a((h,x)=>{this.pushMessage(h),this.addEvent(x)}),onKvChanged:a((h,x)=>{this.addEvent(x)}),onUrgentNotice:a((h,x)=>{this.addEvent(x),this.showUrgentNotification(x)}),onNotification:a((h,x)=>{console.log("Êî∂Âà∞ÈÄöÁü•‰∫ã‰ª∂:",h,x),this.addEvent(x),this.showUrgentNotification(x)}),onOtherEvent:a(h=>{(h.type==="urgent-notice"||h.type==="notification")&&this.showUrgentNotification(h),this.addEvent(h)}),enableLegacySupport:!0});const o=oe("device-event",this.deviceEventHandler),u=oe("kv-key-changed",a(h=>{h.content&&h.timestamp?this.addEvent({_id:`kv-${Date.now()}-${Math.random()}`,type:"kv-key-changed",content:h.content,timestamp:h.timestamp,eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo}):this.addEvent({_id:`legacy-kv-${Date.now()}-${Math.random()}`,type:"kv-key-changed",content:h,timestamp:h.updatedAt||new Date().toISOString(),uuid:h.uuid})})),m=oe("urgent-notice",a(h=>{console.log("Êî∂Âà∞Á¥ßÊÄ•ÈÄöÁü•:",h),this.addEvent({_id:`urgent-${Date.now()}-${Math.random()}`,type:"urgent-notice",content:h.content||h,timestamp:h.timestamp||new Date().toISOString(),eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo}),this.showUrgentNotification(h)})),f=oe("notification",a(h=>{var x;console.log("Êî∂Âà∞ÈÄöÁü•‰∫ã‰ª∂:",h),this.addEvent({_id:`notification-${Date.now()}-${Math.random()}`,type:"notification",content:h.content||h,timestamp:h.timestamp||new Date().toISOString(),eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo||((x=h.content)==null?void 0:x.senderInfo)}),this.showUrgentNotification(h)}));this.cleanupFunctions=[l,i,m,f,o,u],this.visible&&this.onOpen()},beforeUnmount(){this.isDestroying=!0,this.cleanupFunctions&&Array.isArray(this.cleanupFunctions)&&this.cleanupFunctions.forEach(t=>{try{typeof t=="function"&&t()}catch(e){console.warn("ChatWidget Ê∏ÖÁêÜÂáΩÊï∞ÊâßË°åÂ§±Ë¥•:",e)}});try{this.offMessage&&this.offMessage(),this.offDeviceEvent&&this.offDeviceEvent(),this.offKvChanged&&this.offKvChanged()}catch(t){console.warn("ChatWidget ÊóßÊ∏ÖÁêÜÂáΩÊï∞ÊâßË°åÂ§±Ë¥•:",t)}this.cleanupFunctions=[],this.messages=[],this.allEvents=[]},methods:{open(){this.visible=!0,this.$emit("update:modelValue",!0),this.onOpen()},close(){this.visible=!1,this.$emit("update:modelValue",!1);try{localStorage.setItem("chat.lastVisit",new Date().toISOString())}catch{}this.unreadCount=0},onOpen(){this.$nextTick(()=>this.scrollToBottom())},insertEmoji(t){this.text+=t,this.$nextTick(()=>{var e,a;if((a=(e=this.$refs.inputRef)==null?void 0:e.$el)!=null&&a.querySelector){const l=this.$refs.inputRef.$el.querySelector("textarea");l==null||l.focus()}})},handleEnter(t){t.shiftKey||this.send()},send(){const t=this.text.trim();if(!t)return;const e={_id:`self-${Date.now()}-${Math.random()}`,text:t,at:new Date().toISOString(),senderId:this.socketId,self:!0,senderInfo:{deviceName:"Êàë",deviceType:"client",isReadOnly:!1}};this.pushMessage(e),this.addEvent({_id:`self-event-${Date.now()}-${Math.random()}`,type:"chat",content:{text:t},timestamp:new Date().toISOString(),senderId:this.socketId,senderInfo:{deviceName:"Êú¨ËÆæÂ§á",deviceType:"client",isReadOnly:!1}}),Jt(t),this.text=""},pushMessage(t){if(!(this.isDestroying||!t))try{const e={_id:`${t.at||Date.now()}-${Math.random()}`,text:typeof(t==null?void 0:t.text)=="string"?t.text:(t==null?void 0:t.text)||"",at:t.at||new Date().toISOString(),senderId:t.senderId,self:!!(t.senderId&&t.senderId===this.socketId),senderInfo:t.senderInfo||null,deviceName:this.getDeviceName(t.senderInfo,t.senderId===this.socketId)};if(!e.text)return;this.messages.push(e),this.visible||this.unreadCount++,this.$nextTick(()=>{this.isDestroying||this.scrollToBottom()}),this.messages.length>500&&this.messages.shift()}catch(e){console.error("ChatWidget pushMessage ÈîôËØØ:",e)}},formatTime(t){try{const e=new Date(t),a=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0");return`${a}:${l}`}catch{return""}},scrollToBottom(){if(!this.isDestroying)try{const t=this.$refs.listRef;if(!t)return;requestAnimationFrame(()=>{!this.isDestroying&&t&&(t.scrollTop=t.scrollHeight)})}catch(t){console.warn("ChatWidget scrollToBottom ÈîôËØØ:",t)}},addEvent(t){if(!(this.isDestroying||!t))try{this.allEvents.unshift(t),t.type==="chat"||t.type==="chat:message"?this.eventStats.chat++:t.type==="kv-key-changed"?this.eventStats.kvChanged++:this.eventStats.other++,this.allEvents.length>200&&(this.allEvents=this.allEvents.slice(0,200))}catch(e){console.error("ChatWidget addEvent ÈîôËØØ:",e)}},getEventColor(t){switch(t){case"chat":case"chat:message":return"success";case"kv-key-changed":return"info";default:return"warning"}},getEventTypeLabel(t){switch(t){case"chat":case"chat:message":return"ËÅäÂ§©";case"kv-key-changed":return"KVÂèòÂåñ";default:return t}},formatDeviceInfo(t){return Qt(t)},getDeviceName(t,e=!1){return e?"Êàë":t?t.deviceName==="realtime"?"Á≥ªÁªü":t.deviceName||t.deviceType||"Êú™Áü•ËÆæÂ§á":"Êú™Áü•ËÆæÂ§á"},showUrgentNotification(t){try{this.$refs.urgentNotification?this.$refs.urgentNotification.show(t):console.warn("Á¥ßÊÄ•ÈÄöÁü•ÁªÑ‰ª∂Êú™ÊâæÂà∞")}catch(e){console.error("ÊòæÁ§∫Á¥ßÊÄ•ÈÄöÁü•Â§±Ë¥•:",e)}}}},zs={class:"text-subtitle-1"},Ms={key:0,ref:"listRef",class:"messages"},Ls={key:0,class:"divider-row"},Ps={class:"avatar"},Fs={class:"bubble"},$s={key:0,class:"sender-name"},Rs={class:"text"},Bs={class:"meta"},Os={key:0,class:"device-name"},js={key:1,class:"events-container"},Hs={class:"event-stats mb-3"},Ks={class:"text-h6"},qs={class:"text-h6"},Ws={class:"text-h6"},Gs={class:"events-list"},Qs={class:"d-flex align-center mb-1"},Js={class:"text-caption"},Ys={key:0,class:"mb-1 text-caption"},Xs={class:"event-content"},Zs={key:0,class:"chat-content"},en={key:1,class:"text-caption event-data"},tn={key:0,class:"text-center text-grey pa-4"},sn={key:0,class:"pagination mt-2"};function nn(t,e,a,l,i,o){const u=kt;return c(),v(E,null,[o.showToggleButton?(c(),v("div",{key:0,style:re(o.toggleStyle),class:"chat-toggle"},[s(y,{color:"primary",icon:"",variant:"flat",onClick:e[0]||(e[0]=m=>o.open())},{default:n(()=>[s(Kt,{content:i.unreadCount||void 0,"model-value":i.unreadCount>0,color:"error",overlap:""},{default:n(()=>[s(D,null,{default:n(()=>[...e[7]||(e[7]=[d(" mdi-chat ",-1)])]),_:1})]),_:1},8,["content","model-value"])]),_:1})],4)):w("",!0),te(r("div",{style:re(o.panelStyle),class:"chat-panel"},[s(_,{border:"",class:"chat-card",elevation:"8"},{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[s(D,{class:"mr-2"},{default:n(()=>[...e[8]||(e[8]=[d(" mdi-chat-processing ",-1)])]),_:1}),r("span",zs,g(o.modeTitle),1),s(U),s(rt,{modelValue:i.currentMode,"onUpdate:modelValue":e[1]||(e[1]=m=>i.currentMode=m),class:"mr-2",mandatory:"",size:"small",variant:"outlined"},{default:n(()=>[s(y,{value:"chat",size:"small"},{default:n(()=>[s(D,null,{default:n(()=>[...e[9]||(e[9]=[d("mdi-chat",-1)])]),_:1})]),_:1}),s(y,{value:"events",size:"small"},{default:n(()=>[s(D,null,{default:n(()=>[...e[10]||(e[10]=[d("mdi-format-list-bulleted",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Ke,{location:"top"},{activator:n(({props:m})=>[s(P,Be({color:i.connected?"success":"grey",size:"x-small"},m,{variant:"tonal"}),{default:n(()=>[d(g(i.connected?"Â∑≤ËøûÊé•":"Êú™ËøûÊé•"),1)]),_:1},16,["color"])]),default:n(()=>[r("span",null,"Socket "+g(i.socketId||"-"),1)]),_:1}),s(y,{icon:"",variant:"text",onClick:e[2]||(e[2]=m=>o.close())},{default:n(()=>[s(D,null,{default:n(()=>[...e[11]||(e[11]=[d("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),s(ce),s(N,{class:"chat-body"},{default:n(()=>[i.currentMode==="chat"?(c(),v("div",Ms,[(c(!0),v(E,null,A(o.decoratedMessages,m=>(c(),v(E,{key:m._id},[m._type==="divider"?(c(),v("div",Ls,[s(ce,{class:"my-2"}),e[12]||(e[12]=r("div",{class:"divider-text"}," ‰ªäÂ§© - ‰∏äÊ¨°ËÆøÈóÆ ",-1)),s(ce,{class:"my-2"})])):(c(),v("div",{key:1,class:le([{self:m.self},"message-row"])},[r("div",Ps,[s(ke,{color:m.self?"primary":"grey",size:"24"},{default:n(()=>[s(D,{size:"small"},{default:n(()=>[d(g(m.self?"mdi-account":"mdi-account-outline"),1)]),_:2},1024)]),_:2},1032,["color"])]),r("div",Fs,[!m.self&&m.deviceName?(c(),v("div",$s,g(m.deviceName),1)):w("",!0),r("div",Rs,g(m.text),1),r("div",Bs,[m.self&&m.deviceName?(c(),v("span",Os,g(m.deviceName)+" ‚Ä¢ ",1)):w("",!0),d(" "+g(o.formatTime(m.at)),1)])])],2))],64))),128))],512)):(c(),v("div",js,[r("div",Hs,[s(ae,{dense:""},{default:n(()=>[s(X,{cols:"4"},{default:n(()=>[s(_,{color:"success",dark:"",size:"small"},{default:n(()=>[s(N,{class:"text-center pa-2"},{default:n(()=>[r("div",Ks,g(i.eventStats.chat),1),e[13]||(e[13]=r("div",{class:"text-caption"}," ËÅäÂ§© ",-1))]),_:1})]),_:1})]),_:1}),s(X,{cols:"4"},{default:n(()=>[s(_,{color:"info",dark:"",size:"small"},{default:n(()=>[s(N,{class:"text-center pa-2"},{default:n(()=>[r("div",qs,g(i.eventStats.kvChanged),1),e[14]||(e[14]=r("div",{class:"text-caption"}," KVÂèòÂåñ ",-1))]),_:1})]),_:1})]),_:1}),s(X,{cols:"4"},{default:n(()=>[s(_,{color:"warning",dark:"",size:"small"},{default:n(()=>[s(N,{class:"text-center pa-2"},{default:n(()=>[r("div",Ws,g(i.eventStats.other),1),e[15]||(e[15]=r("div",{class:"text-caption"}," ÂÖ∂‰ªñ ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),r("div",Gs,[(c(!0),v(E,null,A(o.paginatedEvents,m=>(c(),v("div",{key:m._id,class:"event-item mb-2"},[s(_,{color:o.getEventColor(m.type),size:"small",variant:"outlined"},{default:n(()=>[s(N,{class:"pa-2"},{default:n(()=>{var f;return[r("div",Qs,[s(P,{color:o.getEventColor(m.type),size:"x-small"},{default:n(()=>[d(g(o.getEventTypeLabel(m.type)),1)]),_:2},1032,["color"]),s(U),r("span",Js,g(o.formatTime(m.timestamp||m.at)),1)]),m.senderInfo?(c(),v("div",Ys,[e[16]||(e[16]=r("strong",null,"ÂèëÈÄÅËÄÖ:",-1)),d(" "+g(o.formatDeviceInfo(m.senderInfo)),1)])):w("",!0),r("div",Xs,[m.type==="chat"||m.type==="chat:message"?(c(),v("div",Zs,g(((f=m.content)==null?void 0:f.text)||m.text),1)):(c(),v("pre",en,g(JSON.stringify(m.content||m,null,1)),1))])]}),_:2},1024)]),_:2},1032,["color"])]))),128)),i.allEvents.length===0?(c(),v("div",tn," ÊöÇÊó†‰∫ã‰ª∂ ")):w("",!0)]),o.totalPages>1?(c(),v("div",sn,[s(Yt,{modelValue:i.currentPage,"onUpdate:modelValue":e[3]||(e[3]=m=>i.currentPage=m),length:o.totalPages,"total-visible":3,size:"small"},null,8,["modelValue","length"])])):w("",!0)]))]),_:1}),i.currentMode==="chat"?(c(),b(ce,{key:0})):w("",!0),i.currentMode==="chat"?(c(),b(q,{key:1,class:"chat-input"},{default:n(()=>[s(y,{class:"mr-1",icon:"",variant:"text",onClick:e[4]||(e[4]=m=>o.insertEmoji("üòÑ"))},{default:n(()=>[s(D,null,{default:n(()=>[...e[17]||(e[17]=[d("mdi-emoticon-outline",-1)])]),_:1})]),_:1}),s(_e,{ref:"inputRef",modelValue:i.text,"onUpdate:modelValue":e[5]||(e[5]=m=>i.text=m),"auto-grow":"",class:"flex-grow-1","hide-details":"",placeholder:"ËæìÂÖ•Ê∂àÊÅØ",rows:"1",variant:"solo",onKeydown:[We($e(o.handleEnter,["prevent"]),["enter"]),e[6]||(e[6]=We($e(()=>{},["shift","stop"]),["enter"]))]},null,8,["modelValue","onKeydown"]),s(y,{disabled:!o.canSend,class:"ml-2",color:"primary",onClick:o.send},{default:n(()=>[s(D,{start:""},{default:n(()=>[...e[18]||(e[18]=[d(" mdi-send ",-1)])]),_:1}),e[19]||(e[19]=d(" ÂèëÈÄÅ ",-1))]),_:1},8,["disabled","onClick"])]),_:1})):w("",!0)]),_:1})],4),[[he,i.visible]]),s(u,{ref:"urgentNotification"},null,512)],64)}const Ue=O(Us,[["render",nn],["__scopeId","data-v-1a62ac2a"]]),an={name:"UrgentTestDialog",components:{ChatWidget:Ue,EventSender:Ae},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{sending:!1,notificationForm:{isUrgent:!1,message:"",isPersistent:!1},sentMessages:[],receiptCleanup:[],persistentNotifications:[],editDialog:!1,editForm:{id:null,message:"",isUrgent:!1,resend:!1},savingEdit:!1,deleteConfirmDialog:!1,itemToDelete:null}},computed:{dialog:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},mounted(){this.setupEventListeners(),this.loadPersistentNotifications()},beforeUnmount(){this.cleanup()},methods:{generateNotificationId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let a=0;a<32;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},async sendNotification(){if(this.notificationForm.message.trim()){this.sending=!0;try{const t=this.generateNotificationId(),e=this.notificationForm.message,a=this.notificationForm.isUrgent,l=this.notificationForm.isPersistent,i=await this.$refs.eventSender.sendNotification(e,a,[],{deviceName:"ÊµãËØïËÆæÂ§á",deviceType:"system",isReadOnly:!1},t),o=(i==null?void 0:i.eventId)||`msg-${Date.now()}`;if(this.sentMessages.push({id:o,notificationId:t,message:e,isUrgent:a,timestamp:new Date().toISOString(),receipts:{displayed:[],read:[]}}),l)try{const u="notification-list",m=await Z.loadData(u);let f=[];m&&Array.isArray(m)?f=m:m&&m.success!==!1&&Array.isArray(m.data)&&(f=m.data);const h={id:t,message:e,isUrgent:a,timestamp:new Date().toISOString()};f.unshift(h),await Z.saveData(u,f),this.persistentNotifications=f,console.log("Â∏∏È©ªÈÄöÁü•Â∑≤‰øùÂ≠ò")}catch(u){console.error("‰øùÂ≠òÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",u)}console.log("ÈÄöÁü•Â∑≤ÂèëÈÄÅÔºå‰∫ã‰ª∂ID:",o,"ÈÄöÁü•ID:",t),this.resetForm()}catch(t){console.error("ÂèëÈÄÅÈÄöÁü•Â§±Ë¥•:",t)}finally{this.sending=!1}}},resetForm(){this.notificationForm={isUrgent:!1,message:"",isPersistent:!1}},close(){this.dialog=!1},setupEventListeners(){const t=oe("notification-displayed",a=>{console.log("Êî∂Âà∞ÊòæÁ§∫ÂõûÊâß:",a),this.updateReceipt(a,"displayed")}),e=oe("notification-read",a=>{console.log("Êî∂Âà∞Â∑≤ËØªÂõûÊâß:",a),this.updateReceipt(a,"read")});this.receiptCleanup.push(t,e)},updateReceipt(t,e){var o,u,m,f,h;const a=t.originalEventId,l=t.notificationId||((o=t.content)==null?void 0:o.notificationId);if(!a&&!l)return;const i=this.sentMessages.find(x=>x.id===a||x.notificationId===l);if(i){const x={senderId:t.senderId||"unknown-sender",deviceName:((u=t.senderInfo)==null?void 0:u.deviceName)||((m=t.deviceInfo)==null?void 0:m.deviceName)||"Êú™Áü•ËÆæÂ§á",deviceType:((f=t.senderInfo)==null?void 0:f.deviceType)||((h=t.deviceInfo)==null?void 0:h.deviceType)||"unknown",timestamp:new Date().toISOString()};i.receipts[e].find(M=>M.senderId===x.senderId)||(i.receipts[e].push(x),console.log(`Êõ¥Êñ∞${e}ÂõûÊâß:`,i.id,x))}},cleanup(){this.receiptCleanup.forEach(t=>t()),this.receiptCleanup=[]},formatTime(t){return new Date(t).toLocaleString("zh-CN")},getReceiptStatus(t){return t.read.length>0?"Â∑≤ËØª":t.displayed.length>0?"Â∑≤ÊòæÁ§∫":"Â∑≤ÂèëÈÄÅ"},getReceiptColor(t){return t.read.length>0?"success":t.displayed.length>0?"info":"grey"},formatDeviceTime(t){return new Date(t).toLocaleTimeString("zh-CN")},getMainCardColor(t){return t.read.length>0?"success":t.displayed.length>0?"info":"grey"},hasAnyReceipts(t){return t.read.length>0||t.displayed.length>0},getDisplayedOnlyDevices(t){const e=t.read.map(a=>a.senderId);return t.displayed.filter(a=>!e.includes(a.senderId))},openEditDialog(t){this.editForm={id:t.id,message:t.message,isUrgent:t.isUrgent||!1,resend:!1,timestamp:t.timestamp},this.editDialog=!0},async saveEdit(){var t,e;if(this.editForm.message.trim()){this.savingEdit=!0;try{const a=this.persistentNotifications.findIndex(l=>l.id===this.editForm.id);if(a!==-1){if(this.persistentNotifications[a]={...this.persistentNotifications[a],message:this.editForm.message,isUrgent:this.editForm.isUrgent,timestamp:new Date().toISOString()},await Z.saveData("notification-list",this.persistentNotifications),this.editForm.resend){const l=this.editForm.id,i=this.editForm.message,o=this.editForm.isUrgent,u=await this.$refs.eventSender.sendNotification(i,o,[],{deviceName:"ÊµãËØïËÆæÂ§á",deviceType:"system",isReadOnly:!1},l),m=(u==null?void 0:u.eventId)||`msg-${Date.now()}`;this.sentMessages.push({id:m,notificationId:l,message:i,isUrgent:o,timestamp:new Date().toISOString(),receipts:{displayed:[],read:[]}})}this.editDialog=!1,(t=this.$message)==null||t.success("Â∑≤Êõ¥Êñ∞")}}catch(a){console.error("‰øùÂ≠òÂ§±Ë¥•",a),(e=this.$message)==null||e.error("‰øùÂ≠òÂ§±Ë¥•")}finally{this.savingEdit=!1}}},async loadPersistentNotifications(){try{const t=await Z.loadData("notification-list");t&&Array.isArray(t)?this.persistentNotifications=t:t&&t.success!==!1&&Array.isArray(t.data)?this.persistentNotifications=t.data:this.persistentNotifications=[]}catch(t){console.error("Âä†ËΩΩÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",t)}},async deleteNotification(t){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÈÄöÁü•ÂêóÔºü"))try{this.sentMessages=this.sentMessages.filter(a=>a.id!==t),this.persistentNotifications=this.persistentNotifications.filter(a=>a.id!==t),console.log("ÈÄöÁü•Â∑≤Âà†Èô§ÔºåÈÄöÁü•ID:",t)}catch(a){console.error("Âà†Èô§ÈÄöÁü•Â§±Ë¥•:",a)}},deletePersistentNotification(t){this.itemToDelete=t,this.deleteConfirmDialog=!0},async executeDelete(){var e,a;if(!this.itemToDelete)return;const t=this.itemToDelete;this.deleteConfirmDialog=!1,this.itemToDelete=null;try{this.persistentNotifications=this.persistentNotifications.filter(i=>i.id!==t);const l=this.persistentNotifications.length>0?this.persistentNotifications:{};await Z.saveData("notification-list",l),(e=this.$message)==null||e.success("Â∑≤Âà†Èô§")}catch(l){console.error("Âà†Èô§Â§±Ë¥•",l),(a=this.$message)==null||a.error("Âà†Èô§Â§±Ë¥•")}}}},on={key:0,class:"text-center text-grey py-4"},ln={key:0,class:"text-center text-grey py-8"},rn={class:"d-flex align-center mb-2"},dn={class:"font-weight-medium"},un={class:"text-caption font-weight-medium"},cn={class:"text-body-2 mb-3",style:{"max-height":"60px",overflow:"hidden"}},mn={class:"text-caption"},fn={key:0},hn={class:"align-center"},gn={class:"text-body-2 font-weight-medium"},pn={class:"text-caption mt-1"},vn={class:"align-center"},yn={class:"text-body-2 font-weight-medium"},kn={class:"text-caption text-grey"},xn={class:"text-caption text-grey mt-1"},bn={key:1};function wn(t,e,a,l,i,o){const u=Ue,m=Ae;return c(),b(H,{modelValue:o.dialog,"onUpdate:modelValue":e[11]||(e[11]=f=>o.dialog=f),fullscreen:"",transition:"dialog-bottom-transition",scrollable:""},{default:n(()=>[s(_,null,{default:n(()=>[s(Ye,{dark:"",flat:""},{default:n(()=>[s(Xe,null,{default:n(()=>[s(D,{class:"mr-2"},{default:n(()=>[...e[12]||(e[12]=[d(" mdi-chat ",-1)])]),_:1}),e[13]||(e[13]=d(" ÂèëÈÄÅÈÄöÁü• ",-1))]),_:1}),s(U),s(y,{icon:"mdi-close",onClick:o.close},null,8,["onClick"])]),_:1}),s(N,{class:"pa-0"},{default:n(()=>[s(pt,null,{default:n(()=>[s(ae,null,{default:n(()=>[s(X,{cols:"12"},{default:n(()=>[s(_,null,{default:n(()=>[s(N,null,{default:n(()=>[s(Ze,null,{default:n(()=>[s(ae,null,{default:n(()=>[s(X,{cols:"12",md:"6"},{default:n(()=>[s(et,{modelValue:i.notificationForm.isUrgent,"onUpdate:modelValue":e[0]||(e[0]=f=>i.notificationForm.isUrgent=f),label:"Âº∫Ë∞ÉÈÄöÁü•",color:"red",inset:""},null,8,["modelValue"]),s(Je,{modelValue:i.notificationForm.isPersistent,"onUpdate:modelValue":e[1]||(e[1]=f=>i.notificationForm.isPersistent=f),label:"Â∏∏È©ªÂ±ïÁ§∫",color:"primary","hide-details":"",class:"mt-0"},null,8,["modelValue"])]),_:1}),s(X,{cols:"12"},{default:n(()=>[s(_e,{modelValue:i.notificationForm.message,"onUpdate:modelValue":e[2]||(e[2]=f=>i.notificationForm.message=f),label:"ÈÄöÁü•ÂÜÖÂÆπ",outlined:"",rows:"3",placeholder:"ËØ∑ËæìÂÖ•Âº∫Ë∞ÉÈÄöÁü•ÁöÑÂÜÖÂÆπ..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(q,{class:"px-6 pb-6"},{default:n(()=>[s(y,{color:i.notificationForm.isUrgent?"red":"blue",disabled:!i.notificationForm.message.trim(),loading:i.sending,size:"large",variant:"elevated",onClick:o.sendNotification},{default:n(()=>[s(D,{left:""},{default:n(()=>[d(g(i.notificationForm.isUrgent?"mdi-alert-circle":"mdi-information"),1)]),_:1}),d(" "+g(i.notificationForm.isUrgent?"ÂèëÈÄÅÂº∫Ë∞ÉÈÄöÁü•":"ÂèëÈÄÅÈÄöÁü•"),1)]),_:1},8,["color","disabled","loading","onClick"]),s(U)]),_:1})]),_:1})]),_:1})]),_:1}),s(ae,{class:"mt-4"},{default:n(()=>[s(X,{cols:"12"},{default:n(()=>[s(_,null,{default:n(()=>[s($,null,{default:n(()=>[s(D,{class:"mr-2"},{default:n(()=>[...e[14]||(e[14]=[d("mdi-pin",-1)])]),_:1}),e[15]||(e[15]=d(" Â∏∏È©ªÈÄöÁü•ÁÆ°ÁêÜ ",-1))]),_:1}),s(N,null,{default:n(()=>[i.persistentNotifications.length===0?(c(),v("div",on," ÊöÇÊó†Â∏∏È©ªÈÄöÁü• ")):(c(),b(pe,{key:1},{default:n(()=>[(c(!0),v(E,null,A(i.persistentNotifications,f=>(c(),b(ve,{key:f.id,title:f.message,subtitle:o.formatTime(f.timestamp),lines:"two"},{prepend:n(()=>[s(D,{color:f.isUrgent?"error":"primary"},{default:n(()=>[d(g(f.isUrgent?"mdi-alert-circle":"mdi-information"),1)]),_:2},1032,["color"])]),append:n(()=>[s(y,{icon:"mdi-pencil",variant:"text",size:"small",onClick:h=>o.openEditDialog(f)},null,8,["onClick"]),s(y,{icon:"mdi-delete",variant:"text",color:"error",size:"small",onClick:h=>o.deletePersistentNotification(f.id)},null,8,["onClick"])]),_:2},1032,["title","subtitle"]))),128))]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),s(ae,{class:"mt-4"},{default:n(()=>[s(X,{cols:"12"},{default:n(()=>[s(_,null,{default:n(()=>[s($,null,{default:n(()=>[s(D,{class:"mr-2"},{default:n(()=>[...e[16]||(e[16]=[d(" mdi-history ",-1)])]),_:1}),e[17]||(e[17]=d(" Ê∂àÊÅØËÆ∞ÂΩï ",-1)),s(U)]),_:1}),s(N,null,{default:n(()=>[i.sentMessages.length===0?(c(),v("div",ln,[s(D,{size:"64",color:"grey-lighten-2"},{default:n(()=>[...e[18]||(e[18]=[d(" mdi-message-outline ",-1)])]),_:1}),e[19]||(e[19]=r("div",{class:"mt-2"}," ÊöÇÊó†ÂèëÈÄÅËÆ∞ÂΩï ",-1))])):(c(),b(ae,{key:1},{default:n(()=>[(c(!0),v(E,null,A(i.sentMessages.slice().reverse(),f=>(c(),b(X,{key:f.id,cols:"12",md:"6",lg:"4"},{default:n(()=>[s(_,{color:o.getMainCardColor(f.receipts),class:"mb-2"},{default:n(()=>[s(N,null,{default:n(()=>[r("div",rn,[r("span",dn,g(f.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•"),1),s(U),r("span",un,g(o.getReceiptStatus(f.receipts)),1)]),r("div",cn,g(f.message),1),r("div",mn,[r("div",null,"ÂèëÈÄÅÊó∂Èó¥Ôºö"+g(o.formatTime(f.timestamp)),1),r("div",null,"‰∫ã‰ª∂IDÔºö"+g(f.id),1),r("div",null,"ÈÄöÁü•IDÔºö"+g(f.notificationId),1)])]),_:2},1024)]),_:2},1032,["color"]),o.hasAnyReceipts(f.receipts)?(c(),v("div",fn,[(c(!0),v(E,null,A(f.receipts.read,h=>(c(),b(_,{key:`${h.senderId}-read`,color:"success",class:"mb-1",size:"small"},{default:n(()=>[s(N,{class:"pa-2"},{default:n(()=>[r("div",hn,[r("span",gn,g(h.deviceName),1),e[20]||(e[20]=r("br",null,null,-1)),d(" "+g(h.deviceType),1)]),r("div",pn," Â∑≤ËØª‰∫é "+g(o.formatDeviceTime(h.timestamp)),1)]),_:2},1024)]),_:2},1024))),128)),(c(!0),v(E,null,A(o.getDisplayedOnlyDevices(f.receipts),h=>(c(),b(_,{key:`${h.senderId}-displayed`,color:"info-lighten-4",variant:"outlined",class:"mb-1",size:"small"},{default:n(()=>[s(N,{class:"pa-2"},{default:n(()=>[r("div",vn,[r("span",yn,g(h.deviceName),1),s(U),r("span",kn,g(h.deviceType=="classroom"?"ÊïôÂÆ§ËÆæÂ§á‰∏äÁöÑÂ∫îÁî®":h.deviceType),1)]),r("div",xn," Â∑≤ÊòæÁ§∫‰∫é "+g(o.formatDeviceTime(h.timestamp)),1)]),_:2},1024)]),_:2},1024))),128))])):(c(),v("div",bn,[s(_,{color:"info-lighten-4",variant:"outlined",class:"mb-1",size:"small",title:"Êó†ËÆæÂ§áÂú®Á∫ø"},{default:n(()=>[s(N,null,{default:n(()=>[...e[21]||(e[21]=[d(" Â¶ÇÊûúÊï∞ÁßíÂêé‰ªªÁÑ∂ÊòæÁ§∫Ëøô‰∏™ÊèêÁ§∫ÔºåÂàôÂèØËÉΩÊ≤°Êúâ‰ªª‰ΩïËÆæÂ§áÂú®Á∫øÊé•Êî∂ÈÄöÁü•„ÄÇ ",-1)])]),_:1})]),_:1})]))]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(u),s(m,{ref:"eventSender"},null,512),s(H,{modelValue:i.editDialog,"onUpdate:modelValue":e[8]||(e[8]=f=>i.editDialog=f),"max-width":"500",fullscreen:t.$vuetify.display.xs},{default:n(()=>[s(_,null,{default:n(()=>[s(Ye,{flat:"",density:"compact"},{default:n(()=>[s(Xe,null,{default:n(()=>[...e[22]||(e[22]=[d("ÁºñËæëÂ∏∏È©ªÈÄöÁü•",-1)])]),_:1}),s(U),s(y,{icon:"mdi-close",onClick:e[3]||(e[3]=f=>i.editDialog=!1)})]),_:1}),s(N,null,{default:n(()=>[s(Ze,null,{default:n(()=>[s(_e,{modelValue:i.editForm.message,"onUpdate:modelValue":e[4]||(e[4]=f=>i.editForm.message=f),label:"ÈÄöÁü•ÂÜÖÂÆπ",rows:"3","auto-grow":""},null,8,["modelValue"]),s(et,{modelValue:i.editForm.isUrgent,"onUpdate:modelValue":e[5]||(e[5]=f=>i.editForm.isUrgent=f),label:"Âº∫Ë∞ÉÈÄöÁü•",color:"error","hide-details":""},null,8,["modelValue"]),s(Je,{modelValue:i.editForm.resend,"onUpdate:modelValue":e[6]||(e[6]=f=>i.editForm.resend=f),label:"‰øùÂ≠òÂπ∂ÈáçÊñ∞ÂèëÈÄÅÈÄöÁü•",hint:"ÂãæÈÄâÂêéÂ∞Ü‰Ωú‰∏∫Êñ∞ÈÄöÁü•ÂèëÈÄÅÁªôÊâÄÊúâÂú®Á∫øËÆæÂ§á","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{variant:"text",onClick:e[7]||(e[7]=f=>i.editDialog=!1)},{default:n(()=>[...e[23]||(e[23]=[d("ÂèñÊ∂à",-1)])]),_:1}),s(y,{color:"primary",loading:i.savingEdit,onClick:o.saveEdit},{default:n(()=>[...e[24]||(e[24]=[d("‰øùÂ≠ò",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","fullscreen"]),s(H,{modelValue:i.deleteConfirmDialog,"onUpdate:modelValue":e[10]||(e[10]=f=>i.deleteConfirmDialog=f),"max-width":"400"},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"text-h5"},{default:n(()=>[...e[25]||(e[25]=[d("Á°ÆËÆ§Âà†Èô§",-1)])]),_:1}),s(N,null,{default:n(()=>[...e[26]||(e[26]=[d("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Â∏∏È©ªÈÄöÁü•ÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ",-1)])]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=f=>i.deleteConfirmDialog=!1)},{default:n(()=>[...e[27]||(e[27]=[d("ÂèñÊ∂à",-1)])]),_:1}),s(y,{color:"error",variant:"text",onClick:o.executeDelete},{default:n(()=>[...e[28]||(e[28]=[d("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}const xt=O(an,[["render",wn],["__scopeId","data-v-c6850940"]]),Sn={name:"FloatingICP"},Cn={"aria-label":"xICPÂ§áxÂè∑",class:"floating-icp-link",href:"https://beian.miit.gov.cn/",rel:"noopener noreferrer",target:"_blank",style:{display:"none"}};function _n(t,e,a,l,i,o){return c(),v("a",Cn," xICPÂ§áxÂè∑ ")}const bt=O(Sn,[["render",_n],["__scopeId","data-v-fa73670f"]]),Dn={name:"FloatingToolbar",props:{loading:{type:Boolean,default:!1},unreadCount:{type:Number,default:0},selectedDate:{type:[String,Date],required:!0},isToday:{type:Boolean,required:!0},copyToTodayLoading:{type:Boolean,default:!1}},data(){return{isExpanded:!1}},methods:{handleDateSelect(t){this.$emit("date-select",t)}}},Tn={class:"floating-toolbar-container"};function In(t,e,a,l,i,o){return c(),v("div",Tn,[s(Pt,null,{default:n(()=>[s(_,{class:le([{"toolbar-expanded":i.isExpanded},"floating-toolbar"]),elevation:"4",rounded:"xl"},{default:n(()=>[s(Oe,{class:"toolbar-buttons",variant:"text"},{default:n(()=>[te(s(y,{title:"Êü•ÁúãÊò®Â§©",class:"toolbar-btn",icon:"mdi-chevron-left",variant:"text",onClick:e[0]||(e[0]=u=>t.$emit("prev-day"))},null,512),[[ge]]),te(s(y,{title:"Áº©Â∞èÂ≠ó‰Ωì",class:"toolbar-btn",icon:"mdi-format-font-size-decrease",variant:"text",onClick:e[1]||(e[1]=u=>t.$emit("zoom","out"))},null,512),[[ge]]),te(s(y,{title:"ÊîæÂ§ßÂ≠ó‰Ωì",class:"toolbar-btn",icon:"mdi-format-font-size-increase",variant:"text",onClick:e[2]||(e[2]=u=>t.$emit("zoom","up"))},null,512),[[ge]]),s(ts,{"close-on-content-click":!1,location:"top"},{activator:n(({props:u})=>[te(s(y,Be({title:"ÈÄâÊã©Êó•Êúü",class:"toolbar-btn",icon:"mdi-calendar"},u,{variant:"text"}),null,16),[[ge]])]),default:n(()=>[s(_,{border:"",class:"date-picker-card"},{default:n(()=>[s(Mt,{"model-value":a.selectedDate,color:"primary","onUpdate:modelValue":o.handleDateSelect},null,8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),te(s(y,{loading:a.loading,title:"Âà∑Êñ∞Êï∞ÊçÆ",class:"toolbar-btn",icon:"mdi-refresh",variant:"text",onClick:e[3]||(e[3]=u=>t.$emit("refresh"))},null,8,["loading"]),[[ge]]),a.isToday?w("",!0):te((c(),b(y,{key:0,title:"Êü•ÁúãÊòéÂ§©",class:"toolbar-btn",icon:"mdi-chevron-right",variant:"text",onClick:e[4]||(e[4]=u=>t.$emit("next-day"))},null,512)),[[ge]])]),_:1})]),_:1},8,["class"])]),_:1}),s(Ft,null,{default:n(()=>[a.isToday?w("",!0):(c(),b(y,{key:0,loading:a.copyToTodayLoading,disabled:a.copyToTodayLoading,class:"side-action-btn",color:"primary",elevation:"4","prepend-icon":"mdi-content-copy",rounded:"xl",size:"large",text:"Â§çÂà∂‰Ωú‰∏öÂÜÖÂÆπÂà∞‰ªäÂ§©",onClick:e[5]||(e[5]=u=>t.$emit("copy-to-today"))},{default:n(()=>[...e[6]||(e[6]=[d("Â§çÂà∂Âà∞‰ªäÂ§©",-1)])]),_:1},8,["loading","disabled"]))]),_:1})])}const wt=O(Dn,[["render",In],["__scopeId","data-v-7076d3aa"]]),En={name:"AttendanceManagementDialog",props:{modelValue:{type:Boolean,required:!0},studentList:{type:Array,required:!0},attendance:{type:Object,required:!0},dateString:{type:String,default:""}},emits:["update:modelValue","save","change"],setup(){const{mobile:t}=Ce();return{isMobile:t}},data(){return{attendanceSearch:"",attendanceFilter:[]}},computed:{filteredStudents(){let t=[...this.studentList];if(this.attendanceSearch){const e=this.attendanceSearch.toLowerCase();t=t.filter(a=>a.toLowerCase().includes(e))}return this.attendanceFilter&&this.attendanceFilter.length>0&&(t=t.filter(e=>!!(this.attendanceFilter.includes("present")&&this.isPresent(e)||this.attendanceFilter.includes("absent")&&this.isAbsent(e)||this.attendanceFilter.includes("late")&&this.isLate(e)||this.attendanceFilter.includes("exclude")&&this.isExclude(e)))),t},extractedSurnames(){if(!this.studentList||this.studentList.length===0)return[];const t=new Map;return this.studentList.forEach(e=>{if(e&&e.length>0){const a=e.charAt(0);t.set(a,(t.get(a)||0)+1)}}),Array.from(t.entries()).map(([e,a])=>({name:e,count:a})).sort((e,a)=>{const l=tt(e.name,{toneType:"none"}),i=tt(a.name,{toneType:"none"});return l.localeCompare(i)})}},methods:{toggleFilter(t){const e=this.attendanceFilter.indexOf(t);e===-1?this.attendanceFilter.push(t):this.attendanceFilter.splice(e,1)},isPresent(t){const{absent:e,late:a,exclude:l}=this.attendance;return!e.includes(t)&&!a.includes(t)&&!l.includes(t)},isAbsent(t){return this.attendance.absent.includes(t)},isLate(t){return this.attendance.late.includes(t)},isExclude(t){return this.attendance.exclude.includes(t)},getStudentStatusColor(t){return this.attendance.absent.includes(t)?"error":this.attendance.late.includes(t)?"warning":this.attendance.exclude.includes(t)?"grey":"success"},getStudentStatusIcon(t){return this.attendance.absent.includes(t)?"mdi-account-off":this.attendance.late.includes(t)?"mdi-clock-alert":this.attendance.exclude.includes(t)?"mdi-account-cancel":"mdi-account-check"},removeFromAll(t){const e=this.attendance.absent.indexOf(t);e>-1&&this.attendance.absent.splice(e,1);const a=this.attendance.late.indexOf(t);a>-1&&this.attendance.late.splice(a,1);const l=this.attendance.exclude.indexOf(t);l>-1&&this.attendance.exclude.splice(l,1)},setPresent(t){this.removeFromAll(t),this.$emit("change")},setAbsent(t){this.removeFromAll(t),this.attendance.absent.push(t),this.$emit("change")},setLate(t){this.removeFromAll(t),this.attendance.late.push(t),this.$emit("change")},setExclude(t){this.removeFromAll(t),this.attendance.exclude.push(t),this.$emit("change")},setAllPresent(){this.attendance.absent.splice(0,this.attendance.absent.length),this.attendance.late.splice(0,this.attendance.late.length),this.attendance.exclude.splice(0,this.attendance.exclude.length),this.$emit("change")},setAllAbsent(){this.setAllPresent(),this.attendance.absent.push(...this.studentList),this.$emit("change")},setAllLate(){this.setAllPresent(),this.attendance.late.push(...this.studentList),this.$emit("change")},setAllExclude(){this.setAllPresent(),this.attendance.exclude.push(...this.studentList),this.$emit("change")}}},Vn={class:"d-flex flex-wrap mt-2 gap-1"},Nn={class:"d-flex flex-wrap mb-4 gap-2"},An={class:"flex-grow-1"},Un={class:"d-flex align-center"},zn={class:"text-subtitle-1"},Mn={class:"attendance-actions"},Ln={class:"d-flex flex-wrap gap-2"};function Pn(t,e,a,l,i,o){return c(),b(H,{"model-value":a.modelValue,fullscreen:l.isMobile,"fullscreen-breakpoint":"sm","max-width":"900","onUpdate:modelValue":e[7]||(e[7]=u=>t.$emit("update:modelValue",u))},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[s(D,{class:"mr-2",icon:"mdi-account-group"}),e[8]||(e[8]=d(" Âá∫Âã§Áä∂ÊÄÅÁÆ°ÁêÜ ",-1)),s(U),l.isMobile?w("",!0):(c(),b(P,{key:0,class:"ml-2",color:"primary",size:"small"},{default:n(()=>[d(g(a.dateString),1)]),_:1})),l.isMobile?(c(),b(y,{key:1,icon:"mdi-close",variant:"text",onClick:e[0]||(e[0]=u=>t.$emit("update:modelValue",!1))})):w("",!0)]),_:1}),s(N,null,{default:n(()=>[s(ae,{class:"mb-4"},{default:n(()=>[s(X,{cols:"12",md:"12"},{default:n(()=>[s(xe,{modelValue:i.attendanceSearch,"onUpdate:modelValue":e[1]||(e[1]=u=>i.attendanceSearch=u),clearable:"",hint:"ÊîØÊåÅÁ≠õÈÄâÂßìÊ∞èÔºåÂ¶ÇËæìÂÖ•'Â≠ô'ÂèØÁ≠õÈÄâÊâÄÊúâÂßìÂ≠ôÁöÑÂ≠¶Áîü",label:"ÊêúÁ¥¢Â≠¶Áîü","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"]),r("div",Vn,[(c(!0),v(E,null,A(o.extractedSurnames,u=>(c(),b(y,{key:u.name,color:i.attendanceSearch===u.name?"primary":"",variant:i.attendanceSearch===u.name?"elevated":"text",onClick:m=>i.attendanceSearch=i.attendanceSearch===u.name?"":u.name},{default:n(()=>[d(g(u.name)+" ("+g(u.count)+") ",1)]),_:2},1032,["color","variant","onClick"]))),128))])]),_:1})]),_:1}),r("div",Nn,[r("div",null,[s(P,{"append-icon":i.attendanceFilter.includes("present")?"mdi-check":"",color:i.attendanceFilter.includes("present")?"success":"",variant:i.attendanceFilter.includes("present")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-check",value:"present",onClick:e[2]||(e[2]=u=>o.toggleFilter("present"))},{default:n(()=>[...e[9]||(e[9]=[d(" Âà∞ËØæ ",-1)])]),_:1},8,["append-icon","color","variant"]),s(P,{"append-icon":i.attendanceFilter.includes("absent")?"mdi-check":"",color:i.attendanceFilter.includes("absent")?"error":"",variant:i.attendanceFilter.includes("absent")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-off",value:"absent",onClick:e[3]||(e[3]=u=>o.toggleFilter("absent"))},{default:n(()=>[...e[10]||(e[10]=[d(" ËØ∑ÂÅá ",-1)])]),_:1},8,["append-icon","color","variant"]),s(P,{"append-icon":i.attendanceFilter.includes("late")?"mdi-check":"",color:i.attendanceFilter.includes("late")?"warning":"",variant:i.attendanceFilter.includes("late")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-clock-alert",value:"late",onClick:e[4]||(e[4]=u=>o.toggleFilter("late"))},{default:n(()=>[...e[11]||(e[11]=[d(" ËøüÂà∞ ",-1)])]),_:1},8,["append-icon","color","variant"]),s(P,{"append-icon":i.attendanceFilter.includes("exclude")?"mdi-check":"",color:i.attendanceFilter.includes("exclude")?"grey":"",variant:i.attendanceFilter.includes("exclude")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-cancel",value:"exclude",onClick:e[5]||(e[5]=u=>o.toggleFilter("exclude"))},{default:n(()=>[...e[12]||(e[12]=[d(" ‰∏çÂèÇ‰∏é ",-1)])]),_:1},8,["append-icon","color","variant"])])]),s(ae,null,{default:n(()=>[(c(!0),v(E,null,A(o.filteredStudents,u=>(c(),b(X,{key:u,cols:"12",lg:"4",md:"6",sm:"6"},{default:n(()=>[s(_,{border:"",class:"student-card"},{default:n(()=>[s(N,{class:"d-flex align-center pa-2"},{default:n(()=>[r("div",An,[r("div",Un,[s(ke,{color:o.getStudentStatusColor(u),class:"mr-2",size:"24"},{default:n(()=>[s(D,{size:"small"},{default:n(()=>[d(g(o.getStudentStatusIcon(u)),1)]),_:2},1024)]),_:2},1032,["color"]),r("div",zn,g(u),1)])]),r("div",Mn,[s(y,{color:o.isPresent(u)?"success":"",title:"ËÆæ‰∏∫Âà∞ËØæ",icon:"mdi-account-check",size:l.isMobile?"default":"small",variant:"text",onClick:m=>o.setPresent(u)},null,8,["color","size","onClick"]),s(y,{color:o.isAbsent(u)?"error":"",title:"ËÆæ‰∏∫ËØ∑ÂÅá",icon:"mdi-account-off",size:l.isMobile?"default":"small",variant:"text",onClick:m=>o.setAbsent(u)},null,8,["color","size","onClick"]),s(y,{color:o.isLate(u)?"warning":"",title:"ËÆæ‰∏∫ËøüÂà∞",icon:"mdi-clock-alert",size:l.isMobile?"default":"small",variant:"text",onClick:m=>o.setLate(u)},null,8,["color","size","onClick"]),s(y,{color:o.isExclude(u)?"grey":"",title:"ËÆæ‰∏∫‰∏çÂèÇ‰∏é",icon:"mdi-account-cancel",size:l.isMobile?"default":"small",variant:"text",onClick:m=>o.setExclude(u)},null,8,["color","size","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(ae,null,{default:n(()=>[s(X,{cols:"12",md:"12"},{default:n(()=>[s(_,{class:"mb-4",color:"primary",variant:"tonal"},{default:n(()=>[s(N,null,{default:n(()=>[e[17]||(e[17]=r("div",{class:"text-subtitle-2 mb-2"},"ÊâπÈáèÊìç‰Ωú",-1)),r("div",Ln,[s(y,{class:"flex-grow-1",color:"success","prepend-icon":"mdi-account-check",onClick:o.setAllPresent},{default:n(()=>[...e[13]||(e[13]=[d(" ÂÖ®ÈÉ®Âà∞ÈΩê ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"error","prepend-icon":"mdi-account-off",onClick:o.setAllAbsent},{default:n(()=>[...e[14]||(e[14]=[d(" ÂÖ®ÈÉ®ËØ∑ÂÅá ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"warning","prepend-icon":"mdi-clock-alert",onClick:o.setAllLate},{default:n(()=>[...e[15]||(e[15]=[d(" ÂÖ®ÈÉ®ËøüÂà∞ ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"grey","prepend-icon":"mdi-account-cancel",onClick:o.setAllExclude},{default:n(()=>[...e[16]||(e[16]=[d(" ÂÖ®ÈÉ®‰∏çÂèÇ‰∏é ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(ce),s(q,null,{default:n(()=>[s(U),s(y,{color:"primary",onClick:e[6]||(e[6]=u=>t.$emit("save"))},{default:n(()=>[s(D,{start:""},{default:n(()=>[...e[18]||(e[18]=[d("mdi-content-save",-1)])]),_:1}),e[19]||(e[19]=d(" ‰øùÂ≠ò ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","fullscreen"])}const St=O(En,[["render",Pn],["__scopeId","data-v-7f9de516"]]),Fn={name:"HomeworkEditDialog",props:{modelValue:{type:Boolean,required:!0},title:{type:String,required:!0},initialContent:{type:String,default:""},autoSave:{type:Boolean,default:!1},isEditingPastData:{type:Boolean,default:!1},currentDateString:{type:String,default:""}},emits:["update:modelValue","save"],setup(){const{mobile:t}=Ce();return{isMobile:t}},data(){return{content:"",templateData:null,currentLine:"",currentLineStart:0,currentLineEnd:0,quickTexts:["ËØæ","È¢ò","‰æã","Âèò","T","P"]}},computed:{dialogVisible:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},subject(){return this.title},hasTemplates(){var t,e;return!!((e=(t=this.templateData)==null?void 0:t.actions)!=null&&e.length||this.subjectBooks||this.commonBooks)},subjectBooks(){var t,e,a;return!this.subject||!((a=(e=(t=this.templateData)==null?void 0:t.subjects)==null?void 0:e[this.subject])!=null&&a.books)?null:this.templateData.subjects[this.subject].books},commonBooks(){var t,e;return(e=(t=this.templateData)==null?void 0:t.commonSubject)!=null&&e.books?this.templateData.commonSubject.books:null},showQuickTools(){return C("display.showQuickTools")},autoSavePromptText(){return C("edit.autoSavePromptText")},manualSavePromptText(){return C("edit.manualSavePromptText")}},watch:{async modelValue(t){if(t){this.content=this.initialContent;try{this.templateData=await Z.loadData("classworks-config-homework-template")}catch(e){console.error("Failed to load homework templates:",e),this.templateData=null}this.$nextTick(()=>{this.$refs.inputRef&&(this.$refs.inputRef.focus(),this.updateCurrentLine())})}}},methods:{handleClose(){const t=this.content.trim();t!==this.initialContent.trim()&&this.$emit("save",t),this.dialogVisible=!1},updateCurrentLine(){const e=this.$refs.inputRef.$el.querySelector("textarea").selectionStart,a=this.content;let l=0;const i=a.split(`
`);for(let o=0;o<i.length;o++){const u=i[o].length,m=l+u;if(e<=m||o===i.length-1){this.currentLine=i[o],this.currentLineStart=l,this.currentLineEnd=m;break}l=m+1}this.currentLine||(this.currentLine="",this.currentLineStart=a.length,this.currentLineEnd=a.length)},isBookSelected(t){return this.currentLine.includes(t)},isPageSelected(t,e){return this.currentLine.includes(e)},handleBookClick(t){if(this.isBookSelected(t)){const e=this.content.split(`
`),a=e.findIndex(l=>l.includes(t));a!==-1&&(e.splice(a,1),this.content=e.join(`
`))}else{const e=this.content.trim().length>0;this.content=(e?this.content.trim()+`
`:"")+t}this.$nextTick(()=>{const e=this.$refs.inputRef.$el.querySelector("textarea");if(e.focus(),!this.isBookSelected(t)){const a=this.content.split(`
`);let l=0;for(let i=0;i<a.length;i++){if(a[i].includes(t)){l+=a[i].length;break}l+=a[i].length+1}e.setSelectionRange(l,l)}this.updateCurrentLine()})},handlePageClick(t,e){if(this.isPageSelected(t,e)){const a=this.currentLineStart,l=this.currentLineEnd,i=this.content.slice(a,l),o=i.lastIndexOf(e);if(o!==-1){const u=i.slice(0,o)+i.slice(o+e.length);this.content=this.content.slice(0,a)+u.trim()+this.content.slice(l)}}else{const a=this.currentLineStart,l=this.currentLineEnd,i=this.content.slice(a,l);this.content=this.content.slice(0,a)+i.trim()+(i.trim().length>0?" ":"")+e+this.content.slice(l)}this.$nextTick(()=>{const a=this.$refs.inputRef.$el.querySelector("textarea");a.focus();const l=this.content.split(`
`);let i=0;for(let o=0;o<l.length&&(i+=l[o].length,!(i>this.currentLineStart));o++)i+=1;a.setSelectionRange(i,i),this.updateCurrentLine()})},insertTemplate(t){const e=this.$refs.inputRef.$el.querySelector("textarea"),a=e.selectionStart,l=e.selectionEnd,i=a>0&&this.content[a-1]!==" "&&this.content[a-1]!==`
`;this.content=this.content.slice(0,a)+(i?" ":"")+t+this.content.slice(l),this.$nextTick(()=>{e.focus();const o=a+t.length+(i?1:0);e.setSelectionRange(o,o),this.updateCurrentLine()})},insertAtCursor(t){if(!t)return;const e=this.$refs.inputRef.$el.querySelector("textarea"),a=e.selectionStart,l=e.selectionEnd;this.content=this.content.slice(0,a)+t+this.content.slice(l),this.$nextTick(()=>{e.focus();const i=a+t.length;e.setSelectionRange(i,i),this.updateCurrentLine()})},deleteLastChar(){const t=this.$refs.inputRef.$el.querySelector("textarea"),e=t.selectionStart,a=t.selectionEnd;e===a?e>0&&(this.content=this.content.slice(0,e-1)+this.content.slice(e),this.$nextTick(()=>{t.focus(),t.setSelectionRange(e-1,e-1),this.updateCurrentLine()})):(this.content=this.content.slice(0,e)+this.content.slice(a),this.$nextTick(()=>{t.focus(),t.setSelectionRange(e,e),this.updateCurrentLine()}))}}},$n={class:"d-flex"},Rn={class:"flex-grow-1"},Bn={key:0,class:"mt-4"},On={key:0,class:"template-buttons"},jn={key:0,class:"pages-container mt-2"},Hn={key:0,class:"pages-container mt-2"},Kn={key:2,class:"button-group"},qn={key:1,class:"text-center text-body-2 text-disabled mt-2"},Wn={key:0,class:"quick-tools ml-4",style:{"min-width":"180px"}},Gn={class:"numeric-keypad mb-4"},Qn={class:"keypad-row"},Jn={class:"keypad-row"},Yn={class:"keypad-row"},Xn={class:"keypad-row"},Zn={class:"keypad-row"},ei={class:"d-flex flex-wrap gap-1"},ti={class:"d-flex flex-column"},si={class:"text-body-2"};function ni(t,e,a,l,i,o){return c(),b(H,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=u=>o.dialogVisible=u),fullscreen:l.isMobile,"max-width":"900",width:"auto","onClick:outside":o.handleClose},{default:n(()=>[s(_,{border:""},{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[d(g(a.title)+" ",1),s(U),s(y,{icon:"mdi-close",variant:"text",onClick:o.handleClose},null,8,["onClick"])]),_:1}),s(dt,null,{default:n(()=>[d(g(a.autoSave?o.autoSavePromptText:o.manualSavePromptText),1)]),_:1}),s(N,null,{default:n(()=>{var u;return[r("div",$n,[r("div",Rn,[s(_e,{ref:"inputRef",modelValue:i.content,"onUpdate:modelValue":e[0]||(e[0]=m=>i.content=m),"auto-grow":"",placeholder:"‰ΩøÁî®Êç¢Ë°åË°®Á§∫ÂàÜÊù°",rows:"5",width:l.isMobile?"100%":"480",onClick:o.updateCurrentLine,onKeyup:o.updateCurrentLine},null,8,["modelValue","width","onClick","onKeyup"]),i.templateData?(c(),v("div",Bn,[o.hasTemplates?(c(),v("div",On,[o.subjectBooks?(c(!0),v(E,{key:0},A(o.subjectBooks,(m,f)=>(c(),v("div",{key:f,class:"button-group"},[s(P,{color:o.isBookSelected(f)?"success":"default",variant:o.isBookSelected(f)?"elevated":"flat",class:"ma-1 book-chip",onClick:h=>o.handleBookClick(f)},{default:n(()=>[d(g(f),1)]),_:2},1032,["color","variant","onClick"]),o.isBookSelected(f)?(c(),v("div",jn,[(c(!0),v(E,null,A(m,h=>(c(),b(P,{key:h,color:o.isPageSelected(f,h)?"info":"default",variant:o.isPageSelected(f,h)?"elevated":"flat",class:"ma-1",onClick:x=>o.handlePageClick(f,h)},{default:n(()=>[d(g(h),1)]),_:2},1032,["color","variant","onClick"]))),128))])):w("",!0)]))),128)):w("",!0),o.commonBooks?(c(!0),v(E,{key:1},A(o.commonBooks,(m,f)=>(c(),v("div",{key:f,class:"button-group"},[s(P,{color:o.isBookSelected(f)?"success":"default",variant:o.isBookSelected(f)?"elevated":"flat",class:"ma-1 book-chip",onClick:h=>o.handleBookClick(f)},{default:n(()=>[d(g(f),1)]),_:2},1032,["color","variant","onClick"]),o.isBookSelected(f)?(c(),v("div",Hn,[(c(!0),v(E,null,A(m,h=>(c(),b(P,{key:h,color:o.isPageSelected(f,h)?"info":"default",variant:o.isPageSelected(f,h)?"elevated":"flat",class:"ma-1",onClick:x=>o.handlePageClick(f,h)},{default:n(()=>[d(g(h),1)]),_:2},1032,["color","variant","onClick"]))),128))])):w("",!0)]))),128)):w("",!0),(u=i.templateData.actions)!=null&&u.length?(c(),v("div",Kn,[(c(!0),v(E,null,A(i.templateData.actions,m=>(c(),b(P,{key:m,class:"ma-1",color:"primary",variant:"flat",onClick:f=>o.insertTemplate(m)},{default:n(()=>[d(g(m),1)]),_:2},1032,["onClick"]))),128))])):w("",!0)])):(c(),v("div",qn," ÊöÇÊó†ÂèØÁî®ÁöÑÊ®°Êùø "))])):w("",!0)]),o.showQuickTools&&!l.isMobile?(c(),v("div",Wn,[r("div",Gn,[r("div",Qn,[(c(),v(E,null,A(3,m=>s(y,{key:m,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>o.insertAtCursor(String(m))},{default:n(()=>[d(g(m),1)]),_:2},1032,["onClick"])),64))]),r("div",Jn,[(c(),v(E,null,A(3,m=>s(y,{key:m,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>o.insertAtCursor(String(m+3))},{default:n(()=>[d(g(m+3),1)]),_:2},1032,["onClick"])),64))]),r("div",Yn,[(c(),v(E,null,A(3,m=>s(y,{key:m,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>o.insertAtCursor(String(m+6))},{default:n(()=>[d(g(m+6),1)]),_:2},1032,["onClick"])),64))]),r("div",Xn,[s(y,{class:"keypad-btn",size:"small",variant:"tonal",onClick:e[1]||(e[1]=m=>o.insertAtCursor("-"))},{default:n(()=>[...e[6]||(e[6]=[d(" - ",-1)])]),_:1}),s(y,{class:"keypad-btn",size:"small",variant:"tonal",onClick:e[2]||(e[2]=m=>o.insertAtCursor("0"))},{default:n(()=>[...e[7]||(e[7]=[d(" 0 ",-1)])]),_:1}),s(y,{class:"keypad-btn",color:"error",size:"small",variant:"tonal",onClick:o.deleteLastChar},{default:n(()=>[...e[8]||(e[8]=[d(" ‚Üê ",-1)])]),_:1},8,["onClick"])]),r("div",Zn,[s(y,{class:"keypad-btn space-btn",size:"small",variant:"tonal",onClick:e[3]||(e[3]=m=>o.insertAtCursor(" "))},{default:n(()=>[...e[9]||(e[9]=[d(" Á©∫Ê†º ",-1)])]),_:1}),s(y,{class:"keypad-btn space-btn",size:"small",variant:"tonal",onClick:e[4]||(e[4]=m=>o.insertAtCursor(`
`))},{default:n(()=>[...e[10]||(e[10]=[d(" Êç¢Ë°å ",-1)])]),_:1})])]),r("div",ei,[(c(!0),v(E,null,A(i.quickTexts,m=>(c(),b(y,{key:m,size:"small",variant:"flat",onClick:f=>o.insertAtCursor(m)},{default:n(()=>[d(g(m),1)]),_:2},1032,["onClick"]))),128))])])):w("",!0)])]}),_:1}),a.isEditingPastData?(c(),b(ye,{key:0,type:"warning",variant:"tonal",class:"mx-4 mb-4",border:"start","border-color":"warning",prominent:""},{prepend:n(()=>[...e[11]||(e[11]=[])]),default:n(()=>[r("div",ti,[e[12]||(e[12]=r("div",{class:"text-h6 mb-1"},"‰Ω†ÊâìÁÆó‰øÆÊîπÂéÜÂè≤Ôºü",-1)),r("div",si," ËøôÊòØ "+g(new Date(a.currentDateString.slice(0,4),a.currentDateString.slice(4,6)-1,a.currentDateString.slice(6,8)).toLocaleDateString())+" ÁöÑ‰Ωú‰∏ö ‚Ä¢ ËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºåÁ°Æ‰øù‰∏ç‰ºöË¶ÜÁõñÈáçË¶ÅÊï∞ÊçÆ ",1)])]),_:1})):w("",!0),e[13]||(e[13]=r("div",{class:"text-center text-body-2 text-disabled mb-5"}," ÁÇπÂáªÁ©∫ÁôΩÂ§ÑÂÆåÊàêÁºñËæë ",-1))]),_:1})]),_:1},8,["modelValue","fullscreen","onClick:outside"])}const Ct=O(Fn,[["render",ni],["__scopeId","data-v-b3e3018d"]]),ii={name:"AttendanceSidebar",props:{studentList:{type:Array,required:!0},attendance:{type:Object,required:!0},isEditingDisabled:{type:Boolean,default:!1}},emits:["click","disabled-click"],setup(){return{display:Ce()}},methods:{handleClick(){this.isEditingDisabled?this.$emit("disabled-click"):this.$emit("click")}}},ai={style:{"white-space":"nowrap"}},oi={style:{"white-space":"nowrap"}},li={style:{"white-space":"nowrap"}},ri={key:0},di={style:{"white-space":"nowrap"}},ui={style:{"white-space":"nowrap"}},ci={key:0},mi={style:{"white-space":"nowrap"}},fi={style:{"white-space":"nowrap"}},hi={key:0},gi={style:{"white-space":"nowrap"}};function pi(t,e,a,l,i,o){return a.studentList&&a.studentList.length?te((c(),b(X,{key:0,class:le([{"cursor-not-allowed":a.isEditingDisabled},"attendance-area no-select"]),cols:"1",onClick:o.handleClick},{default:n(()=>[e[10]||(e[10]=r("h1",null,"Âá∫Âã§",-1)),r("h2",null,[e[0]||(e[0]=r("span",{style:{"white-space":"nowrap"}}," Â∫îÂà∞",-1)),e[1]||(e[1]=d(" : ",-1)),r("span",ai,g(a.studentList.length-a.attendance.exclude.length)+"‰∫∫ ",1)]),r("h2",null,[e[2]||(e[2]=r("span",{style:{"white-space":"nowrap"}}," ÂÆûÂà∞",-1)),e[3]||(e[3]=d(" : ",-1)),r("span",oi,g(a.studentList.length-a.attendance.absent.length-a.attendance.late.length-a.attendance.exclude.length)+"‰∫∫ ",1)]),r("h2",null,[e[4]||(e[4]=r("span",{style:{"white-space":"nowrap"}}," ËØ∑ÂÅá",-1)),e[5]||(e[5]=d(" : ",-1)),r("span",li,g(a.attendance.absent.length)+"‰∫∫ ",1)]),(c(!0),v(E,null,A(a.attendance.absent,(u,m)=>(c(),v("h3",{key:"absent-"+m,class:"gray-text"},[l.display.lgAndUp.value?(c(),v("span",ri,g(`${m+1}. `),1)):w("",!0),r("span",di,g(u),1)]))),128)),r("h2",null,[e[6]||(e[6]=r("span",{style:{"white-space":"nowrap"}},"ËøüÂà∞",-1)),e[7]||(e[7]=d(" : ",-1)),r("span",ui,g(a.attendance.late.length)+"‰∫∫ ",1)]),(c(!0),v(E,null,A(a.attendance.late,(u,m)=>(c(),v("h3",{key:"late-"+m,class:"gray-text"},[l.display.lgAndUp.value?(c(),v("span",ci,g(`${m+1}. `),1)):w("",!0),r("span",mi,g(u),1)]))),128)),r("h2",null,[e[8]||(e[8]=r("span",{style:{"white-space":"nowrap"}},"‰∏çÂèÇ‰∏é",-1)),e[9]||(e[9]=d(" : ",-1)),r("span",fi,g(a.attendance.exclude.length)+"‰∫∫ ",1)]),(c(!0),v(E,null,A(a.attendance.exclude,(u,m)=>(c(),v("h3",{key:"exclude-"+m,class:"gray-text"},[l.display.lgAndUp.value?(c(),v("span",hi,g(`${m+1}. `),1)):w("",!0),r("span",gi,g(u),1)]))),128))]),_:1},8,["class","onClick"])),[[ge,a.isEditingDisabled?!1:{class:`text-${["primary","secondary","info","success","warning","error"][Math.floor(Math.random()*6)]}`}]]):w("",!0)}const _t=O(ii,[["render",pi],["__scopeId","data-v-8dbe204a"]]),vi={class:"d-flex flex-no-wrap justify-space-between"},yi={class:"pe-4"},ki={class:"mb-3"},Dt={__name:"PwaInstallCard",setup(t){const e=z(!1),a=z(!1),l=z(!1),i=Ge({title:"",message:"",links:[]}),o={pending:"ÂæÖÊéàÊùÉ",granted:"Â∑≤ÂÆåÊàê",denied:"Â∑≤ÊãíÁªù",unavailable:"‰∏çÂèØÁî®"},u={pending:"mdi-progress-clock",granted:"mdi-check-circle",denied:"mdi-close-circle",unavailable:"mdi-help-circle"},m={pending:"primary",granted:"success",denied:"error",unavailable:"surface-variant"},f=Ge({pwa:{label:"ÂÆâË£ÖÂ∫îÁî®",description:"Â∞ÜÁΩëÁ´ôÂÆâË£Ö‰∏∫Áã¨Á´ãÂ∫îÁî®Ôºå‰æø‰∫éÂø´ÈÄüÂêØÂä®",status:"pending"},notification:{label:"ÈÄöÁü•ÊùÉÈôê",description:"ÂÖÅËÆ∏Êé•Êî∂‰Ωú‰∏ö„ÄÅËÄÉËØïÁ≠âÈÄöÁü•ÊèêÈÜí",status:"pending"},storage:{label:"Á¶ªÁ∫øÂ≠òÂÇ®",description:"ÂêØÁî®ÊåÅ‰πÖÂåñÂ≠òÂÇ®‰ª•Ëé∑ÂæóÊõ¥Á®≥ÂÅ•ÁöÑÁ¶ªÁ∫ø‰ΩìÈ™å",status:"pending"}}),h=G(()=>[{key:"pwa",...f.pwa},{key:"notification",...f.notification},{key:"storage",...f.storage}]),x=G(()=>h.value.some(k=>k.status==="pending")),V={pwa:[{text:"MDN - ÂÆâË£Ö PWA ÊåáÂçó",desc:"Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÊîØÊåÅÂπ∂ÊâãÂä®Ëß¶ÂèëÂÆâË£Ö",href:"https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps/Guides/Installing"},{text:"Microsoft Edge - PWA ‰ΩìÈ™å",desc:"Edge ÊµèËßàÂô®ÂÆâË£Ö‰∏é UX ËØ¥Êòé",href:"https://learn.microsoft.com/zh-cn/microsoft-edge/progressive-web-apps/ux"}],notification:[{text:"MDN - ÈÄöÁü•ÊùÉÈôê‰∏éÁî®Ê≥ï",desc:"ÊµèËßàÂô®ÈÄöÁü•ÊùÉÈôêÁöÑÂ∑•‰ΩúÊñπÂºè‰∏éË∞ÉËØï",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/notification"}],storage:[{text:"MDN - Storage ÊåÅ‰πÖÂåñËØ¥Êòé",desc:"‰∫ÜËß£ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÁöÑÂèØÁî®ÊÄß‰∏éÁî≥ËØ∑ÊñπÂºè",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/persist"}]};let M;const K=async()=>{var R;if(C("pwa.hideInstallCard")){e.value=!1;return}if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0?f.pwa.status="granted":(window.deferredPwaPrompt,f.pwa.status="pending"),typeof Notification>"u")f.notification.status="unavailable";else{const j=Notification.permission;f.notification.status=j==="granted"?"granted":j==="denied"?"denied":"pending"}if((R=navigator.storage)!=null&&R.persisted){const j=await navigator.storage.persisted();f.storage.status=j?"granted":"pending"}else f.storage.status="unavailable";const F=h.value.some(j=>j.status!=="granted");e.value=F},L=async()=>{const k=window.deferredPwaPrompt;if(!k){f.pwa.status="pending",J("pwa","ÊµèËßàÂô®Ê≤°ÊúâÊèê‰æõÂÆâË£ÖÊèêÁ§∫ÔºåÂèØÊåâÊñáÊ°£ÊâãÂä®ÂÆâË£Ö„ÄÇ");return}k.prompt();const{outcome:I}=await k.userChoice;f.pwa.status=I==="accepted"?"granted":"denied",I!=="accepted"&&J("pwa","Â¶ÇÊûúÊú™Âá∫Áé∞ÂÆâË£ÖÂºπÁ™óÔºåÊàñË¢´ÊãíÁªùÔºåËØ∑ÊåâËØ¥ÊòéÊâãÂä®ÂÆâË£Ö„ÄÇ"),window.deferredPwaPrompt=null},B=async()=>{if(typeof Notification>"u"){f.notification.status="unavailable",J("notification","ÂΩìÂâçÁéØÂ¢É‰∏çÊîØÊåÅÈÄöÁü• APIÔºåÂèØÊü•ÁúãËØ¥ÊòéÊâãÂä®ÂºÄÂêØÊàñÊõ¥Êç¢ÊµèËßàÂô®„ÄÇ");return}const k=await Rt();f.notification.status=k?"granted":"denied",k||J("notification","ÈÄöÁü•ËØ∑Ê±ÇÊú™Ë¢´Êéà‰∫àÔºåËØ∑ÊåâËØ¥ÊòéÊ£ÄÊü•ÊµèËßàÂô®ÊàñÁ≥ªÁªüËÆæÁΩÆ„ÄÇ")},Q=async()=>{var I;if(!((I=navigator.storage)!=null&&I.persist)){f.storage.status="unavailable",J("storage","ÂΩìÂâçÊµèËßàÂô®‰∏çÊîØÊåÅÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºåÂèØÊü•ÁúãËØ¥ÊòéÊàñÊõ¥Êç¢ÊµèËßàÂô®„ÄÇ");return}const k=await Bt();f.storage.status=k?"granted":"denied",k||J("storage","Êú™ËÉΩÂêØÁî®ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºåÂèØÊåâËØ¥ÊòéÊ£ÄÊü•ÊµèËßàÂô®ÊàñÁ≥ªÁªüËÆæÁΩÆ„ÄÇ")},de=async()=>{if(!(!x.value||a.value)){a.value=!0;try{await L(),await B(),await Q()}finally{a.value=!1,await K()}}},ee=async k=>{if(!a.value){a.value=!0;try{k==="pwa"?await L():k==="notification"?await B():k==="storage"&&await Q()}finally{a.value=!1,await K()}}},J=(k,I="")=>{k==="pwa"?i.title="Â¶Ç‰ΩïÂÆâË£Ö‰∏∫Â∫îÁî®":k==="notification"?i.title="Â¶Ç‰ΩïÂºÄÂêØÈÄöÁü•":i.title="Â¶Ç‰ΩïÂêØÁî®Á¶ªÁ∫øÂ≠òÂÇ®",i.message=I||"Êü•Áúã‰ª•‰∏ãÊ≠•È™§Ëé∑ÂèñÊõ¥Â§öËØ¥Êòé„ÄÇ",i.links=V[k]||[],l.value=!0},ue=()=>{se("pwa.hideInstallCard",!0),e.value=!1},S=()=>{f.pwa.status!=="granted"&&(f.pwa.status="pending"),K()},T=()=>{K()};return je(()=>{K(),window.addEventListener("pwa-prompt-ready",S),M=window.matchMedia("(display-mode: standalone)"),M.addEventListener("change",T)}),$t(()=>{window.removeEventListener("pwa-prompt-ready",S),M&&M.removeEventListener("change",T)}),(k,I)=>e.value?(c(),b(_,{key:0,class:"mb-4",color:"surface-variant",variant:"tonal"},{default:n(()=>[r("div",vi,[r("div",yi,[s($,{class:"text-h6"},{default:n(()=>[...I[2]||(I[2]=[d(" ÂÆâË£ÖÂ∫îÁî®‰∏éÊéàÊùÉ ",-1)])]),_:1}),s(dt,{class:"pb-1"},{default:n(()=>[...I[3]||(I[3]=[d(" ÊâãÂä®ÁÇπÈÄâ‰∏ãÊñπÈ°πÁõÆËØ∑Ê±ÇÂÆâË£ÖÂíåÊùÉÈôêÔºå‰πüÂèØ‰ª•Áõ¥Êé•ÂÖ≥Èó≠ ",-1)])]),_:1}),s(N,{class:"pt-0 pb-1"},{default:n(()=>[s(pe,{density:"comfortable",lines:"two"},{default:n(()=>[(c(!0),v(E,null,A(h.value,F=>(c(),b(ve,{key:F.key,disabled:a.value,onClick:()=>ee(F.key)},{prepend:n(()=>[s(ke,{color:m[F.status],size:"32",variant:"tonal"},{default:n(()=>[s(D,{icon:u[F.status]},null,8,["icon"])]),_:2},1032,["color"])]),append:n(()=>[s(P,{color:m[F.status],size:"small",variant:"tonal",class:"me-2"},{default:n(()=>[d(g(o[F.status]),1)]),_:2},1032,["color"]),s(y,{variant:"text",icon:"mdi-information",size:"small",disabled:a.value,onClick:$e(()=>J(F.key),["stop"])},null,8,["disabled","onClick"])]),default:n(()=>[s(Ee,null,{default:n(()=>[d(g(F.label),1)]),_:2},1024),s(Ve,null,{default:n(()=>[d(g(F.description),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"]))),128))]),_:1})]),_:1}),s(q,null,{default:n(()=>[s(y,{class:"ms-2",variant:"outlined",size:"small",onClick:ue},{default:n(()=>[...I[4]||(I[4]=[d(" ÂÖ≥Èó≠ ",-1)])]),_:1}),s(y,{class:"ms-2",variant:"elevated",color:"primary",size:"small","prepend-icon":a.value?"mdi-timer-sand":"mdi-shield-check",disabled:!x.value||a.value,onClick:de},{default:n(()=>[d(g(a.value?"Â§ÑÁêÜ‰∏≠":"‰∏ÄÊ¨°Â§ÑÁêÜÂÖ®ÈÉ®"),1)]),_:1},8,["prepend-icon","disabled"])]),_:1})]),s(ke,{class:"ma-3",size:"100",rounded:"0"},{default:n(()=>[s(D,{icon:"mdi-monitor-cellphone",size:"80"})]),_:1})]),s(H,{modelValue:l.value,"onUpdate:modelValue":I[1]||(I[1]=F=>l.value=F),"max-width":"520"},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"text-h6"},{default:n(()=>[d(g(i.title),1)]),_:1}),s(N,null,{default:n(()=>[r("p",ki,g(i.message),1),s(pe,{density:"comfortable"},{default:n(()=>[(c(!0),v(E,null,A(i.links,(F,R)=>(c(),b(ve,{key:R,href:F.href,target:"_blank",rel:"noopener"},{default:n(()=>[s(Ee,null,{default:n(()=>[d(g(F.text),1)]),_:2},1024),s(Ve,null,{default:n(()=>[d(g(F.desc),1)]),_:2},1024)]),_:2},1032,["href"]))),128))]),_:1})]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{variant:"text",onClick:I[0]||(I[0]=F=>l.value=!1)},{default:n(()=>[...I[5]||(I[5]=[d("ÊàëÁü•ÈÅì‰∫Ü",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0)}},xi={name:"HomeActions",props:{synced:Boolean,loadingUpload:Boolean,showRandomPickerButton:Boolean,showExamScheduleButton:Boolean,showListCardButton:Boolean,showFullscreenButton:Boolean,isFullscreen:Boolean,showAntiScreenBurnCard:Boolean,showTestCardButton:Boolean},emits:["upload","show-sync-message","open-random-picker","toggle-fullscreen","add-test-card"]},bi={class:"d-flex flex-wrap align-center mt-4"};function wi(t,e,a,l,i,o){return c(),v(E,null,[r("div",bi,[a.synced?(c(),b(y,{key:1,color:"success",size:"large",onClick:e[1]||(e[1]=u=>t.$emit("show-sync-message"))},{default:n(()=>[...e[9]||(e[9]=[d(" ÂêåÊ≠•ÂÆåÊàê ",-1)])]),_:1})):(c(),b(y,{key:0,loading:a.loadingUpload,class:"ml-2",color:"error",size:"large",onClick:e[0]||(e[0]=u=>t.$emit("upload"))},{default:n(()=>[...e[8]||(e[8]=[d(" ‰∏ä‰º† ",-1)])]),_:1},8,["loading"])),a.showRandomPickerButton?(c(),b(y,{key:2,"append-icon":"mdi-dice-multiple",class:"ml-2",color:"amber","prepend-icon":"mdi-account-question",size:"large",onClick:e[2]||(e[2]=u=>t.$emit("open-random-picker"))},{default:n(()=>[...e[10]||(e[10]=[d(" ÈöèÊú∫ÁÇπÂêç ",-1)])]),_:1})):w("",!0),a.showExamScheduleButton?(c(),b(Oe,{key:3,class:"ml-2",color:"green",variant:"elevated",divided:""},{default:n(()=>[s(y,{"prepend-icon":"mdi-calendar-check",size:"large",onClick:e[3]||(e[3]=u=>t.$router.push("/examschedule"))},{default:n(()=>[...e[11]||(e[11]=[d(" ËÄÉËØïÁúãÊùø ",-1)])]),_:1}),s(y,{icon:"mdi-plus",size:"large",onClick:e[4]||(e[4]=u=>t.$emit("add-exam-card"))})]),_:1})):w("",!0),a.showListCardButton?(c(),b(y,{key:4,class:"ml-2",color:"primary-darken-1","prepend-icon":"mdi-list-box",size:"large",onClick:e[5]||(e[5]=u=>t.$router.push("/list"))},{default:n(()=>[...e[12]||(e[12]=[d(" ÂàóË°® ",-1)])]),_:1})):w("",!0),a.showFullscreenButton?(c(),b(y,{key:5,color:a.isFullscreen?"blue-grey":"blue","prepend-icon":a.isFullscreen?"mdi-fullscreen-exit":"mdi-fullscreen",class:"ml-2",size:"large",onClick:e[6]||(e[6]=u=>t.$emit("toggle-fullscreen"))},{default:n(()=>[d(g(a.isFullscreen?"ÈÄÄÂá∫ÂÖ®Â±è":"ÂÖ®Â±èÊòæÁ§∫"),1)]),_:1},8,["color","prepend-icon"])):w("",!0),a.showTestCardButton?(c(),b(y,{key:6,class:"ml-2",color:"purple","prepend-icon":"mdi-test-tube",size:"large",onClick:e[7]||(e[7]=u=>t.$emit("add-test-card"))},{default:n(()=>[...e[13]||(e[13]=[d(" Ê∑ªÂä†ÊµãËØïÂç°Áâá ",-1)])]),_:1})):w("",!0)]),a.showAntiScreenBurnCard?(c(),b(_,{key:0,border:"",class:"mt-4 anti-burn-card",color:"primary",variant:"tonal"},{default:n(()=>[s($,{class:"text-subtitle-1"},{default:n(()=>[s(D,{icon:"mdi-shield-check",size:"small",start:""}),e[14]||(e[14]=d(" Â±èÂπï‰øùÊä§ÊäÄÊúØÂ∑≤ÂêØÁî® ",-1))]),_:1}),s(N,{class:"text-body-2"},{default:n(()=>[...e[15]||(e[15]=[r("p",null," ‰∏∫Èò≤Ê≠¢OLED/LCDÂ±èÂπïÁÉßÂ±èÔºåÁïåÈù¢ÂÖÉÁ¥†‰ºöÂÆöÊúüÂæÆË∞É‰ΩçÁΩÆ„ÄÇ ",-1),r("p",{class:"text-caption text-grey"}," Ê≠§ÂäüËÉΩ‰∏ç‰ºöÂΩ±ÂìçÊ≠£Â∏∏‰ΩøÁî®Ôºå‰ªÖÂú®ÈïøÊó∂Èó¥ÈùôÊ≠¢ÊòæÁ§∫Êó∂ÁîüÊïà„ÄÇ ",-1),r("p",{class:"text-caption text-grey"}," Âª∫ËÆÆÂú®ÊîæÂ≠¶ÂêéÂÖ≥Èó≠ÊòæÁ§∫Âô®‰ª•ËäÇÁ∫¶ËÉΩÊ∫ê„ÄÇ ",-1)])]),_:1})]),_:1})):w("",!0)],64)}const Tt=O(xi,[["render",wi]]),Si={name:"RelativeTimeDisplay",props:{time:{type:[String,Date,Number],required:!0}},computed:{displayTime(){if(!this.time)return"";const t=new Date(this.time),e=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=a.getTime()-l.getTime(),o=Math.round(i/(1e3*60*60*24));if(o===0)return"‰ªäÂ§©";if(o===1)return"ÊòéÂ§©";if(o===2)return"ÂêéÂ§©";if(o===-1)return"Êò®Â§©";if(o===-2)return"ÂâçÂ§©";const u=l.getDay()||7,m=new Date(l);m.setDate(l.getDate()-u+1);const f=new Date(l);if(f.setDate(l.getDate()+(7-u)),a>=m&&a<=f)return["Âë®Êó•","Âë®‰∏Ä","Âë®‰∫å","Âë®‰∏â","Âë®Âõõ","Âë®‰∫î","Âë®ÂÖ≠"][t.getDay()];const h=t.getMonth()+1,x=t.getDate();return`${h}Êúà${x}Êó•`}}};function Ci(t,e,a,l,i,o){return c(),v("span",null,g(o.displayTime),1)}const It=O(Si,[["render",Ci]]),De=Ot("exam",{state:()=>({examList:[],exams:{},loadingList:!1,loadingDetails:{}}),actions:{async fetchExamList(){if(!this.loadingList){this.loadingList=!0;try{const t=await Z.loadData("es_list");Array.isArray(t)?this.examList=t:this.examList=[]}catch(t){console.error("Failed to load exam list:",t)}finally{this.loadingList=!1}}},async fetchExam(t){if(this.exams[t])return this.exams[t];if(!this.loadingDetails[t]){this.loadingDetails[t]=!0;try{const e=await Z.loadData(`es_${t}`);return e&&(this.exams[t]=e),e}catch(e){console.error(`Failed to load exam details for ${t}:`,e)}finally{this.loadingDetails[t]=!1}}},async getUpcomingExams(t=25){await this.fetchExamList();const e=[],a=new Date,l=new Date(a.getTime()+2*24*60*60*1e3),i=this.examList.slice(0,t);for(const o of i){let u=this.exams[o.id];u||(u=await this.fetchExam(o.id)),u&&u.examInfos&&Array.isArray(u.examInfos)&&u.examInfos.some(f=>{const h=new Date(f.start);return h>=a&&h<=l})&&e.push({id:o.id,...u})}return e}}}),_i={name:"ConciseExamCard",components:{RelativeTimeDisplay:It},props:{examId:{type:String,required:!0},contentStyle:{type:Object,default:()=>({})},readonly:{type:Boolean,default:!1}},computed:{...ct(De,["exams","loadingDetails"]),exam(){return this.exams[this.examId]},loading(){return this.loadingDetails[this.examId]},groupedExamInfos(){if(!this.exam||!this.exam.examInfos)return[];const t=[...this.exam.examInfos].sort((l,i)=>new Date(l.start)-new Date(i.start)),e=[];let a=null;return t.forEach(l=>{const o=new Date(l.start).toDateString();(!a||a.key!==o)&&(a={key:o,date:l.start,infos:[]},e.push(a)),a.infos.push(l)}),e}},mounted(){this.fetchExam(this.examId)},methods:{...ut(De,["fetchExam"]),formatTimeOnly(t){if(!t)return"";try{const e=new Date(t),a=e.getHours().toString().padStart(2,"0"),l=e.getMinutes().toString().padStart(2,"0");return`${a}:${l}`}catch{return""}},isPast(t){return t?new Date(t)<new Date:!1}}},Di={class:"text-truncate"},Ti={key:0,class:"d-flex justify-center align-center py-4"},Ii={key:1,class:"d-flex flex-column"},Ei={class:"text-subtitle-2 font-weight-bold text-primary mb-1"},Vi={class:"font-weight-bold mr-2",style:{"font-size":"1.1em"}},Ni={class:"font-weight-medium text-grey-darken-2",style:{"font-size":"0.85em"}},Ai={key:2,class:"text-center text-caption text-grey py-2"};function Ui(t,e,a,l,i,o){const u=It;return c(),b(_,{border:"",class:"fill-height d-flex flex-column cursor-pointer hover-elevation",elevation:"0",onClick:e[0]||(e[0]=m=>t.$emit("click"))},{default:n(()=>[s($,{class:"d-flex align-center py-2 px-3 bg-primary-lighten-5 text-subtitle-1 font-weight-bold"},{default:n(()=>{var m;return[r("span",Di,g(((m=o.exam)==null?void 0:m.examName)||"Âä†ËΩΩ‰∏≠..."),1)]}),_:1}),s(N,{class:"flex-grow-1 pa-4 overflow-y-auto",style:re(a.contentStyle)},{default:n(()=>[o.loading?(c(),v("div",Ti,[s(mt,{indeterminate:"",size:"24",color:"primary"})])):o.exam?(c(),v("div",Ii,[(c(!0),v(E,null,A(o.groupedExamInfos,(m,f)=>(c(),v("div",{key:f,class:"mb-3"},[r("div",Ei,[s(u,{time:m.date},null,8,["time"])]),(c(!0),v(E,null,A(m.infos,(h,x)=>(c(),v("div",{key:x,class:le(["d-flex align-center justify-space-between py-1 border-b-sm",{"border-none":x===m.infos.length-1,"text-grey":o.isPast(h.end)}])},[r("div",Vi,g(h.name),1),r("div",Ni,g(o.formatTimeOnly(h.start))+" - "+g(o.formatTimeOnly(h.end)),1)],2))),128))]))),128))])):(c(),v("div",Ai,"Êó†Ê≥ïÂä†ËΩΩ"))]),_:1},8,["style"])]),_:1})}const Et=O(_i,[["render",Ui],["__scopeId","data-v-33424f55"]]),zi=["6IO4","5Lmz","6JCd6I6J","5rer","5aW4"],Mi=zi.map(t=>gt.decode(t)),at=.75,Li={name:"HitokotoCard",data(){return{enabled:!1,refreshInterval:60,kvConfig:{sources:["zhaoyu"],sensitiveWords:[]},sentence:"",author:"",origin:"",loading:!1,timer:null,unwatch:null,fontSize:28}},computed:{contentStyle(){return{"font-size":`${this.fontSize*at}px`,"white-space":"pre-wrap","line-height":"1.6","text-align":"left"}},authorStyle(){return{"font-size":`${this.fontSize*at*.6}px`,"text-align":"left"}}},async mounted(){this.loadLocalSettings(),await this.loadKvSettings(),this.fetchSentence(),this.startTimer(),this.unwatch=He(()=>{this.loadLocalSettings(),this.startTimer()})},beforeUnmount(){this.stopTimer(),this.unwatch&&this.unwatch()},methods:{loadLocalSettings(){this.enabled=ze.getSetting("hitokoto.enabled"),this.refreshInterval=ze.getSetting("hitokoto.refreshInterval"),this.fontSize=ze.getSetting("font.size")},async loadKvSettings(){try{const t=await Z.loadData("sentence-info");let e=t;t&&t.data&&(e=t.data),e&&(this.kvConfig={sources:Array.isArray(e.sources)&&e.sources.length>0?e.sources:["zhaoyu"],sensitiveWords:e.sensitiveWords?e.sensitiveWords.split(/[,Ôºå]/).map(a=>a.trim()).filter(a=>a):[],jinrishiciToken:e.jinrishiciToken})}catch(t){console.error("Failed to load sentence-info",t)}},startTimer(){this.timer&&clearInterval(this.timer),this.refreshInterval>0&&(this.timer=setInterval(this.fetchSentence,this.refreshInterval*1e3))},stopTimer(){this.timer&&clearInterval(this.timer)},async fetchSentence(){if(!this.loading){this.loading=!0;try{const t=this.kvConfig.sources,e=t[Math.floor(Math.random()*t.length)];let a=null,l="",i="",o="";if(e==="hitokoto")a=(await Me.get("https://v1.hitokoto.cn/")).data,l=a.hitokoto,i=a.from_who,o=a.from;else if(e==="zhaoyu"){const u=await Me.get("https://hub.saintic.com/openservice/sentence/all.json");u.data.success&&(a=u.data.data,l=a.sentence||a.content||a.name,i=a.author,o=a.name||a.origin)}else if(e==="jinrishici")if(this.kvConfig.jinrishiciToken){const u=await Me.get("https://v2.jinrishici.com/one.json?client=npm-sdk/1.0&X-User-Token="+encodeURIComponent(this.kvConfig.jinrishiciToken),{});u.data.status==="success"&&(a=u.data.data,l=a.content,i=a.origin.author,o=a.origin.title)}else return console.warn("Jinrishici token missing. Please enable it in settings to generate a token."),this.loading=!1,this.fetchSentence();if(l){if([...Mi,...this.kvConfig.sensitiveWords].some(f=>f&&l.includes(f)))return this.loading=!1,this.fetchSentence();this.sentence=l,this.author=i||"",this.origin=o||"Êú™Áü•"}}catch(t){console.error("Failed to fetch sentence",t),this.sentence="Ëé∑ÂèñÂ§±Ë¥•",this.author="",this.origin=""}finally{this.loading=!1}}}}},Pi={key:0,class:"mr-2"},Fi={key:1};function $i(t,e,a,l,i,o){return c(),b(_,{class:"hitokoto-card",elevation:"2",border:"",rounded:"xl",loading:i.loading,height:"100%",onClick:o.fetchSentence},{default:n(()=>[s(N,{class:"pa-6 d-flex flex-column justify-center",style:{height:"100%"}},{default:n(()=>[r("div",{class:"font-weight-medium mb-4 serif-font",style:re(o.contentStyle)},g(i.sentence),5),r("div",{class:"text-medium-emphasis serif-font",style:re(o.authorStyle)},[i.author?(c(),v("span",Pi,g(i.author),1)):w("",!0),i.origin?(c(),v("span",Fi,"„Ää"+g(i.origin)+"„Äã",1)):w("",!0)],4)]),_:1})]),_:1},8,["loading","onClick"])}const Vt=O(Li,[["render",$i],["__scopeId","data-v-de957b7d"]]),Ri={name:"HomeworkGrid",components:{HitokotoCard:Vt,ConciseExamCard:Et},props:{sortedItems:{type:Array,required:!0},unusedSubjects:{type:Array,required:!0},emptySubjectDisplay:{type:String,default:"button"},isMobile:{type:Boolean,default:!1},isEditingDisabled:{type:Boolean,default:!1},contentStyle:{type:Object,default:()=>({})},highlightedCards:{type:Object,default:()=>({})}},emits:["open-dialog","open-attendance","disabled-click"],mounted(){this.resizeObserver=new ResizeObserver(()=>{this.resizeAllGridItems()}),this.$refs.gridContainer&&this.resizeObserver.observe(this.$refs.gridContainer),this.$nextTick(()=>{this.resizeAllGridItems(),this.$refs.items&&this.$refs.items.forEach(t=>{t.firstElementChild&&this.resizeObserver.observe(t.firstElementChild)})})},updated(){this.$nextTick(()=>{this.resizeAllGridItems(),this.$refs.items&&this.$refs.items.forEach(t=>{t.firstElementChild&&this.resizeObserver.observe(t.firstElementChild)})})},beforeUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{resizeGridItem(t){const e=this.$refs.gridContainer;if(!e)return;const a=parseInt(window.getComputedStyle(e).getPropertyValue("grid-auto-rows")),l=parseInt(window.getComputedStyle(e).getPropertyValue("gap")),i=t.firstElementChild;if(!i)return;const o=i.getBoundingClientRect().height,u=Math.ceil((o+l)/(a+l));t.style.gridRowEnd=`span ${u}`},resizeAllGridItems(){const t=this.$refs.items;t&&t.forEach(e=>this.resizeGridItem(e))},handleCardClick(t,e){if(this.isEditingDisabled){this.$emit("disabled-click");return}t==="attendance"?this.$emit("open-attendance"):t==="dialog"&&this.$emit("open-dialog",e)},splitPoint(t){return t.split(`
`).filter(e=>e.trim())},handleMouseMove(t){const e=t.currentTarget,a=e.getBoundingClientRect(),l=(t.clientX-a.left)/a.width*100,i=(t.clientY-a.top)/a.height*100;e.style.setProperty("--x",`${l}%`),e.style.setProperty("--y",`${i}%`)},handleTouchMove(t){if(t.touches.length===1){const e=t.touches[0],a=t.currentTarget,l=a.getBoundingClientRect(),i=(e.clientX-l.left)/l.width*100,o=(e.clientY-l.top)/l.height*100;a.style.setProperty("--x",`${i}%`),a.style.setProperty("--y",`${o}%`)}}}},Bi={ref:"gridContainer",class:"grid-masonry"},Oi=["data-key"],ji={key:0,style:{height:"100%"}},Hi={key:1,style:{height:"100%"}},Ki={class:"d-flex justify-space-between align-center mb-2"},qi={class:"text-h6"},Wi={key:0,class:"mb-2"},Gi={class:"text-error text-caption mb-1"},Qi={class:"d-flex flex-wrap",style:{gap:"4px"}},Ji={key:1,class:"mb-2"},Yi={class:"text-warning text-caption mb-1"},Xi={class:"d-flex flex-wrap",style:{gap:"4px"}},Zi={key:2,class:"mb-2"},ea={class:"text-grey text-caption mb-1"},ta={class:"d-flex flex-wrap",style:{gap:"4px"}},sa={key:3,class:"text-success text-center mt-2"},na={class:"empty-subjects mt-4"},ia={key:0,class:"d-flex flex-wrap justify-center"},aa={key:2,class:"empty-subjects-grid"};function oa(t,e,a,l,i,o){const u=Vt,m=Et;return c(),v(E,null,[r("div",Bi,[s(Fe,{name:"grid"},{default:n(()=>[(c(!0),v(E,null,A(a.sortedItems,f=>(c(),v("div",{key:f.key,ref_for:!0,ref:"items","data-key":f.key,style:re({order:f.order}),class:"grid-item"},[f.type==="hitokoto"?(c(),v("div",ji,[s(u)])):f.type==="exam"?(c(),v("div",Hi,[s(m,{"exam-id":f.data.examId,"content-style":a.contentStyle,onClick:h=>t.$emit("open-exam-detail",f.data.examId)},null,8,["exam-id","content-style","onClick"])])):f.type==="attendance"?(c(),b(_,{key:2,class:le([{"glow-highlight":a.highlightedCards[f.key],"cursor-not-allowed":a.isEditingDisabled,"cursor-pointer":!a.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:e[0]||(e[0]=h=>o.handleCardClick("attendance",null)),onMousemove:o.handleMouseMove,onTouchmove:o.handleTouchMove},{default:n(()=>[s($,{class:"d-flex align-center"},{default:n(()=>[s(D,{class:"mr-2",color:"primary",icon:"mdi-account-group"}),e[1]||(e[1]=d(" Âá∫Âã§ÁªüËÆ° ",-1))]),_:1}),s(N,null,{default:n(()=>[r("div",Ki,[e[2]||(e[2]=r("span",null,"Â∫îÂà∞/ÂÆûÂà∞",-1)),r("span",qi,g(f.data.total-f.data.exclude.length)+"/"+g(f.data.total-f.data.absent.length-f.data.late.length-f.data.exclude.length),1)]),s(ce,{class:"mb-2"}),f.data.absent.length>0?(c(),v("div",Wi,[r("div",Gi,"ËØ∑ÂÅá ("+g(f.data.absent.length)+")",1),r("div",Qi,[(c(!0),v(E,null,A(f.data.absent,h=>(c(),b(P,{key:h,color:"error",size:"x-small",variant:"flat"},{default:n(()=>[d(g(h),1)]),_:2},1024))),128))])])):w("",!0),f.data.late.length>0?(c(),v("div",Ji,[r("div",Yi,"ËøüÂà∞ ("+g(f.data.late.length)+")",1),r("div",Xi,[(c(!0),v(E,null,A(f.data.late,h=>(c(),b(P,{key:h,color:"warning",size:"x-small",variant:"flat"},{default:n(()=>[d(g(h),1)]),_:2},1024))),128))])])):w("",!0),f.data.exclude.length>0?(c(),v("div",Zi,[r("div",ea,"‰∏çÂèÇ‰∏é ("+g(f.data.exclude.length)+")",1),r("div",ta,[(c(!0),v(E,null,A(f.data.exclude,h=>(c(),b(P,{key:h,color:"grey",size:"x-small",variant:"flat"},{default:n(()=>[d(g(h),1)]),_:2},1024))),128))])])):w("",!0),f.data.absent.length===0&&f.data.late.length===0&&f.data.exclude.length===0?(c(),v("div",sa," ÂÖ®Âã§ ")):w("",!0)]),_:2},1024)]),_:2},1032,["class","onMousemove","onTouchmove"])):f.type==="custom"?(c(),b(_,{key:3,class:le([{"glow-highlight":a.highlightedCards[f.key],"cursor-not-allowed":a.isEditingDisabled,"cursor-pointer":!a.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:h=>o.handleCardClick("dialog",f.key),onMousemove:o.handleMouseMove,onTouchmove:o.handleTouchMove},{default:n(()=>[s($,{class:"text-primary"},{default:n(()=>[s(D,{class:"mr-2",icon:"mdi-card-text-outline",size:"small"}),d(" "+g(f.name),1)]),_:2},1024),s(N,{style:re(a.contentStyle)},{default:n(()=>[d(g(f.content),1)]),_:2},1032,["style"])]),_:2},1032,["class","onClick","onMousemove","onTouchmove"])):(c(),b(_,{key:4,class:le([{"glow-highlight":a.highlightedCards[f.key],"cursor-not-allowed":a.isEditingDisabled,"cursor-pointer":!a.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:h=>o.handleCardClick("dialog",f.key),onMousemove:o.handleMouseMove,onTouchmove:o.handleTouchMove},{default:n(()=>[s($,null,{default:n(()=>[d(g(f.name),1)]),_:2},1024),s(N,{style:re(a.contentStyle)},{default:n(()=>[s(pe,null,{default:n(()=>[(c(!0),v(E,null,A(o.splitPoint(f.content),h=>(c(),b(ve,{key:h},{default:n(()=>[d(g(h),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["style"])]),_:2},1032,["class","onClick","onMousemove","onTouchmove"]))],12,Oi))),128))]),_:1})],512),r("div",na,[a.isMobile?(c(),v("div",ia,[(c(!0),v(E,null,A(a.unusedSubjects,f=>(c(),b(P,{key:f.name,class:"ma-1",color:"primary",variant:"tonal",onClick:h=>o.handleCardClick("dialog",f.name)},{default:n(()=>[s(D,{start:"",size:"small"},{default:n(()=>[...e[3]||(e[3]=[d("mdi-plus",-1)])]),_:1}),d(" "+g(f.name),1)]),_:2},1032,["onClick"]))),128))])):a.emptySubjectDisplay==="button"?(c(),b(Oe,{key:1,divided:"",variant:"tonal"},{default:n(()=>[(c(!0),v(E,null,A(a.unusedSubjects,f=>(c(),b(y,{key:f.name,onClick:h=>o.handleCardClick("dialog",f.name)},{default:n(()=>[s(D,{start:""},{default:n(()=>[...e[4]||(e[4]=[d(" mdi-plus",-1)])]),_:1}),d(" "+g(f.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):(c(),v("div",aa,[s(Fe,{name:"v-list"},{default:n(()=>[(c(!0),v(E,null,A(a.unusedSubjects,f=>(c(),b(_,{key:f.name,border:"",class:"empty-subject-card",onClick:h=>o.handleCardClick("dialog",f.name)},{default:n(()=>[s($,{class:"text-subtitle-1"},{default:n(()=>[d(g(f.name),1)]),_:2},1024),s(N,{class:"text-center"},{default:n(()=>[s(D,{color:"grey",size:"small"},{default:n(()=>[...e[5]||(e[5]=[d(" mdi-plus",-1)])]),_:1}),e[6]||(e[6]=r("div",{class:"text-caption text-grey"},"ÁÇπÂáªÊ∑ªÂä†‰Ωú‰∏ö",-1))]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]))])],64)}const Nt=O(Ri,[["render",oa],["__scopeId","data-v-26d7ac70"]]),la={key:0,class:"mt-2 text-caption text-medium-emphasis"},ra={__name:"StudentNameManager",emits:["token-info-updated"],setup(t,{expose:e,emit:a}){const l=a,i=z(!1),o=z(""),u=z([]),m=z(""),f=z(!1),h=z(""),x=z(null),V=G(()=>{var T;return((T=x.value)==null?void 0:T.deviceType)==="student"}),M=G(()=>{var T;return((T=x.value)==null?void 0:T.isReadOnly)===!0}),K=G(()=>{var T;return((T=x.value)==null?void 0:T.note)||"ËÆæÁΩÆÂêçÁß∞"}),L=G(()=>!!B.value),B=G(()=>C("server.kvToken")),Q=G(()=>C("server.provider")),de=G(()=>Q.value==="kv-server"||Q.value==="classworkscloud"),ee=async()=>{if(!(!de.value||!B.value))try{const T=C("server.domain");if(!T)return;const k=await fe.get(`${T}/kv/_token`,{headers:{Authorization:`Bearer ${B.value}`}});if(x.value=k.data,x.value.deviceType!=="student")return;m.value=x.value.note||"";const F=(await fe.get(`${T}/kv/classworks-list-main`,{headers:{Authorization:`Bearer ${B.value}`}})).data.value||[];if(u.value=Array.isArray(F)?F:[],u.value.length===0)return;const R=x.value.note||"",j=u.value.some(Y=>Y.name===R);(!R||!j)&&(i.value=!0,o.value="")}catch(T){console.error("Ê£ÄÊü•Â≠¶ÁîüÂßìÂêçÁä∂ÊÄÅÂ§±Ë¥•:",T)}},J=async()=>{var T,k,I,F;if(!(!o.value||f.value)){h.value="",f.value=!0;try{const R=C("server.domain"),j=B.value;(await fe.post(`${R}/apps/tokens/${j}/set-student-name`,{name:o.value})).data.success&&(m.value=o.value,i.value=!1,await ee(),l("token-info-updated"))}catch(R){const j=(T=R==null?void 0:R.response)==null?void 0:T.status;j===400?h.value="ËØ•ÂêçÁß∞‰∏çÂú®Â≠¶ÁîüÂàóË°®‰∏≠ÔºåËØ∑ÈÄâÊã©Ê≠£Á°ÆÁöÑÂßìÂêç":j===403?h.value="Âè™ÊúâÂ≠¶ÁîüÁ±ªÂûãÁöÑ Token ÂèØ‰ª•ËÆæÁΩÆÂßìÂêç":j===404?h.value="ËÆæÂ§áÊú™ËÆæÁΩÆÂ≠¶ÁîüÂàóË°®Êàñ Token ‰∏çÂ≠òÂú®":h.value=((F=(I=(k=R==null?void 0:R.response)==null?void 0:k.data)==null?void 0:I.error)==null?void 0:F.message)||(R==null?void 0:R.message)||"ËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï"}finally{f.value=!1}}},ue=()=>{i.value=!1},S=async()=>{if(console.log("StudentNameManager.openDialog called"),console.log("isStudentToken:",V.value),console.log("studentList.length:",u.value.length),console.log("currentStudentName:",m.value),!V.value){console.log("Not a student token, cannot open dialog");return}u.value=await Z.loadData("classworks-list-main"),u.value.length===0?(console.log("Student list is empty, trying to load..."),ee().then(()=>{u.value.length>0?(o.value=m.value,i.value=!0):console.warn("Student list is still empty after reload")})):(o.value=m.value,i.value=!0,console.log("Dialog opened, showDialog:",i.value))};return Ne(B,()=>{ee()}),He(()=>{ee()}),Ne(x,()=>{l("token-info-updated")},{deep:!0}),je(()=>{ee()}),e({checkStudentNameStatus:ee,openDialog:S,currentStudentName:m,isStudentToken:V,isReadOnly:M,displayName:K,hasToken:L,tokenInfo:x}),(T,k)=>(c(),v(E,null,[s(H,{modelValue:i.value,"onUpdate:modelValue":k[1]||(k[1]=I=>i.value=I),"max-width":"500",persistent:""},{default:n(()=>[s(_,null,{default:n(()=>[s($,null,{default:n(()=>[...k[2]||(k[2]=[d("ËÆæÁΩÆÂ≠¶ÁîüÂßìÂêç",-1)])]),_:1}),s(N,null,{default:n(()=>[k[3]||(k[3]=r("div",{class:"mb-2"}," ËØ∑‰ªéÂàóË°®‰∏≠ÈÄâÊã©ÊÇ®ÁöÑÂßìÂêçÔºö ",-1)),s(Lt,{modelValue:o.value,"onUpdate:modelValue":k[0]||(k[0]=I=>o.value=I),items:u.value,clearable:"","hide-details":"","item-title":"name","item-value":"name",label:"Â≠¶ÁîüÂßìÂêç",placeholder:"ÈÄâÊã©ÊÇ®ÁöÑÂßìÂêç"},null,8,["modelValue","items"]),u.value.length>0?(c(),v("div",la," ÂÖ± "+g(u.value.length)+" ‰ΩçÂ≠¶Áîü ",1)):w("",!0),h.value?(c(),b(ye,{key:1,class:"mt-3",type:"error",variant:"tonal"},{default:n(()=>[d(g(h.value),1)]),_:1})):w("",!0)]),_:1}),s(q,null,{default:n(()=>[s(y,{variant:"text",onClick:ue},{default:n(()=>[...k[4]||(k[4]=[d(" Á®çÂêéËÆæÁΩÆ ",-1)])]),_:1}),s(U),s(y,{disabled:!o.value||f.value,loading:f.value,color:"primary",onClick:J},{default:n(()=>[...k[5]||(k[5]=[d(" Á°ÆËÆ§ ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),jt(T.$slots,"header-display",{isStudent:V.value,openDialog:S,studentName:m.value},void 0)],64))}},At=O(ra,[["__scopeId","data-v-49cb0f5f"]]),da={class:"text-center mb-6"},ua={class:"text-body-2"},ca={class:"form-section"},ma={__name:"DeviceAuthDialog",props:{showCancel:{type:Boolean,default:!1},preconfig:{type:Object,default:null}},emits:["success","cancel"],setup(t,{expose:e,emit:a}){const l=t,i=a,o=z({namespace:"",password:""}),u=z(!1),m=z("");Ne(()=>l.preconfig,h=>{h&&(console.log("Â∫îÁî®È¢ÑÈÖçÁΩÆÊï∞ÊçÆ:",h),o.value.namespace=h.namespace||"",o.value.password=h.password||"",h.autoExecute&&h.namespace?(console.log("Ê£ÄÊµãÂà∞Ëá™Âä®ÊâßË°åÊ†áÂøó‰∏îÊúâÂëΩÂêçÁ©∫Èó¥ÔºåËá™Âä®ÊâßË°åËÆ§ËØÅ"),setTimeout(()=>{f()},300)):h.namespace&&console.log("È¢ÑÈÖçÁΩÆÊï∞ÊçÆÂ∑≤Â°´ÂÖ•ÔºåÁ≠âÂæÖÊâãÂä®ËÆ§ËØÅ"))},{immediate:!0,deep:!0});const f=async()=>{var h,x,V,M,K;if(!(!o.value.namespace||u.value)){m.value="",u.value=!0;try{const L=C("server.domain");if(!L)throw new Error("Êú™ÈÖçÁΩÆÊúçÂä°Âô®ÂüüÂêç");const B=await fe.post(`${L}/apps/auth/token`,{namespace:o.value.namespace,password:o.value.password||void 0,appId:"d158067f53627d2b98babe8bffd2fd7d"});if(!B.data.success)throw new Error("ËÆæÂ§áÈ™åËØÅÂ§±Ë¥•");const Q=B.data;se("server.kvToken",Q.token),(h=Q.device)!=null&&h.uuid&&se("device.uuid",Q.device.uuid),i("success",Q)}catch(L){const B=(x=L==null?void 0:L.response)==null?void 0:x.status;B===401||B===403?m.value="ÂØÜÁ†ÅÈîôËØØÊàñÊó†ÊùÉÈôêËÆøÈóÆ":B===404?m.value="ËÆæÂ§á‰∏çÂ≠òÂú®,ËØ∑Ê£ÄÊü• namespace ÊòØÂê¶Ê≠£Á°Æ":m.value=((K=(M=(V=L==null?void 0:L.response)==null?void 0:V.data)==null?void 0:M.error)==null?void 0:K.message)||(L==null?void 0:L.message)||"ËÆ§ËØÅÂ§±Ë¥•,ËØ∑Á®çÂêéÈáçËØï"}finally{u.value=!1}}};return e({reset:()=>{o.value={namespace:"",password:""},m.value=""}}),(h,x)=>(c(),b(_,{class:"auth-card"},{default:n(()=>[s(N,{class:"pa-8"},{default:n(()=>[r("div",da,[s(D,{class:"mb-4",color:"success",size:"80"},{default:n(()=>[...x[4]||(x[4]=[d(" mdi-account-key ",-1)])]),_:1}),x[5]||(x[5]=r("h2",{class:"text-h4 mb-3"}," ËÆæÂ§áËÆ§ËØÅ ",-1)),x[6]||(x[6]=r("p",{class:"text-body-1 text-medium-emphasis"}," ËæìÂÖ•‰Ω†Âú® Classworks KV Ëé∑ÂèñÁöÑËÆ§ËØÅ‰ø°ÊÅØ ",-1))]),s(_,{class:"pa-4 mb-6",color:"info",variant:"tonal"},{default:n(()=>[r("div",ua,[s(D,{class:"mr-2",size:"20"},{default:n(()=>[...x[7]||(x[7]=[d(" mdi-information ",-1)])]),_:1}),x[8]||(x[8]=d(" ÂØπ‰∫éÂ∑≤ÊúâUUIDÁöÑÁî®Êà∑ÔºåÊÇ®Â∫îÂΩì‰ΩøÁî®UUID‰∏éÊÇ®ÁöÑÂØÜÁ†ÅÁôªÂΩï„ÄÇ ",-1))])]),_:1}),r("div",ca,[s(xe,{modelValue:o.value.namespace,"onUpdate:modelValue":x[0]||(x[0]=V=>o.value.namespace=V),class:"mb-4","hide-details":"auto",label:"ÂëΩÂêçÁ©∫Èó¥","prepend-inner-icon":"mdi-identifier",variant:"outlined"},null,8,["modelValue"]),s(xe,{modelValue:o.value.password,"onUpdate:modelValue":x[1]||(x[1]=V=>o.value.password=V),label:"ËÆ§ËØÅÁ†Å","prepend-inner-icon":"mdi-lock-outline",type:"text",variant:"outlined"},null,8,["modelValue"]),m.value?(c(),b(ye,{key:0,class:"mt-4",closable:"",type:"error",variant:"tonal","onClick:close":x[2]||(x[2]=V=>m.value="")},{default:n(()=>[d(g(m.value),1)]),_:1})):w("",!0)])]),_:1}),s(q,{class:"pa-6 pt-0"},{default:n(()=>[t.showCancel?(c(),b(y,{key:0,size:"large",variant:"text",onClick:x[3]||(x[3]=V=>h.$emit("cancel"))},{default:n(()=>[...x[9]||(x[9]=[d(" ÂèñÊ∂à ",-1)])]),_:1})):w("",!0),s(U),s(y,{disabled:!o.value.namespace||u.value,loading:u.value,class:"px-8",color:"primary",size:"x-large",variant:"elevated",onClick:f},{default:n(()=>[s(D,{size:"24",start:""},{default:n(()=>[...x[10]||(x[10]=[d(" mdi-login ",-1)])]),_:1}),x[11]||(x[11]=r("span",{class:"text-h6"},"ËÆ§ËØÅÂπ∂ÁôªÂΩï",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}},fa=O(ma,[["__scopeId","data-v-9e8d02e4"]]),ha={__name:"TokenInputDialog",props:{showCancel:{type:Boolean,default:!1}},emits:["success","cancel"],setup(t,{expose:e,emit:a}){const l=a,i=z(""),o=z(!1),u=z(""),m=async()=>{var f,h,x;if(!(!i.value||o.value)){u.value="",o.value=!0;try{const V=C("server.domain");if(!V)throw new Error("Êú™ÈÖçÁΩÆÊúçÂä°Âô®ÂüüÂêç");await fe.get(`${V}/kv/_info`,{headers:{Accept:"application/json","x-app-token":i.value}}),se("server.kvToken",i.value),l("success")}catch(V){const M=(f=V==null?void 0:V.response)==null?void 0:f.status;M===401||M===403?u.value="Token Êó†ÊïàÊàñÊó†ÊùÉÈôê,ËØ∑Á°ÆËÆ§ÂêéÈáçËØï":M===404?u.value="ÂëΩÂêçÁ©∫Èó¥‰∏çÂ≠òÂú®ÊàñÊúçÂä°Âô®Êú™Â∞±Áª™":u.value=((x=(h=V==null?void 0:V.response)==null?void 0:h.data)==null?void 0:x.message)||(V==null?void 0:V.message)||"È™åËØÅÂ§±Ë¥•,ËØ∑Á®çÂêéÈáçËØï"}finally{o.value=!1}}};return e({reset:()=>{i.value="",u.value=""}}),(f,h)=>(c(),b(_,null,{default:n(()=>[s($,null,{default:n(()=>[...h[2]||(h[2]=[d("ËæìÂÖ•ÊéàÊùÉ Token",-1)])]),_:1}),s(N,null,{default:n(()=>[s(xe,{modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=x=>i.value=x),clearable:"",density:"comfortable","hide-details":"auto",label:"KV ÊéàÊùÉ Token",placeholder:"Á≤òË¥¥‰ªéÊéàÊùÉÈ°µÈù¢Ëé∑ÂèñÁöÑ Token",variant:"outlined"},null,8,["modelValue"]),u.value?(c(),b(ye,{key:0,class:"mt-3",type:"error",variant:"tonal"},{default:n(()=>[d(g(u.value),1)]),_:1})):w("",!0)]),_:1}),s(q,null,{default:n(()=>[s(U),t.showCancel?(c(),b(y,{key:0,variant:"text",onClick:h[1]||(h[1]=x=>f.$emit("cancel"))},{default:n(()=>[...h[3]||(h[3]=[d(" ÂèñÊ∂à ",-1)])]),_:1})):w("",!0),s(y,{disabled:!i.value||o.value,loading:o.value,color:"primary",onClick:m},{default:n(()=>[...h[4]||(h[4]=[d(" ‰øùÂ≠ò Token ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}},ga={__name:"AlternativeCodeDialog",props:{showCancel:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{expose:e,emit:a}){const l=a,i=z(""),o=()=>{i.value&&l("submit",i.value)};return e({reset:()=>{i.value=""}}),(u,m)=>(c(),b(_,null,{default:n(()=>[s($,null,{default:n(()=>[...m[2]||(m[2]=[d("ËæìÂÖ•Êõø‰ª£‰ª£Á†Å",-1)])]),_:1}),s(N,null,{default:n(()=>[s(_e,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=f=>i.value=f),density:"comfortable","hide-details":"auto",label:"Êõø‰ª£‰ª£Á†Å",placeholder:"ËØ∑ËæìÂÖ•Êõø‰ª£‰ª£Á†Å",rows:"5",variant:"outlined"},null,8,["modelValue"]),s(ye,{class:"mt-3",type:"info",variant:"tonal"},{default:n(()=>[...m[3]||(m[3]=[d(" Êõø‰ª£‰ª£Á†ÅÂäüËÉΩÊöÇÊú™ÂÆûÁé∞ÔºåÊï¨ËØ∑ÊúüÂæÖ ",-1)])]),_:1})]),_:1}),s(q,null,{default:n(()=>[s(U),t.showCancel?(c(),b(y,{key:0,variant:"text",onClick:m[1]||(m[1]=f=>u.$emit("cancel"))},{default:n(()=>[...m[4]||(m[4]=[d(" ÂèñÊ∂à ",-1)])]),_:1})):w("",!0),s(y,{disabled:!i.value,color:"primary",onClick:o},{default:n(()=>[...m[5]||(m[5]=[d(" Êèê‰∫§ ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}))}},W=[];for(let t=0;t<256;++t)W.push((t+256).toString(16).slice(1));function pa(t,e=0){return(W[t[e+0]]+W[t[e+1]]+W[t[e+2]]+W[t[e+3]]+"-"+W[t[e+4]]+W[t[e+5]]+"-"+W[t[e+6]]+W[t[e+7]]+"-"+W[t[e+8]]+W[t[e+9]]+"-"+W[t[e+10]]+W[t[e+11]]+W[t[e+12]]+W[t[e+13]]+W[t[e+14]]+W[t[e+15]]).toLowerCase()}let Le;const va=new Uint8Array(16);function ya(){if(!Le){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Le=crypto.getRandomValues.bind(crypto)}return Le(va)}const ka=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ot={randomUUID:ka};function xa(t,e,a){var i;t=t||{};const l=t.random??((i=t.rng)==null?void 0:i.call(t))??ya();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,pa(l)}function ba(t,e,a){return ot.randomUUID&&!t?ot.randomUUID():xa(t)}const wa={class:"step-content"},Sa={class:"text-center mb-6"},Ca={class:"step-content"},_a={class:"relationship-diagram"},Da={class:"diagram-item"},Ta={class:"text-center"},Ia={class:"diagram-description mt-3"},Ea={class:"diagram-connector"},Va={class:"diagram-item"},Na={class:"text-center"},Aa={class:"diagram-description mt-3"},Ua={class:"step-content"},za={class:"button-group"},Ma={class:"d-flex flex-column align-center py-2"},La={class:"d-flex flex-column align-center py-2"},Pa={class:"step-content"},Fa={class:"text-center mb-6"},$a={class:"step-content"},Ra={class:"text-center mb-6"},Ba={class:"d-flex flex-column flex-sm-row align-center"},Oa={class:"flex-grow-1"},ja={class:"text-h6 font-weight-bold"},Ha={class:"text-h5 mb-6"},Ka={class:"text-subtitle-2"},qa={class:"d-flex align-center"},Wa={class:"d-flex align-center"},Ga={class:"step-content"},Qa={class:"text-center mb-6"},Ja={class:"d-flex align-center mb-3"},Ya={class:"text-h6 font-weight-medium"},Xa={key:0,class:"text-body-2 mb-2"},Za={class:"mb-2"},eo={class:"device-code"},to={key:1,class:"text-body-2 text-error"},so={class:"log-box"},no={key:0,class:"text-caption text-medium-emphasis"},io={class:"d-flex flex-wrap gap-2 mt-4"},Ie=5,ao={__name:"FirstTimeGuide",emits:["close","success"],setup(t,{emit:e}){const a=e,l=C("server.authDomain"),i=z(1),o=z(""),u=z("idle"),m=z(""),f=z(null),h=z(null),x=z([]),V=z({1:!1,2:!1,3:!1,4:!1}),M=()=>{i.value<Ie&&i.value++},K=()=>{i.value>1&&i.value--},L=Y=>{o.value=Y,M()},B=()=>{a("close")},Q=()=>{window.open(l,"_blank")},de=()=>{i.value=5},ee=G(()=>Object.values(V.value).filter(Boolean).length/4*100),J=G(()=>u.value==="success"?"success":u.value==="error"?"error":"primary"),ue=G(()=>u.value==="success"?"mdi-check-circle":u.value==="error"?"mdi-alert-circle":u.value==="registering"?"mdi-progress-clock":"mdi-rocket-launch"),S=G(()=>u.value==="success"?"ÂÆåÊàêÔºÅËÆæÂ§áÂ∑≤ÂàõÂª∫":u.value==="error"?"ÂàõÂª∫Â§±Ë¥•":u.value==="registering"?"Ê≠£Âú®ÊâßË°å‚Ä¶":"ÂáÜÂ§áÂºÄÂßã"),T=Y=>{const p=new Date,ne=String(p.getHours()).padStart(2,"0"),ie=String(p.getMinutes()).padStart(2,"0"),Te=String(p.getSeconds()).padStart(2,"0");x.value.push({time:`${ne}:${ie}:${Te}`,message:Y})},k=()=>"Classworks",I=async()=>{var Y,p,ne;if(u.value!=="registering"){u.value="registering",m.value="",x.value=[],V.value={1:!1,2:!1,3:!1,4:!1};try{T("Ê≠£Âú®ÁîüÊàêËÆæÂ§á‰ø°ÊÅØ‚Ä¶");const ie=ba(),Te=k(),qe=C("server.domain");V.value[1]=!0,T("ÂêëÊúçÂä°Âô®Ê≥®ÂÜåËÆæÂ§á‚Ä¶");const zt=await fe.post(`${qe}/devices`,{uuid:ie,deviceName:Te});V.value[2]=!0,f.value={uuid:ie,deviceName:Te,createdAt:new Date().toISOString(),registered:!0},localStorage.setItem("Classworks_progressive_device",JSON.stringify(f.value)),T("Ëé∑ÂèñËÆøÈóÆ‰ª§Áâå‚Ä¶");try{const me=await fe.post(`${qe}/apps/auth/token`,{namespace:ie,password:"",appId:"d158067f53627d2b98babe8bffd2fd7d"});me.data&&me.data.token?(h.value=me.data,se("server.kvToken",me.data.token),(Y=me.data.device)!=null&&Y.uuid&&se("device.uuid",me.data.device.uuid),T("Â∑≤Ëé∑Âèñ Token Âπ∂ÂÜôÂÖ•ÈÖçÁΩÆ")):T("Êú™ËøîÂõû TokenÔºåÊÇ®ÂèØ‰ª•Á®çÂêéÂú®ÊéàÊùÉÈ°µÂÆåÊàêÈÖçÁΩÆ")}catch(me){console.warn("Ëá™Âä®Ëé∑Âèñ Token Â§±Ë¥•:",me),T("Ëá™Âä®Ëé∑Âèñ Token Â§±Ë¥•ÔºåÂèØÂú®ÊéàÊùÉÈ°µÊâãÂä®ÂÆåÊàê")}V.value[3]=!0,T("ÂÆåÊàêÔºÅÊÇ®ÂèØ‰ª•Â∫îÁî®‰ª§ÁâåÊàñÂâçÂæÄÊéàÊùÉÈ°µÈù¢ÁªßÁª≠ÈÖçÁΩÆ"),V.value[4]=!0,u.value="success"}catch(ie){console.error("ËÆæÂ§áÊ≥®ÂÜåÂ§±Ë¥•:",ie),m.value=((ne=(p=ie.response)==null?void 0:p.data)==null?void 0:ne.message)||ie.message||"ÁΩëÁªúËøûÊé•Â§±Ë¥•",T("Â§±Ë¥•Ôºö"+m.value),u.value="error"}}},F=()=>{u.value="idle",m.value="",x.value=[],V.value={1:!1,2:!1,3:!1,4:!1}},R=()=>{const Y=f.value;if(!(Y!=null&&Y.uuid))return;const ne=`${C("server.authDomain")}/?uuid=${encodeURIComponent(Y.uuid)}&tolinktoaccount=true`;window.open(ne,"_blank")},j=()=>{h.value&&a("success",h.value),a("close")};return(Y,p)=>(c(),b(_,{class:"guide-card"},{default:n(()=>[s(Qe,{"model-value":i.value/Ie*100,color:"primary",height:"6"},null,8,["model-value"]),s(N,{class:"pa-8"},{default:n(()=>[te(r("div",wa,[r("div",Sa,[s(D,{class:"mb-4",color:"primary",size:"80"},{default:n(()=>[...p[2]||(p[2]=[d(" mdi-hand-wave ",-1)])]),_:1}),p[3]||(p[3]=r("h2",{class:"text-h4 mb-3"}," Ê¨¢Ëøé‰ΩøÁî® Classworks ",-1)),p[4]||(p[4]=r("p",{class:"text-body-1 text-medium-emphasis"}," ÈÄÇÁî®‰∫éÁè≠Á∫ßÂ§ßÂ±èÁöÑ‰Ωú‰∏öÊùøÂ∞èÂ∑•ÂÖ∑ ",-1))])],512),[[he,i.value===1]]),te(r("div",Ca,[p[17]||(p[17]=r("h3",{class:"text-h5 mb-6 text-center"}," Classworks Âíå Classworks KV ÁöÑÂÖ≥Á≥ª ",-1)),s(_,{class:"pa-6 mb-6",color:"primary",variant:"tonal"},{default:n(()=>[r("div",_a,[r("div",Da,[s(_,{class:"pa-4",color:"blue-darken-1",elevation:"8"},{default:n(()=>[r("div",Ta,[s(D,{color:"white",size:"60"},{default:n(()=>[...p[5]||(p[5]=[d(" mdi-laptop ",-1)])]),_:1}),p[6]||(p[6]=r("h4",{class:"text-h6 text-white mt-2"}," Classworks ",-1)),p[7]||(p[7]=r("p",{class:"text-caption text-white mt-1"}," ‰Ωú‰∏öÊùøÂ∫îÁî® ",-1))])]),_:1}),r("div",Ia,[s(P,{class:"mb-2",color:"blue",size:"small",variant:"flat"},{default:n(()=>[...p[8]||(p[8]=[d(" ÂâçÁ´ØÂ∫îÁî® ",-1)])]),_:1}),p[9]||(p[9]=r("div",{class:"text-body-2"},[d(" ‚Ä¢ ÊòæÁ§∫‰Ωú‰∏öÂÜÖÂÆπ"),r("br"),d(" ‚Ä¢ ÁÆ°ÁêÜÁè≠Á∫ß‰ø°ÊÅØ"),r("br"),d(" ‚Ä¢ Êèê‰æõÁî®Êà∑ÁïåÈù¢ ")],-1))])]),r("div",Ea,[s(D,{color:"primary",size:"40"},{default:n(()=>[...p[10]||(p[10]=[d(" mdi-swap-horizontal ",-1)])]),_:1}),p[11]||(p[11]=r("div",{class:"text-caption font-weight-bold mt-2"}," Êï∞ÊçÆÂêåÊ≠• ",-1))]),r("div",Va,[s(_,{class:"pa-4",color:"green-darken-1",elevation:"8"},{default:n(()=>[r("div",Na,[s(D,{color:"white",size:"60"},{default:n(()=>[...p[12]||(p[12]=[d(" mdi-cloud-sync ",-1)])]),_:1}),p[13]||(p[13]=r("h4",{class:"text-h6 text-white mt-2"}," Classworks KV ",-1)),p[14]||(p[14]=r("p",{class:"text-caption text-white mt-1"}," ‰∫ëÁ´ØÊï∞ÊçÆÂ∫ì ",-1))])]),_:1}),r("div",Aa,[s(P,{class:"mb-2",color:"green",size:"small",variant:"flat"},{default:n(()=>[...p[15]||(p[15]=[d(" ÂêéÁ´ØÊúçÂä° ",-1)])]),_:1}),p[16]||(p[16]=r("div",{class:"text-body-2"},[d(" ‚Ä¢ Â≠òÂÇ®‰Ωú‰∏öÊï∞ÊçÆ"),r("br"),d(" ‚Ä¢ Â§öËÆæÂ§áÂêåÊ≠•"),r("br"),d(" ‚Ä¢ ÊùÉÈôêÁÆ°ÁêÜ ")],-1))])])])]),_:1})],512),[[he,i.value===2]]),te(r("div",Ua,[p[25]||(p[25]=r("h3",{class:"text-h5 mb-6 text-center"}," ‰Ω†ÈúÄË¶ÅÂú®Â§ö‰∏™ËÆæÂ§á‰∏äÊü•Áúã‰Ωú‰∏öÂêóÔºü ",-1)),s(_,{class:"mb-6 pa-4",color:"info",variant:"tonal"},{default:n(()=>[...p[18]||(p[18]=[r("div",{class:"text-body-2"}," ÊØîÂ¶ÇÔºöÂú®ÂÆ∂ÈáåÁîµËÑë„ÄÅÊâãÊú∫‰∏äÊü•ÁúãÔºåÊàñËÄÖÂ§ö‰∏™ÊïôÂÆ§ËÆæÂ§áÂÖ±‰∫´Êï∞ÊçÆ ",-1)])]),_:1}),r("div",za,[s(y,{block:"",class:"mb-4 py-6",color:"primary",size:"x-large",variant:"elevated",onClick:p[0]||(p[0]=ne=>L("cloud"))},{default:n(()=>[r("div",Ma,[s(D,{class:"mb-2",size:"40"},{default:n(()=>[...p[19]||(p[19]=[d(" mdi-cloud-check ",-1)])]),_:1}),p[20]||(p[20]=r("span",{class:"text-h6"},"ÈúÄË¶ÅÔºå‰ΩøÁî®‰∫ëÂêåÊ≠•",-1)),p[21]||(p[21]=r("span",{class:"text-caption mt-1"},"Â§öËÆæÂ§áËÆøÈóÆ",-1))])]),_:1}),s(y,{block:"",class:"py-6",size:"x-large",variant:"outlined",onClick:p[1]||(p[1]=ne=>L("local"))},{default:n(()=>[r("div",La,[s(D,{class:"mb-2",size:"40"},{default:n(()=>[...p[22]||(p[22]=[d(" mdi-laptop ",-1)])]),_:1}),p[23]||(p[23]=r("span",{class:"text-h6"},"‰∏çÈúÄË¶ÅÔºåÂè™Áî®ËøôÂè∞ËÆæÂ§á",-1)),p[24]||(p[24]=r("span",{class:"text-caption mt-1"},"Êú¨Âú∞Â≠òÂÇ®",-1))])]),_:1})])],512),[[he,i.value===3]]),te(r("div",Pa,[r("div",Fa,[s(D,{class:"mb-4",color:"success",size:"80"},{default:n(()=>[...p[26]||(p[26]=[d(" mdi-check-circle ",-1)])]),_:1}),p[28]||(p[28]=r("h3",{class:"text-h5 mb-4"}," ÊÇ®ÂèØ‰ª•‰ΩøÁî®Êú¨Âú∞Ê®°Âºè ",-1)),s(_,{class:"pa-4 text-left",variant:"tonal"},{default:n(()=>[...p[27]||(p[27]=[r("div",{class:"text-body-1 mb-2"}," Ê≠§Êï∞ÊçÆÂ∞ÜÂ≠òÂÇ®Âú®ÊÇ®ÁöÑÊµèËßàÂô®‰∏≠ÔºåÂ¶ÇÊûúÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅIndexedDBÔºåÂèØËÉΩ‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇÂ¶ÇÊûúÊÇ®ÁªèÂ∏∏Ê∏ÖÈô§ÊµèËßàÂô®Êï∞ÊçÆÔºåËØ∑Ë∞®ÊÖé‰ΩøÁî®Êú¨Âú∞Ê®°Âºè„ÄÇ ",-1),r("div",{class:"text-body-1 mb-2"}," Âú®ÂàöÊâçÂú∞ÊñπÁÇπÂáª‰ΩøÁî®Êú¨Âú∞Ê®°ÂºèÁöÑÊåâÈíÆ‰ΩøÁî®„ÄÇ ",-1)])]),_:1})])],512),[[he,i.value===4&&o.value==="local"]]),te(r("div",$a,[r("div",Ra,[s(D,{class:"mb-4",color:"primary",size:"80"},{default:n(()=>[...p[29]||(p[29]=[d(" mdi-cloud-cog ",-1)])]),_:1}),p[30]||(p[30]=r("h3",{class:"text-h5 mb-4"}," ÈúÄË¶ÅÂÖàËÆæÁΩÆ‰∫ëÁ´ØË¥¶Âè∑ ",-1))]),s(_,{class:"pa-6 mb-6",variant:"tonal"},{default:n(()=>[r("div",Ba,[r("div",Oa,[p[32]||(p[32]=r("h4",{class:"text-h6 font-weight-bold mb-2"}," Ëá™Âä®Ê≥®ÂÜåËÆæÂ§á ",-1)),p[33]||(p[33]=r("p",{class:"text-body-2 mb-3 text-medium-emphasis"}," ÈÄöËøáÂºïÂØºÂºèÊµÅÁ®ãËá™Âä®ÂàõÂª∫ËÆæÂ§á„ÄÅËé∑Âèñ‰ª§ÁâåÂπ∂ÂÆåÊàêÂàùÂßãÂåñ„ÄÇÈÄÇÂêàÈ¶ñÊ¨°‰ΩìÈ™åÊàñÂø´ÈÄüÈÉ®ÁΩ≤Â§öÁªàÁ´Ø„ÄÇ ",-1)),s(y,{color:"primary","prepend-icon":"mdi-flash",size:"large",variant:"elevated",onClick:de},{default:n(()=>[...p[31]||(p[31]=[d(" Ëá™Âä®Ê≥®ÂÜå ",-1)])]),_:1})])])]),_:1}),p[41]||(p[41]=r("div",{class:"mb-6"}," ‰πüÂèØ‰ª•ÊâãÂä®ÂâçÂæÄ Classworks KV ÊéßÂà∂Âè∞Ëé∑ÂèñËÆ§ËØÅ‰ø°ÊÅØÔºö ",-1)),s(_,{color:be(l)=="https://kv.houlang.cloud"?"primary":"error",variant:be(l)=="https://kv.houlang.cloud"?"elevated":"outlined",class:"pa-6 mb-6",onClick:Q},{default:n(()=>[s(D,{class:"mb-3",size:"48"},{default:n(()=>[...p[34]||(p[34]=[d(" mdi-open-in-new ",-1)])]),_:1}),r("h4",ja," ËØ∑ËÆøÈóÆ "+g(be(l)=="https://kv.houlang.cloud"?"Classworks KV":"Ëá™ÂÆö‰πâÁöÑ Classworks KV ÂÆû‰æã ")+" ÊéßÂà∂Âè∞ ",1),r("div",Ha,g(be(l)),1),r("h6",Ka,g(be(l)=="https://kv.houlang.cloud"?"Ê≠§ÂÆû‰æãÁî± Classworks KV ÂÆòÊñπÊèê‰æõ":"Ê≠§ÈìæÊé•Áî±ÊÇ®ÁöÑÂÆû‰æã„ÄÅÈ¢ÑÈÖç‰ª£Á†ÅÊàñÁÆ°ÁêÜÂëòÁÆ°ÁêÜÔºåÂΩìÂâçÂèØËÉΩ‰∏çÊòØ Classworks KV ÂÆòÊñπÁöÑÂÆû‰æãÂú∞ÂùÄ„ÄÇ"),1)]),_:1},8,["color","variant"]),s(ss,{class:"mt-6",variant:"accordion"},{default:n(()=>[s(st,null,{default:n(()=>[s(nt,null,{default:n(()=>[r("div",qa,[s(D,{class:"mr-3",color:"warning"},{default:n(()=>[...p[35]||(p[35]=[d(" mdi-help-circle ",-1)])]),_:1}),p[36]||(p[36]=r("span",{class:"text-subtitle-1 font-weight-medium"},"Êàë‰ª•ÂâçÂ∑≤Áªè‰ΩøÁî®Ëøá Classworks KVÔºü",-1))])]),_:1}),s(it,null,{default:n(()=>[s(_,{class:"pa-4",color:"success",variant:"tonal"},{default:n(()=>[...p[37]||(p[37]=[r("div",{class:"text-body-2 mb-2"},[d(" Â¶ÇÊûúÊÇ®‰πãÂâçÂ∑≤Áªè‰ΩøÁî®Ëøá Classworks KVÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÊÇ®ÁöÑ "),r("strong",null,"UUIDÔºàÂëΩÂêçÁ©∫Èó¥Ôºâ"),d(" Âíå "),r("strong",null,"ËÆæÁΩÆÁöÑÂØÜÁ†Å"),d(" ËøõË°åËÆ§ËØÅ„ÄÇ ")],-1),r("div",{class:"text-body-2"},' ËøîÂõû‰∏ä‰∏ÄÈ°µÔºåÁÇπÂáª"Â∑≤Ê≥®ÂÜå"ÊåâÈíÆÔºåËæìÂÖ•ÊÇ®ÁöÑËÆ§ËØÅ‰ø°ÊÅØÂç≥ÂèØÁôªÂΩï„ÄÇ ',-1)])]),_:1})]),_:1})]),_:1}),s(st,null,{default:n(()=>[s(nt,null,{default:n(()=>[r("div",Wa,[s(D,{class:"mr-3",color:"info"},{default:n(()=>[...p[38]||(p[38]=[d(" mdi-help-circle ",-1)])]),_:1}),p[39]||(p[39]=r("span",{class:"text-subtitle-1 font-weight-medium"},"ÊàëÂ¶Ç‰ΩïÈÖçÁΩÆ‰∏çÂêåÁ±ªÂûãÁöÑËÆæÂ§áÔºü",-1))])]),_:1}),s(it,null,{default:n(()=>[s(_,{class:"pa-4",color:"info",variant:"tonal"},{default:n(()=>[...p[40]||(p[40]=[r("div",{class:"text-body-2 mb-2"},[d(" ‰∏çÂêåÁöÑÂØÜÁ†ÅÂØπÂ∫î‰∏çÂêåÁöÑËÆæÂ§áÁ±ªÂûãÔºåËøôÂ∞ÜÁî± "),r("strong",null,"ÁÆ°ÁêÜÂëòÁÆ°ÁêÜ"),d("„ÄÇ ")],-1),r("div",{class:"text-body-2 mb-2"}," ‰æãÂ¶ÇÔºö ",-1),r("ul",{class:"text-body-2 ml-4"},[r("li",{class:"mb-1"}," Áè≠Á∫ßÂ§ßÂ±è‰ΩøÁî®‰∏Ä‰∏™ÂØÜÁ†Å "),r("li",{class:"mb-1"}," ÊïôÂ∏àËÆæÂ§á‰ΩøÁî®Âè¶‰∏Ä‰∏™ÂØÜÁ†Å "),r("li",null,"Â≠¶ÁîüËÆæÂ§á‰ΩøÁî®‰∏çÂêåÁöÑÂØÜÁ†Å")],-1),r("div",{class:"text-body-2 mt-3"}," ËØ∑ËÅîÁ≥ªÊÇ®ÁöÑÁÆ°ÁêÜÂëòËé∑ÂèñÂØπÂ∫îËÆæÂ§áÁ±ªÂûãÁöÑÂØÜÁ†Å„ÄÇ ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[he,i.value===4&&o.value==="cloud"]]),te(r("div",Ga,[r("div",Qa,[s(ke,{class:"mb-4",color:"primary",size:"80",variant:"tonal"},{default:n(()=>[s(D,{size:"48"},{default:n(()=>[...p[42]||(p[42]=[d(" mdi-rocket-launch ",-1)])]),_:1})]),_:1}),p[43]||(p[43]=r("h3",{class:"text-h5 font-weight-bold mb-2"}," Ê∏êËøõÂºèÊ≥®ÂÜå ",-1)),p[44]||(p[44]=r("p",{class:"text-body-2 text-medium-emphasis"}," ÊÇ®ÂèØ‰ª•ÊöÇÊó∂‰∏çÈÖçÁΩÆ Classworks KV ",-1))]),s(Qe,{"model-value":ee.value,class:"mb-6",color:"primary",height:"8",rounded:""},null,8,["model-value"]),s(ae,null,{default:n(()=>[s(X,{cols:"12"},{default:n(()=>[s(_,{color:J.value,variant:"tonal"},{default:n(()=>[s(Se,null,{default:n(()=>[r("div",Ja,[s(D,{color:J.value,class:"mr-2",size:"32"},{default:n(()=>[d(g(ue.value),1)]),_:1},8,["color"]),r("div",Ya,g(S.value),1)]),f.value?(c(),v("div",Xa,[r("div",Za,[p[45]||(p[45]=r("strong",null,"ËÆæÂ§áÂêçÁß∞Ôºö",-1)),d(g(f.value.deviceName),1)]),r("div",null,[p[46]||(p[46]=r("strong",null,"ËÆæÂ§á UUIDÔºö",-1)),r("code",eo,g(f.value.uuid),1)])])):w("",!0),u.value==="error"?(c(),v("div",to,g(m.value),1)):w("",!0)]),_:1})]),_:1},8,["color"])]),_:1}),s(X,{cols:"12"},{default:n(()=>[s(_,{variant:"outlined"},{default:n(()=>[s(Se,null,{default:n(()=>[p[47]||(p[47]=r("div",{class:"text-subtitle-2 font-weight-medium mb-3"}," ËøáÁ®ãÊó•Âøó ",-1)),r("div",so,[(c(!0),v(E,null,A(x.value,(ne,ie)=>(c(),v("div",{key:ie,class:"text-caption log-line"},g(ne.time)+" ¬∑ "+g(ne.message),1))),128)),x.value.length?w("",!0):(c(),v("div",no," Á≠âÂæÖÂºÄÂßã‚Ä¶ "))])]),_:1})]),_:1})]),_:1})]),_:1}),r("div",io,[u.value==="idle"?(c(),b(y,{key:0,color:"primary","prepend-icon":"mdi-play",size:"large",onClick:I},{default:n(()=>[...p[48]||(p[48]=[d(" ÂºÄÂßãÂàõÂª∫ ",-1)])]),_:1})):w("",!0),u.value==="error"?(c(),b(y,{key:1,color:"error","prepend-icon":"mdi-refresh",variant:"outlined",onClick:F},{default:n(()=>[...p[49]||(p[49]=[d(" ÈáçËØï ",-1)])]),_:1})):w("",!0),u.value==="registering"?(c(),b(y,{key:2,loading:!0,color:"primary","prepend-icon":"mdi-progress-clock",variant:"tonal"},{default:n(()=>[...p[50]||(p[50]=[d(" Ê≠£Âú®ÊâßË°å‚Ä¶ ",-1)])]),_:1})):w("",!0),u.value==="success"?(c(),b(y,{key:3,color:"success","prepend-icon":"mdi-check-circle",size:"large",variant:"elevated",onClick:j},{default:n(()=>[...p[51]||(p[51]=[d(" Â∫îÁî®‰ª§ÁâåÂπ∂ÂÖ≥Èó≠ ",-1)])]),_:1})):w("",!0),u.value==="success"?(c(),b(y,{key:4,color:"primary","prepend-icon":"mdi-open-in-new",size:"large",variant:"outlined",onClick:R},{default:n(()=>[...p[52]||(p[52]=[d(" ÂâçÂæÄÁªëÂÆöË¥¶Êà∑ ",-1)])]),_:1})):w("",!0)])],512),[[he,i.value===5]])]),_:1}),s(q,{class:"pa-6 pt-0"},{default:n(()=>[i.value>1?(c(),b(y,{key:0,size:"large",variant:"text",onClick:K},{default:n(()=>[s(D,{start:""},{default:n(()=>[...p[53]||(p[53]=[d(" mdi-chevron-left ",-1)])]),_:1}),p[54]||(p[54]=d(" ‰∏ä‰∏ÄÊ≠• ",-1))]),_:1})):w("",!0),s(U),i.value<Ie&&i.value!==4?(c(),b(y,{key:1,disabled:i.value===3&&!o.value,color:"primary",size:"large",variant:"elevated",onClick:M},{default:n(()=>[p[56]||(p[56]=d(" ‰∏ã‰∏ÄÊ≠• ",-1)),s(D,{end:""},{default:n(()=>[...p[55]||(p[55]=[d(" mdi-chevron-right ",-1)])]),_:1})]),_:1},8,["disabled"])):w("",!0),i.value===Ie||i.value===4?(c(),b(y,{key:2,color:"primary",size:"large",variant:"elevated",onClick:B},{default:n(()=>[...p[57]||(p[57]=[d(" ÂÖ≥Èó≠ ",-1)])]),_:1})):w("",!0)]),_:1})]),_:1}))}},oo=O(ao,[["__scopeId","data-v-817c6e0e"]]),lo={key:0,class:"init-overlay"},ro={class:"init-container"},uo={class:"main-card-row"},co={class:"card-horizontal-layout"},mo={class:"card-icon-wrapper"},fo={class:"card-horizontal-layout"},ho={class:"card-icon-wrapper"},go={class:"card-horizontal-layout"},po={class:"card-icon-wrapper"},vo={class:"options-buttons"},yo={__name:"InitServiceChooser",props:{preconfig:{type:Object,default:()=>({namespace:null,authCode:null,autoOpen:!1,autoExecute:!1})}},emits:["done"],setup(t,{emit:e}){const a=t,l=e,i=z(!1),o=z(!1),u=z(!1),m=z(!1),f=z(!1),h=z(null),x=G(()=>C("server.provider")),V=G(()=>x.value==="kv-server"||x.value==="classworkscloud"),M=G(()=>C("server.kvToken")),K=G(()=>{var T;return(T=a.preconfig)!=null&&T.namespace?{namespace:a.preconfig.namespace,password:a.preconfig.authCode||"",autoExecute:a.preconfig.autoExecute||!1}:null}),L=()=>{const T=window.location.pathname,k=T==="/"||T==="/index"||T==="/index.html",I=V.value&&(!M.value||M.value==="");i.value=k&&I};Ne(()=>a.preconfig,T=>{T!=null&&T.autoOpen&&(T!=null&&T.namespace)&&i.value&&(console.log("Ê£ÄÊµãÂà∞È¢ÑÈÖçÊï∞ÊçÆÔºåËá™Âä®ÊâìÂºÄËÆæÂ§áËÆ§ËØÅÂØπËØùÊ°Ü"),setTimeout(()=>{u.value=!0},500))},{immediate:!0,deep:!0}),je(()=>{L()});const B=()=>{const T=C("server.authDomain"),k="d158067f53627d2b98babe8bffd2fd7d",I=window.location.origin,F=encodeURIComponent(`${I}/authorizecallback`),R=C("device.uuid")||"00000000-0000-4000-8000-000000000000";let j=`${T}/authorize?app_id=${k}&mode=callback&callback_url=${F}&remark=Classworks Ëá™Âä®ÊéàÊùÉ Êù•Ëá™${window.location.hostname} ${new Date().toLocaleString()}`;R!=="00000000-0000-4000-8000-000000000000"&&(j+=`&uuid=${encodeURIComponent(R)}`),window.location.href=j},Q=T=>{o.value=!1,console.log("Ê∏êËøõÂºèÊ≥®ÂÜåÊàêÂäü:",T),L(),l("done")},de=T=>{var k;u.value=!1,console.log("ËÆ§ËØÅÊàêÂäü:",T),(k=a.preconfig)!=null&&k.namespace&&console.log(`È¢ÑÈÖçÊï∞ÊçÆËÆ§ËØÅÊàêÂäü: ${a.preconfig.namespace}`),L(),l("done")},ee=()=>{m.value=!1,L(),l("done")},J=T=>{console.log("Êõø‰ª£‰ª£Á†Å:",T),f.value=!1},ue=()=>{se("server.provider","kv-local"),i.value=!1,window.location.reload(),l("done")},S=()=>{window.open(C("server.authDomain"),"_blank")};return(T,k)=>i.value?(c(),v("div",lo,[r("div",ro,[k[22]||(k[22]=r("div",{class:"init-header"},[r("div",{class:"title"}," Ê¨¢Ëøé‰ΩøÁî® Classworks "),r("div",{class:"subtitle"}," ËØ∑ÈÄâÊã©‰Ω†ÁöÑ‰ΩøÁî®ÊñπÂºè ")],-1)),r("div",uo,[s(_,{class:"main-service-card gradient-new clickable",elevation:"4",onClick:k[0]||(k[0]=I=>o.value=!0)},{default:n(()=>[s(Se,null,{default:n(()=>[r("div",co,[r("div",mo,[s(D,{color:"primary",size:"48"},{default:n(()=>[...k[12]||(k[12]=[d(" mdi-new-box ",-1)])]),_:1})]),k[13]||(k[13]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," ÂàùÊ¨°‰ΩøÁî® "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ‰∫ÜËß£ Classworks KV Âπ∂ÂºÄÂßã‰ΩøÁî® ")],-1))])]),_:1})]),_:1}),s(_,{class:"main-service-card gradient-registered clickable",elevation:"4",onClick:k[1]||(k[1]=I=>u.value=!0)},{default:n(()=>[s(Se,null,{default:n(()=>[r("div",fo,[r("div",ho,[s(D,{color:"success",size:"48"},{default:n(()=>[...k[14]||(k[14]=[d(" mdi-account-check ",-1)])]),_:1})]),k[15]||(k[15]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," Â∑≤Ê≥®ÂÜå "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ‰ΩøÁî®ËÆæÂ§á Namespace ÁôªÂΩï ")],-1))])]),_:1})]),_:1}),s(_,{class:"main-service-card clickable",elevation:"4",onClick:S},{default:n(()=>[s(Se,null,{default:n(()=>[r("div",go,[r("div",po,[s(D,{color:"info",size:"48"},{default:n(()=>[...k[16]||(k[16]=[d(" mdi-database-cog ",-1)])]),_:1})]),k[17]||(k[17]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," Classworks KV "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ÊâìÂºÄ‰∫ëÁ´ØÊéßÂà∂Âè∞ÁÆ°ÁêÜÊï∞ÊçÆ ")],-1))])]),_:1})]),_:1})]),r("div",vo,[s(y,{"prepend-icon":"mdi-laptop",size:"small",variant:"tonal",onClick:ue},{default:n(()=>[...k[18]||(k[18]=[d(" ‰ΩøÁî®Êú¨Âú∞Ê®°Âºè ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-flash",size:"small",variant:"tonal",onClick:B},{default:n(()=>[...k[19]||(k[19]=[d(" ÊéàÊùÉÁ†ÅÂºèÊéàÊùÉÔºàÂºÉÁî®Ôºâ ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-key",size:"small",variant:"tonal",onClick:k[2]||(k[2]=I=>m.value=!0)},{default:n(()=>[...k[20]||(k[20]=[d(" ËæìÂÖ• Token ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-code-tags",size:"small",variant:"tonal",onClick:k[3]||(k[3]=I=>f.value=!0)},{default:n(()=>[...k[21]||(k[21]=[d(" ËæìÂÖ•Êõø‰ª£‰ª£Á†Å ",-1)])]),_:1})]),k[23]||(k[23]=r("div",{class:"footer-hint"}," ÂÆåÊàêÊéàÊùÉÂêéÂèØ‰ΩøÁî®‰Ωú‰∏öÂêåÊ≠•„ÄÅËÄÉËØïÁúãÊùøÁ≠âÂú®Á∫øÂäüËÉΩ„ÄÇ ",-1))]),s(H,{modelValue:o.value,"onUpdate:modelValue":k[5]||(k[5]=I=>o.value=I),"max-width":"600"},{default:n(()=>[s(oo,{onClose:k[4]||(k[4]=I=>o.value=!1),onSuccess:Q})]),_:1},8,["modelValue"]),s(H,{modelValue:u.value,"onUpdate:modelValue":k[7]||(k[7]=I=>u.value=I),"max-width":"500"},{default:n(()=>[s(fa,{ref_key:"deviceAuthDialog",ref:h,preconfig:K.value,"show-cancel":!0,onCancel:k[6]||(k[6]=I=>u.value=!1),onSuccess:de},null,8,["preconfig"])]),_:1},8,["modelValue"]),s(H,{modelValue:m.value,"onUpdate:modelValue":k[9]||(k[9]=I=>m.value=I),"max-width":"500"},{default:n(()=>[s(ha,{"show-cancel":!0,onCancel:k[8]||(k[8]=I=>m.value=!1),onSuccess:ee})]),_:1},8,["modelValue"]),s(H,{modelValue:f.value,"onUpdate:modelValue":k[11]||(k[11]=I=>f.value=I),"max-width":"500"},{default:n(()=>[s(ga,{"show-cancel":!0,onCancel:k[10]||(k[10]=I=>f.value=!1),onSubmit:J})]),_:1},8,["modelValue"])])):w("",!0)}},Ut=O(yo,[["__scopeId","data-v-cbfbc6db"]]),ko={name:"ExamScheduleCard",props:{examId:{type:String,required:!0},contentStyle:{type:Object,default:()=>({})}},computed:{...ct(De,["exams","loadingDetails"]),exam(){return this.exams[this.examId]},loading(){return this.loadingDetails[this.examId]}},mounted(){this.fetchExam(this.examId)},methods:{...ut(De,["fetchExam"]),formatTime(t){if(!t)return"";try{const e=new Date(t),a=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${a}-${l} ${i}:${o}`}catch{return t}}}},xo={class:"text-truncate"},bo={key:0,class:"d-flex justify-center align-center fill-height",style:{"min-height":"200px"}},wo={class:"d-flex align-center mb-1"},So={class:"font-weight-medium"},Co={class:"d-flex align-center"},_o={class:"font-weight-medium"},Do={key:2,class:"d-flex flex-column align-center justify-center fill-height text-grey mt-4"};function To(t,e,a,l,i,o){return c(),b(_,{class:"fill-height d-flex flex-column rounded-xl",elevation:"2"},{default:n(()=>[s($,{class:"d-flex align-center py-3 px-4 bg-primary text-white"},{default:n(()=>{var u;return[s(D,{class:"mr-2"},{default:n(()=>[...e[1]||(e[1]=[d("mdi-calendar-clock",-1)])]),_:1}),r("span",xo,g(((u=o.exam)==null?void 0:u.examName)||"Âä†ËΩΩ‰∏≠..."),1),s(U),s(y,{icon:"mdi-close",variant:"text",density:"comfortable",onClick:e[0]||(e[0]=m=>t.$emit("close"))})]}),_:1}),s(N,{class:"flex-grow-1 pa-4 overflow-y-auto",style:re(a.contentStyle)},{default:n(()=>[o.loading?(c(),v("div",bo,[s(mt,{indeterminate:"",color:"primary"})])):o.exam?(c(),v(E,{key:1},[o.exam.message?(c(),b(ye,{key:0,color:"info",variant:"tonal",class:"mb-4 text-body-1",border:"start",density:"compact"},{default:n(()=>[d(g(o.exam.message),1)]),_:1})):w("",!0),s(pe,{density:"comfortable",class:"pa-0 bg-transparent"},{default:n(()=>[(c(!0),v(E,null,A(o.exam.examInfos,(u,m)=>(c(),b(ve,{key:m,class:"px-0 mb-3"},{prepend:n(()=>[s(ke,{color:"primary",variant:"tonal",size:"large",class:"mr-3 font-weight-bold elevation-1"},{default:n(()=>[d(g(u.name.charAt(0)),1)]),_:2},1024)]),default:n(()=>[s(Ee,{class:"font-weight-bold text-h6 mb-1"},{default:n(()=>[d(g(u.name),1)]),_:2},1024),s(Ve,{class:"text-body-1"},{default:n(()=>[r("div",wo,[s(D,{size:"small",color:"success",class:"mr-2"},{default:n(()=>[...e[2]||(e[2]=[d("mdi-clock-start",-1)])]),_:1}),r("span",So,g(o.formatTime(u.start)),1)]),r("div",Co,[s(D,{size:"small",color:"error",class:"mr-2"},{default:n(()=>[...e[3]||(e[3]=[d("mdi-clock-end",-1)])]),_:1}),r("span",_o,g(o.formatTime(u.end)),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})],64)):(c(),v("div",Do,[s(D,{size:"large",class:"mb-2"},{default:n(()=>[...e[4]||(e[4]=[d("mdi-alert-circle-outline",-1)])]),_:1}),e[5]||(e[5]=d(" Êó†Ê≥ïÂä†ËΩΩËÄÉËØï‰ø°ÊÅØ ",-1))]))]),_:1},8,["style"])]),_:1})}const Io=O(ko,[["render",To],["__scopeId","data-v-52dc8ca5"]]);function Pe(t,e){let a=null;return function(...l){a&&clearTimeout(a),a=setTimeout(()=>{t.apply(this,l)},e)}}function Eo(t,e){let a=null,l=0;return function(...i){const o=Date.now();o-l<e?(a&&clearTimeout(a),a=setTimeout(()=>{l=o,t.apply(this,i)},e)):(l=o,t.apply(this,i))}}const Vo={name:"Classworks ‰Ωú‰∏öÊùø",components:{MessageLog:vt,RandomPicker:yt,FloatingToolbar:wt,FloatingICP:bt,HomeworkEditDialog:Ct,InitServiceChooser:Ut,ChatWidget:Ue,StudentNameManager:At,UrgentTestDialog:xt,AttendanceSidebar:_t,AttendanceManagementDialog:St,HomeworkGrid:Nt,HomeActions:Tt,PwaInstallCard:Dt,ExamScheduleCard:Io,ExamConfigEditor:lt},setup(){const{mobile:t}=Ce(),e=De();return{mobile:t,examStore:e}},data(){const t=[{name:"ËØ≠Êñá",order:0},{name:"Êï∞Â≠¶",order:1},{name:"Ëã±ËØ≠",order:2},{name:"Áâ©ÁêÜ",order:3},{name:"ÂåñÂ≠¶",order:4},{name:"ÁîüÁâ©",order:5},{name:"ÊîøÊ≤ª",order:6},{name:"ÂéÜÂè≤",order:7},{name:"Âú∞ÁêÜ",order:8},{name:"ÂÖ∂‰ªñ",order:9}];return{showAddExamDialog:!1,showExamDetailDialog:!1,selectedExamId:null,upcomingExams:[],dataKey:"",provider:"",useDisplay:Ce,state:{classNumber:"",namespaceInfo:null,deviceName:"",studentList:[],boardData:{homework:{},attendance:{absent:[],late:[],exclude:[]}},dialogVisible:!1,dialogTitle:"",textarea:"",dateString:"",synced:!1,attendDialogVisible:!1,contentStyle:{"font-size":`${C("font.size")}px`},uploadLoading:!1,downloadLoading:!1,snackbar:!1,snackbarText:"",fontSize:C("font.size"),datePickerDialog:!1,selectedDate:new Date().toISOString().split("T")[0].replace(/-/g,""),selectedDateObj:new Date,refreshInterval:null,showNoDataMessage:!1,noDataMessage:"",isToday:!1,attendanceDialog:!1,availableSubjects:t,isFullscreen:!1},loading:{download:!1,upload:!1,students:!1,copyToToday:!1},debouncedUpload:null,debouncedAttendanceSave:null,throttledReflow:null,sortedItemsCache:{key:"",value:[]},confirmDialog:{show:!1,resolve:null,reject:null},urlConfigDialog:{show:!1,config:null,changes:[],validSettings:{},confirmHandler:null,cancelHandler:null,icons:{}},settingsTick:0,isChatOpen:!1,highlightedCards:{},tokenDisplayInfo:{show:!1,readonly:!1,text:"",color:"primary",variant:"tonal",icon:"mdi-account",disabled:!1},realtimeInfo:{show:!1,time:"",key:""},$offKvChanged:null,$offConnect:null,debouncedRealtimeRefresh:null,preconfigData:{namespace:null,authCode:null,autoOpen:!1,autoExecute:!1},urgentTestDialog:!1,tokenInfo:null,persistentNotifications:[],notificationDetailDialog:!1,currentNotification:null}},computed:{isMobile(){return C("display.forceDesktopMode")?!1:this.mobile},titleText(){var u,m;const t=((m=(u=this.state.namespaceInfo)==null?void 0:u.device)==null?void 0:m.name)||this.state.classNumber||"È´ò‰∏âÂÖ´Áè≠",e=this.getToday(),a=new Date(e);a.setDate(a.getDate()-1);const l=this.state.dateString,i=this.formatDate(e),o=this.formatDate(a);return l===i?t+" - ‰ªäÂ§©ÁöÑ‰Ωú‰∏ö":l===o?t+" - Êò®Â§©ÁöÑ‰Ωú‰∏ö":`${t} - ${l}ÁöÑ‰Ωú‰∏ö`},sortedItems(){const t=[];this.isMobile&&t.push({key:"attendance-card",name:"Âá∫Âã§ÁªüËÆ°",type:"attendance",data:{total:this.state.studentList.length,absent:this.state.boardData.attendance.absent,late:this.state.boardData.attendance.late,exclude:this.state.boardData.attendance.exclude}});for(const e in this.state.boardData.homework)if(e.startsWith("exam-")){const a=this.state.boardData.homework[e];t.push({key:e,name:"ËÄÉËØïÂÆâÊéí",type:"exam",data:{examId:a.examId},order:-100,rowSpan:200})}for(const e of this.state.availableSubjects){const a=e.name,l=this.state.boardData.homework[a];if(l&&l.content){const o=100+l.content.split(`
`).filter(u=>u.trim()).length*24;t.push({key:a,name:a,type:"homework",content:l.content,order:e.order,rowSpan:o})}}C("hitokoto.enabled")&&t.push({key:"hitokoto-card",name:"‰∏ÄË®Ä",type:"hitokoto",order:9998,rowSpan:150});for(const e in this.state.boardData.homework)if(e.startsWith("custom-")){const a=this.state.boardData.homework[e],i=100+a.content.split(`
`).filter(o=>o.trim()).length*24;t.push({key:e,name:a.name,type:"custom",content:a.content,order:9999,rowSpan:i})}return t.sort((e,a)=>e.order-a.order),t},unusedSubjects(){const t=Object.keys(this.state.boardData.homework).filter(e=>{var a;return(a=this.state.boardData.homework[e].content)==null?void 0:a.trim()});return this.state.availableSubjects.filter(e=>!t.includes(e.name)).sort((e,a)=>e.order-a.order)},emptySubjects(){return this.emptySubjectDisplay!=="button"?[]:this.unusedSubjects},autoSave(){return C("edit.autoSave")},blockNonTodayAutoSave(){return C("edit.blockNonTodayAutoSave")},isToday(){const t=(()=>{const e=new Date,a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}${l}${i}`})();return this.state.dateString===t},canAutoSave(){return this.autoSave&&(!this.blockNonTodayAutoSave||this.isToday)},needConfirmSave(){return!this.isToday&&this.confirmNonTodaySave},shouldShowBlockedMessage(){return!this.isToday&&this.autoSave&&this.blockNonTodayAutoSave},refreshBeforeEdit(){return C("edit.refreshBeforeEdit")},emptySubjectDisplay(){return C("display.emptySubjectDisplay")},dynamicSort(){return C("display.dynamicSort")},isEditingDisabled(){if(this.state.uploadLoading||this.state.downloadLoading)return!0;const t=this.$refs.studentNameManager;return!!(t!=null&&t.isReadOnly||!this.canEditCurrentDate)},unreadCount(){var t;return((t=this.$refs.messageLog)==null?void 0:t.unreadCount)||0},showRandomPickerButton(){return C("randomPicker.enabled")},showListCardButton(){return C("display.showListCard")},confirmNonTodaySave(){return C("edit.confirmNonTodaySave")},blockPastDataEdit(){return C("edit.blockPastDataEdit")},shouldShowSaveConfirm(){return!this.isToday&&this.confirmNonTodaySave},shouldBlockAutoSave(){return!this.isToday&&this.autoSave&&this.blockNonTodayAutoSave},canEditCurrentDate(){return this.isToday?!0:!this.blockPastDataEdit},isEditingPastData(){return!this.isToday},showFullscreenButton(){return C("display.showFullscreenButton")},showExamScheduleButton(){return C("display.showExamScheduleButton")},showAntiScreenBurnCard(){return C("display.showAntiScreenBurnCard")},showTestCardButton(){return C("developer.enabled")},shouldShowInit(){var i;const t=C("server.provider"),e=t==="kv-server"||t==="classworkscloud",a=C("server.kvToken"),l=((i=this.$route)==null?void 0:i.path)==="/";return this.settingsTick,l&&e&&(!a||a==="")},hasExamCard(){for(const t in this.state.boardData.homework)if(t.startsWith("exam-"))return!0;return!1},shouldShowUrgentTestButton(){const t=C("server.provider");return!(t==="kv-server"||t==="classworkscloud")||!C("server.kvToken")||!this.tokenInfo?!1:this.tokenInfo.deviceType==="teacher"||this.tokenInfo.deviceType==="classroom"},subjectOrder(){return[...this.state.availableSubjects].sort((t,e)=>t.order-e.order).map(t=>t.name)}},watch:{homeworkData:{handler(){this.$nextTick(()=>{this.$refs.waterfall&&this.$refs.waterfall.reflow()})},deep:!0},"$vuetify.display.width":{handler(){this.throttledReflow()},deep:!0},"state.attendanceDialog":{handler(t){this.handleAttendanceDialogClose(t)}}},created(){this.debouncedUpload=Pe(this.uploadData,2e3),this.debouncedAttendanceSave=Pe(async()=>{this.autoSave&&await this.trySave(!0)},2e3),this.throttledReflow=Eo(()=>{this.$refs.gridContainer&&this.optimizeGridLayout(this.sortedItems)},200)},async mounted(){try{this.updateBackendUrl(),await this.initializeData(),await this.loadDeviceInfo(),this.setupAutoRefresh(),this.unwatchSettings=He(()=>{this.updateSettings()}),this.$nextTick(()=>{const t=this.$refs.studentNameManager;t&&(this.studentNameInfo.name=t.currentStudentName,this.studentNameInfo.isStudent=t.isStudentToken,this.studentNameInfo.openDialog=()=>t.openDialog(),this.$watch(()=>t.currentStudentName,e=>{this.studentNameInfo.name=e}),this.$watch(()=>t.isStudentToken,e=>{this.studentNameInfo.isStudent=e}))}),document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.checkHashForRandomPicker(),window.addEventListener("hashchange",this.checkHashForRandomPicker),this.setupRealtimeChannel(),this.$nextTick(()=>{this.updateTokenDisplayInfo()}),await this.loadTokenInfo(),this.loadPersistentNotifications()}catch(t){console.error("ÂàùÂßãÂåñÂ§±Ë¥•:",t),this.showError("ÂàùÂßãÂåñÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï")}},beforeUnmount(){this.unwatchSettings&&this.unwatchSettings(),this.state.refreshInterval&&clearInterval(this.state.refreshInterval),document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),window.removeEventListener("hashchange",this.checkHashForRandomPicker);try{this.$offKvChanged&&typeof this.$offKvChanged=="function"&&(this.$offKvChanged(),this.$offKvChanged=null),this.$offDeviceEvent&&typeof this.$offDeviceEvent=="function"&&(this.$offDeviceEvent(),this.$offDeviceEvent=null),this.$offConnect&&typeof this.$offConnect=="function"&&(this.$offConnect(),this.$offConnect=null),Gt()}catch(t){console.warn("‰∏ªÈ°µÈù¢‰∫ã‰ª∂Ê∏ÖÁêÜÂ§±Ë¥•:",t)}},methods:{async loadDeviceInfo(){var t;try{const e=C("server.provider");if(!(e==="kv-server"||e==="classworkscloud"))return;const l=await Xt.loadNamespaceInfo();if(l&&l.success===!1)return;this.state.namespaceInfo=l||null,this.state.deviceName=((t=l==null?void 0:l.account)==null?void 0:t.deviceName)||""}catch(e){console.warn("Âä†ËΩΩËÆæÂ§á‰ø°ÊÅØÂ§±Ë¥•:",e)}},async loadTokenInfo(){try{const t=C("server.provider");if(!(t==="kv-server"||t==="classworkscloud"))return;const a=C("server.kvToken");if(!a)return;const l=C("server.domain");if(!l)return;const i=await fe.get(`${l}/kv/_token`,{headers:{Authorization:`Bearer ${a}`}});this.tokenInfo=i.data,console.log("Token info loaded:",this.tokenInfo)}catch(t){console.warn("Failed to load token info:",t),this.tokenInfo=null}},updateTokenDisplayInfo(){const t=this.$refs.studentNameManager;if(!t||!t.hasToken){this.tokenDisplayInfo.show=!1,this.tokenDisplayInfo.readonly=!1;return}const e=t.displayName,a=t.isReadOnly,l=t.isStudentToken;if(this.tokenDisplayInfo.readonly=a,!l){this.tokenDisplayInfo.show=!1;return}this.tokenDisplayInfo.text=e,this.tokenDisplayInfo.color="primary",this.tokenDisplayInfo.icon="mdi-account",this.tokenDisplayInfo.disabled=a,this.tokenDisplayInfo.show=!0},handleTokenChipClick(){console.log("Token chip clicked");const t=this.$refs.studentNameManager;console.log("Manager:",t),console.log("Is student token:",t==null?void 0:t.isStudentToken),t&&t.isStudentToken?(console.log("Opening dialog..."),t.openDialog()):console.log("Cannot open dialog - conditions not met")},ensureDate(t){if(t instanceof Date)return t;if(typeof t=="string"){const e=new Date(t);if(!isNaN(e.getTime()))return e}return new Date},formatDate(t){const e=this.ensureDate(t),a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}${l}${i}`},formatTime(t){return t?new Date(t).toLocaleString():""},getToday(){return new Date},async initializeData(){this.parsePreconfigData();const t=await this.parseUrlConfig(),a=new URLSearchParams(window.location.search).get("date"),l=this.getToday();let i=l;if(a){if(/^\d{8}$/.test(a)){const o=a.substring(0,4),u=a.substring(4,6),m=a.substring(6,8);i=new Date(`${o}-${u}-${m}`)}else i=new Date(a);isNaN(i.getTime())&&(i=l)}if(this.state.dateString=this.formatDate(i),this.state.selectedDate=this.state.dateString,this.state.selectedDateObj=i,this.state.isToday=this.formatDate(i)===this.formatDate(l),!t){this.provider=C("server.provider");const o=C("server.classNumber");this.state.classNumber=o}await Promise.all([this.downloadData(),this.loadConfig()]),await this.examStore.fetchExamList();for(const o of this.examStore.examList)this.examStore.fetchExam(o.id);this.checkUpcomingExams()},async checkUpcomingExams(){this.upcomingExams=await this.examStore.getUpcomingExams()},loadExamCards(){},saveExamCards(){},addExamCard(t,e=!1,a=!1){const l=`exam-${t}`;!e&&this.state.boardData.homework[l]?delete this.state.boardData.homework[l]:this.state.boardData.homework[l]={type:"exam",examId:t,name:"ËÄÉËØïÂÆâÊéí",content:""},this.state.synced=!1,a||this.trySave(!0)},openExamDetail(t){this.selectedExamId=t,this.showExamDetailDialog=!0},removeCurrentExamCard(){this.selectedExamId&&(this.addExamCard(this.selectedExamId),this.showExamDetailDialog=!1)},async onExamConfigSaved(){this.selectedExamId&&(delete this.examStore.exams[this.selectedExamId],await this.examStore.fetchExam(this.selectedExamId),this.$message.success("‰øùÂ≠òÊàêÂäü","ËÄÉËØïÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞"))},onExamConfigDeleted(){this.removeCurrentExamCard(),this.$message.success("Âà†Èô§ÊàêÂäü","ËÄÉËØïÈÖçÁΩÆÂ∑≤Âà†Èô§")},isExamCardAdded(t){return!!this.state.boardData.homework[`exam-${t}`]},removeExamCard(t){},addAllUpcomingExams(){let t=0;for(const e of this.upcomingExams)this.isExamCardAdded(e.id)||(this.addExamCard(e.id,!0,!0),t++);t>0?(this.trySave(!0),this.$message.success("Ê∑ªÂä†ÊàêÂäü",`Â∑≤Ê∑ªÂä† ${t} ‰∏™ËÄÉËØïÂÆâÊéí`)):this.$message.info("ÊèêÁ§∫","ÊâÄÊúâËÄÉËØïÂ∑≤Ê∑ªÂä†")},async downloadData(t=!1){var e,a,l;if(!this.loading.download)try{this.loading.download=!0;const i=await Z.loadData("classworks-data-"+this.state.dateString);if(i.success==!1)if(i.error.code==="NOT_FOUND")this.state.showNoDataMessage=!0,this.state.noDataMessage=i.error.message,(t||!this.state.boardData||!this.state.boardData.homework&&!this.state.boardData.attendance)&&(this.state.boardData={homework:{},attendance:{absent:[],late:[],exclude:[]}});else throw new Error(i.error.message);else this.state.boardData={homework:i.homework||{},attendance:{absent:((e=i.attendance)==null?void 0:e.absent)||[],late:((a=i.attendance)==null?void 0:a.late)||[],exclude:((l=i.attendance)==null?void 0:l.exclude)||[]}},this.state.synced=!0,this.state.showNoDataMessage=!1,this.$message.success("‰∏ãËΩΩÊàêÂäü","Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞")}catch(i){console.error("Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:",i),this.$message.error("‰∏ãËΩΩÂ§±Ë¥•",i.message),(t||!this.state.boardData||!this.state.boardData.homework&&!this.state.boardData.attendance)&&(this.state.boardData={homework:{},attendance:{absent:[],late:[],exclude:[]}})}finally{this.loading.download=!1}},async trySave(t=!1){if(t&&!this.canAutoSave)return this.shouldShowBlockedMessage&&this.showMessage("ÈúÄË¶ÅÊâãÂä®‰øùÂ≠ò","Â∑≤Á¶ÅÊ≠¢Ëá™Âä®‰øùÂ≠òÈùûÂΩìÂ§©Êï∞ÊçÆ","warning"),!1;if(!t&&this.needConfirmSave)try{await this.showConfirmDialog()}catch{return!1}try{return await this.uploadData(),!0}catch(e){return this.$message.error("‰øùÂ≠òÂ§±Ë¥•",e.message||"ËØ∑ÈáçËØï"),!1}},async handleClose(){var a;if(!this.currentEditSubject)return;const t=this.state.textarea.trim(),e=((a=this.state.boardData.homework[this.currentEditSubject])==null?void 0:a.content)||"";if(t!==e.trim()){if(!t&&this.currentEditSubject.startsWith("custom-")){delete this.state.boardData.homework[this.currentEditSubject],this.state.synced=!1,this.autoSave&&await this.trySave(!0),this.state.dialogVisible=!1;return}this.state.boardData.homework[this.currentEditSubject].type==="custom"?this.state.boardData.homework[this.currentEditSubject].content=t:this.state.boardData.homework[this.currentEditSubject]={content:t},this.state.synced=!1,this.autoSave&&await this.trySave(!0)}this.state.dialogVisible=!1},async uploadData(){if(!this.loading.upload)try{this.loading.upload=!0;const t=await Z.saveData("classworks-data-"+this.state.dateString,this.state.boardData);if(t.success==!1)throw new Error(t.error.message);this.state.synced=!0,this.$message.success(t.message||"‰øùÂ≠òÊàêÂäü")}finally{this.loading.upload=!1}},async loadConfig(){try{try{const t=await Z.loadData("classworks-list-main");t.success!=!1&&Array.isArray(t)&&(this.state.studentList=t.map(e=>e.name))}catch(t){console.warn("Failed to load student list from dedicated key, falling back to config",t)}await this.loadSubjects()}catch(t){console.error("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•:",t),this.$message.error("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•",t.message)}},async loadSubjects(){try{const t=await Z.loadData("classworks-config-subject");t&&Array.isArray(t)&&(this.state.availableSubjects=t)}catch(t){console.warn("Failed to load subject configuration:",t)}},showSyncMessage(){this.$message.success("Êï∞ÊçÆÂ∑≤ÂêåÊ≠•","Êï∞ÊçÆÂ∑≤ÂÆåÊàê‰∏éÊúçÂä°Âô®ÂêåÊ≠•")},async openDialog(t){var e;if(this.isEditingDisabled){const a=this.$refs.studentNameManager;a!=null&&a.isReadOnly?this.$message.warning("Êó†Ê≥ïÁºñËæë","ÂΩìÂâç‰ΩøÁî®ÁöÑÊòØÂè™ËØª‰ª§Áâå"):this.canEditCurrentDate?this.$message.warning("Êó†Ê≥ïÁºñËæë","Êï∞ÊçÆÂä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô"):this.$message.warning("Êó†Ê≥ïÁºñËæë","Â∑≤Á¶ÅÊ≠¢ÁºñËæëËøáÂæÄÊï∞ÊçÆ");return}if(t.startsWith("custom-")){this.currentEditSubject=t,this.state.dialogTitle=this.state.boardData.homework[t].name,this.state.textarea=this.state.boardData.homework[t].content,this.state.dialogVisible=!0;return}if(this.refreshBeforeEdit)try{await this.downloadData()}catch(a){console.error("Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:",a),this.$message.error("Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•ÔºåÂèØËÉΩÊòæÁ§∫ÁöÑ‰∏çÊòØÊúÄÊñ∞Êï∞ÊçÆ")}this.currentEditSubject=t,this.state.boardData.homework[t]||(this.state.boardData.homework[t]={content:""}),this.state.dialogTitle=((e=this.state.availableSubjects.find(a=>a.name===t))==null?void 0:e.name)||t,this.state.textarea=this.state.boardData.homework[t].content,this.state.dialogVisible=!0},async handleHomeworkSave(t){this.currentEditSubject&&(this.state.boardData.homework[this.currentEditSubject].type==="custom"?this.state.boardData.homework[this.currentEditSubject].content=t:this.state.boardData.homework[this.currentEditSubject]={content:t},this.state.synced=!1,this.autoSave&&await this.trySave(!0))},setAttendanceArea(){if(this.isEditingDisabled){this.handleDisabledClick();return}this.state.attendanceDialog=!0},handleDisabledClick(){const t=this.$refs.studentNameManager;t!=null&&t.isReadOnly?this.$message.warning("Êó†Ê≥ïÁºñËæë","ÂΩìÂâç‰ΩøÁî®ÁöÑÊòØÂè™ËØª‰ª§Áâå"):this.canEditCurrentDate?this.$message.warning("Êó†Ê≥ïÁºñËæë","Êï∞ÊçÆÂä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô"):this.$message.warning("Êó†Ê≥ïÁºñËæë","Â∑≤Á¶ÅÊ≠¢ÁºñËæëËøáÂæÄÊï∞ÊçÆ")},zoom(t){t==="up"&&this.state.fontSize<100?this.state.fontSize+=2:t==="out"&&this.state.fontSize>16&&(this.state.fontSize-=2),this.state.contentStyle={"font-size":`${this.state.fontSize}px`},se("font.size",this.state.fontSize)},updateBackendUrl(){const t=C("server.provider"),e=C("server.classNumber");this.provider=t,this.state.classNumber=e},setupAutoRefresh(){const t=C("refresh.auto"),e=C("refresh.interval");this.state.refreshInterval&&clearInterval(this.state.refreshInterval),t&&(this.state.refreshInterval=setInterval(()=>{this.shouldSkipRefresh()||(this.downloadData(),this.loadPersistentNotifications())},e*1e3))},shouldSkipRefresh(){return!!(this.state.dialogVisible||this.state.attendanceDialog||this.confirmDialog.show||this.state.datePickerDialog||this.loading.upload||this.loading.download||!this.state.synced)},updateSettings(){this.state.fontSize=C("font.size"),this.state.contentStyle={"font-size":`${this.state.fontSize}px`},this.setupAutoRefresh(),this.updateBackendUrl(),this.loadDeviceInfo(),this.loadTokenInfo(),this.settingsTick++},async handleDateSelect(t){if(t)try{const e=this.ensureDate(t),a=this.formatDate(e);if(a===this.state.dateString)return;this.state.dateString=a,this.state.selectedDate=a,this.state.selectedDateObj=e,this.state.isToday=a===this.formatDate(this.getToday()),await Promise.all([this.downloadData(!0),this.loadSubjects()])}catch(e){console.error("Date processing error:",e),this.$message.error("Êó•ÊúüÂ§ÑÁêÜÈîôËØØ","ËØ∑ÈáçÊñ∞ÈÄâÊã©Êó•Êúü")}},setupRealtimeChannel(){try{const t=C("server.kvToken");if(!t){console.warn("Êú™ÈÖçÁΩÆ KV TokenÔºåÊó†Ê≥ïÂä†ÂÖ•ÂÆûÊó∂È¢ëÈÅì");return}ft(),Re(t),this.$offConnect=Wt(()=>Re(t)),this.debouncedRealtimeRefresh||(this.debouncedRealtimeRefresh=Pe(async()=>{var h,x,V;const l=JSON.parse(JSON.stringify(this.state.boardData.homework));await this.downloadData();const i=new Date,o=String(i.getHours()).padStart(2,"0"),u=String(i.getMinutes()).padStart(2,"0"),m=String(i.getSeconds()).padStart(2,"0");(h=this.$message)==null||h.info("Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞",`Â∑≤‰∫é ${o}:${u}:${m} Ëá™Âä®Âà∑Êñ∞`);const f={};for(const M in this.state.boardData.homework){const K=((x=l[M])==null?void 0:x.content)||"",L=((V=this.state.boardData.homework[M])==null?void 0:V.content)||"";K!==L&&(f[M]=!0)}for(const M in l)this.state.boardData.homework[M]||(f[M]=!0);this.highlightedCards=f,setTimeout(()=>{this.highlightedCards={}},1e4)},800));const e=l=>{var o;if(!l)return;if(l.key==="notification-list"){this.loadPersistentNotifications();return}const i=`classworks-data-${this.state.dateString}`;l.key===i&&(l.action!=="upsert"&&l.action!=="delete"||(o=this.debouncedRealtimeRefresh)==null||o.call(this,l.key))},a=l=>{let i=l;l.content&&l.timestamp&&(i={uuid:l.senderId||"realtime",key:l.content.key,action:l.content.action,created:l.content.created,updatedAt:l.content.updatedAt||l.timestamp,deletedAt:l.content.deletedAt,batch:l.content.batch}),e(i)};this.$offKvChanged=oe("kv-key-changed",a),this.deviceEventHandler=ht({onKvChanged:e,enableLegacySupport:!0}),this.$offDeviceEvent=oe("device-event",this.deviceEventHandler)}catch(t){console.warn("ÂÆûÊó∂È¢ëÈÅìÂàùÂßãÂåñÂ§±Ë¥•",t)}},async saveAttendance(){try{await this.trySave(!0),this.state.attendanceDialog=!1}catch(t){console.error("‰øùÂ≠òÂá∫Âã§Áä∂ÊÄÅÂ§±Ë¥•:",t),this.$message.error("‰øùÂ≠òÂ§±Ë¥•","ËØ∑ÈáçËØï")}},showMessage(t,e="",a="success"){this.$message[a](t,e)},updateSortedItemsCache(t,e){this._sortedItemsCache={key:t,value:e}},addTestCard(){const t=Date.now().toString();this.state.boardData.homework[`custom-${t}`]={name:"ÊµãËØïÂç°Áâá",content:`ËøôÊòØ‰∏Ä‰∏™ÊµãËØïÂç°Áâá
ÂèØ‰ª•Áî®Êù•ÊµãËØïÂ∏ÉÂ±Ä`,type:"custom"},this.state.synced=!1},showConfirmDialog(){return new Promise((t,e)=>{this.confirmDialog={show:!0,resolve:()=>{this.confirmDialog.show=!1,t()},reject:()=>{this.confirmDialog.show=!1,e(new Error("Áî®Êà∑ÂèñÊ∂à‰øùÂ≠ò"))}}})},confirmSave(){this.confirmDialog.show=!1,this.confirmDialog.resolve&&this.confirmDialog.resolve(!0)},cancelSave(){this.confirmDialog.show=!1,this.confirmDialog.reject&&this.confirmDialog.reject(new Error("Áî®Êà∑ÂèñÊ∂à‰øùÂ≠ò"))},async manualUpload(){return this.trySave(!1)},handleAttendanceChange(){this.state.synced=!1,this.debouncedAttendanceSave()},async handleAttendanceDialogClose(t){!t&&!this.state.synced&&await this.trySave(!0)},toggleFullscreen(){this.state.isFullscreen?this.exitFullscreen():this.enterFullscreen()},enterFullscreen(){const t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},fullscreenChangeHandler(){this.state.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)},openRandomPicker(){this.$refs.randomPicker&&this.$refs.randomPicker.open()},checkHashForRandomPicker(){window.location.hash==="#random-picker"&&this.$nextTick(()=>{console.log("ÊâìÂºÄÈöèÊú∫ÁÇπÂêç"),window.location.hash="",this.openRandomPicker()})},parseUrlConfig(){try{const e=new URLSearchParams(window.location.search).get("config");if(!e)return!1;try{const a=atob(e),l=Uint8Array.from(a,h=>h.charCodeAt(0)),i=new TextDecoder().decode(l),o=JSON.parse(i);console.log("‰ªéURLËØªÂèñÈÖçÁΩÆ:",o);const u=[],m={},f={};return this.processSpecialSettings(o,u,m),this.processStandardSettings(o,u,m,f),Object.keys(m).length===0?(console.log("URLÈÖçÁΩÆ‰∏éÂΩìÂâçÈÖçÁΩÆÁõ∏ÂêåÔºåÊó†ÈúÄÂ∫îÁî®"),!1):new Promise(h=>{this.urlConfigDialog={show:!0,config:o,changes:u,validSettings:m,icons:f,confirmHandler:()=>{this.urlConfigDialog.show=!1,this.applyUrlConfig(m),h(!0)},cancelHandler:()=>{this.urlConfigDialog.show=!1,h(!1)}}})}catch(a){return console.error("Ëß£ÊûêURLÈÖçÁΩÆÈîôËØØ:",a),this.$message.error("URLÈÖçÁΩÆÈîôËØØ","Êó†Ê≥ïËß£ÊûêÈÖçÁΩÆÊï∞ÊçÆ"),!1}}catch(t){return console.error("Â§ÑÁêÜURLÈÖçÁΩÆÈîôËØØ:",t),!1}},processSpecialSettings(t,e,a){var l,i;if(t.classNumber!==void 0){const o=C("server.classNumber");t.classNumber!==o&&(e.push({key:"server.classNumber",name:"Áè≠Á∫ß",oldValue:o,newValue:t.classNumber,description:((l=we["server.classNumber"])==null?void 0:l.description)||"Áè≠Á∫ßÁºñÂè∑",icon:((i=we["server.classNumber"])==null?void 0:i.icon)||"mdi-account-group"}),a["server.classNumber"]=t.classNumber)}t.date!==void 0&&t.date!==this.state.dateString&&(e.push({key:"date",name:"Êó•Êúü",oldValue:this.state.dateString,newValue:t.date,description:"Êü•ÁúãÁöÑÊó•Êúü",icon:"mdi-calendar"}),a.date=t.date),t.subjects&&Array.isArray(t.subjects)&&(e.push({key:"subjects",name:"ÁßëÁõÆÂàóË°®",oldValue:`${this.state.availableSubjects.length}‰∏™ÁßëÁõÆ`,newValue:`${t.subjects.length}‰∏™ÁßëÁõÆ`,description:"ÂèØÁî®ÁßëÁõÆÂàóË°®",icon:"mdi-notebook"}),a.subjects=t.subjects)},processStandardSettings(t,e,a,l){Object.entries(t).forEach(([i,o])=>{if(["classNumber","date","subjects"].includes(i))return;let u=i,m=we[i];if(!m&&!i.includes(".")){const f=["server.","display.","theme.","edit.","refresh.","font.","randomPicker."];for(const h of f){const x=`${h}${i}`;if(we[x]){u=x,m=we[x];break}}}if(m){let f=this.convertValueToCorrectType(o,m.type);if(m.validate&&!m.validate(f)){console.warn(`URLÈÖçÁΩÆÈ°π ${u} ÁöÑÂÄºÊó†Êïà: ${o}`);return}const h=C(u);f!==h&&(e.push({key:u,name:this.getSettingDisplayName(u),oldValue:this.formatSettingValue(h),newValue:this.formatSettingValue(f),description:m.description||u,icon:m.icon||"mdi-cog"}),a[u]=f,l[u]=m.icon||"mdi-cog")}else e.push({key:i,name:this.getSettingDisplayName(i),oldValue:"Êú™Áü•",newValue:this.formatSettingValue(o),description:"Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π",icon:"mdi-cog-outline"}),a[i]=o,l[i]="mdi-cog-outline"})},convertValueToCorrectType(t,e){return e==="boolean"?!!t:e==="number"?Number(t):String(t)},formatSettingValue(t){return typeof t=="boolean"?t?"ÂºÄÂêØ":"ÂÖ≥Èó≠":t===""||t===null||t===void 0?"Á©∫":t.toString()},getSettingDisplayName(t){const e=t.split("."),a=e[e.length-1];return{provider:"Êï∞ÊçÆÊèê‰æõÊñπ",domain:"ÊúçÂä°Âô®ÂüüÂêç",classNumber:"Áè≠Á∫ßÁºñÂè∑",emptySubjectDisplay:"Á©∫ÁßëÁõÆÊòæÁ§∫ÊñπÂºè",dynamicSort:"Âä®ÊÄÅÊéíÂ∫è",showRandomButton:"ÈöèÊú∫ÊåâÈíÆ",showFullscreenButton:"ÂÖ®Â±èÊåâÈíÆ",cardHoverEffect:"Âç°ÁâáÊÇ¨ÊµÆÊïàÊûú",enhancedTouchMode:"Â¢ûÂº∫Ëß¶Êë∏Ê®°Âºè",showAntiScreenBurnCard:"Èò≤ÁÉßÂ±èÂç°Áâá",mode:"‰∏ªÈ¢òÊ®°Âºè",size:"Â≠ó‰ΩìÂ§ßÂ∞è",autoSave:"Ëá™Âä®‰øùÂ≠ò",blockNonTodayAutoSave:"Á¶ÅÊ≠¢Ëá™Âä®‰øùÂ≠òÈùûÂΩìÊó•",refreshBeforeEdit:"ÁºñËæëÂâçÂà∑Êñ∞",confirmNonTodaySave:"ÈùûÂΩìÊó•‰øùÂ≠òÁ°ÆËÆ§",auto:"Ëá™Âä®Âà∑Êñ∞",interval:"Âà∑Êñ∞Èó¥Èöî"}[a]||a},safeBase64Decode(t){try{return gt.decode(t)}catch(e){throw console.error("Base64Ëß£Á†ÅÈîôËØØ:",e),new Error("Êó†Ê≥ïËß£Á†ÅÈÖçÁΩÆÊï∞ÊçÆ")}},applyUrlConfig(t){for(const[e,a]of Object.entries(t)){if(e==="date"){this.handleDateSelect(a);continue}if(e==="subjects"){this.state.availableSubjects=a;continue}se(e,a),e==="server.classNumber"&&(this.state.classNumber=a)}return this.updateBackendUrl(),this.$message.success("URLÈÖçÁΩÆÂ∑≤Â∫îÁî®","Â∑≤‰ªéURLÂä†ËΩΩÈÖçÁΩÆ"),!0},navigateDay(t){const e=new Date(this.state.selectedDateObj);e.setDate(e.getDate()+t),this.handleDateSelect(e)},async copyHomeworkToToday(){if(!this.loading.copyToToday)try{this.loading.copyToToday=!0;const t=this.state.dateString,e=JSON.parse(JSON.stringify(this.state.boardData.homework)),a=this.getToday(),l=this.formatDate(a);this.state.dateString=l,await this.downloadData();const i={};for(const u in e)e[u]&&e[u].content&&(e[u].type==="custom"?i[u]=JSON.parse(JSON.stringify(e[u])):i[u]={content:e[u].content});this.state.boardData.homework=i,this.state.synced=!1,await this.uploadData(),this.state.selectedDate=l,this.state.selectedDateObj=a,this.state.isToday=!0;const o=new URL(window.location);o.searchParams.delete("date"),window.history.pushState({},"",o),this.$message.success("Â§çÂà∂ÊàêÂäü",`Â∑≤Â∞Ü ${t} ÁöÑ‰Ωú‰∏öÂÜÖÂÆπÂ§çÂà∂Âà∞‰ªäÂ§©ÔºàÂ∑≤ÊõøÊç¢ÂéüÊúâ‰Ωú‰∏öÔºâ`)}catch(t){console.error("Â§çÂà∂‰Ωú‰∏öÂ§±Ë¥•:",t),this.$message.error("Â§çÂà∂Â§±Ë¥•",t.message||"ËØ∑ÈáçËØï")}finally{this.loading.copyToToday=!1}},parsePreconfigData(){try{const t=new URLSearchParams(window.location.search),e=t.get("namespace"),a=t.get("authCode")||t.get("auth_code"),l=t.get("autoExecute")||t.get("auto_execute");e&&(this.preconfigData.namespace=e,this.preconfigData.authCode=a,this.preconfigData.autoOpen=!0,this.preconfigData.autoExecute=this.parseBoolean(l),console.log("Ê£ÄÊµãÂà∞È¢ÑÈÖçÊï∞ÊçÆ:",{namespace:this.preconfigData.namespace,hasAuthCode:!!this.preconfigData.authCode,autoExecute:this.preconfigData.autoExecute}),this.cleanupUrlParams(["namespace","authCode","auth_code","autoExecute","auto_execute"]))}catch(t){console.error("Ëß£ÊûêÈ¢ÑÈÖçÊï∞ÊçÆÂ§±Ë¥•:",t)}},parseBoolean(t){if(!t)return!1;const e=t.toLowerCase();return e==="true"||e==="1"||e==="yes"},cleanupUrlParams(t){try{const e=new URL(window.location);let a=!1;t.forEach(l=>{e.searchParams.has(l)&&(e.searchParams.delete(l),a=!0)}),a&&window.history.replaceState({},document.title,e.toString())}catch(e){console.error("Ê∏ÖÁêÜURLÂèÇÊï∞Â§±Ë¥•:",e)}},async loadPersistentNotifications(){try{const t=await Z.loadData("notification-list");t&&Array.isArray(t)?this.persistentNotifications=t:t&&t.success!==!1&&Array.isArray(t.data)?this.persistentNotifications=t.data:this.persistentNotifications=[]}catch(t){console.error("Âä†ËΩΩÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",t)}},showNotificationDetail(t){this.currentNotification=t,this.notificationDetailDialog=!0},async removePersistentNotification(t){this.persistentNotifications=this.persistentNotifications.filter(a=>a.id!==t);const e=this.persistentNotifications.length>0?this.persistentNotifications:{};await Z.saveData("notification-list",e),this.notificationDetailDialog=!1}}},No={key:2,class:"d-flex"},Ao={class:"text-h6 text-truncate font-weight-bold"},Uo={class:"text-h4 font-weight-medium mb-4",style:{"line-height":"1.5"}},zo={class:"text-subtitle-1 text-grey"},Mo={class:"d-flex align-center flex-wrap"},Lo={class:"text-subtitle-1"},Po={class:"text-grey-darken-1"},Fo={class:"text-primary font-weight-medium"},$o={key:1,class:"text-center py-4 text-grey"};function Ro(t,e,a,l,i,o){const u=Ut,m=At,f=Nt,h=Tt,x=Dt,V=_t,M=Ct,K=St,L=vt,B=wt,Q=bt,de=Ue,ee=xt,J=yt,ue=lt;return c(),v(E,null,[s(es,{class:"no-select"},{append:n(()=>[i.tokenDisplayInfo.readonly?(c(),b(P,{key:0,class:"mx-2",color:"warning","prepend-icon":"mdi-lock-alert",variant:"tonal"},{default:n(()=>[...e[29]||(e[29]=[d(" Âè™ËØª ",-1)])]),_:1})):w("",!0),i.tokenDisplayInfo.show?(c(),b(P,{key:1,style:re({cursor:i.tokenDisplayInfo.disabled?"default":"pointer"}),class:"mx-2",color:"primary","prepend-icon":"mdi-account",variant:"tonal",onClick:o.handleTokenChipClick},{default:n(()=>[d(g(i.tokenDisplayInfo.text),1)]),_:1},8,["style","onClick"])):w("",!0),o.shouldShowUrgentTestButton?(c(),b(y,{key:2,"prepend-icon":"mdi-chat",onClick:e[0]||(e[0]=S=>i.urgentTestDialog=!0),variant:"tonal"},{default:n(()=>[...e[30]||(e[30]=[d("ÂèëÈÄÅÈÄöÁü•",-1)])]),_:1})):w("",!0),s(y,{icon:"mdi-chat",variant:"text",onClick:e[1]||(e[1]=S=>i.isChatOpen=!0)}),s(y,{badge:o.unreadCount||void 0,"badge-color":o.unreadCount?"error":void 0,icon:"mdi-bell",variant:"text",onClick:e[2]||(e[2]=S=>t.$refs.messageLog.drawer=!0)},null,8,["badge","badge-color"]),s(y,{icon:"mdi-cog",variant:"text",onClick:e[3]||(e[3]=S=>t.$router.push("/settings"))})]),default:n(()=>[s(Zt,null,{default:n(()=>[d(g(o.titleText),1)]),_:1}),s(U)]),_:1}),o.shouldShowInit?(c(),b(u,{key:0,preconfig:i.preconfigData,onDone:e[4]||(e[4]=S=>i.settingsTick++)},null,8,["preconfig"])):w("",!0),o.shouldShowInit?w("",!0):(c(),b(m,{key:1,ref:"studentNameManager",onTokenInfoUpdated:o.updateTokenDisplayInfo},null,8,["onTokenInfoUpdated"])),o.shouldShowInit?w("",!0):(c(),v("div",No,[s(pt,{class:"main-window flex-grow-1 no-select bloom-container",fluid:""},{default:n(()=>[i.persistentNotifications.length>0?(c(),b(ae,{key:0,class:"mb-4"},{default:n(()=>[s(X,{cols:"12"},{default:n(()=>[(c(!0),v(E,null,A(i.persistentNotifications,S=>(c(),b(_,{key:S.id,color:S.isUrgent?"error":"primary",class:"mb-2 cursor-pointer",variant:"tonal",onClick:T=>o.showNotificationDetail(S)},{default:n(()=>[s(N,{class:"d-flex align-center py-3"},{default:n(()=>[r("span",Ao,g(S.message),1),s(U),s(y,{icon:"mdi-chevron-right",variant:"text"})]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1})]),_:1})):w("",!0),s(H,{modelValue:i.notificationDetailDialog,"onUpdate:modelValue":e[8]||(e[8]=S=>i.notificationDetailDialog=S),"max-width":"700",scrollable:""},{default:n(()=>[i.currentNotification?(c(),b(_,{key:0,class:"rounded-xl"},{default:n(()=>[s($,{class:"d-flex align-center pa-4 text-h5"},{default:n(()=>[r("span",{class:le([i.currentNotification.isUrgent?"text-error":"","font-weight-bold"])},g(i.currentNotification.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•ËØ¶ÊÉÖ"),3),s(U),s(y,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=S=>i.notificationDetailDialog=!1)})]),_:1}),s(ce),s(N,{class:"pa-6"},{default:n(()=>[r("div",Uo,g(i.currentNotification.message),1),r("div",zo," ÂèëÂ∏ÉÊó∂Èó¥Ôºö"+g(o.formatTime(i.currentNotification.timestamp)),1)]),_:1}),s(ce),s(q,{class:"pa-4"},{default:n(()=>[s(y,{color:"error","prepend-icon":"mdi-delete",size:"x-large",variant:"tonal",class:"px-6",onClick:e[6]||(e[6]=S=>o.removePersistentNotification(i.currentNotification.id))},{default:n(()=>[...e[31]||(e[31]=[d(" Âà†Èô§ÈÄöÁü• ",-1)])]),_:1}),s(U),s(y,{color:"primary",size:"x-large",variant:"elevated",class:"px-8",onClick:e[7]||(e[7]=S=>i.notificationDetailDialog=!1)},{default:n(()=>[...e[32]||(e[32]=[d(" ÂÖ≥Èó≠ ",-1)])]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1},8,["modelValue"]),s(f,{"sorted-items":o.sortedItems,"unused-subjects":o.unusedSubjects,"empty-subject-display":o.emptySubjectDisplay,"is-mobile":o.isMobile,"is-editing-disabled":o.isEditingDisabled,"content-style":i.state.contentStyle,"highlighted-cards":i.highlightedCards,onOpenDialog:o.openDialog,onOpenAttendance:o.setAttendanceArea,onDisabledClick:o.handleDisabledClick,onOpenExamDetail:o.openExamDetail},null,8,["sorted-items","unused-subjects","empty-subject-display","is-mobile","is-editing-disabled","content-style","highlighted-cards","onOpenDialog","onOpenAttendance","onDisabledClick","onOpenExamDetail"]),s(h,{synced:i.state.synced,"loading-upload":i.loading.upload,"show-random-picker-button":o.showRandomPickerButton,"show-exam-schedule-button":o.showExamScheduleButton,"show-list-card-button":o.showListCardButton,"show-fullscreen-button":o.showFullscreenButton,"is-fullscreen":i.state.isFullscreen,"show-anti-screen-burn-card":o.showAntiScreenBurnCard,"show-test-card-button":o.showTestCardButton,onUpload:o.manualUpload,onShowSyncMessage:o.showSyncMessage,onOpenRandomPicker:o.openRandomPicker,onToggleFullscreen:o.toggleFullscreen,onAddTestCard:o.addTestCard,onAddExamCard:e[9]||(e[9]=S=>i.showAddExamDialog=!0)},null,8,["synced","loading-upload","show-random-picker-button","show-exam-schedule-button","show-list-card-button","show-fullscreen-button","is-fullscreen","show-anti-screen-burn-card","show-test-card-button","onUpload","onShowSyncMessage","onOpenRandomPicker","onToggleFullscreen","onAddTestCard"]),s(x),i.upcomingExams.length>0&&!o.hasExamCard?(c(),b(ye,{key:1,class:"mt-4",color:"info",variant:"tonal",closable:"",icon:"mdi-calendar-clock",title:"ËøëÊúüÊúâËÄÉËØïÂÆâÊéí"},{append:n(()=>[s(y,{color:"primary",variant:"text",onClick:o.addAllUpcomingExams},{default:n(()=>[...e[34]||(e[34]=[d(" ‰∏ÄÈîÆÊ∑ªÂä† ",-1)])]),_:1},8,["onClick"])]),default:n(()=>[r("div",Mo,[e[33]||(e[33]=r("span",{class:"mr-2"},"Ê£ÄÊµãÂà∞Êú™Êù•‰∏§Â§©ÂÜÖÊúâ‰ª•‰∏ãËÄÉËØïÔºö",-1)),(c(!0),v(E,null,A(i.upcomingExams,S=>(c(),b(P,{key:S.id,size:"small",class:"mr-1 mb-1",color:"primary"},{default:n(()=>[d(g(S.examName),1)]),_:2},1024))),128))])]),_:1})):w("",!0)]),_:1}),o.isMobile?w("",!0):(c(),b(V,{key:0,"student-list":i.state.studentList,attendance:i.state.boardData.attendance,"is-editing-disabled":o.isEditingDisabled,onClick:o.setAttendanceArea,onDisabledClick:o.handleDisabledClick},null,8,["student-list","attendance","is-editing-disabled","onClick","onDisabledClick"]))])),s(M,{modelValue:i.state.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=S=>i.state.dialogVisible=S),"auto-save":o.autoSave,"initial-content":i.state.textarea,title:i.state.dialogTitle,"is-editing-past-data":o.isEditingPastData,"current-date-string":i.state.dateString,onSave:o.handleHomeworkSave},null,8,["modelValue","auto-save","initial-content","title","is-editing-past-data","current-date-string","onSave"]),s(Ht,{modelValue:i.state.snackbar,"onUpdate:modelValue":e[11]||(e[11]=S=>i.state.snackbar=S),timeout:2e3},{default:n(()=>[d(g(i.state.snackbarText),1)]),_:1},8,["modelValue"]),s(K,{modelValue:i.state.attendanceDialog,"onUpdate:modelValue":e[12]||(e[12]=S=>i.state.attendanceDialog=S),"student-list":i.state.studentList,attendance:i.state.boardData.attendance,"date-string":i.state.dateString,onSave:o.saveAttendance,onChange:o.handleAttendanceChange},null,8,["modelValue","student-list","attendance","date-string","onSave","onChange"]),s(L,{ref:"messageLog"},null,512),s(B,{"is-today":o.isToday,loading:i.loading.download,"copy-to-today-loading":i.loading.copyToToday,"selected-date":i.state.selectedDateObj,"unread-count":o.unreadCount,onRefresh:o.downloadData,onZoom:o.zoom,onOpenMessages:e[13]||(e[13]=S=>t.$refs.messageLog.drawer=!0),onOpenSettings:e[14]||(e[14]=S=>t.$router.push("/settings")),onDateSelect:o.handleDateSelect,onPrevDay:e[15]||(e[15]=S=>o.navigateDay(-1)),onNextDay:e[16]||(e[16]=S=>o.navigateDay(1)),onCopyToToday:o.copyHomeworkToToday},null,8,["is-today","loading","copy-to-today-loading","selected-date","unread-count","onRefresh","onZoom","onDateSelect","onCopyToToday"]),s(Q),s(de,{modelValue:i.isChatOpen,"onUpdate:modelValue":e[17]||(e[17]=S=>i.isChatOpen=S),"show-button":!1},null,8,["modelValue"]),s(ee,{modelValue:i.urgentTestDialog,"onUpdate:modelValue":e[18]||(e[18]=S=>i.urgentTestDialog=S)},null,8,["modelValue"]),s(H,{modelValue:i.confirmDialog.show,"onUpdate:modelValue":e[19]||(e[19]=S=>i.confirmDialog.show=S),"max-width":"400"},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"text-h6"},{default:n(()=>[...e[35]||(e[35]=[d(" Á°ÆËÆ§‰øùÂ≠ò",-1)])]),_:1}),s(N,null,{default:n(()=>[d(" ÊÇ®Ê≠£Âú®‰øÆÊîπ "+g(i.state.dateString)+" ÁöÑÊï∞ÊçÆÔºåÁ°ÆÂÆöË¶Å‰øùÂ≠òÂêóÔºü ",1)]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{color:"grey",variant:"text",onClick:i.confirmDialog.reject},{default:n(()=>[...e[36]||(e[36]=[d(" ÂèñÊ∂à ",-1)])]),_:1},8,["onClick"]),s(y,{color:"primary",onClick:i.confirmDialog.resolve},{default:n(()=>[...e[37]||(e[37]=[d(" Á°ÆËÆ§‰øùÂ≠ò",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(J,{ref:"randomPicker",attendance:i.state.boardData.attendance,"student-list":i.state.studentList},null,8,["attendance","student-list"]),s(H,{modelValue:i.urlConfigDialog.show,"onUpdate:modelValue":e[20]||(e[20]=S=>i.urlConfigDialog.show=S),"max-width":"500"},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"text-h6"},{default:n(()=>[...e[38]||(e[38]=[d(" Á°ÆËÆ§Â∫îÁî®URLÈÖçÁΩÆ",-1)])]),_:1}),s(N,null,{default:n(()=>[e[39]||(e[39]=r("p",null,"‰ª•‰∏ãÈÖçÁΩÆÂ∞ÜÂ∫îÁî®‰∫éÂΩìÂâçÁè≠Á∫ßÔºö",-1)),s(pe,{density:"compact"},{default:n(()=>[(c(!0),v(E,null,A(i.urlConfigDialog.changes,S=>(c(),b(ve,{key:S.key},{prepend:n(()=>[s(D,{icon:S.icon,class:"mr-2",size:"small"},null,8,["icon"])]),default:n(()=>[s(Ee,{class:"d-flex align-center"},{default:n(()=>[r("span",Lo,g(S.name),1),s(Ke,{activator:"parent",location:"top"},{default:n(()=>[d(g(S.description||S.key),1)]),_:2},1024)]),_:2},1024),s(Ve,null,{default:n(()=>[r("span",Po,g(S.oldValue),1),s(D,{class:"mx-1",icon:"mdi-arrow-right",size:"small"}),r("span",Fo,g(S.newValue),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{color:"grey",variant:"text",onClick:i.urlConfigDialog.cancelHandler},{default:n(()=>[...e[40]||(e[40]=[d(" ÂèñÊ∂à ",-1)])]),_:1},8,["onClick"]),s(y,{color:"primary",onClick:i.urlConfigDialog.confirmHandler},{default:n(()=>[...e[41]||(e[41]=[d(" Á°ÆËÆ§Â∫îÁî® ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(H,{modelValue:i.showExamDetailDialog,"onUpdate:modelValue":e[23]||(e[23]=S=>i.showExamDetailDialog=S),persistent:"",fullscreen:""},{default:n(()=>[i.selectedExamId?(c(),b(_,{key:0},{default:n(()=>[s($,{class:"d-flex align-center pa-4"},{default:n(()=>[e[42]||(e[42]=d(" ÁºñËæëËÄÉËØïÈÖçÁΩÆ ",-1)),s(U),s(y,{icon:"mdi-close",variant:"text",onClick:e[21]||(e[21]=S=>i.showExamDetailDialog=!1)})]),_:1}),s(N,{class:"pa-4",style:{"max-height":"70vh","overflow-y":"auto"}},{default:n(()=>[s(ue,{"config-id":i.selectedExamId,"dialog-mode":!0,onSaved:o.onExamConfigSaved,onDeleted:o.onExamConfigDeleted},null,8,["config-id","onSaved","onDeleted"])]),_:1}),s(ce),s(q,{class:"pa-4"},{default:n(()=>[s(y,{color:"error","prepend-icon":"mdi-delete",variant:"tonal",onClick:o.removeCurrentExamCard},{default:n(()=>[...e[43]||(e[43]=[d(" ÁßªÈô§Âç°Áâá ",-1)])]),_:1},8,["onClick"]),s(U),s(y,{color:"primary",variant:"text",onClick:e[22]||(e[22]=S=>i.showExamDetailDialog=!1)},{default:n(()=>[...e[44]||(e[44]=[d(" ÂÖ≥Èó≠ ",-1)])]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1},8,["modelValue"]),s(H,{modelValue:i.showAddExamDialog,"onUpdate:modelValue":e[25]||(e[25]=S=>i.showAddExamDialog=S),"max-width":"500"},{default:n(()=>[s(_,null,{default:n(()=>[s($,{class:"text-h6"},{default:n(()=>[...e[45]||(e[45]=[d("È¢ÑËßàËÄÉËØïÁúãÊùø",-1)])]),_:1}),s(N,null,{default:n(()=>[l.examStore.examList.length>0?(c(),b(pe,{key:0},{default:n(()=>[(c(!0),v(E,null,A(l.examStore.examList,S=>{var T;return c(),b(ve,{key:S.id,title:((T=l.examStore.exams[S.id])==null?void 0:T.examName)||S.id,subtitle:S.id,onClick:k=>o.addExamCard(S.id)},{prepend:n(()=>[s(D,{color:"primary"},{default:n(()=>[...e[46]||(e[46]=[d("mdi-calendar-text",-1)])]),_:1})]),append:n(()=>[s(y,{icon:o.isExamCardAdded(S.id)?"mdi-check":"mdi-plus",color:o.isExamCardAdded(S.id)?"success":"grey",variant:"text"},null,8,["icon","color"])]),_:2},1032,["title","subtitle","onClick"])}),128))]),_:1})):(c(),v("div",$o," ÊöÇÊó†ËÄÉËØïÈÖçÁΩÆ "))]),_:1}),s(q,null,{default:n(()=>[s(U),s(y,{color:"primary",variant:"text",onClick:e[24]||(e[24]=S=>i.showAddExamDialog=!1)},{default:n(()=>[...e[47]||(e[47]=[d("ÂÖ≥Èó≠",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(H,{modelValue:i.notificationDetailDialog,"onUpdate:modelValue":e[28]||(e[28]=S=>i.notificationDetailDialog=S),"max-width":"600"},{default:n(()=>[i.currentNotification?(c(),b(_,{key:0},{default:n(()=>[s($,{class:le(["headline",i.currentNotification.isUrgent?"text-error":"text-primary"])},{default:n(()=>[d(g(i.currentNotification.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•ËØ¶ÊÉÖ"),1)]),_:1},8,["class"]),s(N,{class:"text-h5 py-4"},{default:n(()=>[d(g(i.currentNotification.message),1)]),_:1}),s(q,null,{default:n(()=>[s(y,{color:"error",variant:"text",onClick:e[26]||(e[26]=S=>o.removePersistentNotification(i.currentNotification.id))},{default:n(()=>[...e[48]||(e[48]=[d("Âà†Èô§",-1)])]),_:1}),s(U),s(y,{color:"primary",onClick:e[27]||(e[27]=S=>i.notificationDetailDialog=!1)},{default:n(()=>[...e[49]||(e[49]=[d("ÂÖ≥Èó≠",-1)])]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1},8,["modelValue"]),e[50]||(e[50]=r("br",null,null,-1)),e[51]||(e[51]=r("br",null,null,-1)),e[52]||(e[52]=r("br",null,null,-1))],64)}const dl=O(Vo,[["render",Ro]]);export{dl as default};
