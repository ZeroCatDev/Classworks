import{s as mn,b as fn,V as mt,a as ft,_ as Ct,c as pn}from"./VCombobox-D76-wRQE.js";import{_ as q,o as c,j as g,w as n,c as t,ai as ze,q as K,v as o,A as w,t as v,z as j,ag as He,D as y,af as Ke,M as ue,l as E,i as m,br as hn,L as Ge,am as _t,bs as Vt,k as _,s as ke,bt as gn,C as x,a0 as z,a1 as ie,y as h,P as J,Q as A,K as P,E as je,aj as tt,F as ne,bu as Be,ac as nt,ak as et,G as de,x as te,Y as Le,a4 as wn,N as Ve,O as Ae,H as we,aa as Dt,bf as vn,B as bn,g as yn,ar as kn,bv as xn,p as Sn,bw as Cn,bd as At,d as Fe,ae as pt,aU as _n,a2 as ge,R as ht,ap as Vn,Z as Dn,a3 as Me,aP as An,r as Tn,X as In}from"./index-DS_mP1l0.js";import{V as X}from"./VChip-DXbJhYeb.js";import{V as Tt}from"./VSwitch-W6HBEtkv.js";import{e as Je,V as It}from"./filter-CXn4g5S1.js";import{V as R}from"./VTextField-B3mgzys3.js";import{d as re,a as Qe,c as gt,b as jn,o as En,k as Un}from"./dataProvider-d4kaP9eY.js";import{V as $,a as Te}from"./VAlert-C6vRZNCN.js";import{V as ce,a as O}from"./VRow-t6OL9jRI.js";import{V as st}from"./VContainer-BfESQJFn.js";import{a as Se}from"./VPagination-BGTHzXGg.js";import{V as Ie}from"./VTextarea-DGS_A_Ul.js";import{V as jt}from"./VForm-D0L66uox.js";import{V as it,a as lt,b as Et,c as ot}from"./VExpansionPanels-Dns63qJE.js";import{e as Ut,b as Nn,a as he}from"./VTabsWindowItem-BTN93EL8.js";import{V as wt}from"./VCheckboxBtn-C6cZpiqT.js";import{i as Mn,t as Pn}from"./serverRotation-mM--a4oc.js";import{V as vt,a as bt,b as Bn,c as Ln}from"./VAppBarTitle-BKEu3EYt.js";import{V as zn}from"./VSheet-C1GOiZPj.js";const On={name:"SettingsCard",props:{title:{type:String,required:!0},icon:{type:String,required:!0},loading:{type:Boolean,default:!1}}};function Rn(s,e,a,d,i,l){return c(),g(E,{class:"settings-card rounded-lg",elevation:"2"},{default:n(()=>[t(ze,null,{prepend:n(()=>[t(v,{icon:a.icon,class:"mr-2",size:"large"},null,8,["icon"])]),default:n(()=>[t(K,{class:"text-h6"},{default:n(()=>[o(w(a.title),1)]),_:1})]),_:1}),t(j,null,{default:n(()=>[a.loading?(c(),g(He,{key:0,class:"mb-4",color:"primary",indeterminate:""})):y("",!0),Ke(s.$slots,"default",{},void 0,!0)]),_:3}),s.$slots.actions?(c(),g(ue,{key:0,class:"pa-4"},{default:n(()=>[Ke(s.$slots,"actions",{},void 0,!0)]),_:3})):y("",!0)]),_:3})}const ee=q(On,[["render",Rn],["__scopeId","data-v-9c035df1"]]);var Kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Nt={exports:{}};(function(s,e){(function(a,d){s.exports=d()})(typeof self<"u"?self:Kn,()=>(()=>{var a={3146:(r,p,u)=>{for(var b=u(3491),T=typeof window>"u"?u.g:window,I=["moz","webkit"],H="AnimationFrame",G=T["request"+H],Z=T["cancel"+H]||T["cancelRequest"+H],fe=0;!G&&fe<I.length;fe++)G=T[I[fe]+"Request"+H],Z=T[I[fe]+"Cancel"+H]||T[I[fe]+"CancelRequest"+H];if(!G||!Z){var pe=0,me=0,se=[],be=1e3/60;G=function(D){if(se.length===0){var V=b(),k=Math.max(0,be-(V-pe));pe=k+V,setTimeout(function(){var N=se.slice(0);se.length=0;for(var Q=0;Q<N.length;Q++)if(!N[Q].cancelled)try{N[Q].callback(pe)}catch(le){setTimeout(function(){throw le},0)}},Math.round(k))}return se.push({handle:++me,callback:D,cancelled:!1}),me},Z=function(D){for(var V=0;V<se.length;V++)se[V].handle===D&&(se[V].cancelled=!0)}}r.exports=function(D){return G.call(T,D)},r.exports.cancel=function(){Z.apply(T,arguments)},r.exports.polyfill=function(D){D||(D=T),D.requestAnimationFrame=G,D.cancelAnimationFrame=Z}},3491:function(r){(function(){var p,u,b,T,I,H;typeof performance<"u"&&performance!==null&&performance.now?r.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(r.exports=function(){return(p()-I)/1e6},u=process.hrtime,T=(p=function(){var G;return 1e9*(G=u())[0]+G[1]})(),H=1e9*process.uptime(),I=T-H):Date.now?(r.exports=function(){return Date.now()-b},b=Date.now()):(r.exports=function(){return new Date().getTime()-b},b=new Date().getTime())}).call(this)}},d={};function i(r){var p=d[r];if(p!==void 0)return p.exports;var u=d[r]={exports:{}};return a[r].call(u.exports,u,u.exports,i),u.exports}i.n=r=>{var p=r&&r.__esModule?()=>r.default:()=>r;return i.d(p,{a:p}),p},i.d=(r,p)=>{for(var u in p)i.o(p,u)&&!i.o(r,u)&&Object.defineProperty(r,u,{enumerable:!0,get:p[u]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(r,p)=>Object.prototype.hasOwnProperty.call(r,p);var l={};return(()=>{i.d(l,{default:()=>nn});var r=i(3146),p=i.n(r);const u=function(M){return new RegExp(/<[a-z][\s\S]*>/i).test(M)},b=function(M,S){return Math.floor(Math.random()*(S-M+1))+M};var T="TYPE_CHARACTER",I="REMOVE_CHARACTER",H="REMOVE_ALL",G="REMOVE_LAST_VISIBLE_NODE",Z="PAUSE_FOR",fe="CALL_FUNCTION",pe="ADD_HTML_TAG_ELEMENT",me="CHANGE_DELETE_SPEED",se="CHANGE_DELAY",be="CHANGE_CURSOR",D="PASTE_STRING",V="HTML_TAG";function k(M){return k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},k(M)}function N(M,S){var B=Object.keys(M);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(M);S&&(U=U.filter(function(ye){return Object.getOwnPropertyDescriptor(M,ye).enumerable})),B.push.apply(B,U)}return B}function Q(M){for(var S=1;S<arguments.length;S++){var B=arguments[S]!=null?arguments[S]:{};S%2?N(Object(B),!0).forEach(function(U){L(M,U,B[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(B)):N(Object(B)).forEach(function(U){Object.defineProperty(M,U,Object.getOwnPropertyDescriptor(B,U))})}return M}function le(M){return function(S){if(Array.isArray(S))return _e(S)}(M)||function(S){if(typeof Symbol<"u"&&S[Symbol.iterator]!=null||S["@@iterator"]!=null)return Array.from(S)}(M)||function(S,B){if(S){if(typeof S=="string")return _e(S,B);var U={}.toString.call(S).slice(8,-1);return U==="Object"&&S.constructor&&(U=S.constructor.name),U==="Map"||U==="Set"?Array.from(S):U==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(U)?_e(S,B):void 0}}(M)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _e(M,S){(S==null||S>M.length)&&(S=M.length);for(var B=0,U=Array(S);B<S;B++)U[B]=M[B];return U}function W(M,S){for(var B=0;B<S.length;B++){var U=S[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(M,xe(U.key),U)}}function L(M,S,B){return(S=xe(S))in M?Object.defineProperty(M,S,{value:B,enumerable:!0,configurable:!0,writable:!0}):M[S]=B,M}function xe(M){var S=function(B){if(k(B)!="object"||!B)return B;var U=B[Symbol.toPrimitive];if(U!==void 0){var ye=U.call(B,"string");if(k(ye)!="object")return ye;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(B)}(M);return k(S)=="symbol"?S:S+""}const nn=function(){function M(U,ye){var f=this;if(function(C,F){if(!(C instanceof F))throw new TypeError("Cannot call a class as a function")}(this,M),L(this,"state",{cursorAnimation:null,lastFrameTime:null,pauseUntil:null,eventQueue:[],eventLoop:null,eventLoopPaused:!1,reverseCalledEvents:[],calledEvents:[],visibleNodes:[],initialOptions:null,elements:{container:null,wrapper:document.createElement("span"),cursor:document.createElement("span")}}),L(this,"options",{strings:null,cursor:"|",delay:"natural",pauseFor:1500,deleteSpeed:"natural",loop:!1,autoStart:!1,devMode:!1,skipAddStyles:!1,wrapperClassName:"Typewriter__wrapper",cursorClassName:"Typewriter__cursor",stringSplitter:null,onCreateTextNode:null,onRemoveNode:null}),L(this,"setupWrapperElement",function(){f.state.elements.container&&(f.state.elements.wrapper.className=f.options.wrapperClassName,f.state.elements.cursor.className=f.options.cursorClassName,f.state.elements.cursor.innerHTML=f.options.cursor,f.state.elements.container.innerHTML="",f.state.elements.container.appendChild(f.state.elements.wrapper),f.state.elements.container.appendChild(f.state.elements.cursor))}),L(this,"start",function(){return f.state.eventLoopPaused=!1,f.runEventLoop(),f}),L(this,"pause",function(){return f.state.eventLoopPaused=!0,f}),L(this,"stop",function(){return f.state.eventLoop&&((0,r.cancel)(f.state.eventLoop),f.state.eventLoop=null),f}),L(this,"pauseFor",function(C){return f.addEventToQueue(Z,{ms:C}),f}),L(this,"typeOutAllStrings",function(){return typeof f.options.strings=="string"?(f.typeString(f.options.strings).pauseFor(f.options.pauseFor),f):(f.options.strings.forEach(function(C){f.typeString(C).pauseFor(f.options.pauseFor).deleteAll(f.options.deleteSpeed)}),f)}),L(this,"typeString",function(C){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(u(C))return f.typeOutHTMLString(C,F);if(C){var oe=(f.options||{}).stringSplitter,ae=typeof oe=="function"?oe(C):C.split("");f.typeCharacters(ae,F)}return f}),L(this,"pasteString",function(C){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return u(C)?f.typeOutHTMLString(C,F,!0):(C&&f.addEventToQueue(D,{character:C,node:F}),f)}),L(this,"typeOutHTMLString",function(C){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,oe=arguments.length>2?arguments[2]:void 0,ae=function(Ee){var Ue=document.createElement("div");return Ue.innerHTML=Ee,Ue.childNodes}(C);if(ae.length>0)for(var Y=0;Y<ae.length;Y++){var ve=ae[Y],De=ve.innerHTML;ve&&ve.nodeType!==3?(ve.innerHTML="",f.addEventToQueue(pe,{node:ve,parentNode:F}),oe?f.pasteString(De,ve):f.typeString(De,ve)):ve.textContent&&(oe?f.pasteString(ve.textContent,F):f.typeString(ve.textContent,F))}return f}),L(this,"deleteAll",function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"natural";return f.addEventToQueue(H,{speed:C}),f}),L(this,"changeDeleteSpeed",function(C){if(!C)throw new Error("Must provide new delete speed");return f.addEventToQueue(me,{speed:C}),f}),L(this,"changeDelay",function(C){if(!C)throw new Error("Must provide new delay");return f.addEventToQueue(se,{delay:C}),f}),L(this,"changeCursor",function(C){if(!C)throw new Error("Must provide new cursor");return f.addEventToQueue(be,{cursor:C}),f}),L(this,"deleteChars",function(C){if(!C)throw new Error("Must provide amount of characters to delete");for(var F=0;F<C;F++)f.addEventToQueue(I);return f}),L(this,"callFunction",function(C,F){if(!C||typeof C!="function")throw new Error("Callback must be a function");return f.addEventToQueue(fe,{cb:C,thisArg:F}),f}),L(this,"typeCharacters",function(C){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!C||!Array.isArray(C))throw new Error("Characters must be an array");return C.forEach(function(oe){f.addEventToQueue(T,{character:oe,node:F})}),f}),L(this,"removeCharacters",function(C){if(!C||!Array.isArray(C))throw new Error("Characters must be an array");return C.forEach(function(){f.addEventToQueue(I)}),f}),L(this,"addEventToQueue",function(C,F){var oe=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return f.addEventToStateProperty(C,F,oe,"eventQueue")}),L(this,"addReverseCalledEvent",function(C,F){var oe=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return f.options.loop?f.addEventToStateProperty(C,F,oe,"reverseCalledEvents"):f}),L(this,"addEventToStateProperty",function(C,F){var oe=arguments.length>2&&arguments[2]!==void 0&&arguments[2],ae=arguments.length>3?arguments[3]:void 0,Y={eventName:C,eventArgs:F||{}};return f.state[ae]=oe?[Y].concat(le(f.state[ae])):[].concat(le(f.state[ae]),[Y]),f}),L(this,"runEventLoop",function(){f.state.lastFrameTime||(f.state.lastFrameTime=Date.now());var C=Date.now(),F=C-f.state.lastFrameTime;if(!f.state.eventQueue.length){if(!f.options.loop)return;f.state.eventQueue=le(f.state.calledEvents),f.state.calledEvents=[],f.options=Q({},f.state.initialOptions)}if(f.state.eventLoop=p()(f.runEventLoop),!f.state.eventLoopPaused){if(f.state.pauseUntil){if(C<f.state.pauseUntil)return;f.state.pauseUntil=null}var oe,ae=le(f.state.eventQueue),Y=ae.shift();if(!(F<=(oe=Y.eventName===G||Y.eventName===I?f.options.deleteSpeed==="natural"?b(40,80):f.options.deleteSpeed:f.options.delay==="natural"?b(120,160):f.options.delay))){var ve=Y.eventName,De=Y.eventArgs;switch(f.logInDevMode({currentEvent:Y,state:f.state,delay:oe}),ve){case D:case T:var Ee=De.character,Ue=De.node,rt=document.createTextNode(Ee),Ne=rt;f.options.onCreateTextNode&&typeof f.options.onCreateTextNode=="function"&&(Ne=f.options.onCreateTextNode(Ee,rt)),Ne&&(Ue?Ue.appendChild(Ne):f.state.elements.wrapper.appendChild(Ne)),f.state.visibleNodes=[].concat(le(f.state.visibleNodes),[{type:"TEXT_NODE",character:Ee,node:Ne}]);break;case I:ae.unshift({eventName:G,eventArgs:{removingCharacterNode:!0}});break;case Z:var sn=Y.eventArgs.ms;f.state.pauseUntil=Date.now()+parseInt(sn);break;case fe:var ut=Y.eventArgs,ln=ut.cb,on=ut.thisArg;ln.call(on,{elements:f.state.elements});break;case pe:var dt=Y.eventArgs,qe=dt.node,Ze=dt.parentNode;Ze?Ze.appendChild(qe):f.state.elements.wrapper.appendChild(qe),f.state.visibleNodes=[].concat(le(f.state.visibleNodes),[{type:V,node:qe,parentNode:Ze||f.state.elements.wrapper}]);break;case H:var an=f.state.visibleNodes,Xe=De.speed,Oe=[];Xe&&Oe.push({eventName:me,eventArgs:{speed:Xe,temp:!0}});for(var ct=0,rn=an.length;ct<rn;ct++)Oe.push({eventName:G,eventArgs:{removingCharacterNode:!1}});Xe&&Oe.push({eventName:me,eventArgs:{speed:f.options.deleteSpeed,temp:!0}}),ae.unshift.apply(ae,Oe);break;case G:var un=Y.eventArgs.removingCharacterNode;if(f.state.visibleNodes.length){var $e=f.state.visibleNodes.pop(),dn=$e.type,Re=$e.node,cn=$e.character;f.options.onRemoveNode&&typeof f.options.onRemoveNode=="function"&&f.options.onRemoveNode({node:Re,character:cn}),Re&&Re.parentNode.removeChild(Re),dn===V&&un&&ae.unshift({eventName:G,eventArgs:{}})}break;case me:f.options.deleteSpeed=Y.eventArgs.speed;break;case se:f.options.delay=Y.eventArgs.delay;break;case be:f.options.cursor=Y.eventArgs.cursor,f.state.elements.cursor.innerHTML=Y.eventArgs.cursor}f.options.loop&&(Y.eventName===G||Y.eventArgs&&Y.eventArgs.temp||(f.state.calledEvents=[].concat(le(f.state.calledEvents),[Y]))),f.state.eventQueue=ae,f.state.lastFrameTime=C}}}),U)if(typeof U=="string"){var at=document.querySelector(U);if(!at)throw new Error("Could not find container element");this.state.elements.container=at}else this.state.elements.container=U;ye&&(this.options=Q(Q({},this.options),ye)),this.state.initialOptions=Q({},this.options),this.init()}var S,B;return S=M,(B=[{key:"init",value:function(){var U,ye;this.setupWrapperElement(),this.addEventToQueue(be,{cursor:this.options.cursor},!0),this.addEventToQueue(H,null,!0),!window||window.___TYPEWRITER_JS_STYLES_ADDED___||this.options.skipAddStyles||(U=".Typewriter__cursor{-webkit-animation:Typewriter-cursor 1s infinite;animation:Typewriter-cursor 1s infinite;margin-left:1px}@-webkit-keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}",(ye=document.createElement("style")).appendChild(document.createTextNode(U)),document.head.appendChild(ye),window.___TYPEWRITER_JS_STYLES_ADDED___=!0),this.options.autoStart===!0&&this.options.strings&&this.typeOutAllStrings().start()}},{key:"logInDevMode",value:function(U){this.options.devMode&&console.log(U)}}])&&W(S.prototype,B),Object.defineProperty(S,"prototype",{writable:!1}),M}()})(),l.default})())})(Nt);var Jn=Nt.exports;const yt=Fn(Jn),Qn=[{text:"帝高阳之苗裔兮，朕皇考曰伯庸。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"摄提贞于孟陬兮，惟庚寅吾以降。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"皇览揆余初度兮，肇锡余以嘉名。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"名余曰正则兮，字余曰灵均。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"纷吾既有此内美兮，又重之以修能。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"扈江离与辟芷兮，纫秋兰以为佩。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"汩余若将不及兮，恐年岁之不吾与。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"朝搴阰之木兰兮，夕揽洲之宿莽。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"日月忽其不淹兮，春与秋其代序。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"惟草木之零落兮，恐美人之迟暮。(惟 通：唯)",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"不抚壮而弃秽兮，何不改此度？(改此度 一作：改乎此度)",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"乘骐骥以驰骋兮，来吾道夫先路！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"昔三后之纯粹兮，固众芳之所在。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"杂申椒与菌桂兮，岂惟纫夫蕙茝！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"彼尧舜之耿介兮，既遵道而得路。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何桀纣之猖披兮，夫唯捷径以窘步。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"惟夫党人之偷乐兮，路幽昧以险隘。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"岂余身之惮殃兮，恐皇舆之败绩！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忽奔走以先后兮，及前王之踵武。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"荃不查余之中情兮，反信谗而齌怒。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"余固知謇謇之为患兮，忍而不能舍也。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"指九天以为正兮，夫唯灵修之故也。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"曰黄昏以为期兮，羌中道而改路！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"初既与余成言兮，后悔遁而有他。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"余既不难夫离别兮，伤灵修之数化。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"余既滋兰之九畹兮，又树蕙之百亩。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"畦留夷与揭车兮，杂杜衡与芳芷。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"冀枝叶之峻茂兮，愿俟时乎吾将刈。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"虽萎绝其亦何伤兮，哀众芳之芜秽。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"众皆竞进以贪婪兮，凭不厌乎求索。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"羌内恕己以量人兮，各兴心而嫉妒。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忽驰骛以追逐兮，非余心之所急。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"老冉冉其将至兮，恐修名之不立。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"朝饮木兰之坠露兮，夕餐秋菊之落英。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"苟余情其信姱以练要兮，长顑颔亦何伤。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"掔木根以结茝兮，贯薜荔之落蕊。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"矫菌桂以纫蕙兮，索胡绳之纚纚。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"謇吾法夫前修兮，非世俗之所服。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"虽不周于今之人兮，愿依彭咸之遗则。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"长太息以掩涕兮，哀民生之多艰。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"余虽好修姱以鞿羁兮，謇朝谇而夕替。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"既替余以蕙纕兮，又申之以揽茝。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"亦余心之所善兮，虽九死其犹未悔。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"怨灵修之浩荡兮，终不察夫民心。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"众女嫉余之蛾眉兮，谣诼谓余以善淫。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"固时俗之工巧兮，偭规矩而改错。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"背绳墨以追曲兮，竞周容以为度。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忳郁邑余侘傺兮，吾独穷困乎此时也。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"宁溘死以流亡兮，余不忍为此态也。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"鸷鸟之不群兮，自前世而固然。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何方圜之能周兮，夫孰异道而相安？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"屈心而抑志兮，忍尤而攘诟。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"伏清白以死直兮，固前圣之所厚。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"悔相道之不察兮，延伫乎吾将反。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"回朕车以复路兮，及行迷之未远。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"步余马于兰皋兮，驰椒丘且焉止息。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"进不入以离尤兮，退将复修吾初服。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"制芰荷以为衣兮，集芙蓉以为裳。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"不吾知其亦已兮，苟余情其信芳。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"高余冠之岌岌兮，长余佩之陆离。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"芳与泽其杂糅兮，唯昭质其犹未亏。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忽反顾以游目兮，将往观乎四荒。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"佩缤纷其繁饰兮，芳菲菲其弥章。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"民生各有所乐兮，余独好修以为常。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"虽体解吾犹未变兮，岂余心之可惩。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"女媭之婵媛兮，申申其詈予，曰：",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"鲧婞直以亡身兮，终然夭乎羽之野。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"汝何博謇而好修兮，纷独有此姱节？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"薋菉葹以盈室兮，判独离而不服。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"众不可户说兮，孰云察余之中情？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"世并举而好朋兮，夫何茕独而不予听？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"依前圣以节中兮，喟凭心而历兹。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"济沅湘以南征兮，就重华而陈词：",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"启《九辩》与《九歌》兮，夏康娱以自纵。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"不顾难以图后兮，五子用失乎家衖。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"羿淫游以佚畋兮，又好射夫封狐。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"固乱流其鲜终兮，浞又贪夫厥家。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"浇身被服强圉兮，纵欲而不忍。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"日康娱而自忘兮，厥首用夫颠陨。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"夏桀之常违兮，乃遂焉而逢殃。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"后辛之菹醢兮，殷宗用而不长。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"汤禹俨而祗敬兮，周论道而莫差。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"举贤才而授能兮，循绳墨而不颇。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"皇天无私阿兮，览民德焉错辅。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"夫维圣哲以茂行兮，苟得用此下土。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"瞻前而顾后兮，相观民之计极。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"夫孰非义而可用兮？孰非善而可服？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"阽余身而危死兮，览余初其犹未悔。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"不量凿而正枘兮，固前修以菹醢。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"曾歔欷余郁邑兮，哀朕时之不当。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"揽茹蕙以掩涕兮，沾余襟之浪浪。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"跪敷衽以陈辞兮，耿吾既得此中正。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"驷玉虬以椉鹥兮，溘埃风余上征。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"朝发轫于苍梧兮，夕余至乎县圃。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"欲少留此灵琐兮，日忽忽其将暮。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吾令羲和弭节兮，望崦嵫而勿迫。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"路曼曼其修远兮，吾将上下而求索。(曼曼 一作：漫漫)",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"饮余马于咸池兮，总余辔乎扶桑。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"折若木以拂日兮，聊逍遥以相羊。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"前望舒使先驱兮，后飞廉使奔属。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"鸾皇为余先戒兮，雷师告余以未具。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吾令凤鸟飞腾兮，继之以日夜。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"飘风屯其相离兮，帅云霓而来御。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"纷总总其离合兮，斑陆离其上下。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吾令帝阍开关兮，倚阊阖而望予。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"时暧暧其将罢兮，结幽兰而延伫。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"世溷浊而不分兮，好蔽美而嫉妒。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"朝吾将济于白水兮，登阆风而绁马。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忽反顾以流涕兮，哀高丘之无女。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"溘吾游此春宫兮，折琼枝以继佩。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"及荣华之未落兮，相下女之可诒。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吾令丰隆乘云兮，求宓妃之所在。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"解佩纕以结言兮，吾令謇修以为理。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"纷总总其离合兮，忽纬繣其难迁。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"夕归次于穷石兮，朝濯发乎洧盘。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"保厥美以骄傲兮，日康娱以淫游。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"虽信美而无礼兮，来违弃而改求。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"览相观于四极兮，周流乎天余乃下。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"望瑶台之偃蹇兮，见有娀之佚女。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吾令鸩为媒兮，鸩告余以不好。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"雄鸠之鸣逝兮，余犹恶其佻巧。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"心犹豫而狐疑兮，欲自适而不可。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"凤皇既受诒兮，恐高辛之先我。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"欲远集而无所止兮，聊浮游以逍遥。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"及少康之未家兮，留有虞之二姚。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"理弱而媒拙兮，恐导言之不固。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"世溷浊而嫉贤兮，好蔽美而称恶。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"闺中既以邃远兮，哲王又不寤。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"怀朕情而不发兮，余焉能忍而与此终古？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"索琼茅以筳篿兮，命灵氛为余占之。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"曰：两美其必合兮，孰信修而慕之？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"思九州之博大兮，岂惟是其有女？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"曰：勉远逝而无狐疑兮，孰求美而释女？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何所独无芳草兮，尔何怀乎故宇？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"世幽昧以昡曜兮，孰云察余之善恶？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"民好恶其不同兮，惟此党人其独异！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"户服艾以盈要兮，谓幽兰其不可佩。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"览察草木其犹未得兮，岂珵美之能当？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"苏粪壤以充帏兮，谓申椒其不芳。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"欲从灵氛之吉占兮，心犹豫而狐疑。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"巫咸将夕降兮，怀椒糈而要之。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"百神翳其备降兮，九疑缤其并迎。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"皇剡剡其扬灵兮，告余以吉故。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"曰：勉升降以上下兮，求矩矱之所同。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"汤禹俨而求合兮，挚咎繇而能调。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"苟中情其好修兮，又何必用夫行媒？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"说操筑于傅岩兮，武丁用而不疑。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"吕望之鼓刀兮，遭周文而得举。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"宁戚之讴歌兮，齐桓闻以该辅。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"及年岁之未晏兮，时亦犹其未央。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"恐鹈鴂之先鸣兮，使夫百草为之不芳。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何琼佩之偃蹇兮，众薆然而蔽之。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"惟此党人之不谅兮，恐嫉妒而折之。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"时缤纷其变易兮，又何可以淹留？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"兰芷变而不芳兮，荃蕙化而为茅。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何昔日之芳草兮，今直为此萧艾也？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"岂其有他故兮，莫好修之害也！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"余以兰为可恃兮，羌无实而容长。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"委厥美以从俗兮，苟得列乎众芳。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"椒专佞以慢慆兮，樧又欲充夫佩帏。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"既干进而务入兮，又何芳之能祗？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"固时俗之流从兮，又孰能无变化？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"览椒兰其若兹兮，又况揭车与江离？",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"惟兹佩之可贵兮，委厥美而历兹。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"芳菲菲而难亏兮，芬至今犹未沬。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"和调度以自娱兮，聊浮游而求女。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"及余饰之方壮兮，周流观乎上下。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"灵氛既告余以吉占兮，历吉日乎吾将行。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"折琼枝以为羞兮，精琼爢以为粻。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"为余驾飞龙兮，杂瑶象以为车。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"何离心之可同兮？吾将远逝以自疏。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"邅吾道夫昆仑兮，路修远以周流。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"扬云霓之晻蔼兮，鸣玉鸾之啾啾。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"朝发轫于天津兮，夕余至乎西极。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"凤皇翼其承旗兮，高翱翔之翼翼。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"忽吾行此流沙兮，遵赤水而容与。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"麾蛟龙使梁津兮，诏西皇使涉予。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"路修远以多艰兮，腾众车使径待。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"路不周以左转兮，指西海以为期。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"屯余车其千乘兮，齐玉轪而并驰。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"驾八龙之婉婉兮，载云旗之委蛇。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"抑志而弭节兮，神高驰之邈邈。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"奏《九歌》而舞《韶》兮，聊假日以媮乐。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"陟升皇之赫戏兮，忽临睨夫旧乡。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"仆夫悲余马怀兮，蜷局顾而不行。",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"乱曰：已矣哉！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"国无人莫我知兮，又何怀乎故都！",author:"屈原",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"},{text:"既莫足与为美政兮，吾将从彭咸之所居！",author:"离骚",contributor:"Sunwuyuan",link:"https://www.gushiwen.cn/shiwenv.aspx?id=f5714bcd33e3"}],kt={quotes:Qn},xt={text:"点击此处可以查看 Classworks 用户群里沙雕群友们的发言",author:"点击后会复制当前句子到剪贴板中"},St={main:{delay:50,deleteSpeed:100},source:{delay:10,deleteSpeed:10,cursor:""}},Hn={name:"EchoChamberCard",components:{SettingsCard:ee},data:()=>({typewriter:null,sourceWriter:null,currentQuote:xt,hasClicked:!1}),mounted(){this.initTypewriters()},methods:{initTypewriters(){this.typewriter=new yt(this.$refs.typewriter,St.main),this.sourceWriter=new yt(this.$refs.sourceWriter,St.source),this.typeQuote(xt)},typeQuote(s){this.typewriter.deleteAll(30).typeString(s.text).start(),s.author&&this.sourceWriter.deleteAll(20).typeString(s.author).start()},async handleClick(){this.hasClicked||(this.hasClicked=!0),await this.copyToClipboard(),this.currentQuote=this.getRandomQuote(),this.typeQuote(this.currentQuote)},getRandomQuote(){return kt.quotes[Math.floor(Math.random()*kt.quotes.length)]},async copyToClipboard(){if(!this.currentQuote)return;const{text:s,author:e,contributor:a,link:d}=this.currentQuote,i=[s,e&&`作者：${e}`,a&&`贡献者：${a}`,(d||a)&&`来源：${d||`https://github.com/${a}`}`].filter(Boolean);try{await navigator.clipboard.writeText(i.join(`
`))}catch(l){console.error("复制失败:",l)}}},beforeUnmount(){[this.typewriter,this.sourceWriter].forEach(s=>s==null?void 0:s.stop())}},Gn={ref:"typewriter",class:"typewriter-text"},Wn={ref:"sourceWriter",class:"source-text"};function Yn(s,e,a,d,i,l){const r=ee;return c(),g(r,{border:"",icon:"mdi-thought-bubble",title:"回声洞",onClick:l.handleClick},{default:n(()=>[t(j,null,{default:n(()=>[m("div",Gn,null,512),m("div",Wn,null,512)]),_:1}),t(hn,{name:"fade"},{default:n(()=>{var p;return[(p=s.currentQuote)!=null&&p.contributor?(c(),g(X,{key:0,class:"contributor"},{default:n(()=>[t(Ge,{start:""},{default:n(()=>[t(_t,{src:`https://github.com/${s.currentQuote.contributor}.png`},null,8,["src"])]),_:1}),o(" "+w(s.currentQuote.contributor),1)]),_:1})):y("",!0)]}),_:1})]),_:1},8,["onClick"])}const Mt=q(Hn,[["render",Yn],["__scopeId","data-v-a6a55e27"]]),qn={name:"SettingItem",props:{settingKey:{type:String,required:!0},icon:{type:String,default:null},disabled:{type:Boolean,default:!1},title:{type:String,default:null},description:{type:String,default:null}},data(){return{localValue:null,definition:null,type:null,selectOptions:[],hasOptions:!1,minValue:0,maxValue:100,stepValue:1,showSnackbar:!1,snackbarText:"",fontFamilies:[{title:"Arial",value:"Arial, sans-serif"},{title:"Calibri",value:"Calibri, sans-serif"},{title:"Cambria",value:"Cambria, serif"},{title:"Consolas",value:"Consolas, monospace"},{title:"Courier New",value:"Courier New, monospace"},{title:"Georgia",value:"Georgia, serif"},{title:"Helvetica",value:"Helvetica, sans-serif"},{title:"Segoe UI",value:"Segoe UI, sans-serif"},{title:"Times New Roman",value:"Times New Roman, serif"},{title:"Trebuchet MS",value:"Trebuchet MS, sans-serif"},{title:"Verdana",value:"Verdana, sans-serif"},{title:"Monospace",value:"monospace"},{title:"Sans-serif",value:"sans-serif"},{title:"Serif",value:"serif"}],displayValueMappings:{"display.emptySubjectDisplay":{card:"卡片",button:"按钮"},"theme.mode":{light:"浅色",dark:"深色"},"server.provider":{classworkscloud:"Classworks云端存储","kv-local":"KV本地存储","kv-server":"KV远程服务器"}},defaultIcons:{boolean:"mdi-toggle-switch-outline",number:"mdi-numeric",string:"mdi-form-textbox"}}},computed:{displayTitle(){if(this.title)return this.title;if(this.definition&&this.definition.description)return this.definition.description;const s=this.settingKey.split(".");return s[s.length-1]},displayDescription(){return this.description?this.description:this.settingKey},isFontFamily(){return this.settingKey.toLowerCase().includes("fontfamily")||this.settingKey.toLowerCase().includes("font.family")},isDefaultValue(){return this.definition?typeof this.localValue=="object"&&this.localValue!==null?JSON.stringify(this.localValue)===JSON.stringify(this.definition.default):this.localValue===this.definition.default:!0},settingIcon(){return this.icon?this.icon:this.definition&&this.definition.icon?this.definition.icon:this.defaultIcons[this.type]||"mdi-cog-outline"}},created(){this.loadSetting()},methods:{loadSetting(){if(this.definition=gn(this.settingKey),!this.definition){console.error(`未找到设置项定义: ${this.settingKey}`);return}if(this.type=this.definition.type,this.localValue=_(this.settingKey),this.type==="string"){if(this.isFontFamily)this.selectOptions=this.fontFamilies,this.hasOptions=!0;else if(this.settingKey in this.displayValueMappings){const s=this.displayValueMappings[this.settingKey];this.selectOptions=Object.entries(s).map(([e,a])=>({title:a,value:e})),this.hasOptions=!0}else if(this.definition.validate){const e=this.definition.validate.toString().match(/\[(.*?)\]/);if(e){const d=e[1].split(",").map(i=>{const l=i.trim().replace(/['"]/g,"");return{title:this.getDisplayValue(l)||l,value:l}});d.length>0&&(this.selectOptions=d,this.hasOptions=!0)}}}if(this.type==="number"&&this.definition.validate){const s=this.definition.validate.toString(),e=s.match(/value\s*>=\s*(\d+)/);e&&(this.minValue=Number(e[1]));const a=s.match(/value\s*<=\s*(\d+)/);a&&(this.maxValue=Number(a[1]));const d=this.maxValue-this.minValue;d>100?this.stepValue=10:d>20?this.stepValue=5:d>10?this.stepValue=2:this.stepValue=1}},getDisplayValue(s){return this.settingKey in this.displayValueMappings&&this.displayValueMappings[this.settingKey][s]||s},updateSetting(s){let e=s;this.type==="boolean"?e=!!s:this.type==="number"&&(e=Number(s),e<this.minValue&&(e=this.minValue),e>this.maxValue&&(e=this.maxValue)),ke(this.settingKey,e)?this.$emit("update",this.settingKey,e):(this.localValue=_(this.settingKey),this.$emit("error",this.settingKey))},adjustValue(s){if(this.type!=="number")return;const e=this.localValue+s;e>=this.minValue&&e<=this.maxValue&&(this.localValue=e,this.updateSetting(e))},copySettingId(){navigator.clipboard.writeText(this.settingKey).then(()=>{this.showSnackbarMessage("设置ID已复制到剪贴板")}).catch(s=>{console.error("复制失败:",s)})},copySettingValue(){let s="";typeof this.localValue=="object"&&this.localValue!==null?s=JSON.stringify(this.localValue):s=String(this.localValue),navigator.clipboard.writeText(s).then(()=>{this.showSnackbarMessage("设置值已复制到剪贴板")}).catch(e=>{console.error("复制失败:",e)})},resetToDefault(){this.definition&&(Vt(this.settingKey),this.localValue=_(this.settingKey),this.showSnackbarMessage("已重置为默认值"),this.$emit("update",this.settingKey,this.localValue))},showSnackbarMessage(s){this.snackbarText=s,this.showSnackbar=!0}}},Zn={class:"text-caption text-grey-darken-1"},Xn={class:"d-flex flex-column flex-sm-row align-center"},$n={key:0,class:"me-2"},es={key:2,class:"d-flex align-center"},ts={key:0,class:"px-4 pb-2 pt-0"};function ns(s,e,a,d,i,l){return c(),x(ne,null,[t(A,{disabled:a.disabled,class:"setting-item"},{prepend:n(()=>[t(v,{icon:l.settingIcon},null,8,["icon"])]),append:n(()=>[m("div",Xn,[i.type!=="string"||i.hasOptions?(c(),x("div",$n,[i.type==="boolean"?(c(),g(Tt,{key:0,modelValue:i.localValue,"onUpdate:modelValue":[e[0]||(e[0]=r=>i.localValue=r),l.updateSetting],disabled:a.disabled,density:"comfortable","hide-details":""},null,8,["modelValue","disabled","onUpdate:modelValue"])):i.type==="string"&&i.hasOptions?(c(),g(Je,{key:1,modelValue:i.localValue,"onUpdate:modelValue":[e[1]||(e[1]=r=>i.localValue=r),l.updateSetting],disabled:a.disabled,items:i.selectOptions,"bg-color":"surface",class:"setting-select",density:"compact","hide-details":"","item-title":"title","item-value":"value",variant:"outlined"},null,8,["modelValue","disabled","items","onUpdate:modelValue"])):i.type==="number"?(c(),x("div",es,[t(h,{disabled:a.disabled||i.localValue<=i.minValue,icon:"mdi-minus",size:"small",variant:"text",onClick:e[2]||(e[2]=r=>l.adjustValue(-i.stepValue))},null,8,["disabled"]),t(R,{modelValue:i.localValue,"onUpdate:modelValue":[e[3]||(e[3]=r=>i.localValue=r),l.updateSetting],modelModifiers:{number:!0},disabled:a.disabled,max:i.maxValue,min:i.minValue,step:i.stepValue,"bg-color":"surface",class:"mx-2 setting-number-field",density:"compact","hide-details":"",style:{width:"80px"},type:"number",variant:"outlined"},null,8,["modelValue","disabled","max","min","step","onUpdate:modelValue"]),t(h,{disabled:a.disabled||i.localValue>=i.maxValue,icon:"mdi-plus",size:"small",variant:"text",onClick:e[4]||(e[4]=r=>l.adjustValue(i.stepValue))},null,8,["disabled"])])):y("",!0)])):y("",!0),t(It,{location:"bottom"},{activator:n(({props:r})=>[t(h,je({disabled:a.disabled,class:"ml-2",icon:"mdi-dots-vertical",size:"small"},r,{variant:"text"}),null,16,["disabled"])]),default:n(()=>[t(J,{density:"compact"},{default:n(()=>[t(A,{onClick:l.copySettingId},{prepend:n(()=>[t(v,{icon:"mdi-key",size:"small"})]),default:n(()=>[t(z,null,{default:n(()=>[...e[7]||(e[7]=[o("复制设置ID",-1)])]),_:1})]),_:1},8,["onClick"]),t(A,{onClick:l.copySettingValue},{prepend:n(()=>[t(v,{icon:"mdi-content-copy",size:"small"})]),default:n(()=>[t(z,null,{default:n(()=>[...e[8]||(e[8]=[o("复制设置值",-1)])]),_:1})]),_:1},8,["onClick"]),t(P),t(A,{disabled:l.isDefaultValue,onClick:l.resetToDefault},{prepend:n(()=>[t(v,{icon:"mdi-restore",size:"small"})]),default:n(()=>[t(z,null,{default:n(()=>[...e[9]||(e[9]=[o("重置为默认值",-1)])]),_:1})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})])]),default:n(()=>[t(z,{class:"text-wrap"},{default:n(()=>[o(w(l.displayTitle),1)]),_:1}),t(ie,{class:"d-flex align-center text-wrap"},{default:n(()=>[m("span",Zn,w(a.settingKey),1)]),_:1})]),_:1},8,["disabled"]),i.type==="string"&&!i.hasOptions?(c(),x("div",ts,[t(R,{modelValue:i.localValue,"onUpdate:modelValue":[e[5]||(e[5]=r=>i.localValue=r),l.updateSetting],disabled:a.disabled,"bg-color":"surface",class:"setting-text-field mt-1",density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","disabled","onUpdate:modelValue"])])):y("",!0),t(tt,{modelValue:i.showSnackbar,"onUpdate:modelValue":e[6]||(e[6]=r=>i.showSnackbar=r),timeout:2e3,color:"success",location:"top"},{default:n(()=>[o(w(i.snackbarText),1)]),_:1},8,["modelValue"])],64)}const Ce=q(qn,[["render",ns],["__scopeId","data-v-08b49b47"]]),ss={name:"SettingsExplorer",components:{SettingItem:Ce},data(){return{searchQuery:"",currentSettings:{},unwatchFunction:null}},computed:{isDeveloperMode(){return _("developer.enabled")},allSettings(){var e;const s=[];for(const[a,d]of Object.entries(et))this.searchQuery&&!a.toLowerCase().includes(this.searchQuery.toLowerCase())&&!((e=d.description)!=null&&e.toLowerCase().includes(this.searchQuery.toLowerCase()))||s.push({key:a,...d});return s},formattedSettings(){return JSON.stringify(this.currentSettings,null,2)}},created(){this.updateCurrentSettings(),this.unwatchFunction=nt(()=>{this.updateCurrentSettings()})},beforeUnmount(){this.unwatchFunction&&this.unwatchFunction()},methods:{updateCurrentSettings(){this.currentSettings=Be()},onSettingUpdate(s,e){this.$emit("update",s,e),this.updateCurrentSettings()},onSettingError(s){this.$emit("error",s)},copySettingsToClipboard(){navigator.clipboard.writeText(JSON.stringify(this.currentSettings)).then(()=>{this.$emit("message",{type:"success",text:"设置已复制到剪贴板"})}).catch(s=>{console.error("复制到剪贴板失败:",s),this.$emit("message",{type:"error",text:"复制到剪贴板失败"})})}}},is={class:"settings-explorer"},ls={class:"settings-json"};function os(s,e,a,d,i,l){const r=Ce;return c(),x("div",is,[m("div",null,[t(R,{modelValue:i.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=p=>i.searchQuery=p),class:"mb-4",clearable:"",density:"comfortable",label:"搜索设置","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"]),t(J,null,{default:n(()=>[(c(!0),x(ne,null,de(l.allSettings,p=>(c(),x("div",{key:p.key},[(c(),g(r,{key:p.key,disabled:p.requireDeveloper&&!l.isDeveloperMode,"setting-key":p.key,onError:l.onSettingError,onUpdate:l.onSettingUpdate},null,8,["disabled","setting-key","onError","onUpdate"])),t(P,{class:"my-2"})]))),128))]),_:1}),t(E,{border:""},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[...e[1]||(e[1]=[o("当前配置",-1)])]),_:1}),t(j,null,{default:n(()=>[m("pre",ls,w(l.formattedSettings),1)]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{onClick:l.copySettingsToClipboard},{default:n(()=>[e[3]||(e[3]=o(" 复制到剪贴板 ",-1)),t(v,{right:""},{default:n(()=>[...e[2]||(e[2]=[o("mdi-content-copy",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})])])}const Pt=q(ss,[["render",os],["__scopeId","data-v-4d032f99"]]),as={name:"SettingGroup",props:{title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:null},border:{type:Boolean,default:!1}},methods:{onSettingUpdate(s,e){this.$emit("update",s,e)},onSettingError(s){this.$emit("error",s)}}};function rs(s,e,a,d,i,l){return c(),g(E,{border:a.border,class:"setting-group"},{default:n(()=>[a.title?(c(),g(K,{key:0,class:"d-flex align-center"},{default:n(()=>[a.icon?(c(),g(v,{key:0,icon:a.icon,class:"mr-2"},null,8,["icon"])):y("",!0),o(" "+w(a.title),1)]),_:1})):y("",!0),a.description?(c(),g(Le,{key:1},{default:n(()=>[o(w(a.description),1)]),_:1})):y("",!0),t(j,null,{default:n(()=>[t(J,null,{default:n(()=>[Ke(s.$slots,"default",{},void 0,!0)]),_:3})]),_:3}),s.$slots.actions?(c(),g(ue,{key:2},{default:n(()=>[Ke(s.$slots,"actions",{},void 0,!0)]),_:3})):y("",!0)]),_:3},8,["border"])}const We=q(as,[["render",rs],["__scopeId","data-v-9af32ae4"]]),us={subjects:{语文:{books:{课本:["第一单元","第二单元"],练习册:["第一章","第二章"]}},数学:{books:{课本:["第一章","第二章"],习题册:["基础练习","提高练习"]}},英语:{books:{课本:["Unit 1","Unit 2"],练习册:["Chapter 1","Chapter 2"]}}},commonSubject:{books:{试卷:["单元测试","期中测试","期末测试"],假期作业:["必做题","选做题"]}},actions:["写完","下一课","不交","明天交"]},ds={name:"HomeworkTemplateCard",components:{SettingsCard:ee,SettingGroup:We},data(){return{loading:!1,error:null,config:wn(JSON.parse(JSON.stringify(us))),originalConfig:null,newSubject:"",newCommonBook:"",newAction:"",newTask:"",editedSubjects:{},editedBookTypes:{},newBookTypes:{},newBooks:{},showSnackbar:!1,snackbarText:"",snackbarColor:"success",isNewConfig:!0,dialog:{show:!1,title:"",nameLabel:"",editedItem:{name:"",type:"",subject:"",bookType:"",originalName:"",tasks:[]}}}},computed:{subjectList(){return Object.keys(this.config.subjects)},hasChanges(){return this.isNewConfig?!0:this.originalConfig&&JSON.stringify(this.config)!==JSON.stringify(this.originalConfig)}},created(){this.loadConfig()},methods:{async loadConfig(){var s,e;this.loading=!0;try{const a=await re.loadData("classworks-config-homework-template");if(a){const d=a;Object.assign(this.config,d),this.originalConfig=JSON.parse(JSON.stringify(d)),this.isNewConfig=!1,this.showMessage("配置已加载","success")}else if(((s=a.error)==null?void 0:s.code)==="NOT_FOUND")this.showMessage("使用默认配置","info"),this.isNewConfig=!0;else{const d=((e=a.error)==null?void 0:e.message)||"加载失败";this.showMessage(`加载失败: ${d}，可继续编辑当前配置`,"warning")}}catch(a){console.error("Failed to load config:",a),this.showMessage("加载失败，可继续编辑当前配置","warning")}this.loading=!1},async saveConfig(){this.loading=!0;try{const s=await re.saveData("classworks-config-homework-template",this.config);if(s)this.originalConfig=JSON.parse(JSON.stringify(this.config)),this.isNewConfig=!1,this.showMessage("配置已保存","success");else throw new Error(s||"保存失败")}catch(s){console.error("Failed to save config:",s),this.showMessage(`保存失败: ${s.message}，请稍后重试`,"error")}this.loading=!1},showMessage(s,e="success"){this.snackbarText=s,this.snackbarColor=e,this.showSnackbar=!0},addSubject(){this.newSubject&&(this.config.subjects[this.newSubject]||(this.config.subjects[this.newSubject]={books:{}}),this.newSubject="")},updateSubject(s){const e=this.editedSubjects[s];if(e&&e!==s){const a=this.config.subjects[s];this.config.subjects[e]=a,delete this.config.subjects[s]}delete this.editedSubjects[s]},deleteSubject(s){delete this.config.subjects[s]},addBookType(s){const e=this.newBookTypes[s];e&&(this.config.subjects[s].books[e]||(this.config.subjects[s].books[e]=[]),this.newBookTypes[s]="")},updateBookType(s,e){const a=`${s}-${e}`,d=this.editedBookTypes[a];if(d&&d!==e){const i=this.config.subjects[s].books[e];this.config.subjects[s].books[d]=i,delete this.config.subjects[s].books[e]}delete this.editedBookTypes[a]},deleteBookType(s,e){s==="common"?delete this.config.commonSubject.books[e]:delete this.config.subjects[s].books[e]},addBook(s,e){const a=`${s}-${e}`,d=this.newBooks[a];d&&(this.config.subjects[s].books[e].includes(d)||this.config.subjects[s].books[e].push(d),this.newBooks[a]="")},removeBook(s,e,a){const d=this.config.subjects[s].books[e],i=d.indexOf(a);i>-1&&d.splice(i,1)},addCommonBook(){this.newCommonBook&&(this.config.commonSubject.books[this.newCommonBook]||(this.config.commonSubject.books[this.newCommonBook]=[]),this.newCommonBook="")},removeCommonBook(s){delete this.config.commonSubject.books[s]},addAction(){this.newAction&&(this.config.actions.includes(this.newAction)||this.config.actions.push(this.newAction),this.newAction="")},removeAction(s){const e=this.config.actions.indexOf(s);e>-1&&this.config.actions.splice(e,1)},openBookDialog(s,e,a){this.dialog.show=!0,this.dialog.title="编辑需完成部分",this.dialog.nameLabel="部分名称",this.dialog.editedItem={name:a,type:"book",subject:s,bookType:e,originalName:a,tasks:this.config.subjects[s].books[e]}},openCommonBookDialog(s){this.dialog.show=!0,this.dialog.title="编辑通用作业本",this.dialog.nameLabel="作业本名称",this.dialog.editedItem={name:s,type:"commonBook",originalName:s,tasks:Array.isArray(this.config.commonSubject.books[s])?[...this.config.commonSubject.books[s]]:[]}},openActionDialog(s){this.dialog={show:!0,title:"编辑操作",nameLabel:"操作名称",editedItem:{name:s,type:"action",originalName:s,tasks:[]}}},addTask(){this.newTask&&(this.dialog.editedItem.tasks||(this.dialog.editedItem.tasks=[]),this.dialog.editedItem.tasks.push(this.newTask),this.newTask="")},removeTask(s){this.dialog.editedItem.tasks.splice(s,1)},openSubjectBookDialog(s,e,a){this.dialog.show=!0,this.dialog.title=s==="common"?"编辑通用作业本":"编辑作业本",this.dialog.nameLabel="作业本名称",this.dialog.editedItem={name:e,type:"subjectBook",subject:s,originalName:e,tasks:Array.isArray(a)?[...a]:[]}},saveDialog(){const{type:s,name:e,subject:a,originalName:d,tasks:i}=this.dialog.editedItem;if(!e){this.showMessage("名称不能为空","error");return}let l;const r=a==="common"?this.config.commonSubject.books:a?this.config.subjects[a].books:null;switch(s){case"subjectBook":r&&(d!==e?(r[e]=i||[],delete r[d]):r[e]=i||[]);break;case"action":l=this.config.actions.indexOf(d),l>-1&&(this.config.actions[l]=e);break}this.closeDialog()},closeDialog(){this.dialog={show:!1,title:"",nameLabel:"",editedItem:{name:"",type:"",subject:"",originalName:"",tasks:[]}},this.newTask=""}}},cs={class:"d-flex justify-space-between align-center mb-6"};function ms(s,e,a,d,i,l){const r=We,p=ee;return c(),g(p,{loading:i.loading,border:"",icon:"mdi-book-edit",title:"作业模板配置"},{default:n(()=>[i.error?(c(),g($,{key:0,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:n(()=>[o(w(i.error),1)]),_:1})):y("",!0),m("div",cs,[m("div",null,[t(h,{loading:i.loading,class:"mr-2",color:"primary","prepend-icon":"mdi-refresh",size:"large",onClick:l.loadConfig},{default:n(()=>[...e[7]||(e[7]=[o(" 重新加载配置 ",-1)])]),_:1},8,["loading","onClick"]),t(h,{loading:i.loading,color:"success","prepend-icon":"mdi-content-save",size:"large",onClick:l.saveConfig},{default:n(()=>[...e[8]||(e[8]=[o(" 保存所有更改 ",-1)])]),_:1},8,["loading","onClick"])]),l.hasChanges?(c(),g(X,{key:0,color:"warning",variant:"elevated"},{default:n(()=>[...e[9]||(e[9]=[o(" 有未保存的更改 ",-1)])]),_:1})):y("",!0)]),t(ce,null,{default:n(()=>[t(O,{cols:"12",md:"6"},{default:n(()=>[t(r,{border:"",icon:"mdi-book",title:"科目配置"},{default:n(()=>[t(J,null,{default:n(()=>[t(A,null,{default:n(()=>[t(R,{modelValue:i.newSubject,"onUpdate:modelValue":e[0]||(e[0]=u=>i.newSubject=u),"append-inner-icon":"mdi-plus",density:"comfortable",label:"添加新科目",variant:"outlined","onClick:appendInner":l.addSubject,onKeyup:Ve(l.addSubject,["enter"])},null,8,["modelValue","onClick:appendInner","onKeyup"])]),_:1}),(c(!0),x(ne,null,de(l.subjectList,u=>(c(),g(A,{key:u},{default:n(()=>[t(E,{border:"",class:"w-100 mb-2"},{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(R,{modelValue:i.editedSubjects[u],"onUpdate:modelValue":b=>i.editedSubjects[u]=b,placeholder:u,density:"comfortable","hide-details":"",variant:"plain",onBlur:b=>l.updateSubject(u)},null,8,["modelValue","onUpdate:modelValue","placeholder","onBlur"]),t(te),t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:b=>l.deleteSubject(u)},null,8,["onClick"])]),_:2},1024),t(j,null,{default:n(()=>[t(R,{modelValue:i.newBookTypes[u],"onUpdate:modelValue":b=>i.newBookTypes[u]=b,"append-inner-icon":"mdi-plus",class:"mb-2",density:"comfortable",label:"添加作业本名称",variant:"outlined","onClick:appendInner":()=>l.addBookType(u),onKeyup:Ve(()=>l.addBookType(u),["enter"])},null,8,["modelValue","onUpdate:modelValue","onClick:appendInner","onKeyup"]),t(J,{border:"",density:"compact",rounded:""},{default:n(()=>[(c(!0),x(ne,null,de(i.config.subjects[u].books,(b,T)=>(c(),g(A,{key:T,title:T,onClick:I=>l.openSubjectBookDialog(u,T,b)},{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-book-open-variant"})]),append:n(()=>[t(X,{class:"mr-2",color:"info",size:"small"},{default:n(()=>[o(w(b.length)+"个部分 ",1)]),_:2},1024),t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:Ae(()=>l.deleteBookType(u,T),["stop"])},null,8,["onClick"])]),_:2},1032,["title","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(O,{cols:"12",md:"6"},{default:n(()=>[t(r,{border:"",icon:"mdi-cog",title:"通用配置"},{default:n(()=>[t(J,null,{default:n(()=>[t(A,null,{default:n(()=>[t(R,{modelValue:i.newCommonBook,"onUpdate:modelValue":e[1]||(e[1]=u=>i.newCommonBook=u),"append-inner-icon":"mdi-plus",density:"comfortable",label:"添加作业本名称",variant:"outlined","onClick:appendInner":l.addCommonBook,onKeyup:Ve(l.addCommonBook,["enter"])},null,8,["modelValue","onClick:appendInner","onKeyup"])]),_:1}),t(A,null,{default:n(()=>[t(J,{border:"",density:"compact",rounded:""},{default:n(()=>[(c(!0),x(ne,null,de(i.config.commonSubject.books,(u,b)=>(c(),g(A,{key:b,title:b,onClick:T=>l.openSubjectBookDialog("common",b,u)},{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-book-multiple"})]),append:n(()=>[t(X,{class:"mr-2",color:"info",size:"small"},{default:n(()=>[o(w(u.length)+"个部分 ",1)]),_:2},1024),t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:Ae(()=>l.deleteBookType("common",b),["stop"])},null,8,["onClick"])]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1}),t(P,{class:"my-2"}),t(A,null,{default:n(()=>[t(R,{modelValue:i.newAction,"onUpdate:modelValue":e[2]||(e[2]=u=>i.newAction=u),"append-inner-icon":"mdi-plus",density:"comfortable",label:"添加操作",variant:"outlined","onClick:appendInner":l.addAction,onKeyup:Ve(l.addAction,["enter"])},null,8,["modelValue","onClick:appendInner","onKeyup"])]),_:1}),t(A,null,{default:n(()=>[t(J,{border:"",density:"compact",rounded:""},{default:n(()=>[(c(!0),x(ne,null,de(i.config.actions,u=>(c(),g(A,{key:u,title:u,onClick:b=>l.openActionDialog(u)},{append:n(()=>[t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:Ae(b=>l.removeAction(u),["stop"])},null,8,["onClick"])]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(we,{modelValue:i.dialog.show,"onUpdate:modelValue":e[5]||(e[5]=u=>i.dialog.show=u),"max-width":"600px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"text-h5 pa-4"},{default:n(()=>[o(w(i.dialog.title),1)]),_:1}),t(j,null,{default:n(()=>[t(st,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(O,{cols:"12"},{default:n(()=>[t(R,{modelValue:i.dialog.editedItem.name,"onUpdate:modelValue":e[3]||(e[3]=u=>i.dialog.editedItem.name=u),label:i.dialog.nameLabel,rules:[u=>!!u||"名称不能为空"],density:"comfortable",variant:"outlined"},null,8,["modelValue","label","rules"])]),_:1}),i.dialog.editedItem.type==="subjectBook"?(c(),g(O,{key:0,cols:"12"},{default:n(()=>[e[10]||(e[10]=m("div",{class:"text-subtitle-2 mb-2"},"所属科目",-1)),t(X,{color:"primary"},{default:n(()=>[o(w(i.dialog.editedItem.subject),1)]),_:1})]),_:1})):y("",!0),["subjectBook","commonBook"].includes(i.dialog.editedItem.type)?(c(),g(O,{key:1,cols:"12"},{default:n(()=>[t(E,{variant:"outlined"},{default:n(()=>[t(K,{class:"text-subtitle-1 py-2"},{default:n(()=>[...e[11]||(e[11]=[o("需完成部分",-1)])]),_:1}),t(j,{class:"pt-0"},{default:n(()=>[t(J,{border:"",class:"mb-2",density:"compact",rounded:""},{default:n(()=>[(c(!0),x(ne,null,de(i.dialog.editedItem.tasks,(u,b)=>(c(),g(A,{key:b},{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-checkbox-blank-circle-outline",size:"small"})]),append:n(()=>[t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:T=>l.removeTask(b)},null,8,["onClick"])]),default:n(()=>[t(R,{modelValue:i.dialog.editedItem.tasks[b],"onUpdate:modelValue":T=>i.dialog.editedItem.tasks[b]=T,density:"compact","hide-details":"",variant:"plain"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1}),t(R,{modelValue:i.newTask,"onUpdate:modelValue":e[4]||(e[4]=u=>i.newTask=u),"append-inner-icon":"mdi-plus",class:"mt-2",density:"comfortable",label:"添加需完成部分",variant:"outlined","onClick:appendInner":l.addTask,onKeyup:Ve(l.addTask,["enter"])},null,8,["modelValue","onClick:appendInner","onKeyup"])]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1}),t(ue,{class:"pa-4"},{default:n(()=>[t(te),t(h,{color:"primary",variant:"elevated",onClick:l.saveDialog},{default:n(()=>[...e[12]||(e[12]=[o(" 关闭 ",-1)])]),_:1},8,["onClick"]),t(h,{color:"error",variant:"text",onClick:l.closeDialog},{default:n(()=>[...e[13]||(e[13]=[o(" 取消 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(tt,{modelValue:i.showSnackbar,"onUpdate:modelValue":e[6]||(e[6]=u=>i.showSnackbar=u),color:i.snackbarColor,timeout:3e3},{default:n(()=>[o(w(i.snackbarText),1)]),_:1},8,["modelValue","color"])]),_:1},8,["loading"])}const Bt=q(ds,[["render",ms],["__scopeId","data-v-67769fa2"]]),fs={name:"SubjectManagementCard",components:{SettingsCard:ee},data(){return{loading:!1,error:null,subjects:[],originalSubjects:null,newSubjectName:"",showSnackbar:!1,snackbarText:"",snackbarColor:"success",defaultSubjects:[{name:"语文",order:0},{name:"数学",order:1},{name:"英语",order:2},{name:"物理",order:3},{name:"化学",order:4},{name:"生物",order:5},{name:"政治",order:6},{name:"历史",order:7},{name:"地理",order:8},{name:"其他",order:9}]}},computed:{hasChanges(){return this.originalSubjects&&JSON.stringify(this.subjects)!==JSON.stringify(this.originalSubjects)}},created(){this.loadConfig()},methods:{async loadConfig(){this.loading=!0;try{const s=await re.loadData("classworks-config-subject");s?(this.subjects=s.map((e,a)=>({name:e.name,order:e.order??a})).sort((e,a)=>e.order-a.order),this.originalSubjects=JSON.parse(JSON.stringify(this.subjects)),this.showMessage("配置已加载","success")):(this.subjects=[],this.originalSubjects=[],this.showMessage("使用默认配置","info"))}catch(s){console.error("Failed to load config:",s),this.showMessage("加载失败，可继续编辑当前配置","warning")}this.loading=!1},async saveConfig(){this.loading=!0;try{const s=await re.saveData("classworks-config-subject",this.subjects);if(s)this.originalSubjects=JSON.parse(JSON.stringify(this.subjects)),this.showMessage("配置已保存","success");else throw new Error(s||"保存失败")}catch(s){console.error("Failed to save config:",s),this.showMessage(`保存失败: ${s.message}，请稍后重试`,"error")}this.loading=!1},showMessage(s,e="success"){this.snackbarText=s,this.snackbarColor=e,this.showSnackbar=!0},addSubject(){if(!this.newSubjectName)return;const s={name:this.newSubjectName,order:this.subjects.length};this.subjects.push(s),this.newSubjectName=""},updateSubject(s){const e=this.subjects.findIndex(a=>a.order===s.order);e>-1&&(this.subjects[e]={...s})},deleteSubject(s){const e=this.subjects.findIndex(a=>a.order===s.order);e>-1&&(this.subjects.splice(e,1),this.subjects.forEach((a,d)=>{a.order=d}))},moveSubject(s,e){const a=s+e;if(a>=0&&a<this.subjects.length){const d=this.subjects[s];this.subjects[s]=this.subjects[a],this.subjects[a]=d,this.subjects.forEach((i,l)=>{i.order=l})}},resetToDefault(){this.subjects=JSON.parse(JSON.stringify(this.defaultSubjects)),this.showMessage("已重置为默认科目列表","info")}}},ps={class:"d-flex justify-space-between align-center mb-6"},hs={class:"d-flex flex-column align-center mr-2"};function gs(s,e,a,d,i,l){const r=ee;return c(),g(r,{loading:i.loading,border:"",icon:"mdi-book-multiple",title:"科目管理"},{default:n(()=>[i.error?(c(),g($,{key:0,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:n(()=>[o(w(i.error),1)]),_:1})):y("",!0),m("div",ps,[m("div",null,[t(h,{loading:i.loading,class:"mr-2",color:"primary","prepend-icon":"mdi-refresh",size:"large",variant:"text",onClick:l.loadConfig},{default:n(()=>[...e[2]||(e[2]=[o(" 重新加载 ",-1)])]),_:1},8,["loading","onClick"]),t(h,{loading:i.loading,color:"success","prepend-icon":"mdi-content-save",size:"large",onClick:l.saveConfig},{default:n(()=>[...e[3]||(e[3]=[o(" 保存 ",-1)])]),_:1},8,["loading","onClick"]),t(h,{loading:i.loading,class:"mr-2","prepend-icon":"mdi-restore",variant:"text",onClick:l.resetToDefault},{default:n(()=>[...e[4]||(e[4]=[o(" 重置为默认 ",-1)])]),_:1},8,["loading","onClick"])]),l.hasChanges?(c(),g(X,{key:0,color:"warning",variant:"elevated"},{default:n(()=>[...e[5]||(e[5]=[o(" 有未保存的更改 ",-1)])]),_:1})):y("",!0)]),t(E,{class:"mb-4",variant:"outlined"},{default:n(()=>[t(j,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(O,{cols:"12",sm:"6"},{default:n(()=>[t(R,{modelValue:i.newSubjectName,"onUpdate:modelValue":e[0]||(e[0]=p=>i.newSubjectName=p),rules:[p=>!!p||"科目名称不能为空"],"append-inner-icon":"mdi-plus",density:"comfortable",label:"科目名称",variant:"outlined",onKeyup:Ve(l.addSubject,["enter"]),"onClick:appendInner":l.addSubject},null,8,["modelValue","rules","onKeyup","onClick:appendInner"])]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{variant:"outlined"},{default:n(()=>[t(j,{class:"pa-0"},{default:n(()=>[t(J,{lines:"one"},{default:n(()=>[(c(!0),x(ne,null,de(i.subjects,(p,u)=>(c(),g(A,{key:p.order},{prepend:n(()=>[m("div",hs,[t(h,{disabled:u===0,icon:"mdi-chevron-up",size:"small",variant:"text",onClick:b=>l.moveSubject(u,-1)},null,8,["disabled","onClick"]),t(h,{disabled:u===i.subjects.length-1,icon:"mdi-chevron-down",size:"small",variant:"text",onClick:b=>l.moveSubject(u,1)},null,8,["disabled","onClick"])])]),append:n(()=>[t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:b=>l.deleteSubject(p)},null,8,["onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[t(R,{modelValue:p.name,"onUpdate:modelValue":b=>p.name=b,density:"compact","hide-details":"",variant:"plain",onBlur:b=>l.updateSubject(p)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(tt,{modelValue:i.showSnackbar,"onUpdate:modelValue":e[1]||(e[1]=p=>i.showSnackbar=p),color:i.snackbarColor,timeout:3e3},{default:n(()=>[o(w(i.snackbarText),1)]),_:1},8,["modelValue","color"])]),_:1},8,["loading"])}const Lt=q(fs,[["render",gs],["__scopeId","data-v-f87674cf"]]),ws={};function vs(s,e,a,d,i,l){const r=Ce,p=ee;return c(),g(p,{icon:"mdi-cog",title:"编辑设置"},{default:n(()=>[t(J,null,{default:n(()=>[t(r,{"setting-key":"randomPicker.enabled"}),t(P,{class:"my-2"}),t(r,{"setting-key":"randomPicker.mode"}),t(P,{class:"my-2"}),t(r,{"setting-key":"randomPicker.minNumber"}),t(P,{class:"my-2"}),t(r,{"setting-key":"randomPicker.maxNumber"}),t(P,{class:"my-2"}),t(r,{"setting-key":"randomPicker.defaultCount"}),t(P,{class:"my-2"}),t(r,{"setting-key":"randomPicker.animation"})]),_:1})]),_:1})}const zt=q(ws,[["render",vs]]),bs={name:"HitokotoSettings",components:{SettingGroup:We,SettingItem:Ce},data(){return{kvConfig:{sources:["zhaoyu"],sensitiveWords:"",jinrishiciToken:null},loading:!1,testLoading:!1,testMessage:"",testColor:"info",testResultDialog:!1,testResultData:null,enableCloudSensitiveWords:!0}},mounted(){this.loadKvSettings()},methods:{async loadKvSettings(){this.loading=!0;try{const s=await re.loadData("sentence-info");let e=s;s&&s.data&&(e=s.data),e&&(this.kvConfig={sources:Array.isArray(e.sources)?e.sources:["zhaoyu"],sensitiveWords:e.sensitiveWords||"",jinrishiciToken:e.jinrishiciToken})}catch(s){console.error("Failed to load sentence-info",s)}finally{this.loading=!1}},async saveKvSettings(){this.loading=!0;try{if(this.kvConfig.sources.includes("jinrishici")&&!this.kvConfig.jinrishiciToken)try{const s=await Qe.get("https://v2.jinrishici.com/token");s.data.status==="success"&&(this.kvConfig.jinrishiciToken=s.data.data)}catch(s){console.error("Failed to get jinrishici token",s)}await re.saveData("sentence-info",this.kvConfig)}catch(s){console.error("Failed to save sentence-info",s)}finally{this.loading=!1}},async testJinrishici(){var s,e;this.testLoading=!0,this.testMessage="",this.testColor="info";try{const a={};this.kvConfig.jinrishiciToken&&(a["X-User-Token"]=this.kvConfig.jinrishiciToken);const d=await Qe.get("https://v2.jinrishici.com/info?X-User-Token="+encodeURIComponent(this.kvConfig.jinrishiciToken));if(d.data&&d.data.status==="success"){this.testResultData=d.data,this.testResultDialog=!0;const i=(s=d.data.data)==null?void 0:s.token,l=(e=d.data.data)==null?void 0:e.region,r=this.kvConfig.jinrishiciToken?i===this.kvConfig.jinrishiciToken:!0;this.testColor=r?"success":"warning",this.testMessage=r?`接口正常，Token 一致：${i}${l?`，地区：${l}`:""}`:`接口返回 Token 与当前设置不一致：${i}${l?`，地区：${l}`:""}`}else this.testColor="error",this.testMessage="接口返回非 success，请检查网络或 Token 配置。"}catch(a){console.error("Failed to test jinrishici info",a),this.testColor="error",this.testMessage="接口测试失败，请检查网络或 Token。"}finally{this.testLoading=!1}}}},ys={class:"d-flex flex-wrap gap-2"},ks={class:"text-caption text-orange mt-2"},xs={class:"d-flex flex-column flex-sm-row align-center w-100"},Ss={key:2,class:"text-center pb-4"},Cs={class:"d-flex align-center mb-2"},_s={class:"text-body-1 font-weight-medium"},Vs={class:"d-flex align-center mb-2"},Ds={class:"text-body-1 font-weight-medium"},As={class:"d-flex align-center mb-2"},Ts={class:"text-body-1 font-weight-medium"},Is={class:"d-flex align-center mb-2"},js={class:"text-body-2 font-weight-medium"},Es={class:"d-flex align-center mb-2"},Us={class:"text-body-1 font-weight-medium"},Ns={class:"d-flex align-center mb-2"},Ms={class:"text-body-1 font-weight-medium"},Ps={class:"px-4 py-3"},Bs={class:"d-flex flex-wrap gap-2"};function Ls(s,e,a,d,i,l){const r=Ce,p=We;return c(),x("div",null,[t(p,{title:"一言设置",icon:"mdi-comment-quote"},{default:n(()=>[t(r,{"setting-key":"hitokoto.enabled"}),t(r,{"setting-key":"hitokoto.refreshInterval"})]),_:1}),t(p,{title:"数据源配置",icon:"mdi-cloud-sync",class:"mt-4"},{default:n(()=>[e[13]||(e[13]=m("div",{class:"text-caption text-grey px-4 pt-2 pb-2"},"以下配置将同步到云端，对所有连接此班级的设备生效。",-1)),t(A,null,{default:n(()=>[t(z,{class:"mb-2"},{default:n(()=>[...e[7]||(e[7]=[o("启用数据源",-1)])]),_:1}),m("div",ys,[t(Se,{modelValue:i.kvConfig.sources,"onUpdate:modelValue":[e[0]||(e[0]=u=>i.kvConfig.sources=u),l.saveKvSettings],label:"一言 (Hitokoto)",value:"hitokoto","hide-details":"",density:"compact",class:"mr-4",disabled:i.loading},null,8,["modelValue","disabled","onUpdate:modelValue"]),t(Se,{modelValue:i.kvConfig.sources,"onUpdate:modelValue":[e[1]||(e[1]=u=>i.kvConfig.sources=u),l.saveKvSettings],label:"诏预 (Zhaoyu)",value:"zhaoyu","hide-details":"",density:"compact",class:"mr-4",disabled:i.loading},null,8,["modelValue","disabled","onUpdate:modelValue"]),t(Se,{modelValue:i.kvConfig.sources,"onUpdate:modelValue":[e[2]||(e[2]=u=>i.kvConfig.sources=u),l.saveKvSettings],label:"今日诗词 (Jinrishici)",value:"jinrishici","hide-details":"",density:"compact",disabled:i.loading},null,8,["modelValue","disabled","onUpdate:modelValue"])]),m("div",ks,[t(v,{size:"x-small",color:"orange",class:"mr-1"},{default:n(()=>[...e[8]||(e[8]=[o("mdi-alert",-1)])]),_:1}),e[9]||(e[9]=o(" 一言（Hitokoto）数据源已收到关于存在负面内容的大量反馈，请用户谨慎启用。 ",-1))])]),_:1}),i.kvConfig.sources.includes("jinrishici")?(c(),g(A,{key:0},{default:n(()=>[t(R,{modelValue:i.kvConfig.jinrishiciToken,"onUpdate:modelValue":e[3]||(e[3]=u=>i.kvConfig.jinrishiciToken=u),label:"今日诗词 Token",variant:"outlined",density:"comfortable",disabled:i.loading,hint:"留空则自动获取，也可以手动输入已有 Token","persistent-hint":"",class:"mt-2",onChange:l.saveKvSettings},null,8,["modelValue","disabled","onChange"])]),_:1})):y("",!0),i.kvConfig.sources.includes("jinrishici")?(c(),g(A,{key:1},{default:n(()=>[m("div",xs,[t(h,{loading:i.testLoading,color:"primary",variant:"outlined",class:"mr-sm-4 mb-2 mb-sm-0",onClick:l.testJinrishici},{default:n(()=>[...e[10]||(e[10]=[o(" 测试今日诗词接口 ",-1)])]),_:1},8,["loading","onClick"]),i.testMessage?(c(),g($,{key:0,type:i.testColor,density:"comfortable",border:"start",class:"flex-grow-1"},{default:n(()=>[o(w(i.testMessage),1)]),_:1},8,["type"])):y("",!0)])]),_:1})):y("",!0),t(A,null,{default:n(()=>[t(Ie,{modelValue:i.kvConfig.sensitiveWords,"onUpdate:modelValue":e[4]||(e[4]=u=>i.kvConfig.sensitiveWords=u),disabled:i.loading,label:"敏感词过滤 (用逗号分隔)",variant:"outlined",rows:"3","auto-grow":"","hide-details":"",class:"mt-2 mb-2",onChange:l.saveKvSettings},null,8,["modelValue","disabled","onChange"])]),_:1}),t(A,null,{default:n(()=>[t(Se,{label:"启用云端敏感词列表","hide-details":"",modelValue:i.enableCloudSensitiveWords,"onUpdate:modelValue":e[5]||(e[5]=u=>i.enableCloudSensitiveWords=u),density:"compact",disabled:"",class:"mb-2"},null,8,["modelValue"]),e[11]||(e[11]=m("div",{class:"text-caption text-grey"},[o(" 已启用的数据源将在获取一言时随机尝试，直到成功获取内容为止。"),m("br"),o(" 敏感词过滤会将包含任意敏感词的句子过滤掉，避免显示不当内容。"),m("br")],-1))]),_:1}),i.loading?(c(),x("div",Ss,[t(Dt,{indeterminate:"",size:"24",color:"primary"}),e[12]||(e[12]=m("span",{class:"ml-2 text-caption"},"正在同步配置...",-1))])):y("",!0)]),_:1}),t(we,{modelValue:i.testResultDialog,"onUpdate:modelValue":e[6]||(e[6]=u=>i.testResultDialog=u),"max-width":"600"},{default:n(()=>[i.testResultData?(c(),g(E,{key:0,class:"rounded-lg"},{default:n(()=>[t(j,{class:"pa-0"},{default:n(()=>[t(J,{lines:"two",class:"py-0"},{default:n(()=>[t(A,{class:"px-4 py-3"},{prepend:n(()=>[t(Ge,{color:"primary",variant:"tonal",class:"mr-2"},{default:n(()=>[t(v,{icon:"mdi-key-variant"})]),_:1})]),default:n(()=>[t(z,{class:"text-subtitle-2 font-weight-bold mb-1"},{default:n(()=>[...e[14]||(e[14]=[o("Token",-1)])]),_:1}),t(ie,{class:"text-body-2 text-high-emphasis",style:{"word-break":"break-all"}},{default:n(()=>[o(w(i.testResultData.data.token),1)]),_:1})]),_:1}),t(P),t(ce,{"no-gutters":""},{default:n(()=>[t(O,{cols:"6"},{default:n(()=>[t(A,{class:"px-4 py-2"},{prepend:n(()=>[t(v,{icon:"mdi-ip-network",color:"grey-darken-1",class:"mr-2"})]),default:n(()=>[t(z,{class:"text-caption text-grey-darken-1"},{default:n(()=>[...e[15]||(e[15]=[o("IP 地址",-1)])]),_:1}),t(ie,{class:"text-body-2"},{default:n(()=>[o(w(i.testResultData.data.ip),1)]),_:1})]),_:1})]),_:1}),t(O,{cols:"6"},{default:n(()=>[t(A,{class:"px-4 py-2"},{prepend:n(()=>[t(v,{icon:"mdi-map-marker-radius",color:"grey-darken-1",class:"mr-2"})]),default:n(()=>[t(z,{class:"text-caption text-grey-darken-1"},{default:n(()=>[...e[16]||(e[16]=[o("地区",-1)])]),_:1}),t(ie,{class:"text-body-2"},{default:n(()=>[o(w(i.testResultData.data.region),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(P),t(st,{class:"px-4 py-3"},{default:n(()=>[t(ce,{dense:""},{default:n(()=>[t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",Cs,[t(v,{icon:"mdi-thermometer",color:"orange",class:"mr-2"}),m("div",null,[e[17]||(e[17]=m("div",{class:"text-caption text-grey"},"温度",-1)),m("div",_s,w(i.testResultData.data.weatherData.temperature)+"°C",1)])])]),_:1}),t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",Vs,[t(v,{icon:"mdi-weather-cloudy",color:"blue-grey",class:"mr-2"}),m("div",null,[e[18]||(e[18]=m("div",{class:"text-caption text-grey"},"天气",-1)),m("div",Ds,w(i.testResultData.data.weatherData.weather),1)])])]),_:1}),t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",As,[t(v,{icon:"mdi-water-percent",color:"blue",class:"mr-2"}),m("div",null,[e[19]||(e[19]=m("div",{class:"text-caption text-grey"},"湿度",-1)),m("div",Ts,w(i.testResultData.data.weatherData.humidity)+"%",1)])])]),_:1}),t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",Is,[t(v,{icon:"mdi-weather-windy",color:"teal",class:"mr-2"}),m("div",null,[e[20]||(e[20]=m("div",{class:"text-caption text-grey"},"风向/风力",-1)),m("div",js,w(i.testResultData.data.weatherData.windDirection)+" "+w(i.testResultData.data.weatherData.windPower)+"级 ",1)])])]),_:1}),t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",Es,[t(v,{icon:"mdi-blur",color:"grey",class:"mr-2"}),m("div",null,[e[21]||(e[21]=m("div",{class:"text-caption text-grey"},"PM2.5",-1)),m("div",Us,w(i.testResultData.data.weatherData.pm25),1)])])]),_:1}),t(O,{cols:"6",sm:"4"},{default:n(()=>[m("div",Ns,[t(v,{icon:"mdi-eye",color:"indigo",class:"mr-2"}),m("div",null,[e[22]||(e[22]=m("div",{class:"text-caption text-grey"},"能见度",-1)),m("div",Ms,w(i.testResultData.data.weatherData.visibility),1)])])]),_:1})]),_:1})]),_:1}),t(P),m("div",Ps,[e[23]||(e[23]=m("div",{class:"text-caption text-grey mb-2"},"环境标签",-1)),m("div",Bs,[(c(!0),x(ne,null,de(i.testResultData.data.tags,u=>(c(),g(X,{key:u,size:"small",color:"primary",variant:"tonal",class:"mr-1 mb-1"},{default:n(()=>[o(w(u),1)]),_:2},1024))),128))])]),t(P),t(A,{class:"px-4 py-2"},{prepend:n(()=>[t(v,{icon:"mdi-clock-outline",size:"small",class:"mr-2"})]),default:n(()=>[t(z,{class:"text-caption text-grey-darken-1"},{default:n(()=>[o(" 北京时间: "+w(new Date(i.testResultData.data.beijingTime).toLocaleString()),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue"])])}const Ot=q(bs,[["render",Ls]]),zs={name:"NotificationSoundSettings",data(){return{singleSound:"",urgentSound:"",currentAudio:null,showAutoplayWarning:!0}},computed:{soundOptions(){return fn.map(s=>({title:s.replace(".mp3",""),value:s}))}},mounted(){this.loadSettings()},beforeUnmount(){this.stopPreview()},methods:{loadSettings(){this.singleSound=_("notification.singleSound"),this.urgentSound=_("notification.urgentSound")},onSingleSoundChange(s){var e;ke("notification.singleSound",s),(e=this.$message)==null||e.success("设置已保存",`单次通知铃声: ${s}`)},onUrgentSoundChange(s){var e;ke("notification.urgentSound",s),(e=this.$message)==null||e.success("设置已保存",`紧急通知铃声: ${s}`)},async previewSound(s){var e,a;this.showAutoplayWarning=!1,this.stopPreview();try{const d=await this.playSoundWithPromise(s,!1);this.currentAudio=d,this.currentAudio&&this.currentAudio.addEventListener("ended",()=>{this.currentAudio=null},{once:!0})}catch(d){console.error("播放音频失败:",d),d.name==="NotAllowedError"?(e=this.$message)==null||e.warning("无法播放音频","浏览器阻止了自动播放，请再次点击试听按钮"):(a=this.$message)==null||a.error("播放失败","音频文件加载失败，请稍后重试")}},playSoundWithPromise(s,e=!1){return new Promise((a,d)=>{const i=this.getSoundPath(s);if(!i){d(new Error("音频文件不存在"));return}try{const l=new Audio(i);l.loop=e,l.play().then(()=>{a(l)}).catch(r=>{d(r)})}catch(l){d(l)}})},getSoundPath(s){if(!s)return null;try{return`/sounds/${s}`}catch{return null}},stopPreview(){this.currentAudio&&(mn(this.currentAudio),this.currentAudio=null)},resetSingleSound(){var s;this.singleSound="Teams 默认.mp3",ke("notification.singleSound",this.singleSound),(s=this.$message)==null||s.success("已恢复单次通知铃声默认设置")},resetUrgentSound(){var s;this.urgentSound="Teams 默认通话铃.mp3",ke("notification.urgentSound",this.urgentSound),(s=this.$message)==null||s.success("已恢复紧急通知铃声默认设置")}}},Os={class:"d-flex align-center"},Rs={class:"mt-3 d-flex gap-2"},Ks={class:"mt-3 d-flex gap-2"};function Fs(s,e,a,d,i,l){return c(),g(E,{class:"notification-sound-settings"},{default:n(()=>[t(K,null,{default:n(()=>[...e[5]||(e[5]=[o(" 通知铃声设置 ",-1)])]),_:1}),t(j,null,{default:n(()=>[i.showAutoplayWarning?(c(),g($,{key:0,type:"info",variant:"tonal",closable:"",class:"mb-4","onClick:close":e[0]||(e[0]=r=>i.showAutoplayWarning=!1)},{default:n(()=>[m("div",Os,[t(v,{class:"mr-2"},{default:n(()=>[...e[6]||(e[6]=[o("mdi-information",-1)])]),_:1}),e[7]||(e[7]=m("span",null,"首次使用请点击试听按钮测试音频播放是否正常",-1))])]),_:1})):y("",!0),t(ce,null,{default:n(()=>[t(O,{cols:"12"},{default:n(()=>[t(E,{border:""},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[t(v,{left:""},{default:n(()=>[...e[8]||(e[8]=[o("mdi-bell-ring",-1)])]),_:1}),e[9]||(e[9]=o(" 单次通知铃声 ",-1))]),_:1}),t(j,null,{default:n(()=>[t(Je,{modelValue:i.singleSound,"onUpdate:modelValue":[e[1]||(e[1]=r=>i.singleSound=r),l.onSingleSoundChange],items:l.soundOptions,label:"选择铃声","prepend-icon":"mdi-music-note",variant:"outlined",density:"comfortable"},{item:n(({props:r,item:p})=>[t(A,je(r,{onClick:u=>l.previewSound(p.value)}),{prepend:n(()=>[t(v,null,{default:n(()=>[...e[10]||(e[10]=[o("mdi-music-note",-1)])]),_:1})]),append:n(()=>[t(h,{icon:"",size:"small",variant:"text",onClick:Ae(u=>l.previewSound(p.value),["stop"])},{default:n(()=>[t(v,null,{default:n(()=>[...e[11]||(e[11]=[o("mdi-play",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1040,["onClick"])]),_:1},8,["modelValue","items","onUpdate:modelValue"]),m("div",Rs,[t(h,{color:"primary",variant:"tonal",onClick:e[2]||(e[2]=r=>l.previewSound(i.singleSound))},{default:n(()=>[t(v,{left:""},{default:n(()=>[...e[12]||(e[12]=[o("mdi-play",-1)])]),_:1}),e[13]||(e[13]=o(" 试听 ",-1))]),_:1}),t(h,{onClick:l.resetSingleSound},{default:n(()=>[t(v,{left:""},{default:n(()=>[...e[14]||(e[14]=[o("mdi-restore",-1)])]),_:1}),e[15]||(e[15]=o(" 恢复 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}),t(O,{cols:"12"},{default:n(()=>[t(E,{border:""},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[t(v,{left:"",color:"error"},{default:n(()=>[...e[16]||(e[16]=[o("mdi-bell-alert",-1)])]),_:1}),e[17]||(e[17]=o(" 紧急通知铃声 ",-1))]),_:1}),t(j,null,{default:n(()=>[t(Je,{modelValue:i.urgentSound,"onUpdate:modelValue":[e[3]||(e[3]=r=>i.urgentSound=r),l.onUrgentSoundChange],items:l.soundOptions,label:"选择铃声","prepend-icon":"mdi-music-note",variant:"outlined",density:"comfortable"},{item:n(({props:r,item:p})=>[t(A,je(r,{onClick:u=>l.previewSound(p.value)}),{prepend:n(()=>[t(v,null,{default:n(()=>[...e[18]||(e[18]=[o("mdi-music-note",-1)])]),_:1})]),append:n(()=>[t(h,{icon:"",size:"small",variant:"text",onClick:Ae(u=>l.previewSound(p.value),["stop"])},{default:n(()=>[t(v,null,{default:n(()=>[...e[19]||(e[19]=[o("mdi-play",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1040,["onClick"])]),_:1},8,["modelValue","items","onUpdate:modelValue"]),m("div",Ks,[t(h,{color:"error",variant:"tonal",onClick:e[4]||(e[4]=r=>l.previewSound(i.urgentSound))},{default:n(()=>[t(v,{left:""},{default:n(()=>[...e[20]||(e[20]=[o("mdi-play",-1)])]),_:1}),e[21]||(e[21]=o(" 试听 ",-1))]),_:1}),t(h,{onClick:l.resetUrgentSound},{default:n(()=>[t(v,{left:""},{default:n(()=>[...e[22]||(e[22]=[o("mdi-restore",-1)])]),_:1}),e[23]||(e[23]=o(" 恢复 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Rt=q(zs,[["render",Fs],["__scopeId","data-v-55be56a4"]]),Js={name:"ThemeSettingsCard",components:{SettingsCard:ee},data(){return{localTheme:_("theme.mode")}},watch:{localTheme(s){ke("theme.mode",s),this.updateTheme(s)}},setup(){return{theme:vn()}},methods:{updateTheme(s){this.theme.global.name.value=s}}};function Qs(s,e,a,d,i,l){const r=ee;return c(),g(r,{icon:"mdi-palette",title:"主题设置"},{default:n(()=>[t(J,null,{default:n(()=>[t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-theme-light-dark"})]),append:n(()=>[t(bn,{modelValue:i.localTheme,"onUpdate:modelValue":e[0]||(e[0]=p=>i.localTheme=p),color:"primary",density:"comfortable"},{default:n(()=>[t(h,{value:"light"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-white-balance-sunny"}),e[3]||(e[3]=o(" 明亮 ",-1))]),_:1}),t(h,{value:"dark"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-moon-waning-crescent"}),e[4]||(e[4]=o(" 暗黑 ",-1))]),_:1})]),_:1},8,["modelValue"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[1]||(e[1]=[o("主题模式",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[2]||(e[2]=[o("选择明亮或暗黑主题",-1)])]),_:1})]),_:1})]),_:1})]),_:1})}const Kt=q(Js,[["render",Qs]]),Hs={name:"DisplaySettingsCard",components:{SettingsCard:ee,SettingItem:Ce},data(){return{}}};function Gs(s,e,a,d,i,l){const r=Ce,p=ee;return c(),g(p,{border:"",icon:"mdi-monitor",title:"显示设置"},{default:n(()=>[t(J,null,{default:n(()=>[t(r,{"setting-key":"display.emptySubjectDisplay"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.dynamicSort"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.showRandomButton"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.showFullscreenButton"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.cardHoverEffect"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.enhancedTouchMode"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.showQuickTools"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.showAntiScreenBurnCard"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.showExamScheduleButton"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.forceDesktopMode"}),t(P,{class:"my-2"}),t(r,{"setting-key":"display.lateStudentsArePresent"})]),_:1})]),_:1})}const Ft=q(Hs,[["render",Gs]]),Ws={};function Ys(s,e,a,d,i,l){const r=Ce,p=ee;return c(),g(p,{icon:"mdi-cog",title:"编辑设置"},{default:n(()=>[t(J,null,{default:n(()=>[t(r,{"setting-key":"edit.autoSave"}),t(P,{class:"my-2"}),t(r,{"setting-key":"edit.blockNonTodayAutoSave"}),t(P,{class:"my-2"}),t(r,{"setting-key":"edit.confirmNonTodaySave"}),t(P,{class:"my-2"}),t(r,{"setting-key":"edit.refreshBeforeEdit"}),t(P,{class:"my-2"}),t(r,{"setting-key":"edit.autoSavePromptText"}),t(P,{class:"my-2"}),t(r,{"setting-key":"edit.manualSavePromptText"})]),_:1})]),_:1})}const Jt=q(Ws,[["render",Ys]]),qs={name:"RefreshSettingsCard",components:{SettingsCard:ee},data(){return{}}};function Zs(s,e,a,d,i,l){const r=Ce,p=ee;return c(),g(p,{icon:"mdi-refresh-circle",title:"刷新设置"},{default:n(()=>[t(jt,null,{default:n(()=>[t(J,null,{default:n(()=>[t(r,{"setting-key":"refresh.auto",title:"自动刷新"}),t(P,{class:"my-2"}),t(r,{"setting-key":"refresh.interval",title:"刷新间隔"})]),_:1})]),_:1})]),_:1})}const Qt=q(qs,[["render",Zs]]),Xs={name:"SettingsLinkGenerator",data(){return{selectedItems:[],generatedLink:"",linkCopied:!1,search:"",preconfigForm:{namespace:"",authCode:"",autoExecute:!1},unifiedLink:"",headers:[{title:"",key:"data-table-select"},{title:"设置项",key:"description",sortable:!0},{title:"当前值",key:"value",sortable:!0},{title:"键名",key:"key",class:"d-none d-sm-table-cell",sortable:!0},{title:"状态",key:"isChanged",sortable:!0}]}},computed:{settingItems(){const s=Be(),e=[];for(const[a,d]of Object.entries(et)){if(d.requireDeveloper&&!s["developer.enabled"])continue;const i=s[a]!==d.default;e.push({key:a,description:d.description||a,value:s[a],icon:d.icon||"mdi-cog",isChanged:i,defaultValue:d.default})}return e.sort((a,d)=>a.key.localeCompare(d.key))},filteredItems(){if(!this.search)return this.settingItems;const s=this.search.toLowerCase();return s==="已修改"?this.settingItems.filter(e=>e.isChanged):s==="是"||s==="否"?this.settingItems.filter(e=>typeof e.value=="boolean"&&(s==="是"?e.value:!e.value)):this.settingItems.filter(e=>{const a=e.description.toLowerCase(),d=e.key.toLowerCase(),i=String(e.value).toLowerCase(),l=e.isChanged?"已修改":"默认";return a.includes(s)||d.includes(s)||i.includes(s)||l.includes(s)})},hasDisplaySettings(){return this.selectedItems.some(s=>s.startsWith("display."))},hasEditSettings(){return this.selectedItems.some(s=>s.startsWith("edit."))},hasServerSettings(){return this.selectedItems.some(s=>s.startsWith("server."))},hasChangedSettings(){const s=Be();return this.selectedItems.some(e=>{const a=et[e];return a&&s[e]!==a.default})}},methods:{handleSelectionChange(s){this.selectedItems=s.map(e=>e.key),this.generateLink()},generateLink(){const s=`${window.location.protocol}//${window.location.host}/`,e=Be(),a={};for(const d of this.selectedItems)a[d]=e[d];if(Object.keys(a).length===0){this.generatedLink=s;return}try{const d=JSON.stringify(a),l=new TextEncoder().encode(d),p={config:btoa(Array.from(l).map(I=>String.fromCharCode(I)).join(""))},b=new URLSearchParams(window.location.search).get("date");b&&(p.date=b);const T=new URLSearchParams(p).toString();this.generatedLink=`${s}?${T}`}catch(d){console.error("生成链接失败:",d),this.generatedLink="链接生成失败，请重试"}this.linkCopied=!1},async copyLink(){this.generatedLink||this.generateLink();try{await navigator.clipboard.writeText(this.generatedLink),this.linkCopied=!0,setTimeout(()=>{this.linkCopied=!1},3e3)}catch(s){console.error("复制链接失败:",s)}},resetSelection(){this.selectedItems=[],this.generatedLink="",this.linkCopied=!1},selectAll(){this.selectedItems=this.settingItems.map(s=>s.key),this.generateLink()},selectDataSourceSettings(){const s=this.settingItems.filter(e=>e.key.startsWith("server.")&&e.key!=="server.kvToken").map(e=>e.key);this.selectedItems=s,this.generateLink()},selectChangedSettings(){const s=this.settingItems.filter(e=>e.isChanged&&e.key!=="server.kvToken").map(e=>e.key);this.selectedItems=s,this.generateLink()},selectByPrefix(s){const e=this.settingItems.filter(a=>a.key.startsWith(`${s}.`)).map(a=>a.key);this.selectedItems=e},autoGenerateLink(){this.selectedItems.length>0?this.generateLink():this.generatedLink=""},getSettingDescription(s){const e=this.settingItems.find(a=>a.key===s);return e?e.description:s},generateUnifiedLink(){if(this.preconfigForm.namespace.trim())try{const s=`${window.location.protocol}//${window.location.host}/`,e=new URLSearchParams;if(e.append("namespace",this.preconfigForm.namespace.trim()),this.preconfigForm.authCode.trim()&&e.append("authCode",this.preconfigForm.authCode.trim()),this.preconfigForm.autoExecute&&e.append("autoExecute","true"),this.selectedItems.length>0){const a=Be(),d={};for(const u of this.selectedItems)d[u]=a[u];const i=JSON.stringify(d),r=new TextEncoder().encode(i),p=btoa(Array.from(r).map(u=>String.fromCharCode(u)).join(""));e.append("config",p)}this.unifiedLink=`${s}?${e.toString()}`,this.linkCopied=!1,console.log("生成统一链接:",this.unifiedLink),console.log("包含预配置:",!!this.preconfigForm.namespace),console.log("包含设置数量:",this.selectedItems.length)}catch(s){console.error("生成统一链接失败:",s),this.unifiedLink="链接生成失败，请重试"}},async copyUnifiedLink(){if(this.unifiedLink||this.generateUnifiedLink(),!(!this.unifiedLink||this.unifiedLink.includes("失败")))try{await navigator.clipboard.writeText(this.unifiedLink),this.linkCopied=!0,setTimeout(()=>{this.linkCopied=!1},3e3)}catch(s){console.error("复制统一链接失败:",s)}},openTestLink(){this.unifiedLink&&!this.unifiedLink.includes("失败")&&window.open(this.unifiedLink,"_blank")},clearAll(){this.preconfigForm={namespace:"",authCode:"",autoExecute:!1},this.selectedItems=[],this.unifiedLink="",this.generatedLink="",this.linkCopied=!1}},watch:{selectedItems:{handler(){this.preconfigForm.namespace.trim()&&this.generateUnifiedLink()},deep:!0},"preconfigForm.namespace":{handler(){this.preconfigForm.namespace.trim()?this.generateUnifiedLink():this.unifiedLink=""}},"preconfigForm.authCode":{handler(){this.preconfigForm.namespace.trim()&&this.generateUnifiedLink()}},"preconfigForm.autoExecute":{handler(){this.preconfigForm.namespace.trim()&&this.generateUnifiedLink()}}}},$s={class:"d-flex mb-3 gap-2 flex-wrap"},ei={class:"d-flex align-center mb-3 flex-wrap gap-2"},ti={class:"d-flex align-center"},ni={class:"d-flex align-center"},si={key:0},ii={key:1},li={key:2},oi={class:"text-caption text-grey"},ai={class:"d-flex mb-3 gap-2 flex-wrap"},ri={class:"d-flex flex-wrap gap-1"};function ui(s,e,a,d,i,l){return c(),x("div",null,[t(E,{border:"",class:"unified-link-generator"},{default:n(()=>[t(K,{class:"text-h6"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-link-variant",start:""}),e[6]||(e[6]=o(" 统一链接生成器 ",-1))]),_:1}),t(j,null,{default:n(()=>[e[35]||(e[35]=m("div",{class:"text-body-2 text-medium-emphasis mb-4"}," 生成包含预配置认证信息和设置的统一链接。可以同时预配置设备认证和应用设置。 ",-1)),t(E,{class:"mb-4",variant:"tonal"},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[t(v,{start:""},{default:n(()=>[...e[7]||(e[7]=[o("mdi-account-key",-1)])]),_:1}),e[8]||(e[8]=o(" 预配置认证信息 ",-1))]),_:1}),t(j,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(O,{cols:"12",md:"6"},{default:n(()=>[t(R,{modelValue:i.preconfigForm.namespace,"onUpdate:modelValue":e[0]||(e[0]=r=>i.preconfigForm.namespace=r),hint:"设备的命名空间标识符",label:"命名空间","persistent-hint":"",placeholder:"例如: classroom-001","prepend-inner-icon":"mdi-identifier",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(O,{cols:"12",md:"6"},{default:n(()=>[t(R,{modelValue:i.preconfigForm.authCode,"onUpdate:modelValue":e[1]||(e[1]=r=>i.preconfigForm.authCode=r),hint:"留空则需要用户手动输入",label:"认证码","persistent-hint":"",placeholder:"设备认证码（可选）","prepend-inner-icon":"mdi-lock-outline",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),t(ce,{class:"mt-2"},{default:n(()=>[t(O,{cols:"12"},{default:n(()=>[t(Se,{modelValue:i.preconfigForm.autoExecute,"onUpdate:modelValue":e[2]||(e[2]=r=>i.preconfigForm.autoExecute=r),density:"compact",hint:"启用后会自动尝试认证，即使没有认证码也会尝试",label:"自动执行认证","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),i.preconfigForm.namespace?(c(),g($,{key:0,class:"mt-3",type:"info",variant:"tonal"},{default:n(()=>[e[13]||(e[13]=m("div",{class:"text-subtitle-2 mb-2"},"预配置信息：",-1)),t(X,{class:"mr-2 mb-1",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[9]||(e[9]=[o("mdi-identifier",-1)])]),_:1}),o(" 命名空间: "+w(i.preconfigForm.namespace),1)]),_:1}),i.preconfigForm.authCode?(c(),g(X,{key:0,class:"mr-2 mb-1",color:"warning",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[10]||(e[10]=[o("mdi-lock",-1)])]),_:1}),o(" 认证码: "+w(i.preconfigForm.authCode.length>8?i.preconfigForm.authCode.substring(0,8)+"...":i.preconfigForm.authCode),1)]),_:1})):(c(),g(X,{key:1,class:"mr-2 mb-1",color:"grey",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[11]||(e[11]=[o("mdi-lock-open",-1)])]),_:1}),e[12]||(e[12]=o(" 无认证码 ",-1))]),_:1})),t(X,{color:i.preconfigForm.autoExecute?"success":"orange",class:"mr-2 mb-1",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[o(w(i.preconfigForm.autoExecute?"mdi-play-circle":"mdi-hand-back-left"),1)]),_:1}),o(" "+w(i.preconfigForm.autoExecute?"自动认证":"手动认证"),1)]),_:1},8,["color"])]),_:1})):y("",!0)]),_:1})]),_:1}),t(E,{class:"mb-4",variant:"tonal"},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[t(v,{start:""},{default:n(()=>[...e[14]||(e[14]=[o("mdi-cog-transfer",-1)])]),_:1}),e[15]||(e[15]=o(" 设置分享（可选） ",-1))]),_:1}),t(j,null,{default:n(()=>[e[22]||(e[22]=m("div",{class:"text-body-2 text-medium-emphasis mb-3"}," 选择需要包含在链接中的设置项。如果不选择任何设置，将只生成预配置认证链接。 ",-1)),m("div",$s,[t(h,{color:"primary","prepend-icon":"mdi-server-network",size:"small",variant:"tonal",onClick:l.selectDataSourceSettings},{default:n(()=>[...e[16]||(e[16]=[o(" 数据源设置 ",-1)])]),_:1},8,["onClick"]),t(h,{color:"primary","prepend-icon":"mdi-compare",size:"small",variant:"tonal",onClick:l.selectChangedSettings},{default:n(()=>[...e[17]||(e[17]=[o(" 已变更设置 ",-1)])]),_:1},8,["onClick"]),t(h,{color:"success","prepend-icon":"mdi-select-all",size:"small",variant:"tonal",onClick:l.selectAll},{default:n(()=>[...e[18]||(e[18]=[o(" 全选 ",-1)])]),_:1},8,["onClick"]),t(h,{color:"error","prepend-icon":"mdi-select-remove",size:"small",variant:"tonal",onClick:l.resetSelection},{default:n(()=>[...e[19]||(e[19]=[o(" 清除选择 ",-1)])]),_:1},8,["onClick"])]),m("div",ei,[t(X,{class:"mr-2",color:"primary"},{default:n(()=>[o(" 已选 "+w(i.selectedItems.length)+" 项设置 ",1)]),_:1}),i.selectedItems.length>0?(c(),x(ne,{key:0},[(c(!0),x(ne,null,de(i.selectedItems.slice(0,3),r=>(c(),g(X,{key:r,class:"mr-1",size:"small",variant:"text"},{default:n(()=>[o(w(l.getSettingDescription(r)),1)]),_:2},1024))),128)),i.selectedItems.length>3?(c(),g(X,{key:0,color:"grey",size:"small",variant:"text"},{default:n(()=>[o(" +"+w(i.selectedItems.length-3)+" 更多 ",1)]),_:1})):y("",!0)],64)):y("",!0)]),t(it,{variant:"accordion"},{default:n(()=>[t(lt,null,{default:n(()=>[t(Et,null,{default:n(({expanded:r})=>[m("div",ti,[t(v,{class:"mr-2"},{default:n(()=>[o(w(r?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024),e[20]||(e[20]=o(" 显示设置列表详情 ",-1))])]),_:1}),t(ot,null,{default:n(()=>[t(R,{modelValue:i.search,"onUpdate:modelValue":e[3]||(e[3]=r=>i.search=r),class:"mb-4",clearable:"","hide-details":"",label:"搜索设置","prepend-inner-icon":"mdi-magnify","single-line":""},null,8,["modelValue"]),t(Ut,{modelValue:i.selectedItems,"onUpdate:modelValue":e[4]||(e[4]=r=>i.selectedItems=r),headers:i.headers,items:l.filteredItems,"items-per-page":l.settingItems.length,"sort-by":[{key:"isChanged",order:"desc"}],class:"rounded setting-table",density:"compact","item-value":"key","show-select":"","onUpdate:selected":l.handleSelectionChange},{"item.description":n(({item:r})=>[m("div",ni,[t(v,{icon:r.icon,class:"mr-2",size:"small"},null,8,["icon"]),o(" "+w(r.description)+" ",1),r.key==="server.kvToken"?(c(),g(X,{key:0,class:"ml-2",color:"error",size:"x-small"},{default:n(()=>[...e[21]||(e[21]=[o(" 敏感 ",-1)])]),_:1})):y("",!0)])]),"item.value":n(({item:r})=>[typeof r.value=="boolean"?(c(),x("span",si,w(r.value?"是":"否"),1)):r.key==="server.kvToken"&&r.value?(c(),x("span",ii,w(r.value.substring(0,8))+"... ",1)):(c(),x("span",li,w(r.value),1))]),"item.key":n(({item:r})=>[m("span",oi,w(r.key),1)]),"item.isChanged":n(({item:r})=>[t(X,{color:r.isChanged?"warning":"success",text:r.isChanged?"已修改":"默认",density:"compact",size:"x-small"},null,8,["color","text"])]),_:2},1032,["modelValue","headers","items","items-per-page","onUpdate:selected"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{class:"mb-4",variant:"outlined"},{default:n(()=>[t(K,{class:"text-subtitle-1"},{default:n(()=>[t(v,{start:""},{default:n(()=>[...e[23]||(e[23]=[o("mdi-link",-1)])]),_:1}),e[24]||(e[24]=o(" 生成的统一链接 ",-1))]),_:1}),t(j,null,{default:n(()=>[m("div",ai,[t(h,{disabled:!i.preconfigForm.namespace.trim(),color:"primary","prepend-icon":"mdi-auto-fix",variant:"flat",onClick:l.generateUnifiedLink},{default:n(()=>[...e[25]||(e[25]=[o(" 生成统一链接 ",-1)])]),_:1},8,["disabled","onClick"]),t(h,{disabled:!i.unifiedLink,color:"success","prepend-icon":"mdi-test-tube",variant:"tonal",onClick:l.openTestLink},{default:n(()=>[...e[26]||(e[26]=[o(" 测试链接 ",-1)])]),_:1},8,["disabled","onClick"]),t(h,{color:"error","prepend-icon":"mdi-delete",variant:"tonal",onClick:l.clearAll},{default:n(()=>[...e[27]||(e[27]=[o(" 清空所有 ",-1)])]),_:1},8,["onClick"])]),t(R,{modelValue:i.unifiedLink,"onUpdate:modelValue":e[5]||(e[5]=r=>i.unifiedLink=r),"append-inner-icon":i.linkCopied?"mdi-check":"mdi-content-copy",placeholder:i.preconfigForm.namespace?"点击「生成统一链接」按钮":"请先输入命名空间",class:"mb-3",label:"统一链接",readonly:"",variant:"outlined","onClick:appendInner":l.copyUnifiedLink},null,8,["modelValue","append-inner-icon","placeholder","onClick:appendInner"]),i.unifiedLink?(c(),g($,{key:0,class:"mb-3",type:"success",variant:"tonal"},{default:n(()=>[e[33]||(e[33]=m("div",{class:"text-subtitle-2 mb-2"},"链接包含内容：",-1)),m("div",ri,[t(X,{color:"primary",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[28]||(e[28]=[o("mdi-account-key",-1)])]),_:1}),e[29]||(e[29]=o(" 预配置认证 ",-1))]),_:1}),i.selectedItems.length>0?(c(),g(X,{key:0,color:"secondary",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[30]||(e[30]=[o("mdi-cog",-1)])]),_:1}),o(" "+w(i.selectedItems.length)+" 项设置 ",1)]),_:1})):(c(),g(X,{key:1,color:"grey",size:"small"},{default:n(()=>[t(v,{size:"small",start:""},{default:n(()=>[...e[31]||(e[31]=[o("mdi-cog-off",-1)])]),_:1}),e[32]||(e[32]=o(" 无额外设置 ",-1))]),_:1}))])]),_:1})):y("",!0)]),_:1})]),_:1}),t($,{type:"warning",variant:"tonal"},{default:n(()=>[...e[34]||(e[34]=[m("div",{class:"text-subtitle-2 mb-2"},"⚠️ 安全提醒",-1),m("ul",{class:"text-body-2 pl-4"},[m("li",null,"认证码和设置信息会在URL中传输，请谨慎分发"),m("li",null,"建议仅在受信任的网络环境中使用"),m("li",null,"生产环境建议使用HTTPS协议"),m("li",null,"数据源设置和已变更设置默认不包含敏感Token信息")],-1)])]),_:1})]),_:1})]),_:1})])}const Ht=q(Xs,[["render",ui]]),di={name:"UnsavedWarning",props:{show:Boolean,message:{type:String,default:"未保存"}}},ci={class:"warning-container"};function mi(s,e,a,d,i,l){return c(),x("div",ci,[a.show?(c(),g(X,{key:0,class:"warning-chip",color:"warning",size:"small"},{default:n(()=>[o(w(a.message),1)]),_:1})):y("",!0)])}const Ye=q(di,[["render",mi],["__scopeId","data-v-0f36b655"]]),fi=Sn({disabled:Boolean,modelValue:{type:Boolean,default:null},...Cn()},"VHover"),Gt=yn()({name:"VHover",props:fi(),emits:{"update:modelValue":s=>!0},setup(s,e){let{slots:a}=e;const d=kn(s,"modelValue"),{runOpenDelay:i,runCloseDelay:l}=xn(s,r=>!s.disabled&&(d.value=r));return()=>{var r;return(r=a.default)==null?void 0:r.call(a,{isHovering:d.value,props:{onMouseenter:i,onMouseleave:l}})}}}),pi={name:"TeacherListCard",components:{UnsavedWarning:Ye},props:{isMobile:Boolean},data(){return{newTeacher:{name:"",subjects:[],isHeadTeacher:!1},editState:{index:-1,teacher:null},modelValue:{list:[],text:"",advanced:!1},loading:!1,error:null,lastSavedData:null,unsavedChanges:!1,commonSubjects:["语文","数学","英语","物理","化学","生物","政治","历史","地理","信息技术","音乐","美术","体育"]}},watch:{modelValue:{handler(s){this.lastSavedData&&(this.unsavedChanges=JSON.stringify(s.list)!==JSON.stringify(this.lastSavedData)),this.modelValue.advanced||(this.modelValue.text=JSON.stringify(s.list,null,2))},deep:!0}},mounted(){this.loadTeachers()},methods:{async loadTeachers(){var s;this.error=null;try{if(this.loading=!0,!_("server.classNumber"))throw new Error("请先设置班号");try{const a=await re.loadData("classworks-list-teacher");a.success!==!1&&Array.isArray(a)&&(this.modelValue.list=a.map(d=>({name:d.name||"",subjects:Array.isArray(d.subjects)?d.subjects:[],isHeadTeacher:!!d.isHeadTeacher})),this.modelValue.text=JSON.stringify(this.modelValue.list,null,2),this.lastSavedData=JSON.parse(JSON.stringify(this.modelValue.list)),this.unsavedChanges=!1)}catch(a){console.warn("Failed to load teacher list, initializing empty list",a),this.modelValue.list=[],this.modelValue.text="[]",this.lastSavedData=[]}}catch(e){console.error("加载教师列表失败:",e),this.error=e.message||"加载失败，请检查设置",(s=this.$message)==null||s.error("加载失败",this.error)}finally{this.loading=!1}},async saveTeachers(){var s,e,a;try{if(!_("server.classNumber"))throw new Error("请先设置班号");const i=this.modelValue.list.map(r=>({name:r.name,subjects:Array.isArray(r.subjects)?r.subjects:[],isHeadTeacher:!!r.isHeadTeacher})),l=await re.saveData("classworks-list-teacher",i);if(l.success===!1)throw new Error(((s=l.error)==null?void 0:s.message)||"保存失败");this.modelValue.list=i,this.lastSavedData=JSON.parse(JSON.stringify(i)),this.unsavedChanges=!1,(e=this.$message)==null||e.success("保存成功","教师列表已更新")}catch(d){console.error("保存教师列表失败:",d),(a=this.$message)==null||a.error("保存失败",d.message||"请重试")}},toggleAdvanced(){this.modelValue.advanced=!this.modelValue.advanced,this.modelValue.advanced&&(this.modelValue.text=JSON.stringify(this.modelValue.list,null,2))},handleTextInput(s){if(this.modelValue.advanced)try{const e=JSON.parse(s);Array.isArray(e)?(this.modelValue.list=e.map(a=>({name:a.name||"",subjects:Array.isArray(a.subjects)?a.subjects:[],isHeadTeacher:!!a.isHeadTeacher})),this.error=null):this.error="JSON 必须是一个数组"}catch(e){this.error="JSON 格式错误: "+e.message}},addTeacher(){var e,a;const s=this.newTeacher.name.trim();if(!s){(e=this.$message)==null||e.warning("提示","请输入教师姓名");return}if(this.newTeacher.subjects.length===0){(a=this.$message)==null||a.warning("提示","请选择至少一个任教科目");return}this.modelValue.list.push({name:s,subjects:[...this.newTeacher.subjects],isHeadTeacher:this.newTeacher.isHeadTeacher}),this.newTeacher={name:"",subjects:[],isHeadTeacher:!1}},startEdit(s,e){this.editState.index=s,this.editState.teacher={name:e.name,subjects:[...e.subjects],isHeadTeacher:e.isHeadTeacher}},saveEdit(){var s,e;if(this.editState.index!==-1){const a=this.editState.teacher.name.trim();if(!a){(s=this.$message)==null||s.warning("提示","教师姓名不能为空");return}if(this.editState.teacher.subjects.length===0){(e=this.$message)==null||e.warning("提示","请选择至少一个任教科目");return}this.modelValue.list[this.editState.index]={name:a,subjects:[...this.editState.teacher.subjects],isHeadTeacher:this.editState.teacher.isHeadTeacher},this.editState.index=-1,this.editState.teacher=null}},cancelEdit(){this.editState.index=-1,this.editState.teacher=null},removeTeacher(s){s!==void 0&&this.modelValue.list.splice(s,1)},handleClick(s,e){this.isMobile&&this.startEdit(s,e)}}},hi={key:0},gi={class:"d-flex align-start mb-3"},wi={class:"flex-grow-1"},vi={class:"d-flex align-center mb-1"},bi=["onClick"],yi={key:0,class:"mt-2"},ki={key:1,class:"mt-1"},xi={key:1,class:"pt-2"};function Si(s,e,a,d,i,l){const r=Ye;return c(),g(E,{class:Fe({"unsaved-changes":i.unsavedChanges}),color:i.unsavedChanges?"warning-subtle":void 0,border:""},{default:n(()=>[t(ze,null,{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-account-tie",size:"large"})]),append:n(()=>[t(r,{show:i.unsavedChanges,message:"有未保存的更改"},null,8,["show"]),t(h,{color:i.modelValue.advanced?"primary":void 0,"prepend-icon":"mdi-code-braces",variant:"text",onClick:l.toggleAdvanced},{default:n(()=>[o(w(i.modelValue.advanced?"返回基础编辑":"高级编辑"),1)]),_:1},8,["color","onClick"])]),default:n(()=>[t(K,{class:"text-h6"},{default:n(()=>[...e[4]||(e[4]=[o("教师列表",-1)])]),_:1})]),_:1}),t(j,null,{default:n(()=>[i.loading?(c(),g(He,{key:0,class:"mb-4",color:"primary",indeterminate:""})):y("",!0),i.error?(c(),g($,{key:1,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:n(()=>[o(w(i.error),1)]),_:1})):y("",!0),t(At,null,{default:n(()=>[i.modelValue.advanced?(c(),x("div",xi,[t(Ie,{modelValue:i.modelValue.text,"onUpdate:modelValue":[e[3]||(e[3]=p=>i.modelValue.text=p),l.handleTextInput],hint:"JSON 格式编辑教师列表。每个教师需包含 name、subjects（数组）、isHeadTeacher（布尔值）",label:"批量编辑教师列表 (JSON)","persistent-hint":"",placeholder:'[{"name":"教师姓名","subjects":["语文","数学"],"isHeadTeacher":true}]',rows:"15",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])])):(c(),x("div",hi,[t(E,{class:"mb-6",variant:"outlined"},{default:n(()=>[t(j,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(O,{cols:"12",md:"4"},{default:n(()=>[t(R,{modelValue:i.newTeacher.name,"onUpdate:modelValue":e[0]||(e[0]=p=>i.newTeacher.name=p),density:"comfortable","hide-details":"",label:"教师姓名",placeholder:"输入教师姓名","prepend-inner-icon":"mdi-account",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(O,{cols:"12",md:"5"},{default:n(()=>[t(mt,{modelValue:i.newTeacher.subjects,"onUpdate:modelValue":e[1]||(e[1]=p=>i.newTeacher.subjects=p),items:i.commonSubjects,chips:"",clearable:"","closable-chips":"",density:"comfortable","hide-details":"",label:"任教科目",multiple:"",placeholder:"选择或输入科目","prepend-inner-icon":"mdi-book-open-variant",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(O,{cols:"12",md:"3",class:"d-flex align-center gap-2"},{default:n(()=>[t(Se,{modelValue:i.newTeacher.isHeadTeacher,"onUpdate:modelValue":e[2]||(e[2]=p=>i.newTeacher.isHeadTeacher=p),density:"comfortable","hide-details":"",label:"班主任"},null,8,["modelValue"]),t(h,{disabled:!i.newTeacher.name.trim()||i.newTeacher.subjects.length===0,color:"primary","prepend-icon":"mdi-plus",onClick:l.addTeacher},{default:n(()=>[...e[5]||(e[5]=[o(" 添加教师 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),i.modelValue.list.length===0?(c(),g(ce,{key:0},{default:n(()=>[t(O,{cols:"12"},{default:n(()=>[t($,{type:"info",variant:"tonal"},{default:n(()=>[...e[6]||(e[6]=[o(" 暂无教师信息，请添加教师 ",-1)])]),_:1})]),_:1})]),_:1})):(c(),g(ce,{key:1},{default:n(()=>[(c(!0),x(ne,null,de(i.modelValue.list,(p,u)=>(c(),g(O,{key:u,cols:"12",lg:"6",xl:"4"},{default:n(()=>[t(Gt,null,{default:n(({isHovering:b,props:T})=>[t(E,je({elevation:a.isMobile?1:b?4:1,border:"",class:"teacher-card"},{ref_for:!0},T),{default:n(()=>[t(j,{class:"pa-4"},{default:n(()=>[m("div",gi,[t(Ge,{color:p.isHeadTeacher?"primary":"grey-lighten-1",class:"mr-3",size:"48"},{default:n(()=>[t(v,{icon:p.isHeadTeacher?"mdi-star":"mdi-account",size:"28"},null,8,["icon"])]),_:2},1032,["color"]),m("div",wi,[m("div",vi,[i.editState.index===u?(c(),g(R,{key:0,modelValue:i.editState.teacher.name,"onUpdate:modelValue":I=>i.editState.teacher.name=I,autofocus:"",class:"flex-grow-1",density:"compact","hide-details":"",variant:"underlined"},null,8,["modelValue","onUpdate:modelValue"])):(c(),x("span",{key:1,class:"text-h6 font-weight-medium",onClick:I=>l.handleClick(u,p)},w(p.name),9,bi)),p.isHeadTeacher?(c(),g(X,{key:2,class:"ml-2",color:"primary",density:"comfortable",size:"small",variant:"flat"},{default:n(()=>[...e[7]||(e[7]=[o(" 班主任 ",-1)])]),_:1})):y("",!0)]),i.editState.index===u?(c(),x("div",yi,[t(mt,{modelValue:i.editState.teacher.subjects,"onUpdate:modelValue":I=>i.editState.teacher.subjects=I,items:i.commonSubjects,chips:"","closable-chips":"",density:"compact","hide-details":"",label:"任教科目",multiple:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"]),t(Se,{modelValue:i.editState.teacher.isHeadTeacher,"onUpdate:modelValue":I=>i.editState.teacher.isHeadTeacher=I,class:"mt-2",density:"compact","hide-details":"",label:"班主任"},null,8,["modelValue","onUpdate:modelValue"])])):(c(),x("div",ki,[(c(!0),x(ne,null,de(p.subjects,(I,H)=>(c(),g(X,{key:H,class:"mr-1 mb-1",density:"comfortable",size:"small",variant:"tonal"},{default:n(()=>[o(w(I),1)]),_:2},1024))),128))]))]),m("div",{class:Fe([{"opacity-100":b||a.isMobile||i.editState.index===u},"d-flex gap-1 action-buttons ml-2"])},[i.editState.index===u?(c(),g(h,{key:0,color:"success",icon:"mdi-check",size:"small",variant:"text",onClick:l.saveEdit},null,8,["onClick"])):y("",!0),i.editState.index===u?(c(),g(h,{key:1,color:"grey",icon:"mdi-close",size:"small",variant:"text",onClick:l.cancelEdit},null,8,["onClick"])):(c(),g(h,{key:2,color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:I=>l.startEdit(u,p)},null,8,["onClick"])),i.editState.index!==u?(c(),g(h,{key:3,color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:I=>l.removeTeacher(u)},null,8,["onClick"])):y("",!0)],2)])]),_:2},1024)]),_:2},1040,["elevation"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]))]),_:1}),t(ce,{class:"mt-6"},{default:n(()=>[t(O,{class:"d-flex gap-2",cols:"12"},{default:n(()=>[t(h,{disabled:i.loading,loading:i.loading,color:"primary","prepend-icon":"mdi-content-save",size:"large",onClick:l.saveTeachers},{default:n(()=>[...e[8]||(e[8]=[o(" 保存教师列表 ",-1)])]),_:1},8,["disabled","loading","onClick"]),t(h,{disabled:i.loading,loading:i.loading,color:"error","prepend-icon":"mdi-refresh",size:"large",variant:"outlined",onClick:l.loadTeachers},{default:n(()=>[...e[9]||(e[9]=[o(" 重载教师列表 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class","color"])}const Wt=q(pi,[["render",Si],["__scopeId","data-v-16455a49"]]),Ci={name:"StudentListCard",components:{UnsavedWarning:Ye},props:{isMobile:Boolean},data(){return{newStudentName:"",editState:{index:-1,name:""},modelValue:{list:[],text:"",advanced:!1},loading:!1,error:null,lastSavedData:null,unsavedChanges:!1}},watch:{modelValue:{handler(s){this.lastSavedData&&(this.unsavedChanges=JSON.stringify(s.list)!==JSON.stringify(this.lastSavedData)),this.modelValue.advanced||(this.modelValue.text=s.list.slice().sort((e,a)=>e.id-a.id).map(e=>e.name).join(`
`))},deep:!0}},mounted(){this.loadStudents()},methods:{async loadStudents(){var s;this.error=null;try{if(this.loading=!0,!_("server.classNumber"))throw new Error("请先设置班号");try{const a=await re.loadData("classworks-list-main");a.success!=!1&&Array.isArray(a)&&(this.modelValue.list=a.map((d,i)=>typeof d=="string"?{id:i+1,name:d}:{id:d.id||i+1,name:d.name||d.toString()}),this.modelValue.list.sort((d,i)=>d.id-i.id),this.modelValue.text=this.modelValue.list.map(d=>d.name).join(`
`),this.lastSavedData=JSON.parse(JSON.stringify(this.modelValue.list)),this.unsavedChanges=!1)}catch(a){console.warn("Failed to load student list from dedicated key, falling back to config",a)}}catch(e){console.error("加载学生列表失败:",e),this.error=e.message||"加载失败，请检查设置",(s=this.$message)==null||s.error("加载失败",this.error)}finally{this.loading=!1}},async saveStudents(){var s,e,a;try{if(!_("server.classNumber"))throw new Error("请先设置班号");const i=this.modelValue.list.slice().sort((r,p)=>r.id-p.id).map((r,p)=>({id:p+1,name:r.name})),l=await re.saveData("classworks-list-main",i);if(l.success===!1)throw new Error(((s=l.error)==null?void 0:s.message)||"保存失败");this.modelValue.list=i,this.lastSavedData=JSON.parse(JSON.stringify(i)),this.unsavedChanges=!1,(e=this.$message)==null||e.success("保存成功","学生列表已更新")}catch(d){console.error("保存学生列表失败:",d),(a=this.$message)==null||a.error("保存失败",d.message||"请重试")}},toggleAdvanced(){this.modelValue.advanced=!this.modelValue.advanced},handleTextInput(s){if(!this.modelValue.advanced)return;const e=s.split(`
`).filter(l=>l.trim()),a=new Map(this.modelValue.list.map(l=>[l.name,l.id]));let d=Math.max(0,...this.modelValue.list.map(l=>l.id));const i=e.map(l=>(l=l.trim(),a.has(l)?{id:a.get(l),name:l}:{id:++d,name:l}));this.modelValue.list=i},addStudent(){const s=this.newStudentName.trim();if(s&&!this.modelValue.list.some(e=>e.name===s)){const e=Math.max(0,...this.modelValue.list.map(a=>a.id));this.modelValue.list.push({id:e+1,name:s}),this.newStudentName=""}},startEdit(s,e){this.editState.index=s,this.editState.name=e.name},saveEdit(){if(this.editState.index!==-1){const s=this.editState.name.trim();s&&s!==this.modelValue.list[this.editState.index].name&&(this.modelValue.list[this.editState.index].name=s),this.editState.index=-1,this.editState.name=""}},removeStudent(s){s!==void 0&&this.modelValue.list.splice(s,1)},moveStudent(s,e){if(e==="top"){if(s>0){const a=this.modelValue.list[s];this.modelValue.list.splice(s,1),this.modelValue.list.unshift(a),this.modelValue.list.forEach((d,i)=>d.id=i+1)}}else{const a=e==="up"?s-1:s+1;a>=0&&a<this.modelValue.list.length&&([this.modelValue.list[s],this.modelValue.list[a]]=[this.modelValue.list[a],this.modelValue.list[s]],[this.modelValue.list[s].id,this.modelValue.list[a].id]=[this.modelValue.list[a].id,this.modelValue.list[s].id])}},handleClick(s,e){this.isMobile&&this.startEdit(s,e)},sortStudentsByPinyin(){const s=[...this.modelValue.list].sort((e,a)=>{const d=ft(e.name,{toneType:"none"}),i=ft(a.name,{toneType:"none"});return d.localeCompare(i)});s.forEach((e,a)=>e.id=a+1),this.modelValue.list=s}}},_i={key:0},Vi=["onClick"],Di={key:1,class:"pt-2"};function Ai(s,e,a,d,i,l){const r=Ye;return c(),g(E,{class:Fe({"unsaved-changes":i.unsavedChanges}),color:i.unsavedChanges?"warning-subtle":void 0,border:""},{default:n(()=>[t(ze,null,{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-account-group",size:"large"})]),append:n(()=>[t(r,{show:i.unsavedChanges,message:"有未保存的更改"},null,8,["show"]),t(h,{disabled:i.modelValue.list.length===0,class:"mr-2","prepend-icon":"mdi-sort-alphabetical-variant",variant:"text",onClick:l.sortStudentsByPinyin},{default:n(()=>[...e[4]||(e[4]=[o(" 按姓名首字母排序 ",-1)])]),_:1},8,["disabled","onClick"]),t(h,{color:i.modelValue.advanced?"primary":void 0,"prepend-icon":"mdi-code-braces",variant:"text",onClick:l.toggleAdvanced},{default:n(()=>[o(w(i.modelValue.advanced?"返回基础编辑":"高级编辑"),1)]),_:1},8,["color","onClick"])]),default:n(()=>[t(K,{class:"text-h6"},{default:n(()=>[...e[3]||(e[3]=[o("学生列表",-1)])]),_:1})]),_:1}),t(j,null,{default:n(()=>[i.loading?(c(),g(He,{key:0,class:"mb-4",color:"primary",indeterminate:""})):y("",!0),i.error?(c(),g($,{key:1,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:n(()=>[o(w(i.error),1)]),_:1})):y("",!0),t(At,null,{default:n(()=>[i.modelValue.advanced?(c(),x("div",Di,[t(Ie,{modelValue:i.modelValue.text,"onUpdate:modelValue":[e[2]||(e[2]=p=>i.modelValue.text=p),l.handleTextInput],hint:"使用文本编辑模式批量编辑学生名单，保存时会自动去除空行",label:"批量编辑学生列表","persistent-hint":"",placeholder:"每行输入一个学生姓名",rows:"10",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])])):(c(),x("div",_i,[t(ce,{class:"mb-6"},{default:n(()=>[t(O,{cols:"12",md:"4",sm:"6"},{default:n(()=>[t(R,{modelValue:i.newStudentName,"onUpdate:modelValue":e[0]||(e[0]=p=>i.newStudentName=p),class:"mb-4","hide-details":"",label:"添加学生",placeholder:"输入学生姓名后回车添加","prepend-inner-icon":"mdi-account-plus",variant:"outlined",onKeyup:Ve(l.addStudent,["enter"])},{append:n(()=>[t(h,{disabled:!i.newStudentName.trim(),color:"primary",icon:"mdi-plus",variant:"text",onClick:l.addStudent},null,8,["disabled","onClick"])]),_:1},8,["modelValue","onKeyup"])]),_:1})]),_:1}),t(ce,null,{default:n(()=>[(c(!0),x(ne,null,de(i.modelValue.list,(p,u)=>(c(),g(O,{key:u,cols:"12",lg:"3",md:"4",sm:"6"},{default:n(()=>[t(Gt,null,{default:n(({isHovering:b,props:T})=>[t(E,je({elevation:a.isMobile?1:b?4:1,border:"",class:"student-card"},{ref_for:!0},T),{default:n(()=>[t(j,{class:"d-flex align-center pa-3"},{default:n(()=>[t(It,{"open-on-hover":!a.isMobile,location:"bottom"},{activator:n(({props:I})=>[t(h,je({class:"mr-3 font-weight-medium",size:"small"},{ref_for:!0},I,{variant:"tonal"}),{default:n(()=>[o(w(u+1),1)]),_:2},1040)]),default:n(()=>[t(J,{density:"compact",nav:""},{default:n(()=>[t(A,{disabled:u===0,"prepend-icon":"mdi-arrow-up-bold",onClick:I=>l.moveStudent(u,"top")},{default:n(()=>[...e[5]||(e[5]=[o(" 置顶 ",-1)])]),_:1},8,["disabled","onClick"]),t(P),t(A,{disabled:u===0,"prepend-icon":"mdi-arrow-up",onClick:I=>l.moveStudent(u,"up")},{default:n(()=>[...e[6]||(e[6]=[o(" 上移 ",-1)])]),_:1},8,["disabled","onClick"]),t(A,{disabled:u===i.modelValue.list.length-1,"prepend-icon":"mdi-arrow-down",onClick:I=>l.moveStudent(u,"down")},{default:n(()=>[...e[7]||(e[7]=[o(" 下移 ",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1032,["open-on-hover"]),i.editState.index===u?(c(),g(R,{key:0,modelValue:i.editState.name,"onUpdate:modelValue":e[1]||(e[1]=I=>i.editState.name=I),autofocus:"",class:"flex-grow-1",density:"compact","hide-details":"",variant:"underlined",onBlur:l.saveEdit,onKeyup:Ve(l.saveEdit,["enter"])},null,8,["modelValue","onBlur","onKeyup"])):(c(),x("span",{key:1,class:"text-body-1 flex-grow-1",onClick:I=>l.handleClick(u,p)},w(p.name),9,Vi)),m("div",{class:Fe([{"opacity-100":b||a.isMobile},"d-flex gap-1 action-buttons"])},[t(h,{color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:I=>l.startEdit(u,p)},null,8,["onClick"]),t(h,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:I=>l.removeStudent(u)},null,8,["onClick"])],2)]),_:2},1024)]),_:2},1040,["elevation"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),t(ce,{class:"mt-6"},{default:n(()=>[t(O,{class:"d-flex gap-2",cols:"12"},{default:n(()=>[t(h,{disabled:i.loading,loading:i.loading,color:"primary","prepend-icon":"mdi-content-save",size:"large",onClick:l.saveStudents},{default:n(()=>[...e[8]||(e[8]=[o(" 保存名单 ",-1)])]),_:1},8,["disabled","loading","onClick"]),t(h,{disabled:i.loading,loading:i.loading,color:"error","prepend-icon":"mdi-refresh",size:"large",variant:"outlined",onClick:l.loadStudents},{default:n(()=>[...e[9]||(e[9]=[o(" 重载名单 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class","color"])}const Yt=q(Ci,[["render",Ai],["__scopeId","data-v-7e220985"]]),Ti={key:0,class:"d-flex justify-center align-center fill-height"},Ii={key:1,class:"d-flex justify-center align-center fill-height"},ji={key:2},Ei={class:"text-caption ml-4 text-medium-emphasis"},Ui={key:0},Ni={key:1},Mi={class:"text-error"},qt={__name:"CloudMigrationDialog",props:{modelValue:Boolean},emits:["update:modelValue"],setup(s,{emit:e}){const a=s,d=e,i=ge(!1),l=ge(!1),r=ge(!1),p=ge([]),u=ge([]),b=ge(!1),T=ge(null),I=ge(null),H=[{id:"student-list",label:"学生列表",description:"classworks-list-main",matcher:D=>D==="classworks-list-main"||D.startsWith("classworks-list-main")},{id:"homework-data",label:"作业数据",description:"classworks-data-*",matcher:D=>D.startsWith("classworks-data-")},{id:"lists",label:"列表",description:"classworks-list-*",matcher:D=>D.startsWith("classworks-list-")},{id:"other",label:"其他",description:"所有其他键",matcher:D=>!D.startsWith("classworks-data-")&&!D.startsWith("classworks-list-")}];pt(()=>a.modelValue,D=>{i.value=D,D&&G()}),pt(i,D=>{d("update:modelValue",D)});const G=async()=>{l.value=!0;try{const D=await gt.loadKeys({limit:1e3});p.value=D.keys||[],u.value=[]}catch(D){console.error(D)}finally{l.value=!1}},Z=D=>p.value.filter(D.matcher),fe=D=>Z(D).length,pe=D=>{const V=Z(D);return V.length===0?!1:V.filter(N=>u.value.includes(N)).length===V.length},me=D=>{const V=Z(D);if(V.length===0)return!1;const k=V.filter(N=>u.value.includes(N)).length;return k>0&&k<V.length},se=D=>{const V=Z(D);if(V.length===0)return;const k=pe(D),N=new Set(u.value);k?V.forEach(Q=>N.delete(Q)):V.forEach(Q=>N.add(Q)),u.value=Array.from(N)},be=async()=>{var D,V,k;r.value=!0,I.value=null,T.value=null;try{const N={};for(const L of u.value){const xe=await gt.loadData(L);if(xe){if(xe&&xe.success===!1&&xe.error){console.warn(`Skipping key ${L} due to load error`,xe.error);continue}N[L]=xe}}const Q=_("server.domain"),le=_("server.kvToken");if(!Q||!le)throw new Error("请先配置服务器地址和 Token");const _e=Q.replace(/\/$/,""),W=await jn.post(`${_e}/kv/_batchimport`,N,{headers:{Authorization:`Bearer ${le}`,"Content-Type":"application/json"}});if(W.data&&W.data.code===200)T.value=W.data.data,b.value=!0,i.value=!1;else throw new Error(((D=W.data)==null?void 0:D.message)||"迁移失败")}catch(N){console.error(N),I.value=((k=(V=N.response)==null?void 0:V.data)==null?void 0:k.message)||N.message||"发生未知错误",b.value=!0}finally{r.value=!1}};return(D,V)=>(c(),x(ne,null,[t(we,{modelValue:i.value,"onUpdate:modelValue":V[2]||(V[2]=k=>i.value=k),"max-width":"600",scrollable:""},{default:n(()=>[t(E,null,{default:n(()=>[t(K,null,{default:n(()=>[...V[5]||(V[5]=[o("迁移到云端",-1)])]),_:1}),t(j,{style:{height:"400px"}},{default:n(()=>[l.value?(c(),x("div",Ti,[t(Dt,{indeterminate:"",color:"primary"})])):p.value.length===0?(c(),x("div",Ii," 没有找到本地数据 ")):(c(),x("div",ji,[t(J,{"select-strategy":"classic",class:"mb-4"},{default:n(()=>[t(_n,null,{default:n(()=>[...V[6]||(V[6]=[o("选择数据类型",-1)])]),_:1}),(c(),x(ne,null,de(H,k=>t(A,{key:k.id,onClick:N=>se(k)},{prepend:n(()=>[t(wt,{"model-value":pe(k),indeterminate:me(k),onClick:Ae(N=>se(k),["stop"])},null,8,["model-value","indeterminate","onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[o(w(k.label),1)]),_:2},1024),t(ie,null,{default:n(()=>[o(w(k.description)+" ("+w(fe(k))+" 项)",1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1}),t(P,{class:"mb-4"}),t(it,null,{default:n(()=>[t(lt,{title:"详细数据列表"},{default:n(()=>[t(ot,null,{default:n(()=>[t(J,{"select-strategy":"classic",density:"compact"},{default:n(()=>[(c(!0),x(ne,null,de(p.value,k=>(c(),g(A,{key:k,value:k},{prepend:n(()=>[t(wt,{modelValue:u.value,"onUpdate:modelValue":V[0]||(V[0]=N=>u.value=N),value:k},null,8,["modelValue","value"])]),default:n(()=>[t(z,null,{default:n(()=>[o(w(k),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]))]),_:1}),t(P),t(ue,null,{default:n(()=>[m("div",Ei," 已选择 "+w(u.value.length)+" 项 ",1),t(te),t(h,{variant:"text",onClick:V[1]||(V[1]=k=>i.value=!1)},{default:n(()=>[...V[7]||(V[7]=[o("取消",-1)])]),_:1}),t(h,{color:"primary",onClick:be,loading:r.value,disabled:u.value.length===0},{default:n(()=>[...V[8]||(V[8]=[o(" 开始迁移 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:b.value,"onUpdate:modelValue":V[4]||(V[4]=k=>b.value=k),"max-width":"500"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,null,{default:n(()=>[...V[9]||(V[9]=[o("迁移结果",-1)])]),_:1}),t(j,null,{default:n(()=>[T.value?(c(),x("div",Ui,[m("p",null,"总计: "+w(T.value.summary.total),1),m("p",null,"成功: "+w(T.value.summary.successful),1),m("p",null,"失败: "+w(T.value.summary.failed),1)])):I.value?(c(),x("div",Ni,[m("p",Mi,w(I.value),1)])):y("",!0)]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{color:"primary",onClick:V[3]||(V[3]=k=>b.value=!1)},{default:n(()=>[...V[10]||(V[10]=[o("关闭",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Pi={name:"KvDatabaseCard",components:{SettingsCard:ee,CloudMigrationDialog:qt},data(){return{loading:!1,loadingData:!1,savingData:!1,deletingData:!1,kvData:[],searchQuery:"",viewDialog:!1,editDialog:!1,deleteDialog:!1,createDialog:!1,cloudUrlDialog:!1,showMigrationDialog:!1,selectedItem:null,editingItem:null,itemToDelete:null,selectedCloudItem:null,gettingCloudUrl:!1,cloudUrlResult:null,cloudUrlError:null,cloudUrlOptions:{migrateFromLocal:!0,autoConfigureCloud:!0},editingData:"",newKey:"",newData:"",tableHeaders:[{title:"键名",key:"key",sortable:!0},{title:"操作",key:"actions",sortable:!1,width:"120px"}]}},computed:{currentProvider(){return _("server.provider")},isKvProvider(){return this.currentProvider==="kv-local"||this.currentProvider==="kv-server"||this.currentProvider==="classworkscloud"},connectionStatus(){return this.isKvProvider?this.currentProvider==="kv-local"?"本地数据库":"服务器数据库":"当前数据提供者不支持KV数据库管理"},connectionIcon(){return this.isKvProvider?this.currentProvider==="kv-local"?"mdi-database":"mdi-database-sync":"mdi-database-off"},connectionColor(){return this.isKvProvider?"success":"error"},filteredKvData(){return this.searchQuery?this.kvData.filter(s=>s.key.toLowerCase().includes(this.searchQuery.toLowerCase())):this.kvData},isValidJson(){if(!this.editingData)return!0;try{return JSON.parse(this.editingData),!0}catch{return!1}},isValidNewJson(){if(!this.newData)return!0;try{return JSON.parse(this.newData),!0}catch{return!1}},isValidKey(){return!this.newKey||this.newKey.trim()===""?!1:!this.kvData.some(s=>s.key===this.newKey.trim())}},async mounted(){this.isKvProvider&&await this.loadKvData()},methods:{async refreshConnection(){this.loading=!0;try{await new Promise(s=>setTimeout(s,500)),this.$message.success("连接状态已刷新")}catch(s){this.$message.error("刷新失败",s.message)}finally{this.loading=!1}},async loadKvData(){var s;if(!this.isKvProvider){this.$message.warning("当前数据提供者不支持KV数据库管理");return}this.loadingData=!0;try{this.kvData=[];const e=await re.loadKeys({sortBy:"key",sortDir:"asc",limit:1e3});if(e.success===!1)throw new Error(((s=e.error)==null?void 0:s.message)||"获取键名列表失败");this.kvData=e.keys.map(a=>({key:a,value:null,loaded:!1})),this.$message.success("键名加载完成",`共找到 ${this.kvData.length} 个键，总计 ${e.total_rows} 个键`)}catch(e){this.$message.error("加载数据失败",e.message)}finally{this.loadingData=!1}},async viewItem(s){this.selectedItem=s,this.viewDialog=!0,(!s.loaded||s.value===null)&&await this.loadItemData(s)},async editItem(s){this.editingItem=s,(!s.loaded||s.value===null)&&await this.loadItemData(s),this.editingData=this.formatJsonData(s.value),this.editDialog=!0},async loadItemData(s){try{const e=await re.loadData(s.key);if(e&&e.success!==!1)s.value=e,s.loaded=!0;else throw new Error("数据加载失败")}catch(e){this.$message.error("加载数据失败",e.message),s.value=null,s.loaded=!1}},closeEditDialog(){this.editDialog=!1,this.editingItem=null,this.editingData=""},createNewItem(){this.newKey="",this.newData=`{
  "example": "value"
}`,this.createDialog=!0},closeCreateDialog(){this.createDialog=!1,this.newKey="",this.newData=""},async saveNewData(){var s;if(!(!this.isValidKey||!this.isValidNewJson)){this.savingData=!0;try{const e=JSON.parse(this.newData),a=this.newKey.trim(),d=await re.saveData(a,e);if(d&&!d.error)this.kvData.push({key:a,value:e,loaded:!0}),this.$message.success("数据创建成功"),this.closeCreateDialog();else throw new Error(((s=d.error)==null?void 0:s.message)||"创建失败")}catch(e){this.$message.error("创建失败",e.message)}finally{this.savingData=!1}}},async saveEditedData(){var s;if(!(!this.isValidJson||!this.editingItem)){this.savingData=!0;try{const e=JSON.parse(this.editingData),a=await re.saveData(this.editingItem.key,e);if(a&&!a.error){const d=this.kvData.findIndex(i=>i.key===this.editingItem.key);d!==-1&&(this.kvData[d].value=e,this.kvData[d].loaded=!0),this.$message.success("数据保存成功"),this.closeEditDialog()}else throw new Error(((s=a.error)==null?void 0:s.message)||"保存失败")}catch(e){this.$message.error("保存失败",e.message)}finally{this.savingData=!1}}},confirmDelete(s){this.itemToDelete=s,this.deleteDialog=!0},async deleteItem(){if(this.itemToDelete){this.deletingData=!0;try{this.currentProvider==="kv-local"?await(await En("ClassworksDB",2)).transaction("kv","readwrite").objectStore("kv").delete(this.itemToDelete.key):await re.saveData(this.itemToDelete.key,null);const s=this.kvData.findIndex(e=>e.key===this.itemToDelete.key);s!==-1&&this.kvData.splice(s,1),this.$message.success("数据删除成功"),this.deleteDialog=!1,this.itemToDelete=null}catch(s){this.$message.error("删除失败",s.message)}finally{this.deletingData=!1}}},formatJsonData(s){try{return JSON.stringify(s,null,2)}catch{return String(s)}},async copyToClipboard(s){try{const e=this.formatJsonData(s);await navigator.clipboard.writeText(e),this.$message.success("数据已复制到剪贴板")}catch(e){this.$message.error("复制失败",e.message)}},async getCloudUrl(s){this.selectedCloudItem=s,this.cloudUrlResult=null,this.cloudUrlError=null,this.cloudUrlDialog=!0,await this.fetchCloudUrl()},async fetchCloudUrl(){var s;if(this.selectedCloudItem){this.gettingCloudUrl=!0,this.cloudUrlError=null;try{const e=await re.getKeyCloudUrl(this.selectedCloudItem.key,this.cloudUrlOptions);e.success?(this.cloudUrlResult=e,this.$message.success("云端地址获取成功")):(this.cloudUrlError=((s=e.error)==null?void 0:s.message)||"获取云端地址失败",this.$message.error("获取失败",this.cloudUrlError))}catch(e){this.cloudUrlError=e.message||"获取云端地址时发生错误",this.$message.error("获取失败",this.cloudUrlError)}finally{this.gettingCloudUrl=!1}}},async refreshCloudUrl(){await this.fetchCloudUrl()},async copyCloudUrl(){var s;if((s=this.cloudUrlResult)!=null&&s.url)try{await navigator.clipboard.writeText(this.cloudUrlResult.url),this.$message.success("云端地址已复制到剪贴板")}catch(e){this.$message.error("复制失败",e.message)}},openCloudUrl(){var s;if((s=this.cloudUrlResult)!=null&&s.url)try{window.open(this.cloudUrlResult.url,"_blank")}catch(e){this.$message.error("打开链接失败",e.message)}}}},Bi={class:"text-primary"},Li={class:"mt-2"},zi={key:0,class:"mb-2"},Oi={key:1,class:"mb-2"};function Ri(s,e,a,d,i,l){const r=qt,p=ee;return c(),g(p,{loading:i.loading,icon:"mdi-database-edit",title:"KV数据库管理"},{default:n(()=>[t(J,null,{default:n(()=>[t(A,null,{prepend:n(()=>[t(v,{color:l.connectionColor,icon:l.connectionIcon,class:"mr-3"},null,8,["color","icon"])]),append:n(()=>[t(h,{loading:i.loading,variant:"tonal",onClick:l.refreshConnection},{default:n(()=>[...e[20]||(e[20]=[o(" 刷新 ",-1)])]),_:1},8,["loading","onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[19]||(e[19]=[o("数据库状态",-1)])]),_:1}),t(ie,null,{default:n(()=>[o(w(l.connectionStatus),1)]),_:1})]),_:1}),t(P,{class:"my-2"}),t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-format-list-bulleted"})]),append:n(()=>[t(ht,{variant:"tonal"},{default:n(()=>[t(h,{loading:i.loadingData,onClick:l.loadKvData},{default:n(()=>[...e[22]||(e[22]=[o(" 加载数据 ",-1)])]),_:1},8,["loading","onClick"]),t(h,{disabled:!l.isKvProvider,onClick:l.createNewItem},{default:n(()=>[t(v,{class:"mr-1",icon:"mdi-plus"}),e[23]||(e[23]=o(" 新建 ",-1))]),_:1},8,["disabled","onClick"]),t(h,{onClick:e[0]||(e[0]=u=>i.showMigrationDialog=!0)},{default:n(()=>[t(v,{class:"mr-1",icon:"mdi-cloud-upload"}),e[24]||(e[24]=o(" 从本地迁移 ",-1))]),_:1})]),_:1})]),default:n(()=>[t(z,null,{default:n(()=>[...e[21]||(e[21]=[o("数据条目",-1)])]),_:1}),t(ie,null,{default:n(()=>[o("共 "+w(i.kvData.length)+" 条记录",1)]),_:1})]),_:1})]),_:1}),i.kvData.length>0?(c(),g(E,{key:0,class:"mt-4",variant:"outlined"},{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-table"}),e[25]||(e[25]=o(" KV数据列表 ",-1)),t(te),t(R,{modelValue:i.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=u=>i.searchQuery=u),clearable:"",density:"compact","hide-details":"",label:"搜索键名","prepend-inner-icon":"mdi-magnify",style:{"max-width":"300px"},variant:"outlined"},null,8,["modelValue"])]),_:1}),t(Ut,{headers:i.tableHeaders,items:l.filteredKvData,"items-per-page":10,loading:i.loadingData,class:"elevation-0","item-value":"key"},{"item.key":n(({item:u})=>[m("code",Bi,w(u.key),1)]),"item.actions":n(({item:u})=>[t(ht,{density:"compact",variant:"text"},{default:n(()=>[t(h,{icon:"mdi-eye",size:"small",title:"查看",onClick:b=>l.viewItem(u)},null,8,["onClick"]),t(h,{icon:"mdi-pencil",size:"small",title:"编辑",onClick:b=>l.editItem(u)},null,8,["onClick"]),t(h,{color:"primary",icon:"mdi-cloud-download",size:"small",title:"获取云端地址",onClick:b=>l.getCloudUrl(u)},null,8,["onClick"]),t(h,{color:"error",icon:"mdi-delete",size:"small",title:"删除",onClick:b=>l.confirmDelete(u)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["headers","items","loading"])]),_:1})):y("",!0),t(we,{modelValue:i.viewDialog,"onUpdate:modelValue":e[5]||(e[5]=u=>i.viewDialog=u),"max-width":"800px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-eye"}),e[26]||(e[26]=o(" 查看数据 ",-1)),t(te),t(h,{icon:"mdi-close",variant:"text",onClick:e[2]||(e[2]=u=>i.viewDialog=!1)})]),_:1}),i.selectedItem?(c(),g(Le,{key:0},{default:n(()=>[e[27]||(e[27]=o(" 键名: ",-1)),m("code",null,w(i.selectedItem.key),1)]),_:1})):y("",!0),t(j,null,{default:n(()=>[i.selectedItem?(c(),g(Ie,{key:0,"model-value":l.formatJsonData(i.selectedItem.value),class:"font-monospace",label:"数据内容",readonly:"",rows:"15",variant:"outlined"},null,8,["model-value"])):y("",!0)]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"tonal",onClick:e[3]||(e[3]=u=>{var b;return l.copyToClipboard((b=i.selectedItem)==null?void 0:b.value)})},{default:n(()=>[t(v,{class:"mr-1",icon:"mdi-content-copy"}),e[28]||(e[28]=o(" 复制数据 ",-1))]),_:1}),t(h,{variant:"text",onClick:e[4]||(e[4]=u=>i.viewDialog=!1)},{default:n(()=>[...e[29]||(e[29]=[o(" 关闭 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:i.editDialog,"onUpdate:modelValue":e[7]||(e[7]=u=>i.editDialog=u),"max-width":"800px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-pencil"}),e[30]||(e[30]=o(" 编辑数据 ",-1)),t(te),t(h,{icon:"mdi-close",variant:"text",onClick:l.closeEditDialog},null,8,["onClick"])]),_:1}),i.editingItem?(c(),g(Le,{key:0},{default:n(()=>[e[31]||(e[31]=o(" 键名: ",-1)),m("code",null,w(i.editingItem.key),1)]),_:1})):y("",!0),t(j,null,{default:n(()=>[t(Ie,{modelValue:i.editingData,"onUpdate:modelValue":e[6]||(e[6]=u=>i.editingData=u),error:!l.isValidJson,"error-messages":l.isValidJson?[]:["请输入有效的JSON格式"],class:"font-monospace",label:"数据内容 (JSON格式)",rows:"15",variant:"outlined"},null,8,["modelValue","error","error-messages"])]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:l.closeEditDialog},{default:n(()=>[...e[32]||(e[32]=[o(" 取消 ",-1)])]),_:1},8,["onClick"]),t(h,{disabled:!l.isValidJson,loading:i.savingData,color:"primary",variant:"tonal",onClick:l.saveEditedData},{default:n(()=>[...e[33]||(e[33]=[o(" 保存 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:i.createDialog,"onUpdate:modelValue":e[10]||(e[10]=u=>i.createDialog=u),"max-width":"800px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-plus"}),e[34]||(e[34]=o(" 新建数据 ",-1)),t(te),t(h,{icon:"mdi-close",variant:"text",onClick:l.closeCreateDialog},null,8,["onClick"])]),_:1}),t(j,null,{default:n(()=>[t(R,{modelValue:i.newKey,"onUpdate:modelValue":e[8]||(e[8]=u=>i.newKey=u),error:!l.isValidKey,"error-messages":l.isValidKey?[]:["键名不能为空且不能与现有键重复"],class:"mb-4",label:"键名",placeholder:"请输入键名，如：my-config",variant:"outlined"},null,8,["modelValue","error","error-messages"]),t(Ie,{modelValue:i.newData,"onUpdate:modelValue":e[9]||(e[9]=u=>i.newData=u),error:!l.isValidNewJson,"error-messages":l.isValidNewJson?[]:["请输入有效的JSON格式"],class:"font-monospace",label:"数据内容 (JSON格式)",placeholder:'请输入JSON数据，如：{"name": "value"}',rows:"15",variant:"outlined"},null,8,["modelValue","error","error-messages"])]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:l.closeCreateDialog},{default:n(()=>[...e[35]||(e[35]=[o(" 取消 ",-1)])]),_:1},8,["onClick"]),t(h,{disabled:!l.isValidKey||!l.isValidNewJson,loading:i.savingData,color:"primary",variant:"tonal",onClick:l.saveNewData},{default:n(()=>[...e[36]||(e[36]=[o(" 创建 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:i.cloudUrlDialog,"onUpdate:modelValue":e[15]||(e[15]=u=>i.cloudUrlDialog=u),"max-width":"800px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-cloud-download"}),e[37]||(e[37]=o(" 获取云端访问地址 ",-1)),t(te),t(h,{icon:"mdi-close",variant:"text",onClick:e[11]||(e[11]=u=>i.cloudUrlDialog=!1)})]),_:1}),i.selectedCloudItem?(c(),g(Le,{key:0},{default:n(()=>[e[38]||(e[38]=o(" 键名: ",-1)),m("code",null,w(i.selectedCloudItem.key),1)]),_:1})):y("",!0),t(j,null,{default:n(()=>[i.cloudUrlError?(c(),g($,{key:0,class:"mb-4",type:"error",variant:"tonal"},{default:n(()=>[o(w(i.cloudUrlError),1)]),_:1})):y("",!0),i.cloudUrlResult&&i.cloudUrlResult.success?(c(),g($,{key:1,class:"mb-4",type:"success",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[39]||(e[39]=[o("云端地址获取成功",-1)])]),_:1}),m("div",Li,[i.cloudUrlResult.migrated?(c(),x("div",zi,[t(v,{class:"mr-1",color:"success",icon:"mdi-database-arrow-up"}),e[40]||(e[40]=o(" 数据已从本地迁移到云端 ",-1))])):y("",!0),i.cloudUrlResult.configured?(c(),x("div",Oi,[t(v,{class:"mr-1",color:"info",icon:"mdi-cog"}),e[41]||(e[41]=o(" 云端配置已自动设置 ",-1))])):y("",!0)])]),_:1})):y("",!0),i.cloudUrlResult&&i.cloudUrlResult.url?(c(),g(R,{key:2,"model-value":i.cloudUrlResult.url,"append-inner-icon":"mdi-content-copy",class:"font-monospace",label:"云端访问地址",readonly:"",variant:"outlined","onClick:appendInner":l.copyCloudUrl},null,8,["model-value","onClick:appendInner"])):y("",!0),i.cloudUrlResult&&i.cloudUrlResult.url?(c(),g(it,{key:3,class:"mt-4"},{default:n(()=>[t(lt,null,{default:n(()=>[t(Et,null,{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-cog"}),e[42]||(e[42]=o(" 高级选项 ",-1))]),_:1}),t(ot,null,{default:n(()=>[t(Se,{modelValue:i.cloudUrlOptions.migrateFromLocal,"onUpdate:modelValue":e[12]||(e[12]=u=>i.cloudUrlOptions.migrateFromLocal=u),density:"compact",label:"从本地迁移数据到云端"},null,8,["modelValue"]),t(Se,{modelValue:i.cloudUrlOptions.autoConfigureCloud,"onUpdate:modelValue":e[13]||(e[13]=u=>i.cloudUrlOptions.autoConfigureCloud=u),density:"compact",label:"自动配置云端默认设置"},null,8,["modelValue"]),t(h,{loading:i.gettingCloudUrl,class:"mt-2",color:"primary",variant:"tonal",onClick:l.refreshCloudUrl},{default:n(()=>[t(v,{class:"mr-1",icon:"mdi-refresh"}),e[43]||(e[43]=o(" 重新获取 ",-1))]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:e[14]||(e[14]=u=>i.cloudUrlDialog=!1)},{default:n(()=>[...e[44]||(e[44]=[o(" 关闭 ",-1)])]),_:1}),i.cloudUrlResult&&i.cloudUrlResult.url?(c(),g(h,{key:0,color:"primary",variant:"tonal",onClick:l.openCloudUrl},{default:n(()=>[t(v,{class:"mr-1",icon:"mdi-open-in-new"}),e[45]||(e[45]=o(" 在新窗口打开 ",-1))]),_:1},8,["onClick"])):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:i.deleteDialog,"onUpdate:modelValue":e[17]||(e[17]=u=>i.deleteDialog=u),"max-width":"400px"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,{class:"d-flex align-center text-error"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-alert"}),e[46]||(e[46]=o(" 确认删除 ",-1))]),_:1}),t(j,null,{default:n(()=>{var u;return[e[48]||(e[48]=o(" 确定要删除键名为 ",-1)),m("code",null,w((u=i.itemToDelete)==null?void 0:u.key),1),e[49]||(e[49]=o(" 的数据吗？ ",-1)),e[50]||(e[50]=m("br",null,null,-1)),e[51]||(e[51]=m("br",null,null,-1)),t($,{class:"mt-2",type:"warning",variant:"tonal"},{default:n(()=>[...e[47]||(e[47]=[o(" 此操作不可撤销，请谨慎操作！ ",-1)])]),_:1})]}),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:e[16]||(e[16]=u=>i.deleteDialog=!1)},{default:n(()=>[...e[52]||(e[52]=[o(" 取消 ",-1)])]),_:1}),t(h,{loading:i.deletingData,color:"error",variant:"tonal",onClick:l.deleteItem},{default:n(()=>[...e[53]||(e[53]=[o(" 删除 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(r,{modelValue:i.showMigrationDialog,"onUpdate:modelValue":e[18]||(e[18]=u=>i.showMigrationDialog=u)},null,8,["modelValue"])]),_:1},8,["loading"])}const Zt=q(Pi,[["render",Ri],["__scopeId","data-v-67879974"]]),Ki={name:"DataProviderSettingsCard",components:{SettingsCard:ee},data(){return{loading:!1,serverchecktime:{},confirmDialog:!1,confirmTitle:"",confirmMessage:"",confirmAction:null,machineId:null,migrateLoading:!1}},computed:{currentProvider(){return _("server.provider")},isKvProvider(){return this.currentProvider==="kv-local"||this.currentProvider==="kv-server"||this.currentProvider==="classworkscloud"}},async created(){this.machineId=_("device.uuid")},methods:{async checkServerConnection(){this.loading=!0,this.serverchecktime=new Date;const s=[];try{const e=_("server.siteKey"),a={Accept:"application/json"};if(e&&(a["x-site-key"]=e),Mn()){const d=await Pn(async p=>{const u=await Qe.get(`${p}/check`,{method:"GET",headers:a});if(u.data.status!=="success")throw new Error("服务器响应异常");return u},{onServerTried:({url:p,status:u,tried:b})=>{s.length=0,s.push(...b)}}),i=new Date-this.serverchecktime,l=s.find(p=>p.status==="success");let r=`服务器连接正常 延迟${i}ms`;if(s.length>1){const p=s.map((u,b)=>`${b+1}. ${u.url} (${u.status==="success"?"成功":"失败"})`).join(`
`);r+=`

依次尝试的服务器:
${p}`}else l&&(r+=`
服务器: ${l.url}`);this.$message.success("连接成功",r)}else{const d=_("server.domain");if((await Qe.get(`${d}/check`,{method:"GET",headers:a})).data.status==="success")this.$message.success("连接成功","服务器连接正常 延迟"+(new Date-this.serverchecktime)+"ms");else throw new Error("服务器响应异常")}}catch(e){let a=e.message||"无法连接到服务器";if(s.length>0){const d=s.map((i,l)=>`${l+1}. ${i.url} (失败${i.error?`: ${i.error}`:""})`).join(`
`);a+=`

依次尝试的服务器:
${d}

所有服务器均连接失败`}this.$message.error("连接失败",a)}finally{this.loading=!1}},confirmClearLocalStorage(){this.confirmTitle="确认清除",this.confirmMessage="此操作将清除所有本地存储的数据，确定要继续吗？",this.confirmAction=this.clearLocalStorage,this.confirmDialog=!0},clearLocalStorage(){try{localStorage.clear(),this.$message.success("清除成功","本地存储数据已清除"),this.confirmDialog=!1}catch(s){this.$message.error("清除失败",s.message)}},confirmClearIndexedDB(){this.confirmTitle="确认清除",this.confirmMessage="此操作将清除所有IndexedDB中的数据，确定要继续吗？",this.confirmAction=this.clearIndexedDB,this.confirmDialog=!0},async clearIndexedDB(){try{await window.indexedDB.deleteDatabase("ClassworksDB"),this.$message.success("清除成功","数据库缓存已清除"),this.confirmDialog=!1,this.isKvProvider&&setTimeout(()=>{window.location.reload()},1500)}catch(s){this.$message.error("清除失败",s.message)}},async exportData(){try{const s="ClassworksDB",e={indexedDB:{}},a=await new Promise((u,b)=>{const T=window.indexedDB.open(s);T.onerror=()=>b(T.error),T.onsuccess=()=>u(T.result)}),d=Array.from(a.objectStoreNames);for(const u of d){const T=a.transaction(u,"readonly").objectStore(u),I=await new Promise((H,G)=>{const Z=T.getAll();Z.onerror=()=>G(Z.error),Z.onsuccess=()=>H(Z.result)});e.indexedDB[u]=I}const i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(i),r=document.createElement("a"),p=new Date().toISOString().split("T")[0];r.href=l,r.download=`homework-indexeddb-${p}.json`,r.click(),URL.revokeObjectURL(l),this.$message.success("导出成功","IndexedDB数据已导出")}catch(s){console.error("导出失败:",s),this.$message.error("导出失败",s.message||"无法导出数据库数据")}},async migrateData(){this.migrateLoading=!0,this.$router.push("/datamigration"),this.migrateLoading=!1},handleConfirm(){this.confirmAction&&this.confirmAction()}}};function Fi(s,e,a,d,i,l){const r=ee;return c(),g(r,{icon:"mdi-database-cog",title:"数据源设置"},{default:n(()=>[t(J,null,{default:n(()=>[l.currentProvider==="kv-server"||l.currentProvider==="classworkscloud"?(c(),g(A,{key:0},{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-lan-connect"})]),append:n(()=>[t(h,{loading:i.loading,variant:"tonal",onClick:l.checkServerConnection},{default:n(()=>[...e[3]||(e[3]=[o(" 测试连接 ",-1)])]),_:1},8,["loading","onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[2]||(e[2]=[o("检查服务器连接",-1)])]),_:1})]),_:1})):y("",!0),l.currentProvider==="kv-local"?(c(),x(ne,{key:1},[t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-database"})]),append:n(()=>[t(h,{color:"error",variant:"tonal",onClick:l.confirmClearIndexedDB},{default:n(()=>[...e[6]||(e[6]=[o(" 清除 ",-1)])]),_:1},8,["onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[4]||(e[4]=[o("清除数据库缓存",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[5]||(e[5]=[o("这将清除所有本地数据库中的数据 ",-1)])]),_:1})]),_:1}),t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-database-export"})]),append:n(()=>[t(h,{variant:"tonal",onClick:l.exportData},{default:n(()=>[...e[8]||(e[8]=[o(" 导出",-1)])]),_:1},8,["onClick"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[7]||(e[7]=[o("导出数据库",-1)])]),_:1})]),_:1})],64)):y("",!0),t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-lan-connect"})]),append:n(()=>[t(h,{to:"/cachemanagement",variant:"tonal"},{default:n(()=>[...e[10]||(e[10]=[o(" 查看",-1)])]),_:1})]),default:n(()=>[t(z,null,{default:n(()=>[...e[9]||(e[9]=[o("查看本地缓存",-1)])]),_:1})]),_:1})]),_:1}),t(we,{modelValue:i.confirmDialog,"onUpdate:modelValue":e[1]||(e[1]=p=>i.confirmDialog=p),"max-width":"400"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,null,{default:n(()=>[o(w(i.confirmTitle),1)]),_:1}),t(j,null,{default:n(()=>[o(w(i.confirmMessage),1)]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{color:"grey",variant:"text",onClick:e[0]||(e[0]=p=>i.confirmDialog=!1)},{default:n(()=>[...e[11]||(e[11]=[o("取消 ",-1)])]),_:1}),t(h,{color:"error",variant:"tonal",onClick:l.handleConfirm},{default:n(()=>[...e[12]||(e[12]=[o("确认 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Xt=q(Ki,[["render",Fi]]),Ji={name:"CloudNamespaceInfoCard",props:{visible:{type:Boolean,default:!0}},data(){return{namespaceInfo:{},loading:!1,hasNamespaceInfo:!1,showReinitDialog:!1,defaultAuthServer:_("server.authDomain")}},watch:{visible(s){s===!0&&this.fetchNamespaceInfo()}},mounted(){this.visible&&this.fetchNamespaceInfo()},methods:{formatDate(s){if(!s)return"未知";try{return new Date(s).toLocaleString("zh-CN")}catch{return s}},async fetchNamespaceInfo(){this.loading=!0;try{const s=await Un.loadNamespaceInfo();this.namespaceInfo=s,this.hasNamespaceInfo=!0,this.loading=!1}catch(s){console.error("获取命名空间信息失败:",s),this.hasNamespaceInfo=!1,this.namespaceInfo={}}finally{this.loading=!1}},async reloadInfo(){await this.fetchNamespaceInfo()},getBindAccountUrl(){var e,a;const s=(a=(e=this.namespaceInfo)==null?void 0:e.device)==null?void 0:a.uuid;return s?`${this.defaultAuthServer}?uuid=${encodeURIComponent(s)}&tolinktoaccount=true`:this.defaultAuthServer},confirmReinitialize(){ke("server.kvToken",""),ke("device.uuid",""),this.showReinitDialog=!1,this.$router.push("/")}}},Qi={key:0,class:"mb-4"},Hi={key:1,class:"d-flex align-center mb-4"},Gi={class:"d-flex flex-column gap-1"},Wi={class:"d-flex align-center"},Yi={class:"d-flex align-center"},qi={key:0,class:"d-flex align-center"},Zi={class:"text-truncate"},Xi={class:"d-flex align-center"},$i={key:1,class:"d-flex align-center"};function el(s,e,a,d,i,l){return c(),g(E,{disabled:!i.hasNamespaceInfo,loading:i.loading,class:"my-4"},{loader:n(()=>[i.loading?(c(),g(He,{key:0,color:"primary",indeterminate:""})):y("",!0)]),default:n(()=>[t(K,null,{default:n(()=>[t(v,{class:"me-2"},{default:n(()=>[...e[3]||(e[3]=[o(" mdi-cloud-check ",-1)])]),_:1}),e[4]||(e[4]=o(" 设备信息 ",-1))]),_:1}),i.hasNamespaceInfo?(c(),g(j,{key:0},{default:n(()=>[i.namespaceInfo.hasAccount===!1?(c(),x("div",Qi,[t($,{border:"",type:"warning",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[5]||(e[5]=[o("设备未绑定账号",-1)])]),_:1}),e[7]||(e[7]=m("div",null,"当前设备尚未绑定账号,部分功能可能受限。请前往绑定账号以获得完整体验。",-1)),t(h,{href:l.getBindAccountUrl(),"append-icon":"mdi-open-in-new",class:"mt-3",target:"_blank",variant:"outlined"},{default:n(()=>[...e[6]||(e[6]=[o(" 前往绑定账号 ",-1)])]),_:1},8,["href"])]),_:1})])):y("",!0),i.namespaceInfo.hasAccount&&i.namespaceInfo.account?(c(),x("div",Hi,[t(E,{"prepend-avatar":i.namespaceInfo.account.avatarUrl,subtitle:"此设备由贵校管理 管理员账号 ID: "+i.namespaceInfo.account.id,title:i.namespaceInfo.account.name||"未命名用户",border:"",class:"w-100",hover:"",variant:"tonal"},{default:n(()=>[t(j,null,{default:n(()=>[...e[8]||(e[8]=[o(" 此设备由贵校或贵单位管理，该管理员系此空间所有者，如有疑问请咨询他，对于恶意绑定、滥用行为请反馈。 ",-1)])]),_:1})]),_:1},8,["prepend-avatar","subtitle","title"])])):y("",!0),i.namespaceInfo.device?(c(),g(E,{key:2,border:"",class:"mb-4",hover:"",variant:"tonal"},{default:n(()=>[t(K,{class:"pb-1"},{default:n(()=>[...e[9]||(e[9]=[o(" 设备信息 ",-1)])]),_:1}),t(j,null,{default:n(()=>[m("div",Gi,[m("div",Wi,[t(v,{class:"me-2",size:"small"},{default:n(()=>[...e[10]||(e[10]=[o(" mdi-tag ",-1)])]),_:1}),e[11]||(e[11]=m("span",{class:"font-weight-medium me-2"},"设备名称:",-1)),m("span",null,w(i.namespaceInfo.device.name||"未命名设备"),1)]),m("div",Yi,[t(v,{class:"me-2",size:"small"},{default:n(()=>[...e[12]||(e[12]=[o(" mdi-identifier ",-1)])]),_:1}),e[13]||(e[13]=m("span",{class:"font-weight-medium me-2"},"设备 ID:",-1)),m("span",null,w(i.namespaceInfo.device.id),1)]),i.namespaceInfo.hasAccount===!1&&i.namespaceInfo.device.uuid?(c(),x("div",qi,[t(v,{class:"me-2",size:"small"},{default:n(()=>[...e[14]||(e[14]=[o(" mdi-uuid ",-1)])]),_:1}),e[15]||(e[15]=m("span",{class:"font-weight-medium me-2"},"UUID:",-1)),m("span",Zi,w(i.namespaceInfo.device.uuid),1)])):y("",!0),m("div",Xi,[t(v,{class:"me-2",size:"small"},{default:n(()=>[...e[16]||(e[16]=[o(" mdi-calendar ",-1)])]),_:1}),e[17]||(e[17]=m("span",{class:"font-weight-medium me-2"},"创建时间:",-1)),m("span",null,w(l.formatDate(i.namespaceInfo.device.createdAt)),1)]),i.namespaceInfo.device.updatedAt?(c(),x("div",$i,[t(v,{class:"me-2",size:"small"},{default:n(()=>[...e[18]||(e[18]=[o(" mdi-calendar-clock ",-1)])]),_:1}),e[19]||(e[19]=m("span",{class:"font-weight-medium me-2"},"更新时间:",-1)),m("span",null,w(l.formatDate(i.namespaceInfo.device.updatedAt)),1)])):y("",!0)])]),_:1})]),_:1})):y("",!0),t(E,{border:"",hover:"",subtitle:"文档形键值数据库",title:"Classworks KV"},{default:n(()=>[t(j,null,{default:n(()=>[...e[20]||(e[20]=[o(" Classworks KV 是厚浪云推出的文档形键值数据库，其是一个开放的云应用平台，为各种应用提供存储服务。此设备正在使用其服务，如果您希望管理设备信息，请前往 Classworks KV 的网站，如果您在服务推出前就在使用 Classworks，您的数据已被自动迁移。 ",-1),m("br",null,null,-1),m("br",null,null,-1),o(" Classworks KV 的全域管理员是 ",-1),m("a",{href:"https://wuyuan.dev",target:"_blank"}," 孙悟元 ",-1)])]),_:1}),t(ue,null,{default:n(()=>[t(h,{href:i.defaultAuthServer,"append-icon":"mdi-open-in-new",class:"text-none",target:"_blank"},{default:n(()=>[...e[21]||(e[21]=[o(" 前往 Classworks KV ",-1)])]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})):(c(),g(j,{key:1},{default:n(()=>[t($,{type:"info",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[22]||(e[22]=[o("未获取到设备信息",-1)])]),_:1}),e[23]||(e[23]=m("p",null,"您尚未完成云端存储授权或连接失败，请点击下方按钮进行初始化。",-1))]),_:1})]),_:1})),t(ue,null,{default:n(()=>[t(te),t(h,{loading:i.loading,color:"primary",variant:"outlined",onClick:l.reloadInfo},{default:n(()=>[...e[24]||(e[24]=[o(" 刷新设备信息 ",-1)])]),_:1},8,["loading","onClick"]),t(h,{color:"error",variant:"outlined",onClick:e[0]||(e[0]=r=>i.showReinitDialog=!0)},{default:n(()=>[...e[25]||(e[25]=[o(" 重新初始化云端存储 ",-1)])]),_:1})]),_:1}),t(we,{modelValue:i.showReinitDialog,"onUpdate:modelValue":e[2]||(e[2]=r=>i.showReinitDialog=r),"max-width":"500"},{default:n(()=>[t(E,null,{default:n(()=>[t(K,null,{default:n(()=>[...e[26]||(e[26]=[o("确认重新初始化",-1)])]),_:1}),t(j,null,{default:n(()=>[t($,{class:"mb-3",type:"warning",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[27]||(e[27]=[o("警告",-1)])]),_:1}),e[28]||(e[28]=o(" 此操作将清除当前的云端存储配置（包括 Token），您需要重新进行授权。 ",-1))]),_:1}),e[29]||(e[29]=m("p",null,"您确定要重新初始化云端存储吗？",-1))]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:e[1]||(e[1]=r=>i.showReinitDialog=!1)},{default:n(()=>[...e[30]||(e[30]=[o(" 取消 ",-1)])]),_:1}),t(h,{color:"error",onClick:l.confirmReinitialize},{default:n(()=>[...e[31]||(e[31]=[o(" 确认 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["disabled","loading"])}const $t=q(Ji,[["render",el]]),tl={name:"ServerSettingsCard",components:{SettingsCard:ee,CloudNamespaceInfoCard:$t},props:{loading:Boolean},data(){return{unwatch:null,serverSettings:{provider:_("server.provider"),domain:_("server.domain"),classNumber:_("server.classNumber"),kvToken:_("server.kvToken")},settingsChangeTimeout:null}},computed:{currentProvider(){return this.serverSettings.provider},isKvProvider(){return this.currentProvider==="kv-local"||this.currentProvider==="kv-server"},isClassworksCloud(){return this.currentProvider==="classworkscloud"},useServer(){return this.currentProvider==="server"||this.currentProvider==="kv-server"||this.currentProvider==="classworkscloud"}},watch:{serverSettings:{handler(){this.settingsChangeTimeout&&clearTimeout(this.settingsChangeTimeout),this.settingsChangeTimeout=setTimeout(()=>{this.saveAllSettings()},100)},deep:!0}},mounted(){this.loadAllSettings(),this.unwatch=nt(()=>{this.loadAllSettings(),this.$forceUpdate&&this.$forceUpdate()})},beforeUnmount(){this.unwatch&&this.unwatch()},methods:{loadAllSettings(){this.serverSettings={provider:_("server.provider"),domain:_("server.domain"),classNumber:_("server.classNumber"),kvToken:_("server.kvToken")}},saveAllSettings(){Object.entries(this.serverSettings).forEach(([s,e])=>{const a=`server.${s}`,d=_(a);e!==d&&(ke(a,e)?console.log(`设置已更新: ${a} = ${e}`):(console.error(`设置失败: ${a}`),this.serverSettings[s]=d))})}}},nl={key:0},sl={key:2},il={key:3},ll={key:4};function ol(s,e,a,d,i,l){const r=$t,p=ee;return c(),g(p,{loading:a.loading,icon:"mdi-database",title:"数据源设置"},{default:n(()=>[t(jt,null,{default:n(()=>[t(Je,{modelValue:i.serverSettings.provider,"onUpdate:modelValue":e[0]||(e[0]=u=>i.serverSettings.provider=u),items:[{title:"Classworks云端存储",value:"classworkscloud"},{title:"KV本地存储",value:"kv-local"},{title:"KV远程服务器",value:"kv-server"}],class:"mb-3",density:"comfortable","item-title":"title","item-value":"value",label:"数据提供者","prepend-icon":"mdi-database",variant:"outlined"},null,8,["modelValue"]),l.isKvProvider?(c(),g($,{key:0,class:"my-2",type:"info",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[5]||(e[5]=[o("KV 存储系统",-1)])]),_:1}),e[7]||(e[7]=m("p",null,"KV存储系统使用本机唯一标识符(UUID)来区分不同设备的数据。",-1)),l.currentProvider==="kv-server"?(c(),x("p",nl,[...e[6]||(e[6]=[o(" 服务器端点格式: ",-1),m("code",null,"http(s)://服务器域名/",-1),m("br",null,null,-1),o(" 在服务器域名处仅填写基础URL，不需要任何路径。 ",-1)])])):y("",!0)]),_:1})):y("",!0),l.isClassworksCloud?(c(),g($,{key:1,class:"my-2",color:"success",type:"info",variant:"tonal"},{default:n(()=>[t(Te,null,{default:n(()=>[...e[8]||(e[8]=[o("Classworks云端存储",-1)])]),_:1}),e[9]||(e[9]=m("p",null,"Classworks云端存储是官方提供的存储解决方案，自动配置了最优的访问设置。",-1)),e[10]||(e[10]=m("p",null,"使用此选项时，服务器域名和网站令牌将自动配置，无需手动设置。",-1))]),_:1})):y("",!0),t(P,{class:"my-2"}),l.isClassworksCloud?(c(),x("div",sl,[t(R,{modelValue:i.serverSettings.kvToken,"onUpdate:modelValue":e[1]||(e[1]=u=>i.serverSettings.kvToken=u),class:"mb-2",density:"comfortable",hint:"令牌用于云端存储授权",label:"KV 授权令牌","persistent-hint":"","prepend-icon":"mdi-shield-key",variant:"outlined"},null,8,["modelValue"]),t(r,{visible:l.isClassworksCloud,class:"mt-4"},null,8,["visible"])])):l.currentProvider==="kv-server"?(c(),x("div",il,[t(R,{modelValue:i.serverSettings.domain,"onUpdate:modelValue":e[2]||(e[2]=u=>i.serverSettings.domain=u),class:"mb-2",density:"comfortable",hint:"例如: https://example.com (不需要路径)",label:"服务器域名","persistent-hint":"","prepend-icon":"mdi-web",variant:"outlined"},null,8,["modelValue"]),t(R,{modelValue:i.serverSettings.kvToken,"onUpdate:modelValue":e[3]||(e[3]=u=>i.serverSettings.kvToken=u),class:"mb-2",density:"comfortable",hint:"令牌用于服务器验证",label:"KV 授权令牌","persistent-hint":"","prepend-icon":"mdi-shield-key",variant:"outlined"},null,8,["modelValue"])])):l.currentProvider==="kv-local"?(c(),x("div",ll,[t(R,{modelValue:i.serverSettings.classNumber,"onUpdate:modelValue":e[4]||(e[4]=u=>i.serverSettings.classNumber=u),class:"mb-2",density:"comfortable",hint:"例如: 高三八班",label:"班级编号","persistent-hint":"","prepend-icon":"mdi-account-group",variant:"outlined"},null,8,["modelValue"])])):y("",!0)]),_:1})]),_:1},8,["loading"])}const en=q(tl,[["render",ol]]),al="classworks",rl="module",ul="0.0.0",dl={dev:"vite --host",build:"vite build",preview:"vite preview",lint:"eslint . --fix",prebuild:"node scripts/generate-sound-list.js"},cl={"@fingerprintjs/fingerprintjs":"^5.0.1","@mdi/font":"7.4.47","@microsoft/clarity":"^1.0.2","@sentry/vue":"^10.36.0","@vueuse/core":"^14.1.0",axios:"^1.13.2",idb:"^8.0.3","js-base64":"^3.7.8","js-yaml":"^4.1.1","lucide-vue-next":"^0.555.0",marked:"^17.0.1","pinyin-pro":"^3.27.0","ratelimit-header-parser":"^0.1.0","roboto-fontface":"*","socket.io-client":"^4.8.1","typewriter-effect":"^2.22.0",uuid:"^13.0.0",vue:"^3.5.25","vue-sonner":"^2.0.9",vuetify:"^3.11.0"},ml={"@eslint/js":"^9.39.1","@vite-pwa/assets-generator":"^1.0.2","@vitejs/plugin-vue":"^6.0.2",eslint:"^9.39.1","eslint-plugin-import":"^2.32.0","eslint-plugin-n":"^17.23.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^7.2.1","eslint-plugin-vue":"^10.6.2",pinia:"^3.0.4",sass:"1.94.2","sass-embedded":"^1.93.3","unplugin-auto-import":"^20.3.0","unplugin-fonts":"^1.4.0","unplugin-vue-components":"^30.0.0","unplugin-vue-router":"^0.18.0",vite:"^5.4.11","vite-plugin-pwa":"^1.2.0","vite-plugin-vue-devtools":"^7.6.8","vite-plugin-vue-layouts":"^0.11.0","vite-plugin-vuetify":"^2.1.2","vue-router":"^4.6.3"},Pe={name:al,private:!0,type:rl,version:ul,scripts:dl,dependencies:cl,devDependencies:ml},fl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAa9SURBVHic7dY9jlxVFIXRY8SsCEDyMCAjgRFBYokARoGQQII5EDIJYhNgyb9td9euqvfu3WuN4CTf1nn2958/vRyg0mdHHwAcxwBAMQMAxQwAFDMAUMwAQDEDAMUMABQzAFDMAEAxAwDFDAAUMwBQzABAMQMAxQwAFDMAUMwAQDEDAMUMABQzAFDMAEAxAwDFDAAUMwBQzABAMQMAxQwAFDMAUMwAQDEDAMUMABQzAFDMAEAxAwDFDAAUMwBQzABAMQMAxQwAFDMAUMwAQDEDAMUMABQzAFDMAEAxAwDFPj/6AI7z2+9/zW9//HX0Gct6/uUX8/yrL44+I+IDKCX+zA7xzxiASuLP7BL/jAGoI/7MTvHPGIAq4s/sFv+MAagh/syO8c8YgAriz+wa/4wB2J74MzvHP2MAtib+zO7xzxiAbYk/0xD/jAHYkvgzLfHPGIDtiD/TFP+MAdiK+DNt8c8YgG2IP9MY/4wB2IL4M63xzxiA5Yk/0xz/jAFYmvgz7fHPGIBliT8j/v8ZgAWJPyP+1wzAYsSfEf/bDMBCxJ8R//sMwCLEnxH/hxmABYg/I/6HGYCTE39G/B9nAE5M/Bnxf5oBOCnxZ8T/OAbghMSfEf/jGYCTEX9G/E9jAE5E/BnxP50BOAnxZ8R/GQNwAuLPiP9yBuBg4s+IP2MADiT+jPhzBuAg4s+I/zoMwAHEnxH/9RiAOxN/RvzXZQDuSPwZ8V+fAbgT8WfEfxsG4A7EnxH/7RiAGxN/Rvy3ZQBuSPwZ8d+eAbgR8WfEfx8G4AbEnxH//RiAKxN/Rvz3ZQCuSPwZ8d+fAbgS8WfEfwwDcAXiz4j/OAYgJP6M+I9lAALiz4j/eAbgQuLPiP8cDMAFxJ8R/3kYgCcSf0b852IAnkD8GfGfjwF4JPFnxH9OBuARxJ8R/3kZgE8Qf0b852YAPkL8GfGfnwF4gPgz4l+DAfgA8WfEvw4D8A7xZ8S/FgPwBvFnxL8eA/CK+DPiX5MBGPGnxL+u+gEQf0b8a6seAPFnxL++2gEQf0b8e6gcAPFnxL+PugEQf0b8e6kaAPFnxL+fmgEQf0b8e6oYAPFnxL+v7QdA/Bnx723rARB/Rvz723YAxJ8Rf4ctB0D8GfH32G4AxJ8Rf5etBkD8GfH32WYAxJ8Rf6ctBkD8GfH3Wn4AxJ8Rf7dn//7z68ujj+AYP774ZX548fPRZyzr+2+/me++/froMyLLfwBcRvyZHeKfMQCVxJ/ZJf4ZA1BH/Jmd4p8xAFXEn9kt/hkDUEP8mR3jnzEAFcSf2TX+GQOwPfFndo5/xgBsTfyZ3eOfMQDbEn+mIf4ZA7Al8Wda4p8xANsRf6Yp/hkDsBXxZ9rinzEA2xB/pjH+GQOwBfFnWuOfMQDLE3+mOf4ZA7A08Wfa458xAMsSf0b8/zMACxJ/RvyvGYDFiD8j/rcZgIWIPyP+9xmARYg/I/4PMwALEH9G/A8zACcn/oz4P84AnJj4M+L/NANwUuLPiP9xDMAJiT8j/sczACcj/oz4n8YAnIj4M+J/OgNwEuLPiP8yBuAExJ8R/+UMwMHEnxF/xgAcSPwZ8ecMwEHEnxH/dRiAA4g/I/7rMQB3Jv6M+K/LANyR+DPivz4DcCfiz4j/NgzAHYg/I/7bMQA3Jv6M+G/LANyQ+DPivz0DcCPiz4j/PgzADYg/I/77MQBXJv6M+O/LAFyR+DPivz8DcCXiz4j/GAbgCsSfEf9xDEBI/BnxH8sABMSfEf/xDMCFxJ8R/zkYgAuIPyP+8zAATyT+jPjPxQA8gfgz4j8fA/BI4s+I/5wMwCOIPyP+8zIAnyD+jPjPzQB8hPgz4j8/A/AA8WfEvwYD8AHiz4h/HQbgHeLPiH8tBuAN4s+Ifz0G4BXxZ8S/JgMw4k+Jf131AyD+jPjXVj0A4s+If321AyD+jPj3UDkA4s+Ifx91AyD+jPj3UjUA4s+Ifz81AyD+jPj3VDEA4s+If1/bD4D4M+Lf29YDIP6M+Pe37QCIPyP+DlsOgPgz4u+x3QCIPyP+LlsNgPgz4u+zzQCIPyP+TlsMgPgz4u+1/ACIPyP+bs/+/efXl0cfARxj+Q8AuJwBgGIGAIoZAChmAKCYAYBiBgCKGQAoZgCgmAGAYgYAihkAKGYAoJgBgGIGAIoZAChmAKCYAYBiBgCKGQAoZgCgmAGAYgYAihkAKGYAoJgBgGIGAIoZAChmAKCYAYBiBgCKGQAoZgCgmAGAYgYAihkAKGYAoJgBgGIGAIoZAChmAKCYAYBiBgCKGQAoZgCgmAGAYgYAiv0Hs2PMhrt8KlMAAAAASUVORK5CYII=",pl={name:"AboutCard",setup(){const s=ge([]),e=ge(!1),a=ge(!1),d=ge(""),i=ge(!1),l=ge(!1),r="964979747",p="https://qm.qq.com/q/T6qImKJjGi",u=Vn(),b=()=>{try{const k={...Pe.dependencies||{},...Pe.devDependencies||{}},N=Object.entries(k).map(([Q,le])=>({name:Q,version:le.replace(/[\^~]/g,""),description:T(Q)}));s.value=N}catch(k){console.error("加载依赖信息失败:",k),s.value=[]}},T=k=>({vue:"渐进式 JavaScript 框架",vuetify:"材料设计组件框架",axios:"Promise 基础的 HTTP 客户端",pinia:"Vue 状态管理库","vue-router":"Vue.js 官方路由管理器","@vitejs/plugin-vue":"Vite 的 Vue 插件"})[k]||"",I=()=>{u.push("/debug")},H=async()=>{i.value=!0;try{const k=await An();d.value=k||""}catch(k){console.error("获取访客ID失败",k)}finally{i.value=!1}},G=()=>H(),Z=async()=>{a.value=!0,d.value||await H()},fe=async()=>{try{await navigator.clipboard.writeText(me.value),l.value=!0,setTimeout(()=>l.value=!1,1800)}catch(k){console.error("复制失败",k)}},pe=Me(()=>{var W,L;const k=navigator||{},N=typeof Intl<"u"&&Intl.DateTimeFormat?Intl.DateTimeFormat().resolvedOptions():{},Q=N&&N.timeZone?N.timeZone:"",le=((L=(W=u.currentRoute)==null?void 0:W.value)==null?void 0:L.fullPath)||location.pathname;return[`App 版本: v${Pe==null?void 0:Pe.version}`,`URL: ${location.href}`,`路由: ${le}`,`UserAgent: ${k.userAgent||""}`,`语言: ${k.language||""}`,`时区: ${Q}`,`平台: ${k.platform||""}`,`在线: ${String(k.onLine)}`,`屏幕: ${(screen==null?void 0:screen.width)||"-"}x${(screen==null?void 0:screen.height)||"-"}`,`视口: ${window.innerWidth||"-"}x${window.innerHeight||"-"}`].join(`
`)}),me=Me(()=>`调试ID: ${d.value||"获取失败"}

浏览器/环境信息:
${pe.value}`),se=Me(()=>["问题描述:","1. 期望行为:","2. 实际行为:","3. 复现步骤:","",me.value].join(`
`)),be=Me(()=>{const k="https://github.com/ZeroCatDev/Classworks/issues/new",N=encodeURIComponent("问题报告"),Q=encodeURIComponent(se.value);return`${k}?title=${N}&body=${Q}`}),D=Me(()=>{const k=encodeURIComponent("Classworks 问题报告"),N=encodeURIComponent(se.value);return`mailto:sun@wuyuan.dev?subject=${k}&body=${N}`}),V=()=>{typeof window.openSentryFeedback=="function"?window.openSentryFeedback():console.warn("Sentry Feedback 功能不可用")};return Dn(()=>{b()}),{Dependencies:s,showDeps:e,showReportDialog:a,debugIdInput:d,visitorLoading:i,copyOk:l,qqGroupNumber:r,qqGroupLink:p,goToDebug:I,reloadVisitorId:G,openReportDialog:Z,copyEnvInfo:fe,openFeedback:V,envBoxText:me,envInfo:pe,reportBody:se,githubIssueUrl:be,mailtoLink:D}}},hl={class:"d-flex flex-column align-start"},gl={class:"d-flex gap-2 flex-wrap mb-6"},wl={class:"text-body-2",style:{"white-space":"pre-wrap",margin:"0"}},vl={class:"d-flex gap-2 flex-wrap mb-4"},bl={class:"d-flex gap-2 mb-4"},yl={class:"text-caption text-medium-emphasis"};function kl(s,e,a,d,i,l){return c(),g(E,{border:"",hover:"",rounded:"xl"},{default:n(()=>[t(ze,null,{prepend:n(()=>[t(v,{class:"mr-2",icon:"mdi-information",size:"large"})]),default:n(()=>[t(K,{class:"text-h6"},{default:n(()=>[...e[6]||(e[6]=[o("关于",-1)])]),_:1})]),_:1}),t(j,null,{default:n(()=>[t(ce,null,{default:n(()=>[t(O,{class:"mx-auto",cols:"12",md:"8"},{default:n(()=>[m("div",hl,[t(Ge,{class:"mb-4",size:"120"},{default:n(()=>[t(_t,{alt:"Classworks",src:fl})]),_:1}),e[37]||(e[37]=m("h2",{class:"text-h5 mb-2"},"Classworks",-1)),e[38]||(e[38]=m("p",{class:"text-body-1 mb-4"},"适用于班级大屏的作业板小工具",-1)),m("div",gl,[t(h,{color:"red","prepend-icon":"mdi-bug",variant:"tonal",onClick:d.openReportDialog},{default:n(()=>[...e[7]||(e[7]=[o(" 报告问题 ",-1)])]),_:1},8,["onClick"]),t(h,{color:"primary",href:"https://qm.qq.com/q/qNBX4ZZVeg","prepend-icon":"mdi-qqchat",target:"_blank",variant:"tonal"},{default:n(()=>[...e[8]||(e[8]=[o(" QQ 群 ",-1)])]),_:1}),t(h,{href:"https://github.com/ClassworksDev/Classworks","prepend-icon":"mdi-github",target:"_blank",variant:"text"},{default:n(()=>[...e[9]||(e[9]=[o(" 前端 ",-1)])]),_:1}),t(h,{href:"https://github.com/ClassworksDev/ClassworksServer","prepend-icon":"mdi-github",target:"_blank",variant:"text"},{default:n(()=>[...e[10]||(e[10]=[o(" 后端 ",-1)])]),_:1})]),t(P,{class:"mb-4 w-100"}),e[39]||(e[39]=m("h3",{class:"text-h6 mb-2"},"备注与致谢",-1)),t(J,{class:"mb-4 bg-transparent"},{default:n(()=>[t(A,{"append-icon":"mdi-link",href:"https://github.com/EnderWolf006/HomeworkBoard",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[...e[11]||(e[11]=[o(" 本项目受到 HomeworkBoard 的启发而开发 ",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[12]||(e[12]=[o(" 感谢 EnderWolf006 (@EnderWolf) fhzit(@Hellofhz) KeyFac 等人的贡献 ",-1)])]),_:1})]),_:1}),t(A,{"append-icon":"mdi-link",href:"https://hlyun.org",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[...e[13]||(e[13]=[o(" Classworks 由",-1),m("strong",null,"厚浪云",-1),o("提供 ",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[14]||(e[14]=[o(" 长江后浪推前浪 浮事新人换旧人 ",-1)])]),_:1})]),_:1}),t(A,{"append-icon":"mdi-link",href:"https://zerocat.houlangs.com",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[...e[15]||(e[15]=[o(" 感谢 ZeroCat 社区的开发者们 ",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[16]||(e[16]=[o(" 新一代，开源，编程社区 ",-1)])]),_:1})]),_:1}),t(P,{class:"ma-1"}),t(A,{"append-icon":"mdi-link",href:"https://github.com/HUSX100/IslandCaller",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[...e[17]||(e[17]=[o(" 本项目与 IslandCaller 没有从属关系 ",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[18]||(e[18]=[o(" IslandCaller 是由 HUSX100 开发的基于 ClassIsland 提醒服务的轻量级点名器 ",-1)])]),_:1})]),_:1}),t(A,{"append-icon":"mdi-link",href:"https://classisland.tech",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[...e[19]||(e[19]=[o(" 本项目与 ClassIsland 没有从属关系 ",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[20]||(e[20]=[o(" ClassIsland 是由 HelloWRC 开发的适用于班级大屏的课表信息显示工具 ",-1)])]),_:1})]),_:1})]),_:1}),t(h,{class:"mb-4","prepend-icon":"mdi-package-variant",variant:"text",onClick:e[0]||(e[0]=r=>d.showDeps=!0)},{default:n(()=>[...e[21]||(e[21]=[o(" 查看使用的第三方库 ",-1)])]),_:1}),t(we,{modelValue:d.showDeps,"onUpdate:modelValue":e[2]||(e[2]=r=>d.showDeps=r),fullscreen:"",transition:"dialog-bottom-transition"},{default:n(()=>[t(E,null,{default:n(()=>[t(vt,null,{default:n(()=>[t(h,{icon:"mdi-close",onClick:e[1]||(e[1]=r=>d.showDeps=!1)}),t(bt,null,{default:n(()=>[...e[22]||(e[22]=[o("使用的第三方库",-1)])]),_:1}),t(te)]),_:1}),t(j,null,{default:n(()=>[t(J,null,{default:n(()=>[(c(!0),x(ne,null,de(d.Dependencies,r=>(c(),g(A,{key:r.name,href:"https://www.npmjs.com/package/"+r.name,"append-icon":"mdi-link",target:"_blank"},{default:n(()=>[t(z,null,{default:n(()=>[o(w(r.name),1)]),_:2},1024),t(ie,null,{default:n(()=>[o(" v"+w(r.version),1)]),_:2},1024)]),_:2},1032,["href"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:d.showReportDialog,"onUpdate:modelValue":e[5]||(e[5]=r=>d.showReportDialog=r),"max-width":"640"},{default:n(()=>[t(E,null,{default:n(()=>[t(vt,{density:"compact"},{default:n(()=>[t(h,{icon:"mdi-close",onClick:e[3]||(e[3]=r=>d.showReportDialog=!1)}),t(bt,null,{default:n(()=>[...e[23]||(e[23]=[o("报告问题",-1)])]),_:1}),t(te)]),_:1}),t(j,null,{default:n(()=>[e[34]||(e[34]=m("p",{class:"mb-4"}," 调试ID与下方的浏览器环境信息将帮助我们快速定位问题，请在反馈中一并附上。 ",-1)),t(zn,{class:"mb-3 pa-3 bg-grey-lighten-4 rounded",style:{"max-height":"260px",overflow:"auto"}},{default:n(()=>[m("pre",wl,w(d.envBoxText),1)]),_:1}),m("div",vl,[t(h,{size:"small",variant:"text","prepend-icon":"mdi-refresh",onClick:d.reloadVisitorId,loading:d.visitorLoading},{default:n(()=>[...e[24]||(e[24]=[o("刷新",-1)])]),_:1},8,["onClick","loading"]),t(h,{size:"small",variant:"text","prepend-icon":"mdi-content-copy",onClick:d.copyEnvInfo},{default:n(()=>[...e[25]||(e[25]=[o("复制信息",-1)])]),_:1},8,["onClick"]),t(h,{size:"small",variant:"text","prepend-icon":"mdi-open-in-new",onClick:d.goToDebug},{default:n(()=>[...e[26]||(e[26]=[o("查看 /debug 页面",-1)])]),_:1},8,["onClick"])]),d.copyOk?(c(),g($,{key:0,type:"success",density:"compact",class:"mb-4"},{default:n(()=>[...e[27]||(e[27]=[o("已复制到剪贴板",-1)])]),_:1})):y("",!0),m("div",bl,[t(h,{size:"small",color:"primary",variant:"elevated","prepend-icon":"mdi-message-alert",onClick:d.openFeedback,block:""},{default:n(()=>[...e[28]||(e[28]=[o(" 发送错误反馈到 Sentry ",-1)])]),_:1},8,["onClick"])]),e[35]||(e[35]=m("h4",{class:"text-subtitle-1 mb-2"},"反馈渠道",-1)),t(J,{lines:"one",class:"bg-transparent"},{default:n(()=>[t(A,{href:d.qqGroupLink,target:"_blank","prepend-icon":"mdi-qqchat"},{default:n(()=>[t(z,null,{default:n(()=>[o("QQ群 ("+w(d.qqGroupNumber)+")",1)]),_:1}),t(ie,null,{default:n(()=>[...e[29]||(e[29]=[o("964979747",-1)])]),_:1})]),_:1},8,["href"]),t(A,{href:d.githubIssueUrl,target:"_blank","prepend-icon":"mdi-github"},{default:n(()=>[t(z,null,{default:n(()=>[...e[30]||(e[30]=[o("GitHub Issue",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[31]||(e[31]=[o("ZeroCatDev/Classworks",-1)])]),_:1})]),_:1},8,["href"]),t(A,{href:d.mailtoLink,target:"_blank","prepend-icon":"mdi-email"},{default:n(()=>[t(z,null,{default:n(()=>[...e[32]||(e[32]=[o("邮件",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[33]||(e[33]=[o("sun@wuyuan.dev",-1)])]),_:1})]),_:1},8,["href"])]),_:1})]),_:1}),t(ue,null,{default:n(()=>[t(te),t(h,{variant:"text",onClick:e[4]||(e[4]=r=>d.showReportDialog=!1)},{default:n(()=>[...e[36]||(e[36]=[o("关闭",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),m("p",yl," Copyright © "+w(new Date().getFullYear())+" Sunwuyuan ",1)])]),_:1})]),_:1})]),_:1})]),_:1})}const tn=q(pl,[["render",kl]]),xl={name:"Settings",components:{ServerSettingsCard:en,EditSettingsCard:Jt,RefreshSettingsCard:Qt,DisplaySettingsCard:Ft,MessageLog:Ct,SettingsCard:ee,StudentListCard:Yt,TeacherListCard:Wt,AboutCard:tn,DataProviderSettingsCard:Xt,ThemeSettingsCard:Kt,EchoChamberCard:Mt,SettingsExplorer:Pt,SettingsLinkGenerator:Ht,RandomPickerCard:zt,HomeworkTemplateCard:Bt,SubjectManagementCard:Lt,KvDatabaseCard:Zt,HitokotoSettings:Ot,NotificationSoundSettings:Rt},setup(){const{mobile:s}=In();return{isMobile:s}},data(){return _("server.provider"),{settings:{server:{domain:_("server.domain"),classNumber:_("server.classNumber"),provider:_("server.provider")},refresh:{auto:_("refresh.auto"),interval:_("refresh.interval")},font:{size:_("font.size")},edit:{autoSave:_("edit.autoSave"),blockNonTodayAutoSave:_("edit.blockNonTodayAutoSave"),confirmNonTodaySave:_("edit.confirmNonTodaySave"),refreshBeforeEdit:_("edit.refreshBeforeEdit")},display:{emptySubjectDisplay:_("display.emptySubjectDisplay"),dynamicSort:_("display.dynamicSort"),showRandomButton:_("display.showRandomButton"),showFullscreenButton:_("display.showFullscreenButton")},developer:{enabled:_("developer.enabled"),showDebugConfig:_("developer.showDebugConfig")},message:{showSidebar:_("message.showSidebar"),maxActiveMessages:_("message.maxActiveMessages"),timeout:_("message.timeout"),saveHistory:_("message.saveHistory")}},dataProviders:[{title:"服务器",value:"server"},{title:"本地数据库",value:"indexedDB"}],studentData:{list:[],text:"",advanced:!1},newStudent:"",editingIndex:-1,editingName:"",deleteDialog:!1,studentToDelete:null,numberDialog:!1,newPosition:"",studentToMove:null,touchStartTime:0,touchTimeout:null,studentsLoading:!1,studentsError:null,debugConfig:"",loading:{server:!1,students:!1},hasUnsavedChanges:!1,lastSavedData:null,settingsTab:"index",settingsTabs:[{title:"首页",icon:"mdi-home",value:"index"},{title:"服务器",icon:"mdi-server",value:"server"},{title:"科目",icon:"mdi-book-edit",value:"subject"},{title:"花名册",icon:"mdi-account-group",value:"student"},{title:"预配链接",icon:"mdi-share",value:"share"},{title:"刷新",icon:"mdi-refresh",value:"refresh"},{title:"编辑",icon:"mdi-pencil",value:"edit"},{title:"显示",icon:"mdi-eye",value:"display"},{title:"主题",icon:"mdi-theme-light-dark",value:"theme"},{title:"通知铃声",icon:"mdi-bell-ring",value:"notification"},{title:"一言",icon:"mdi-comment-quote",value:"hitokoto"},{title:"随机点名",icon:"mdi-dice-multiple",value:"randomPicker"},{title:"开发者",icon:"mdi-developer-board",value:"developer"},{title:"关于",icon:"mdi-information",value:"about"}],drawer:!1}},watch:{settings:{handler(s){this.handleSettingsChange(s)},deep:!0},isMobile:{handler(s){this.drawer=!s},immediate:!0},studentData:{handler(s){this.lastSavedData&&(this.hasUnsavedChanges=JSON.stringify(s.list)!==JSON.stringify(this.lastSavedData)),this.studentData.text=s.list.join(`
`)},deep:!0}},mounted(){this.loadAllSettings(),this.unwatchSettings=nt(()=>{this.loadAllSettings()}),this.drawer=!this.isMobile},beforeUnmount(){this.unwatchSettings&&this.unwatchSettings()},methods:{openClassworksKV(){window.open(_("server.authDomain"),"_blank")},loadAllSettings(){Object.keys(this.settings).forEach(s=>{Object.keys(this.settings[s]).forEach(e=>{this.settings[s][e]=_(`${s}.${e}`)})})},handleSettingsChange(s){this.settingsChangeTimeout&&clearTimeout(this.settingsChangeTimeout),this.settingsChangeTimeout=setTimeout(()=>{Object.entries(s).forEach(([e,a])=>{Object.entries(a).forEach(([d,i])=>{const l=`${e}.${d}`,r=_(l);i!==r&&(ke(l,i)?this.showMessage("设置已更新",`${l} 已保存`):(this.showError("保存失败",`${l} 设置失败`),this.settings[e][d]=r))})})},100)},showMessage(s,e="",a="success"){this.$message[a](s,e)},showError(s,e=""){this.$message.error(s,e)},saveEdit(){if(this.editingIndex!==-1){const s=this.editingName.trim();s&&s!==this.studentData.list[this.editingIndex]&&(this.studentData.list[this.editingIndex]=s),this.editingIndex=-1,this.editingName=""}},startEdit(s,e){this.editingIndex=s,this.editingName=e},confirmDelete(s){this.studentToDelete={index:s,name:this.studentData.list[s]},this.deleteDialog=!0},moveStudent(s,e){const a=e==="up"?s-1:s+1;a>=0&&a<this.studentData.list.length&&([this.studentData.list[s],this.studentData.list[a]]=[this.studentData.list[a],this.studentData.list[s]])},applyNewPosition(){const s=parseInt(this.newPosition)-1;if(this.studentToMove!==null&&s>=0&&s<this.studentData.list.length&&s!==this.studentToMove){const e=this.studentData.list[this.studentToMove];this.studentData.list.splice(this.studentToMove,1),this.studentData.list.splice(s,0,e)}this.numberDialog=!1,this.studentToMove=null,this.newPosition=""},moveToTop(s){if(s>0){const e=this.studentData.list[s];this.studentData.list.splice(s,1),this.studentData.list.unshift(e)}},addStudent(){const s=this.newStudent.trim();s&&!this.studentData.list.includes(s)&&(this.studentData.list.push(s),this.newStudent="")},removeStudent(s){s!==void 0&&(this.studentData.list.splice(s,1),this.deleteDialog=!1,this.studentToDelete=null)},resetFontSize(){Vt("font.size"),this.settings.font.size=_("font.size"),this.showMessage("字体已重置","字体大小已恢复默认值")},handleDeveloperChange(s){s||(this.settings.message={showSidebar:!0,maxActiveMessages:5,timeout:5e3,saveHistory:!0})},resetDeveloperSettings(){this.settings.developer={enabled:!1},this.settings.message={showSidebar:!0,maxActiveMessages:5,timeout:5e3,saveHistory:!0},this.handleSettingsChange(this.settings),this.showMessage("已重置","开发者设置已重置为默认值","warning")},adjustFontSize(s){const a=this.settings.font.size;s==="up"&&a<100?this.settings.font.size=a+2:s==="down"&&a>16&&(this.settings.font.size=a-2),this.handleSettingsChange(this.settings)},onSettingsSaved(){this.showMessage("设置已更新","您的设置已成功保存")},onSettingUpdate(s,e){this.showMessage("设置已更新",`${s} 已保存为 ${e}`)}}},Sl={class:"settings-page"},Cl={class:"mt-4"};function _l(s,e,a,d,i,l){const r=tn,p=en,u=Xt,b=Zt,T=Yt,I=Wt,H=Ht,G=Qt,Z=Jt,fe=Ft,pe=Kt,me=Rt,se=Ot,be=zt,D=Lt,V=Bt,k=ee,N=Tn("developer-settings-card"),Q=Pt,le=Mt,_e=Ct;return c(),x("div",Sl,[t(Ln,{elevation:"1"},{prepend:n(()=>[t(h,{icon:"mdi-arrow-left",variant:"text",onClick:e[0]||(e[0]=W=>s.$router.push("/"))}),t(h,{icon:"mdi-menu",variant:"text",onClick:e[1]||(e[1]=W=>i.drawer=!i.drawer)})]),default:n(()=>[t(Bn,{class:"text-h6"},{default:n(()=>[...e[5]||(e[5]=[o("设置",-1)])]),_:1})]),_:1}),t(st,{fluid:""},{default:n(()=>[t(pn,{modelValue:i.drawer,"onUpdate:modelValue":e[2]||(e[2]=W=>i.drawer=W),permanent:!d.isMobile,temporary:d.isMobile},{default:n(()=>[t(J,null,{default:n(()=>[(c(!0),x(ne,null,de(i.settingsTabs,W=>(c(),g(A,{key:W.value,active:i.settingsTab===W.value,color:i.settingsTab===W.value?"primary":"default","prepend-icon":W.icon,class:"rounded-e-xl",onClick:L=>i.settingsTab=W.value},{default:n(()=>[t(z,null,{default:n(()=>[o(w(W.title),1)]),_:2},1024)]),_:2},1032,["active","color","prepend-icon","onClick"]))),128))]),_:1})]),_:1},8,["modelValue","permanent","temporary"]),t(Nn,{modelValue:i.settingsTab,"onUpdate:modelValue":e[4]||(e[4]=W=>i.settingsTab=W),direction:"vertical",style:{width:"100%"}},{default:n(()=>[t(he,{value:"index"},{default:n(()=>[t(E,{border:"",class:"service-card gradient-right clickable mb-4",color:"primary",elevation:"8",hover:"",rounded:"xl",variant:"tonal",onClick:l.openClassworksKV},{default:n(()=>[t(ze,null,{default:n(()=>[...e[6]||(e[6]=[m("div",{class:"card-title"},[m("div",null,[m("div",{class:"text-h6"},"在寻找 Classworks KV ？"),m("div",{class:"text-caption text-medium-emphasis"}," 文档形键值数据库 ")])],-1)])]),_:1}),t(j,null,{default:n(()=>[m("div",Cl,[t(h,{"append-icon":"mdi-arrow-right",class:"text-none",rounded:"xl",variant:"text",onClick:l.openClassworksKV},{default:n(()=>[...e[7]||(e[7]=[o(" 打开 Classworks KV ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["onClick"]),t(E,{border:"",class:"rounded-xl mb-4",subtitle:"设置",title:"Classworks"},{default:n(()=>[t(j,null,{default:n(()=>[t($,{class:"rounded-xl",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:n(()=>[...e[8]||(e[8]=[o("Classworks 是开源免费的软件，官方没有提供任何形式的付费支持服务，源代码仓库地址在 ",-1),m("a",{href:"https://github.com/ZeroCatDev/Classworks",target:"_blank"},"https://github.com/ZeroCatDev/Classworks",-1),o("。如果您通过有偿协助等付费方式取得本应用，在遇到问题时请在与卖家约定的服务框架下，优先向卖家求助。如果卖家没有提供您预期的服务，请退款或通过其它形式积极维护您的合法权益。 ",-1)])]),_:1}),t($,{class:"mt-4 rounded-xl",color:"info",icon:"mdi-information",variant:"tonal"},{default:n(()=>[...e[9]||(e[9]=[o("请不要使用浏览器清除缓存功能，否则会导致配置丢失。 ",-1),m("del",null,"恶意的操作可能导致您受到贵校教师的处理 ",-1)])]),_:1}),t($,{class:"mt-4 rounded-xl",color:"warning",icon:"mdi-information",variant:"tonal"},{default:n(()=>[e[11]||(e[11]=m("p",null," 请不要使用包括但不限于360极速浏览器、360安全浏览器、夸克浏览器、QQ浏览器等浏览器使用 Classworks ，这些浏览器过时且存在严重的一致性问题。在Windows上，使用新版 Microsoft Edge 浏览器是最推荐的选择。 ",-1)),e[12]||(e[12]=m("p",{style:{color:"#666"}}," 上述浏览器商标为其所属公司所有，Classworks™ 与上述浏览器所属公司无竞争关系。 ",-1)),e[13]||(e[13]=m("br",null,null,-1)),t(h,{"append-icon":"mdi-open-in-new",class:"text-none rounded-xl",color:"warning",href:"https://www.microsoft.com/zh-cn/windows/microsoft-edge",target:"_blank",variant:"tonal"},{default:n(()=>[...e[10]||(e[10]=[o("下载 Microsoft Edge（微软边缘浏览器） ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(r)]),_:1}),t(he,{value:"server"},{default:n(()=>[t(p,{loading:i.loading.server,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"]),t(u,{border:"",class:"mt-4"}),t(b,{border:"",class:"mt-4"})]),_:1}),t(he,{value:"student"},{default:n(()=>[t(T,{"is-mobile":d.isMobile,border:""},null,8,["is-mobile"]),t(I,{"is-mobile":d.isMobile,border:"",class:"mt-4"},null,8,["is-mobile"])]),_:1}),t(he,{value:"share"},{default:n(()=>[t(H,{border:"",class:"mt-4"})]),_:1}),t(he,{value:"refresh"},{default:n(()=>[t(G,{loading:i.loading.refresh,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"])]),_:1}),t(he,{value:"edit"},{default:n(()=>[t(Z,{loading:i.loading.edit,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"])]),_:1}),t(he,{value:"display"},{default:n(()=>[t(fe,{loading:i.loading.display,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"])]),_:1}),t(he,{value:"theme"},{default:n(()=>[t(pe,{loading:i.loading.theme,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"])]),_:1}),t(he,{value:"notification"},{default:n(()=>[t(me,{border:""})]),_:1}),t(he,{value:"hitokoto"},{default:n(()=>[t(se,{border:""})]),_:1}),t(he,{value:"randomPicker"},{default:n(()=>[t(be,{"is-mobile":d.isMobile,border:""},null,8,["is-mobile"])]),_:1}),t(he,{value:"subject"},{default:n(()=>[t(D,{border:""}),e[14]||(e[14]=m("br",null,null,-1)),t(V,{border:""})]),_:1}),t(he,{value:"developer"},{default:n(()=>[t(k,{border:"",icon:"mdi-developer-board",title:"开发者选项"},{default:n(()=>[t(J,null,{default:n(()=>[t(A,null,{prepend:n(()=>[t(v,{class:"mr-3",icon:"mdi-code-tags"})]),append:n(()=>[t(Tt,{modelValue:i.settings.developer.enabled,"onUpdate:modelValue":e[3]||(e[3]=W=>i.settings.developer.enabled=W),density:"comfortable","hide-details":"",onChange:l.handleDeveloperChange},null,8,["modelValue","onChange"])]),default:n(()=>[t(z,null,{default:n(()=>[...e[15]||(e[15]=[o("启用开发者选项",-1)])]),_:1}),t(ie,null,{default:n(()=>[...e[16]||(e[16]=[o("启用后可以查看和修改开发者设置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{loading:i.loading.developer,border:"",onSaved:l.onSettingsSaved},null,8,["loading","onSaved"]),i.settings.developer.enabled?(c(),g(E,{key:0,border:"",class:"mt-4 rounded-lg"},{default:n(()=>[t(K,{class:"d-flex align-center"},{default:n(()=>[t(v,{class:"mr-2",icon:"mdi-cog-outline"}),e[17]||(e[17]=o(" 所有设置 ",-1))]),_:1}),t(Le,null,{default:n(()=>[...e[18]||(e[18]=[o(" 浏览和修改所有可用设置",-1)])]),_:1}),t(j,null,{default:n(()=>[t(Q,{onUpdate:l.onSettingUpdate},null,8,["onUpdate"])]),_:1})]),_:1})):y("",!0),i.settings.developer.enabled?(c(),g(O,{key:1,cols:"12"})):y("",!0)]),_:1}),t(he,{value:"about"},{default:n(()=>[t(r),t(le,{border:"",class:"mt-4"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_e,{ref:"messageLog"},null,512)])}const Ql=q(xl,[["render",_l]]);export{Ql as default};
