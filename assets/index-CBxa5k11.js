const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-1qA4vOSi.js","./index-btKy2yxc.css","./dataProvider-CQZWL-q1.js"])))=>i.map(i=>d[i]);
import{V as Es,a as Vs,_ as Ht}from"./ExamConfigEditor-IBCVBhw5.js";import{_ as ie,k as _,s as be,j as x,o as m,w as a,d as s,l as I,q as Z,t as c,v as E,x as H,y,z,i as r,A as p,B as S,C as g,D as Kt,F as V,E as ke,T as ut,G as R,e as De,H as de,I as ve,n as _e,J as Re,K as Ue,L as Oe,M as ue,N as _t,O as ct,P as $e,Q as Pe,R as ht,S as Le,U as Ns,W as As,X as Ye,Y as qt,Z as L,$ as Tt,a0 as K,a1 as gt,a2 as Us,a3 as st,a4 as nt,a5 as zs,a6 as Ps,a7 as Fs,a8 as Wt,a9 as Gt,aa as Qt,ab as lt,ac as vt,ad as It,g as Ms,p as $s,ae as Rs,af as Ke,ag as Ls,ah as Os,ai as Et,aj as Bs,ak as js,al as qe,am as We,an as ze,ao as Vt,ap as Hs,c as Ks,aq as qs,ar as Ws,as as Gs,at as Qs,au as Js,av as Ys,aw as Xs,ax as Nt,ay as Zs,az as en,aA as At,aB as Ge,aC as Je,aD as tn,aE as Qe}from"./index-1qA4vOSi.js";import{V as Fe,u as sn,a as nn,m as an}from"./VTextField-FQUF6Pvv.js";import{V as pt,a as ln}from"./VTooltip-CBEkFZmi.js";import{V as G}from"./VChip-Du8LEclp.js";import{s as on,g as Jt,j as mt,o as Ne,a as rn,l as dn}from"./socketClient-CPyUQX2s.js";import{p as Ut,s as un,a as zt,_ as Yt}from"./index-ChfJo6Ei.js";import{f as cn,s as mn,c as Xt}from"./deviceEvents-hpNH-V3f.js";import{V as Ce,a as fe}from"./VRow-B38ghAfM.js";import{V as fn,a as Pt}from"./VPagination-RUHGm5oL.js";import{V as Xe}from"./VTextarea-qlbQTXAT.js";import{d as ce,a as ot,g as Zt,b as Ae,k as hn}from"./dataProvider-CQZWL-q1.js";import{V as Ft,a as Mt,b as gn,c as vn}from"./VAppBarTitle-Dyqz9qNq.js";import{V as es}from"./VContainer-C7OIoecX.js";import{V as $t}from"./VForm-DT2jG6br.js";import{V as ft}from"./VSwitch-C9_Rv21o.js";import{V as ts,u as pn,a as yn,b as kn,c as bn,h as xn,m as wn,d as Sn}from"./filter-BPUQ38Jb.js";import{V as Be}from"./VAlert-DDFXpgDP.js";import{V as Cn}from"./VCheckboxBtn-Tsq1D_WS.js";import{V as Dn,a as Rt,b as Lt,c as Ot}from"./VExpansionPanels-Bni8WFfK.js";import"./VSkeletonLoader-CQl_zs87.js";import"./VSheet-BEr9wS9D.js";const _n={name:"RandomPicker",props:{studentList:{type:Array,required:!0},attendance:{type:Object,required:!0,default:()=>({absent:[],late:[],exclude:[]})}},data(){return{dialog:!1,count:_("randomPicker.defaultCount"),isPickingStarted:!1,isAnimating:!1,pickedStudents:[],animationStudents:[],highlightedIndices:[],animationTimer:null,getSetting:_,tempFilters:{excludeAbsent:_("randomPicker.excludeAbsent"),excludeLate:_("randomPicker.excludeLate"),excludeExcluded:_("randomPicker.excludeExcluded")},pickerMode:_("randomPicker.mode"),minNumber:_("randomPicker.minNumber"),maxNumber:_("randomPicker.maxNumber")}},computed:{absentCount(){return this.attendance.absent?this.attendance.absent.length:0},lateCount(){return this.attendance.late?this.attendance.late.length:0},excludedCount(){return this.attendance.exclude?this.attendance.exclude.length:0},numberModeStudents(){if(this.pickerMode!=="number")return[];const t=[];for(let e=this.minNumber;e<=this.maxNumber;e++)t.push(e.toString().padStart(2,"0")+"Âè∑");return t},filteredStudents(){return this.pickerMode==="number"?this.numberModeStudents:!this.studentList||!this.studentList.length?[]:this.studentList.filter(t=>!(this.tempFilters.excludeAbsent&&this.attendance.absent.includes(t)||this.tempFilters.excludeLate&&this.attendance.late.includes(t)||this.tempFilters.excludeExcluded&&this.attendance.exclude.includes(t)))},availableStudents(){return this.filteredStudents},maxAllowedCount(){return Math.min(10,this.filteredStudents.length)},remainingStudents(){return this.filteredStudents.filter(t=>!this.pickedStudents.includes(t))}},watch:{dialog(t){t?(this.count=_("randomPicker.defaultCount"),this.isPickingStarted=!1,this.isAnimating=!1,this.pickedStudents=[],this.tempFilters={excludeAbsent:_("randomPicker.excludeAbsent"),excludeLate:_("randomPicker.excludeLate"),excludeExcluded:_("randomPicker.excludeExcluded")}):this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=null)},tempFilters:{handler(){this.count>this.maxAllowedCount&&(this.count=Math.max(1,this.maxAllowedCount))},deep:!0},pickerMode:{handler(t){be("randomPicker.mode",t)}},minNumber:{handler(t){t>this.maxNumber&&(this.minNumber=this.maxNumber),t<1&&(this.minNumber=1),be("randomPicker.minNumber",this.minNumber)}},maxNumber:{handler(t){t<this.minNumber&&(this.maxNumber=this.minNumber),t>100&&(this.maxNumber=100),be("randomPicker.maxNumber",this.maxNumber)}}},methods:{open(){this.dialog=!0},incrementCount(){this.count<this.maxAllowedCount&&this.count++},decrementCount(){this.count>1&&this.count--},startPicking(){this.filteredStudents.length!==0&&(this.isPickingStarted=!0,_("randomPicker.animation")?this.startAnimation():this.finishPicking())},startAnimation(){this.isAnimating=!0,this.animationStudents=this.filteredStudents.map((t,e)=>({id:`student-${e}`,name:t})),this.animateHighlight()},animateHighlight(){let e=0;const i=50,o=()=>{this.highlightedIndices=[];const n=[];for(let d=0;d<this.count;d++){let u;do u=Math.floor(Math.random()*this.animationStudents.length);while(n.includes(u));n.push(u)}this.highlightedIndices=n,e++;const l=i+e*20;e<5?this.animationTimer=setTimeout(o,l):setTimeout(()=>{this.finishPicking()},500)};o()},finishPicking(){this.isAnimating=!1;const t=[...this.filteredStudents].sort(()=>.5-Math.random());this.pickedStudents=t.slice(0,this.count)},resetPicker(){this.isPickingStarted=!1,this.isAnimating=!1,this.pickedStudents=[],this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=null)},refreshSingleStudent(t){if(this.remainingStudents.length===0)return;const e=Math.floor(Math.random()*this.remainingStudents.length),i=this.remainingStudents[e];this.pickedStudents[t]=i;const o=document.querySelectorAll(".result-card");o[t]&&(o[t].classList.add("refresh-animation"),setTimeout(()=>{o[t].classList.remove("refresh-animation")},500))}}},Tn={class:"d-flex justify-center align-center counter-container"},In={class:"count-display mx-8"},En={class:"text-h2 font-weight-bold"},Vn={class:"mode-switch-container mt-6"},Nn={key:0,class:"number-range-container mt-4"},An={class:"d-flex justify-center align-center gap-4"},Un={class:"mt-4"},zn={key:1,class:"mt-4 text-error"},Pn={class:"mt-4 text-caption"},Fn={class:"pa-2"},Mn={key:0},$n={key:1},Rn={key:2},Ln={key:1,class:"d-flex flex-wrap justify-center gap-2 mt-4"},On={key:0,class:"animation-container"},Bn={class:"animation-wrapper"},jn={key:1,class:"result-container"},Hn={class:"mt-8 d-flex justify-center"};function Kn(t,e,i,o,n,l){return m(),x(de,{modelValue:n.dialog,"onUpdate:modelValue":e[8]||(e[8]=d=>n.dialog=d),"fullscreen-breakpoint":"sm","max-width":"600",persistent:""},{default:a(()=>[s(I,{border:"",class:"random-picker-card",rounded:"xl"},{default:a(()=>[s(Z,{class:"text-h5 d-flex align-center"},{default:a(()=>[s(E,{class:"mr-2",icon:"mdi-account-question"}),e[9]||(e[9]=c(" ÈöèÊú∫ÁÇπÂêç ",-1)),s(H),s(y,{icon:"mdi-close",variant:"text",onClick:e[0]||(e[0]=d=>n.dialog=!1)})]),_:1}),n.isPickingStarted?(m(),x(z,{key:1,class:"text-center py-6"},{default:a(()=>[n.isAnimating?(m(),p("div",On,[r("div",Bn,[s(ut,{class:"shuffle-container",name:"shuffle",tag:"div"},{default:a(()=>[(m(!0),p(V,null,R(n.animationStudents,(d,u)=>(m(),p("div",{key:d.id,class:De([{highlighted:n.highlightedIndices.includes(u)},"student-item"])},g(d.name),3))),128))]),_:1})])])):(m(),p("div",jn,[e[19]||(e[19]=r("div",{class:"text-h6 mb-4"},"ÊäΩÂèñÁªìÊûú",-1)),(m(!0),p(V,null,R(n.pickedStudents,(d,u)=>(m(),x(I,{key:u,class:"mb-2 result-card",color:"primary",variant:"outlined"},{default:a(()=>[s(z,{class:"text-h4 text-center py-4 d-flex align-center justify-center"},{default:a(()=>[c(g(d)+" ",1),s(y,{disabled:l.remainingStudents.length===0,title:l.remainingStudents.length===0?"Ê≤°ÊúâÊõ¥Â§öÂèØÁî®Â≠¶Áîü":"ÈáçÊñ∞ÊäΩÂèñÊ≠§Â≠¶Áîü",class:"ml-2 refresh-btn",icon:"mdi-refresh",size:"small",variant:"text",onClick:f=>l.refreshSingleStudent(u)},null,8,["disabled","title","onClick"])]),_:2},1024)]),_:2},1024))),128)),r("div",Hn,[s(y,{class:"mx-2",color:"primary","prepend-icon":"mdi-refresh",size:"large",onClick:l.resetPicker},{default:a(()=>[...e[17]||(e[17]=[c(" ÈáçÊñ∞ÊäΩÂèñ ",-1)])]),_:1},8,["onClick"]),s(y,{class:"mx-2",color:"grey",size:"large",variant:"outlined",onClick:e[7]||(e[7]=d=>n.dialog=!1)},{default:a(()=>[...e[18]||(e[18]=[c(" ÂÖ≥Èó≠ ",-1)])]),_:1})])]))]),_:1})):(m(),x(z,{key:0,class:"text-center py-6"},{default:a(()=>[e[16]||(e[16]=r("div",{class:"text-h6 mb-4"},"ËØ∑ÈÄâÊã©ÊäΩÂèñ‰∫∫Êï∞",-1)),r("div",Tn,[s(y,{disabled:n.count<=1,class:"counter-btn",color:"primary",icon:"mdi-minus",size:"x-large",variant:"tonal",onClick:l.decrementCount},null,8,["disabled","onClick"]),r("div",In,[r("span",En,g(n.count),1),e[10]||(e[10]=r("span",{class:"text-subtitle-1 ml-2"},"‰∫∫",-1))]),s(y,{disabled:n.count>=l.maxAllowedCount,class:"counter-btn",color:"primary",icon:"mdi-plus",size:"x-large",variant:"tonal",onClick:l.incrementCount},null,8,["disabled","onClick"])]),r("div",Vn,[s(Kt,{modelValue:n.pickerMode,"onUpdate:modelValue":e[1]||(e[1]=d=>n.pickerMode=d),class:"mode-toggle",color:"primary",mandatory:"",rounded:"pill"},{default:a(()=>[s(y,{"prepend-icon":"mdi-account",value:"name"},{default:a(()=>[...e[11]||(e[11]=[c("ÂßìÂêçÊ®°Âºè",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-numeric",value:"number"},{default:a(()=>[...e[12]||(e[12]=[c("Â≠¶Âè∑Ê®°Âºè",-1)])]),_:1})]),_:1},8,["modelValue"])]),n.pickerMode==="number"?(m(),p("div",Nn,[e[14]||(e[14]=r("div",{class:"text-subtitle-1 mb-2"},"Â≠¶Âè∑ËåÉÂõ¥ËÆæÁΩÆ",-1)),r("div",An,[s(Fe,{modelValue:n.minNumber,"onUpdate:modelValue":e[2]||(e[2]=d=>n.minNumber=d),modelModifiers:{number:!0},class:"number-input",density:"compact","hide-details":"",label:"ÊúÄÂ∞èÂÄº",max:"100",min:"1",type:"number"},null,8,["modelValue"]),e[13]||(e[13]=r("span",{class:"mx-2"},"Ëá≥",-1)),s(Fe,{modelValue:n.maxNumber,"onUpdate:modelValue":e[3]||(e[3]=d=>n.maxNumber=d),modelModifiers:{number:!0},class:"number-input",density:"compact","hide-details":"",label:"ÊúÄÂ§ßÂÄº",max:"100",min:"1",type:"number"},null,8,["modelValue"])])])):S("",!0),r("div",Un,[s(y,{disabled:l.filteredStudents.length===0,class:"start-btn",color:"primary","prepend-icon":"mdi-dice-multiple",size:"x-large",onClick:l.startPicking},{default:a(()=>[...e[15]||(e[15]=[c(" ÂºÄÂßãÊäΩÂèñ ",-1)])]),_:1},8,["disabled","onClick"])]),l.filteredStudents.length===0?(m(),p("div",zn,[n.pickerMode==="name"?(m(),p(V,{key:0},[c(" Ê≤°ÊúâÂèØÊäΩÂèñÁöÑÂ≠¶ÁîüÔºåËØ∑Ë∞ÉÊï¥ËøáÊª§ÈÄâÈ°π ")],64)):(m(),p(V,{key:1},[c(" ËØ∑ËÆæÁΩÆÊúâÊïàÁöÑÂ≠¶Âè∑ËåÉÂõ¥ ")],64))])):S("",!0),r("div",Pn,[c(" ÂΩìÂâçÂèØÊäΩÂèñÂ≠¶Áîü: "+g(l.filteredStudents.length)+"‰∫∫ ",1),n.pickerMode==="name"?(m(),x(pt,{key:0,location:"bottom"},{activator:a(({props:d})=>[s(E,ke({class:"ml-1",icon:"mdi-information-outline",size:"small"},d),null,16)]),default:a(()=>[r("div",Fn,[n.tempFilters.excludeAbsent?(m(),p("div",Mn," ‚Ä¢ Â∑≤ÊéíÈô§ËØ∑ÂÅáÂ≠¶Áîü ("+g(l.absentCount)+"‰∫∫) ",1)):S("",!0),n.tempFilters.excludeLate?(m(),p("div",$n," ‚Ä¢ Â∑≤ÊéíÈô§ËøüÂà∞Â≠¶Áîü ("+g(l.lateCount)+"‰∫∫) ",1)):S("",!0),n.tempFilters.excludeExcluded?(m(),p("div",Rn," ‚Ä¢ Â∑≤ÊéíÈô§‰∏çÂèÇ‰∏éÂ≠¶Áîü ("+g(l.excludedCount)+"‰∫∫) ",1)):S("",!0)])]),_:1})):S("",!0),n.pickerMode==="name"?(m(),p("div",Ln,[s(G,{color:n.tempFilters.excludeLate?"warning":"default",variant:n.tempFilters.excludeLate?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-clock-alert",onClick:e[4]||(e[4]=d=>n.tempFilters.excludeLate=!n.tempFilters.excludeLate)},{default:a(()=>[c(g(n.tempFilters.excludeLate?"ÊéíÈô§":"ÂåÖÂê´")+"ËøüÂà∞Â≠¶Áîü ",1)]),_:1},8,["color","variant"]),s(G,{color:n.tempFilters.excludeAbsent?"error":"default",variant:n.tempFilters.excludeAbsent?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-account-off",onClick:e[5]||(e[5]=d=>n.tempFilters.excludeAbsent=!n.tempFilters.excludeAbsent)},{default:a(()=>[c(g(n.tempFilters.excludeAbsent?"ÊéíÈô§":"ÂåÖÂê´")+"ËØ∑ÂÅáÂ≠¶Áîü ",1)]),_:1},8,["color","variant"]),s(G,{color:n.tempFilters.excludeExcluded?"grey":"default",variant:n.tempFilters.excludeExcluded?"elevated":"text",class:"filter-chip","prepend-icon":"mdi-account-cancel",onClick:e[6]||(e[6]=d=>n.tempFilters.excludeExcluded=!n.tempFilters.excludeExcluded)},{default:a(()=>[c(g(n.tempFilters.excludeExcluded?"ÊéíÈô§":"ÂåÖÂê´")+"‰∏çÂèÇ‰∏éÂ≠¶Áîü ",1)]),_:1},8,["color","variant"])])):S("",!0)])]),_:1}))]),_:1})]),_:1},8,["modelValue"])}const ss=ie(_n,[["render",Kn],["__scopeId","data-v-85e7eea6"]]),qn={name:"EventSender",emits:["sent","error"],methods:{async sendEvent(t,e={}){try{return on(t,e),this.$emit("sent",{eventName:t,content:e,timestamp:new Date().toISOString(),success:!0}),{success:!0,eventId:(e==null?void 0:e.eventId)||null,notificationId:(e==null?void 0:e.notificationId)||null}}catch(i){return console.error("ÂèëÈÄÅ‰∫ã‰ª∂Â§±Ë¥•:",i),this.$emit("error",{eventName:t,content:e,error:i.message,timestamp:new Date().toISOString(),success:!1}),{success:!1,error:i.message}}},async sendNotification(t,e=!1,i=[],o={},n=null){const l=`evt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;return this.sendEvent("notification",{eventId:l,notificationId:n,message:t,isUrgent:e,targetDevices:i,senderInfo:o})},async sendReceipt(t,e,i={},o=null){const n=`rcpt-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-receipt",{eventId:n,originalEventId:t,notificationId:o,status:e,deviceInfo:i})},async sendDisplayedReceipt(t={},e=null){const i=`disp-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-displayed",{eventId:i,notificationId:e,deviceInfo:t})},async sendReadReceipt(t={},e=null){const i=`read-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.sendEvent("notification-read",{eventId:i,notificationId:e,deviceInfo:t})}}},Wn={style:{display:"none"}};function Gn(t,e,i,o,n,l){return m(),p("div",Wn)}const at=ie(qn,[["render",Gn]]),Qn={name:"UrgentNotification",components:{EventSender:at},data(){return{visible:!1,notificationQueue:[],currentIndex:0,autoCloseTimer:null,urgentSoundTimer:null,currentAudio:null}},computed:{currentNotification(){return this.notificationQueue[this.currentIndex]||null},hasNotifications(){return this.notificationQueue.length>0},hasMultipleNotifications(){return this.notificationQueue.length>1},notificationCountText(){return this.hasMultipleNotifications?`${this.currentIndex+1} / ${this.notificationQueue.length}`:""},isUrgent(){var t,e;return((e=(t=this.currentNotification)==null?void 0:t.content)==null?void 0:e.isUrgent)||!1},urgencyColor(){return this.isUrgent?"red darken-2":"blue darken-2"},iconColor(){return"white"},urgencyIcon(){return this.isUrgent?"mdi-alert-circle-outline":"mdi-information-outline"},urgencyTitle(){return this.isUrgent?"üö® Á¥ßÊÄ•ÈÄöÁü•":"üì¢ ÈÄöÁü•Ê∂àÊÅØ"},senderName(){var e,i,o;const t=((e=this.currentNotification)==null?void 0:e.senderInfo)||((o=(i=this.currentNotification)==null?void 0:i.content)==null?void 0:o.senderInfo);return t?t.deviceName||t.deviceType||"Êú™Áü•ËÆæÂ§á":"Êú™Áü•ÂèëÈÄÅËÄÖ"},deviceType(){var e,i,o;const t=((e=this.currentNotification)==null?void 0:e.senderInfo)||((o=(i=this.currentNotification)==null?void 0:i.content)==null?void 0:o.senderInfo);return(t==null?void 0:t.deviceType)=="teacher"?"ÊïôÂ∏à":(t==null?void 0:t.deviceType)=="student"?"Â≠¶Áîü":(t==null?void 0:t.deviceType)=="classroom"?"ÊïôÂÆ§":(t==null?void 0:t.deviceType)||"Êú™Áü•Á±ªÂûã"},targetDevices(){var t,e;return((e=(t=this.currentNotification)==null?void 0:t.content)==null?void 0:e.targetDevices)||[]}},beforeUnmount(){this.autoCloseTimer&&clearTimeout(this.autoCloseTimer),this.urgentSoundTimer&&clearInterval(this.urgentSoundTimer),this.stopNotificationSound()},methods:{show(t){var i;if(this.notificationQueue.findIndex(o=>{var n,l;return((n=o.content)==null?void 0:n.notificationId)===((l=t.content)==null?void 0:l.notificationId)})!==-1){console.log("ÈÄöÁü•Â∑≤Â≠òÂú®ÔºåË∑≥ËøáÊ∑ªÂä†");return}this.notificationQueue.push(t),this.visible?(i=t.content)!=null&&i.isUrgent&&!this.isUrgent?(this.currentIndex=this.notificationQueue.length-1,this.sendDisplayedReceipt(),this.playNotificationSound(),this.sendBrowserNotification(t),this.startUrgentSound()):this.sendBrowserNotification(t):(this.currentIndex=this.notificationQueue.length-1,this.visible=!0,this.sendDisplayedReceipt(),this.playNotificationSound(),this.sendBrowserNotification(t),this.isUrgent&&this.startUrgentSound())},close(){var t,e,i,o;try{this.sendReadReceipt(),console.log("Â∑≤ÂèëÈÄÅÂ∑≤ËØªÂõûÊâß")}catch(n){console.warn("ÂèëÈÄÅÂ∑≤ËØªÂõûÊâßÂ§±Ë¥•:",n)}if((e=(t=this.currentNotification)==null?void 0:t.content)!=null&&e.message){const n=this.isUrgent?"Á¥ßÊÄ•ÈÄöÁü•":"ÈÄöÁü•";this.isUrgent?(i=this.$message)==null||i.error(n,`${this.currentNotification.content.message}`):(o=this.$message)==null||o.info(n,`${this.currentNotification.content.message}`)}this.notificationQueue.length>0&&(this.notificationQueue.splice(this.currentIndex,1),this.currentIndex>=this.notificationQueue.length&&(this.currentIndex=Math.max(0,this.notificationQueue.length-1)),this.notificationQueue.length>0?(this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound()):this.closeWithoutRead())},closeWithoutRead(){this.visible=!1,this.notificationQueue=[],this.currentIndex=0,this.autoCloseTimer&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=null),this.stopUrgentSound()},formatTime(t){if(!t)return"";try{const e=new Date(t);if(new Date-e<24*60*60*1e3){const n=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0");return`${n}:${l}`}else{const n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${n}/${l}`}}catch{return"Êó†ÊïàÊó∂Èó¥"}},getDeviceTypeLabel(t){return{classroom:"ÊïôÂÆ§ËÆæÂ§á",student:"Â≠¶ÁîüËÆæÂ§á",teacher:"ÊïôÂ∏àËÆæÂ§á",admin:"ÁÆ°ÁêÜÂëòËÆæÂ§á",system:"Á≥ªÁªüËÆæÂ§á"}[t]||t},playNotificationSound(){try{this.stopNotificationSound();const t=this.isUrgent?_("notification.urgentSound"):_("notification.singleSound");this.currentAudio=Ut(t,!1),this.currentAudio||this.playFallbackSound()}catch(t){console.warn("Êó†Ê≥ïÊí≠ÊîæÈÄöÁü•Èü≥Êïà:",t),this.playFallbackSound()}},playFallbackSound(){try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),i=t.createGain();e.connect(i),i.connect(t.destination),e.frequency.value=1e3,e.type="sine",i.gain.value=.3,e.start(),e.stop(t.currentTime+.3)}catch(t){console.warn("Êó†Ê≥ïÊí≠ÊîæÂ§áÁî®Èü≥Êïà:",t)}},stopNotificationSound(){this.currentAudio&&(un(this.currentAudio),this.currentAudio=null)},sendDisplayedReceipt(){var t;try{this.$refs.eventSender&&((t=this.currentNotification)!=null&&t.eventId)&&(this.$refs.eventSender.sendDisplayedReceipt({},this.currentNotification.content.notificationId),console.log("Â∑≤ÂèëÈÄÅÊòæÁ§∫ÂõûÊâß:",this.currentNotification.eventId))}catch(e){console.warn("ÂèëÈÄÅÊòæÁ§∫ÂõûÊâßÂ§±Ë¥•:",e)}},sendReadReceipt(){var t;try{this.$refs.eventSender&&((t=this.currentNotification)!=null&&t.eventId)&&(this.$refs.eventSender.sendReadReceipt({},this.currentNotification.content.notificationId),console.log("Â∑≤ÂèëÈÄÅÂ∑≤ËØªÂõûÊâß:",this.currentNotification.eventId))}catch(e){console.warn("ÂèëÈÄÅÂ∑≤ËØªÂõûÊâßÂ§±Ë¥•:",e)}},previousNotification(){this.currentIndex>0&&(this.currentIndex--,this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound())},nextNotification(){this.currentIndex<this.notificationQueue.length-1&&(this.currentIndex++,this.sendDisplayedReceipt(),this.isUrgent?this.startUrgentSound():this.stopUrgentSound())},startUrgentSound(){this.stopUrgentSound(),this.stopNotificationSound();const t=_("notification.urgentSound");this.currentAudio=Ut(t,!0),this.currentAudio||(this.urgentSoundTimer=setInterval(()=>{this.visible&&this.isUrgent?this.playFallbackSound():this.stopUrgentSound()},1e3))},stopUrgentSound(){this.urgentSoundTimer&&(clearInterval(this.urgentSoundTimer),this.urgentSoundTimer=null),this.stopNotificationSound()},async sendBrowserNotification(t){var e,i,o,n;if(!("Notification"in window)){console.warn("ÊµèËßàÂô®‰∏çÊîØÊåÅÈÄöÁü•API");return}try{let l=Notification.permission;if(l==="default"&&(l=await Notification.requestPermission()),l!=="granted"){console.warn("Áî®Êà∑Êú™Êéà‰∫àÈÄöÁü•ÊùÉÈôê");return}const d=((e=t.content)==null?void 0:e.message)||"Êñ∞ÈÄöÁü•",u=t.senderInfo||((i=t.content)==null?void 0:i.senderInfo),f=(u==null?void 0:u.deviceName)||(u==null?void 0:u.deviceType)||"Êú™Áü•ÂèëÈÄÅËÄÖ",h=((o=t.content)==null?void 0:o.isUrgent)||!1,k=new Notification(h?"üö® Á¥ßÊÄ•ÈÄöÁü•":"üì¢ ÈÄöÁü•Ê∂àÊÅØ",{body:`${d}

Êù•Ëá™: ${f}`,icon:"/pwa/image/icon-192.png",badge:"/pwa/image/icon-192.png",tag:((n=t.content)==null?void 0:n.notificationId)||`notification-${Date.now()}`,requireInteraction:h,silent:!1,vibrate:h?[200,100,200,100,200]:[200],timestamp:t.timestamp||Date.now()});k.onclick=()=>{window.focus(),k.close()},h||setTimeout(()=>{k.close()},1e4)}catch(l){console.error("ÂèëÈÄÅÊµèËßàÂô®ÈÄöÁü•Â§±Ë¥•:",l)}}}},Jn={class:"urgent-title mb-6"},Yn={class:"urgent-subtitle mb-6"},Xn={key:0,class:"navigation-controls mt-6"},Zn={class:"notification-counter mb-3"},ea={class:"navigation-buttons"},ta={class:"mt-8"};function sa(t,e,i,o,n,l){const d=at;return m(),p(V,null,[s(de,{modelValue:n.visible,"onUpdate:modelValue":e[0]||(e[0]=u=>n.visible=u),"max-width":"800",persistent:"",transition:"dialog-transition",class:"urgent-notification-dialog"},{default:a(()=>[s(I,{class:"urgent-notification-card",color:l.urgencyColor,elevation:"24"},{default:a(()=>[s(z,null,{default:a(()=>{var u,f,h;return[r("div",Jn,g(((f=(u=l.currentNotification)==null?void 0:u.content)==null?void 0:f.message)||"Êó†ÂÜÖÂÆπ"),1),r("div",Yn,g(l.senderName)+" "+g(l.deviceType)+" "+g(l.formatTime((h=l.currentNotification)==null?void 0:h.timestamp)),1),l.hasMultipleNotifications?(m(),p("div",Xn,[s(I,{variant:"flat",color:"rgba(255,255,255,0.1)"},{default:a(()=>[s(z,{class:"text-center"},{default:a(()=>[r("div",Zn,[s(G,{color:"white",variant:"flat",size:"small"},{default:a(()=>[c(g(l.notificationCountText),1)]),_:1})]),r("div",ea,[s(y,{disabled:n.currentIndex===0,color:"white",variant:"outlined",size:"small",onClick:l.previousNotification},{default:a(()=>[s(E,null,{default:a(()=>[...e[1]||(e[1]=[c(" mdi-chevron-left ",-1)])]),_:1}),e[2]||(e[2]=c(" ‰∏ä‰∏Ä‰∏™ ",-1))]),_:1},8,["disabled","onClick"]),s(y,{disabled:n.currentIndex===n.notificationQueue.length-1,color:"white",variant:"outlined",size:"small",class:"ml-2",onClick:l.nextNotification},{default:a(()=>[e[4]||(e[4]=c(" ‰∏ã‰∏Ä‰∏™ ",-1)),s(E,null,{default:a(()=>[...e[3]||(e[3]=[c(" mdi-chevron-right ",-1)])]),_:1})]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1})])):S("",!0),r("div",ta,[s(y,{color:"white",size:"large",variant:"flat",onClick:l.close},{default:a(()=>[s(E,{left:""},{default:a(()=>[...e[5]||(e[5]=[c(" mdi-check ",-1)])]),_:1}),e[6]||(e[6]=c(" ÊàëÁü•ÈÅì‰∫Ü ",-1))]),_:1},8,["onClick"])])]}),_:1})]),_:1},8,["color"])]),_:1},8,["modelValue"]),s(d,{ref:"eventSender"},null,512)],64)}const ns=ie(Qn,[["render",sa],["__scopeId","data-v-6190a823"]]),na={name:"ChatWidget",components:{UrgentNotification:ns},props:{modelValue:{type:Boolean,default:!1},showButton:{type:Boolean,default:!0},offset:{type:Number,default:16},width:{type:Number,default:380},height:{type:Number,default:520}},emits:["update:modelValue"],data(){return{visible:this.modelValue,text:"",messages:[],allEvents:[],lastVisit:null,unreadCount:0,connected:!1,socketId:"",currentMode:"chat",currentPage:1,itemsPerPage:20,loading:!1,isDestroying:!1,eventStats:{chat:0,kvChanged:0,other:0},cleanupFunctions:[]}},computed:{panelStyle(){return{right:this.offset+"px",bottom:this.offset+"px",width:this.width+"px",height:this.height+"px"}},toggleStyle(){return{right:this.offset+"px",bottom:this.offset+"px"}},canSend(){return!!(_("server.kvToken")&&this.text.trim())},showToggleButton(){return this.$props.showButton&&!this.visible},decoratedMessages(){if(!this.lastVisit)return this.messages;const t=this.messages.findIndex(o=>o.at&&new Date(o.at).getTime()>=new Date(this.lastVisit).getTime());if(t<=0)return this.messages;const e=this.messages.slice(0,t),i=this.messages.slice(t);return[...e,{_id:"divider",_type:"divider"},...i]},currentDisplayItems(){return this.currentMode==="chat"?this.decoratedMessages:this.paginatedEvents},paginatedEvents(){if(this.isDestroying||!this.allEvents)return[];const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.allEvents.slice(t,e)},totalPages(){return this.isDestroying||!this.allEvents?1:Math.ceil(this.allEvents.length/this.itemsPerPage)},modeTitle(){return this.currentMode==="chat"?"ËÆæÂ§áËÅäÂ§©ÂÆ§":"ÊâÄÊúâ‰∫ã‰ª∂"}},watch:{modelValue(t){this.visible=t,t&&this.onOpen()}},mounted(){try{const h=localStorage.getItem("chat.lastVisit");h&&(this.lastVisit=h)}catch{}const t=Jt();this.connected=!!t.connected,this.socketId=t.id||"",t.on("connect",()=>{this.connected=!0,this.socketId=t.id||""}),t.on("disconnect",()=>{this.connected=!1});const e=_("server.kvToken");e&&mt(e);const i=h=>(...k)=>{if(!this.isDestroying)try{h(...k)}catch(C){console.error("ChatWidget ‰∫ã‰ª∂Â§ÑÁêÜÈîôËØØ:",C)}},o=Ne("chat:message",i(h=>{this.pushMessage(h),this.addEvent({_id:`legacy-chat-${Date.now()}-${Math.random()}`,type:"chat:message",content:h,timestamp:h.at||new Date().toISOString(),senderId:h.senderId,uuid:h.uuid,senderInfo:h.senderInfo})})),n=Ne("chat",i(h=>{if(h&&h.content&&h.content.text){const k={text:h.content.text,senderId:h.senderId,at:h.timestamp,uuid:h.senderId,senderInfo:h.senderInfo};this.pushMessage(k),this.addEvent({_id:h.eventId||`chat-${Date.now()}-${Math.random()}`,type:"chat",content:h.content,timestamp:h.timestamp,eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo})}}));this.deviceEventHandler=Xt({onChat:i((h,k)=>{this.pushMessage(h),this.addEvent(k)}),onKvChanged:i((h,k)=>{this.addEvent(k)}),onUrgentNotice:i((h,k)=>{this.addEvent(k),this.showUrgentNotification(k)}),onNotification:i((h,k)=>{console.log("Êî∂Âà∞ÈÄöÁü•‰∫ã‰ª∂:",h,k),this.addEvent(k),this.showUrgentNotification(k)}),onOtherEvent:i(h=>{(h.type==="urgent-notice"||h.type==="notification")&&this.showUrgentNotification(h),this.addEvent(h)}),enableLegacySupport:!0});const l=Ne("device-event",this.deviceEventHandler),d=Ne("kv-key-changed",i(h=>{h.content&&h.timestamp?this.addEvent({_id:`kv-${Date.now()}-${Math.random()}`,type:"kv-key-changed",content:h.content,timestamp:h.timestamp,eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo}):this.addEvent({_id:`legacy-kv-${Date.now()}-${Math.random()}`,type:"kv-key-changed",content:h,timestamp:h.updatedAt||new Date().toISOString(),uuid:h.uuid})})),u=Ne("urgent-notice",i(h=>{console.log("Êî∂Âà∞Á¥ßÊÄ•ÈÄöÁü•:",h),this.addEvent({_id:`urgent-${Date.now()}-${Math.random()}`,type:"urgent-notice",content:h.content||h,timestamp:h.timestamp||new Date().toISOString(),eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo}),this.showUrgentNotification(h)})),f=Ne("notification",i(h=>{var k;console.log("Êî∂Âà∞ÈÄöÁü•‰∫ã‰ª∂:",h),this.addEvent({_id:`notification-${Date.now()}-${Math.random()}`,type:"notification",content:h.content||h,timestamp:h.timestamp||new Date().toISOString(),eventId:h.eventId,senderId:h.senderId,senderInfo:h.senderInfo||((k=h.content)==null?void 0:k.senderInfo)}),this.showUrgentNotification(h)}));this.cleanupFunctions=[o,n,u,f,l,d],this.visible&&this.onOpen()},beforeUnmount(){this.isDestroying=!0,this.cleanupFunctions&&Array.isArray(this.cleanupFunctions)&&this.cleanupFunctions.forEach(t=>{try{typeof t=="function"&&t()}catch(e){console.warn("ChatWidget Ê∏ÖÁêÜÂáΩÊï∞ÊâßË°åÂ§±Ë¥•:",e)}});try{this.offMessage&&this.offMessage(),this.offDeviceEvent&&this.offDeviceEvent(),this.offKvChanged&&this.offKvChanged()}catch(t){console.warn("ChatWidget ÊóßÊ∏ÖÁêÜÂáΩÊï∞ÊâßË°åÂ§±Ë¥•:",t)}this.cleanupFunctions=[],this.messages=[],this.allEvents=[]},methods:{open(){this.visible=!0,this.$emit("update:modelValue",!0),this.onOpen()},close(){this.visible=!1,this.$emit("update:modelValue",!1);try{localStorage.setItem("chat.lastVisit",new Date().toISOString())}catch{}this.unreadCount=0},onOpen(){this.$nextTick(()=>this.scrollToBottom())},insertEmoji(t){this.text+=t,this.$nextTick(()=>{var e,i;if((i=(e=this.$refs.inputRef)==null?void 0:e.$el)!=null&&i.querySelector){const o=this.$refs.inputRef.$el.querySelector("textarea");o==null||o.focus()}})},handleEnter(t){t.shiftKey||this.send()},send(){const t=this.text.trim();if(!t)return;const e={_id:`self-${Date.now()}-${Math.random()}`,text:t,at:new Date().toISOString(),senderId:this.socketId,self:!0,senderInfo:{deviceName:"Êàë",deviceType:"client",isReadOnly:!1}};this.pushMessage(e),this.addEvent({_id:`self-event-${Date.now()}-${Math.random()}`,type:"chat",content:{text:t},timestamp:new Date().toISOString(),senderId:this.socketId,senderInfo:{deviceName:"Êú¨ËÆæÂ§á",deviceType:"client",isReadOnly:!1}}),mn(t),this.text=""},pushMessage(t){if(!(this.isDestroying||!t))try{const e={_id:`${t.at||Date.now()}-${Math.random()}`,text:typeof(t==null?void 0:t.text)=="string"?t.text:(t==null?void 0:t.text)||"",at:t.at||new Date().toISOString(),senderId:t.senderId,self:!!(t.senderId&&t.senderId===this.socketId),senderInfo:t.senderInfo||null,deviceName:this.getDeviceName(t.senderInfo,t.senderId===this.socketId)};if(!e.text)return;this.messages.push(e),this.visible||this.unreadCount++,this.$nextTick(()=>{this.isDestroying||this.scrollToBottom()}),this.messages.length>500&&this.messages.shift()}catch(e){console.error("ChatWidget pushMessage ÈîôËØØ:",e)}},formatTime(t){try{const e=new Date(t),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${i}:${o}`}catch{return""}},scrollToBottom(){if(!this.isDestroying)try{const t=this.$refs.listRef;if(!t)return;requestAnimationFrame(()=>{!this.isDestroying&&t&&(t.scrollTop=t.scrollHeight)})}catch(t){console.warn("ChatWidget scrollToBottom ÈîôËØØ:",t)}},addEvent(t){if(!(this.isDestroying||!t))try{this.allEvents.unshift(t),t.type==="chat"||t.type==="chat:message"?this.eventStats.chat++:t.type==="kv-key-changed"?this.eventStats.kvChanged++:this.eventStats.other++,this.allEvents.length>200&&(this.allEvents=this.allEvents.slice(0,200))}catch(e){console.error("ChatWidget addEvent ÈîôËØØ:",e)}},getEventColor(t){switch(t){case"chat":case"chat:message":return"success";case"kv-key-changed":return"info";default:return"warning"}},getEventTypeLabel(t){switch(t){case"chat":case"chat:message":return"ËÅäÂ§©";case"kv-key-changed":return"KVÂèòÂåñ";default:return t}},formatDeviceInfo(t){return cn(t)},getDeviceName(t,e=!1){return e?"Êàë":t?t.deviceName==="realtime"?"Á≥ªÁªü":t.deviceName||t.deviceType||"Êú™Áü•ËÆæÂ§á":"Êú™Áü•ËÆæÂ§á"},showUrgentNotification(t){try{this.$refs.urgentNotification?this.$refs.urgentNotification.show(t):console.warn("Á¥ßÊÄ•ÈÄöÁü•ÁªÑ‰ª∂Êú™ÊâæÂà∞")}catch(e){console.error("ÊòæÁ§∫Á¥ßÊÄ•ÈÄöÁü•Â§±Ë¥•:",e)}}}},aa={class:"text-subtitle-1"},ia={key:0,ref:"listRef",class:"messages"},la={key:0,class:"divider-row"},oa={class:"avatar"},ra={class:"bubble"},da={key:0,class:"sender-name"},ua={class:"text"},ca={class:"meta"},ma={key:0,class:"device-name"},fa={key:1,class:"events-container"},ha={class:"event-stats mb-3"},ga={class:"text-h6"},va={class:"text-h6"},pa={class:"text-h6"},ya={class:"events-list"},ka={class:"d-flex align-center mb-1"},ba={class:"text-caption"},xa={key:0,class:"mb-1 text-caption"},wa={class:"event-content"},Sa={key:0,class:"chat-content"},Ca={key:1,class:"text-caption event-data"},Da={key:0,class:"text-center text-grey pa-4"},_a={key:0,class:"pagination mt-2"};function Ta(t,e,i,o,n,l){const d=ns;return m(),p(V,null,[l.showToggleButton?(m(),p("div",{key:0,style:_e(l.toggleStyle),class:"chat-toggle"},[s(y,{color:"primary",icon:"",variant:"flat",onClick:e[0]||(e[0]=u=>l.open())},{default:a(()=>[s(ln,{content:n.unreadCount||void 0,"model-value":n.unreadCount>0,color:"error",overlap:""},{default:a(()=>[s(E,null,{default:a(()=>[...e[7]||(e[7]=[c(" mdi-chat ",-1)])]),_:1})]),_:1},8,["content","model-value"])]),_:1})],4)):S("",!0),ve(r("div",{style:_e(l.panelStyle),class:"chat-panel"},[s(I,{border:"",class:"chat-card",elevation:"8"},{default:a(()=>[s(Z,{class:"d-flex align-center"},{default:a(()=>[s(E,{class:"mr-2"},{default:a(()=>[...e[8]||(e[8]=[c(" mdi-chat-processing ",-1)])]),_:1}),r("span",aa,g(l.modeTitle),1),s(H),s(Kt,{modelValue:n.currentMode,"onUpdate:modelValue":e[1]||(e[1]=u=>n.currentMode=u),class:"mr-2",mandatory:"",size:"small",variant:"outlined"},{default:a(()=>[s(y,{value:"chat",size:"small"},{default:a(()=>[s(E,null,{default:a(()=>[...e[9]||(e[9]=[c("mdi-chat",-1)])]),_:1})]),_:1}),s(y,{value:"events",size:"small"},{default:a(()=>[s(E,null,{default:a(()=>[...e[10]||(e[10]=[c("mdi-format-list-bulleted",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(pt,{location:"top"},{activator:a(({props:u})=>[s(G,ke({color:n.connected?"success":"grey",size:"x-small"},u,{variant:"tonal"}),{default:a(()=>[c(g(n.connected?"Â∑≤ËøûÊé•":"Êú™ËøûÊé•"),1)]),_:1},16,["color"])]),default:a(()=>[r("span",null,"Socket "+g(n.socketId||"-"),1)]),_:1}),s(y,{icon:"",variant:"text",onClick:e[2]||(e[2]=u=>l.close())},{default:a(()=>[s(E,null,{default:a(()=>[...e[11]||(e[11]=[c("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),s(Ue),s(z,{class:"chat-body"},{default:a(()=>[n.currentMode==="chat"?(m(),p("div",ia,[(m(!0),p(V,null,R(l.decoratedMessages,u=>(m(),p(V,{key:u._id},[u._type==="divider"?(m(),p("div",la,[s(Ue,{class:"my-2"}),e[12]||(e[12]=r("div",{class:"divider-text"}," ‰ªäÂ§© - ‰∏äÊ¨°ËÆøÈóÆ ",-1)),s(Ue,{class:"my-2"})])):(m(),p("div",{key:1,class:De([{self:u.self},"message-row"])},[r("div",oa,[s(Oe,{color:u.self?"primary":"grey",size:"24"},{default:a(()=>[s(E,{size:"small"},{default:a(()=>[c(g(u.self?"mdi-account":"mdi-account-outline"),1)]),_:2},1024)]),_:2},1032,["color"])]),r("div",ra,[!u.self&&u.deviceName?(m(),p("div",da,g(u.deviceName),1)):S("",!0),r("div",ua,g(u.text),1),r("div",ca,[u.self&&u.deviceName?(m(),p("span",ma,g(u.deviceName)+" ‚Ä¢ ",1)):S("",!0),c(" "+g(l.formatTime(u.at)),1)])])],2))],64))),128))],512)):(m(),p("div",fa,[r("div",ha,[s(Ce,{dense:""},{default:a(()=>[s(fe,{cols:"4"},{default:a(()=>[s(I,{color:"success",dark:"",size:"small"},{default:a(()=>[s(z,{class:"text-center pa-2"},{default:a(()=>[r("div",ga,g(n.eventStats.chat),1),e[13]||(e[13]=r("div",{class:"text-caption"}," ËÅäÂ§© ",-1))]),_:1})]),_:1})]),_:1}),s(fe,{cols:"4"},{default:a(()=>[s(I,{color:"info",dark:"",size:"small"},{default:a(()=>[s(z,{class:"text-center pa-2"},{default:a(()=>[r("div",va,g(n.eventStats.kvChanged),1),e[14]||(e[14]=r("div",{class:"text-caption"}," KVÂèòÂåñ ",-1))]),_:1})]),_:1})]),_:1}),s(fe,{cols:"4"},{default:a(()=>[s(I,{color:"warning",dark:"",size:"small"},{default:a(()=>[s(z,{class:"text-center pa-2"},{default:a(()=>[r("div",pa,g(n.eventStats.other),1),e[15]||(e[15]=r("div",{class:"text-caption"}," ÂÖ∂‰ªñ ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),r("div",ya,[(m(!0),p(V,null,R(l.paginatedEvents,u=>(m(),p("div",{key:u._id,class:"event-item mb-2"},[s(I,{color:l.getEventColor(u.type),size:"small",variant:"outlined"},{default:a(()=>[s(z,{class:"pa-2"},{default:a(()=>{var f;return[r("div",ka,[s(G,{color:l.getEventColor(u.type),size:"x-small"},{default:a(()=>[c(g(l.getEventTypeLabel(u.type)),1)]),_:2},1032,["color"]),s(H),r("span",ba,g(l.formatTime(u.timestamp||u.at)),1)]),u.senderInfo?(m(),p("div",xa,[e[16]||(e[16]=r("strong",null,"ÂèëÈÄÅËÄÖ:",-1)),c(" "+g(l.formatDeviceInfo(u.senderInfo)),1)])):S("",!0),r("div",wa,[u.type==="chat"||u.type==="chat:message"?(m(),p("div",Sa,g(((f=u.content)==null?void 0:f.text)||u.text),1)):(m(),p("pre",Ca,g(JSON.stringify(u.content||u,null,1)),1))])]}),_:2},1024)]),_:2},1032,["color"])]))),128)),n.allEvents.length===0?(m(),p("div",Da," ÊöÇÊó†‰∫ã‰ª∂ ")):S("",!0)]),l.totalPages>1?(m(),p("div",_a,[s(fn,{modelValue:n.currentPage,"onUpdate:modelValue":e[3]||(e[3]=u=>n.currentPage=u),length:l.totalPages,"total-visible":3,size:"small"},null,8,["modelValue","length"])])):S("",!0)]))]),_:1}),n.currentMode==="chat"?(m(),x(Ue,{key:0})):S("",!0),n.currentMode==="chat"?(m(),x(ue,{key:1,class:"chat-input"},{default:a(()=>[s(y,{class:"mr-1",icon:"",variant:"text",onClick:e[4]||(e[4]=u=>l.insertEmoji("üòÑ"))},{default:a(()=>[s(E,null,{default:a(()=>[...e[17]||(e[17]=[c("mdi-emoticon-outline",-1)])]),_:1})]),_:1}),s(Xe,{ref:"inputRef",modelValue:n.text,"onUpdate:modelValue":e[5]||(e[5]=u=>n.text=u),"auto-grow":"",class:"flex-grow-1","hide-details":"",placeholder:"ËæìÂÖ•Ê∂àÊÅØ",rows:"1",variant:"solo",onKeydown:[_t(ct(l.handleEnter,["prevent"]),["enter"]),e[6]||(e[6]=_t(ct(()=>{},["shift","stop"]),["enter"]))]},null,8,["modelValue","onKeydown"]),s(y,{disabled:!l.canSend,class:"ml-2",color:"primary",onClick:l.send},{default:a(()=>[s(E,{start:""},{default:a(()=>[...e[18]||(e[18]=[c(" mdi-send ",-1)])]),_:1}),e[19]||(e[19]=c(" ÂèëÈÄÅ ",-1))]),_:1},8,["disabled","onClick"])]),_:1})):S("",!0)]),_:1})],4),[[Re,n.visible]]),s(d,{ref:"urgentNotification"},null,512)],64)}const it=ie(na,[["render",Ta],["__scopeId","data-v-1a62ac2a"]]),Ia={name:"UrgentTestDialog",components:{ChatWidget:it,EventSender:at},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{sending:!1,notificationForm:{isUrgent:!1,message:"",isPersistent:!1},sentMessages:[],receiptCleanup:[],persistentNotifications:[],editDialog:!1,editForm:{id:null,message:"",isUrgent:!1,resend:!1},savingEdit:!1,deleteConfirmDialog:!1,itemToDelete:null}},computed:{dialog:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},mounted(){this.setupEventListeners(),this.loadPersistentNotifications()},beforeUnmount(){this.cleanup()},methods:{generateNotificationId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let i=0;i<32;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},async sendNotification(){if(this.notificationForm.message.trim()){this.sending=!0;try{const t=this.generateNotificationId(),e=this.notificationForm.message,i=this.notificationForm.isUrgent,o=this.notificationForm.isPersistent,n=await this.$refs.eventSender.sendNotification(e,i,[],{deviceName:"ÊµãËØïËÆæÂ§á",deviceType:"system",isReadOnly:!1},t),l=(n==null?void 0:n.eventId)||`msg-${Date.now()}`;if(this.sentMessages.push({id:l,notificationId:t,message:e,isUrgent:i,timestamp:new Date().toISOString(),receipts:{displayed:[],read:[]}}),o)try{const d="notification-list",u=await ce.loadData(d);let f=[];u&&Array.isArray(u)?f=u:u&&u.success!==!1&&Array.isArray(u.data)&&(f=u.data);const h={id:t,message:e,isUrgent:i,timestamp:new Date().toISOString()};f.unshift(h),await ce.saveData(d,f),this.persistentNotifications=f,console.log("Â∏∏È©ªÈÄöÁü•Â∑≤‰øùÂ≠ò")}catch(d){console.error("‰øùÂ≠òÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",d)}console.log("ÈÄöÁü•Â∑≤ÂèëÈÄÅÔºå‰∫ã‰ª∂ID:",l,"ÈÄöÁü•ID:",t),this.resetForm()}catch(t){console.error("ÂèëÈÄÅÈÄöÁü•Â§±Ë¥•:",t)}finally{this.sending=!1}}},resetForm(){this.notificationForm={isUrgent:!1,message:"",isPersistent:!1}},close(){this.dialog=!1},setupEventListeners(){const t=Ne("notification-displayed",i=>{console.log("Êî∂Âà∞ÊòæÁ§∫ÂõûÊâß:",i),this.updateReceipt(i,"displayed")}),e=Ne("notification-read",i=>{console.log("Êî∂Âà∞Â∑≤ËØªÂõûÊâß:",i),this.updateReceipt(i,"read")});this.receiptCleanup.push(t,e)},updateReceipt(t,e){var l,d,u,f,h;const i=t.originalEventId,o=t.notificationId||((l=t.content)==null?void 0:l.notificationId);if(!i&&!o)return;const n=this.sentMessages.find(k=>k.id===i||k.notificationId===o);if(n){const k={senderId:t.senderId||"unknown-sender",deviceName:((d=t.senderInfo)==null?void 0:d.deviceName)||((u=t.deviceInfo)==null?void 0:u.deviceName)||"Êú™Áü•ËÆæÂ§á",deviceType:((f=t.senderInfo)==null?void 0:f.deviceType)||((h=t.deviceInfo)==null?void 0:h.deviceType)||"unknown",timestamp:new Date().toISOString()};n.receipts[e].find(B=>B.senderId===k.senderId)||(n.receipts[e].push(k),console.log(`Êõ¥Êñ∞${e}ÂõûÊâß:`,n.id,k))}},cleanup(){this.receiptCleanup.forEach(t=>t()),this.receiptCleanup=[]},formatTime(t){return new Date(t).toLocaleString("zh-CN")},getReceiptStatus(t){return t.read.length>0?"Â∑≤ËØª":t.displayed.length>0?"Â∑≤ÊòæÁ§∫":"Â∑≤ÂèëÈÄÅ"},getReceiptColor(t){return t.read.length>0?"success":t.displayed.length>0?"info":"grey"},formatDeviceTime(t){return new Date(t).toLocaleTimeString("zh-CN")},getMainCardColor(t){return t.read.length>0?"success":t.displayed.length>0?"info":"grey"},hasAnyReceipts(t){return t.read.length>0||t.displayed.length>0},getDisplayedOnlyDevices(t){const e=t.read.map(i=>i.senderId);return t.displayed.filter(i=>!e.includes(i.senderId))},openEditDialog(t){this.editForm={id:t.id,message:t.message,isUrgent:t.isUrgent||!1,resend:!1,timestamp:t.timestamp},this.editDialog=!0},async saveEdit(){var t,e;if(this.editForm.message.trim()){this.savingEdit=!0;try{const i=this.persistentNotifications.findIndex(o=>o.id===this.editForm.id);if(i!==-1){if(this.persistentNotifications[i]={...this.persistentNotifications[i],message:this.editForm.message,isUrgent:this.editForm.isUrgent,timestamp:new Date().toISOString()},await ce.saveData("notification-list",this.persistentNotifications),this.editForm.resend){const o=this.editForm.id,n=this.editForm.message,l=this.editForm.isUrgent,d=await this.$refs.eventSender.sendNotification(n,l,[],{deviceName:"ÊµãËØïËÆæÂ§á",deviceType:"system",isReadOnly:!1},o),u=(d==null?void 0:d.eventId)||`msg-${Date.now()}`;this.sentMessages.push({id:u,notificationId:o,message:n,isUrgent:l,timestamp:new Date().toISOString(),receipts:{displayed:[],read:[]}})}this.editDialog=!1,(t=this.$message)==null||t.success("Â∑≤Êõ¥Êñ∞")}}catch(i){console.error("‰øùÂ≠òÂ§±Ë¥•",i),(e=this.$message)==null||e.error("‰øùÂ≠òÂ§±Ë¥•")}finally{this.savingEdit=!1}}},async loadPersistentNotifications(){try{const t=await ce.loadData("notification-list");t&&Array.isArray(t)?this.persistentNotifications=t:t&&t.success!==!1&&Array.isArray(t.data)?this.persistentNotifications=t.data:this.persistentNotifications=[]}catch(t){console.error("Âä†ËΩΩÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",t)}},async deleteNotification(t){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÈÄöÁü•ÂêóÔºü"))try{this.sentMessages=this.sentMessages.filter(i=>i.id!==t),this.persistentNotifications=this.persistentNotifications.filter(i=>i.id!==t),console.log("ÈÄöÁü•Â∑≤Âà†Èô§ÔºåÈÄöÁü•ID:",t)}catch(i){console.error("Âà†Èô§ÈÄöÁü•Â§±Ë¥•:",i)}},deletePersistentNotification(t){this.itemToDelete=t,this.deleteConfirmDialog=!0},async executeDelete(){var e,i;if(!this.itemToDelete)return;const t=this.itemToDelete;this.deleteConfirmDialog=!1,this.itemToDelete=null;try{this.persistentNotifications=this.persistentNotifications.filter(n=>n.id!==t);const o=this.persistentNotifications.length>0?this.persistentNotifications:{};await ce.saveData("notification-list",o),(e=this.$message)==null||e.success("Â∑≤Âà†Èô§")}catch(o){console.error("Âà†Èô§Â§±Ë¥•",o),(i=this.$message)==null||i.error("Âà†Èô§Â§±Ë¥•")}}}},Ea={key:0,class:"text-center text-grey py-4"},Va={key:0,class:"text-center text-grey py-8"},Na={class:"d-flex align-center mb-2"},Aa={class:"font-weight-medium"},Ua={class:"text-caption font-weight-medium"},za={class:"text-body-2 mb-3",style:{"max-height":"60px",overflow:"hidden"}},Pa={class:"text-caption"},Fa={key:0},Ma={class:"align-center"},$a={class:"text-body-2 font-weight-medium"},Ra={class:"text-caption mt-1"},La={class:"align-center"},Oa={class:"text-body-2 font-weight-medium"},Ba={class:"text-caption text-grey"},ja={class:"text-caption text-grey mt-1"},Ha={key:1};function Ka(t,e,i,o,n,l){const d=it,u=at;return m(),x(de,{modelValue:l.dialog,"onUpdate:modelValue":e[11]||(e[11]=f=>l.dialog=f),fullscreen:"",transition:"dialog-bottom-transition",scrollable:""},{default:a(()=>[s(I,null,{default:a(()=>[s(Ft,{dark:"",flat:""},{default:a(()=>[s(Mt,null,{default:a(()=>[s(E,{class:"mr-2"},{default:a(()=>[...e[12]||(e[12]=[c(" mdi-chat ",-1)])]),_:1}),e[13]||(e[13]=c(" ÂèëÈÄÅÈÄöÁü• ",-1))]),_:1}),s(H),s(y,{icon:"mdi-close",onClick:l.close},null,8,["onClick"])]),_:1}),s(z,{class:"pa-0"},{default:a(()=>[s(es,null,{default:a(()=>[s(Ce,null,{default:a(()=>[s(fe,{cols:"12"},{default:a(()=>[s(I,null,{default:a(()=>[s(z,null,{default:a(()=>[s($t,null,{default:a(()=>[s(Ce,null,{default:a(()=>[s(fe,{cols:"12",md:"6"},{default:a(()=>[s(ft,{modelValue:n.notificationForm.isUrgent,"onUpdate:modelValue":e[0]||(e[0]=f=>n.notificationForm.isUrgent=f),label:"Âº∫Ë∞ÉÈÄöÁü•",color:"red",inset:""},null,8,["modelValue"]),s(Pt,{modelValue:n.notificationForm.isPersistent,"onUpdate:modelValue":e[1]||(e[1]=f=>n.notificationForm.isPersistent=f),label:"Â∏∏È©ªÂ±ïÁ§∫",color:"primary","hide-details":"",class:"mt-0"},null,8,["modelValue"])]),_:1}),s(fe,{cols:"12"},{default:a(()=>[s(Xe,{modelValue:n.notificationForm.message,"onUpdate:modelValue":e[2]||(e[2]=f=>n.notificationForm.message=f),label:"ÈÄöÁü•ÂÜÖÂÆπ",outlined:"",rows:"3",placeholder:"ËØ∑ËæìÂÖ•Âº∫Ë∞ÉÈÄöÁü•ÁöÑÂÜÖÂÆπ..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(ue,{class:"px-6 pb-6"},{default:a(()=>[s(y,{color:n.notificationForm.isUrgent?"red":"blue",disabled:!n.notificationForm.message.trim(),loading:n.sending,size:"large",variant:"elevated",onClick:l.sendNotification},{default:a(()=>[s(E,{left:""},{default:a(()=>[c(g(n.notificationForm.isUrgent?"mdi-alert-circle":"mdi-information"),1)]),_:1}),c(" "+g(n.notificationForm.isUrgent?"ÂèëÈÄÅÂº∫Ë∞ÉÈÄöÁü•":"ÂèëÈÄÅÈÄöÁü•"),1)]),_:1},8,["color","disabled","loading","onClick"]),s(H)]),_:1})]),_:1})]),_:1})]),_:1}),s(Ce,{class:"mt-4"},{default:a(()=>[s(fe,{cols:"12"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,null,{default:a(()=>[s(E,{class:"mr-2"},{default:a(()=>[...e[14]||(e[14]=[c("mdi-pin",-1)])]),_:1}),e[15]||(e[15]=c(" Â∏∏È©ªÈÄöÁü•ÁÆ°ÁêÜ ",-1))]),_:1}),s(z,null,{default:a(()=>[n.persistentNotifications.length===0?(m(),p("div",Ea," ÊöÇÊó†Â∏∏È©ªÈÄöÁü• ")):(m(),x($e,{key:1},{default:a(()=>[(m(!0),p(V,null,R(n.persistentNotifications,f=>(m(),x(Pe,{key:f.id,title:f.message,subtitle:l.formatTime(f.timestamp),lines:"two"},{prepend:a(()=>[s(E,{color:f.isUrgent?"error":"primary"},{default:a(()=>[c(g(f.isUrgent?"mdi-alert-circle":"mdi-information"),1)]),_:2},1032,["color"])]),append:a(()=>[s(y,{icon:"mdi-pencil",variant:"text",size:"small",onClick:h=>l.openEditDialog(f)},null,8,["onClick"]),s(y,{icon:"mdi-delete",variant:"text",color:"error",size:"small",onClick:h=>l.deletePersistentNotification(f.id)},null,8,["onClick"])]),_:2},1032,["title","subtitle"]))),128))]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),s(Ce,{class:"mt-4"},{default:a(()=>[s(fe,{cols:"12"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,null,{default:a(()=>[s(E,{class:"mr-2"},{default:a(()=>[...e[16]||(e[16]=[c(" mdi-history ",-1)])]),_:1}),e[17]||(e[17]=c(" Ê∂àÊÅØËÆ∞ÂΩï ",-1)),s(H)]),_:1}),s(z,null,{default:a(()=>[n.sentMessages.length===0?(m(),p("div",Va,[s(E,{size:"64",color:"grey-lighten-2"},{default:a(()=>[...e[18]||(e[18]=[c(" mdi-message-outline ",-1)])]),_:1}),e[19]||(e[19]=r("div",{class:"mt-2"}," ÊöÇÊó†ÂèëÈÄÅËÆ∞ÂΩï ",-1))])):(m(),x(Ce,{key:1},{default:a(()=>[(m(!0),p(V,null,R(n.sentMessages.slice().reverse(),f=>(m(),x(fe,{key:f.id,cols:"12",md:"6",lg:"4"},{default:a(()=>[s(I,{color:l.getMainCardColor(f.receipts),class:"mb-2"},{default:a(()=>[s(z,null,{default:a(()=>[r("div",Na,[r("span",Aa,g(f.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•"),1),s(H),r("span",Ua,g(l.getReceiptStatus(f.receipts)),1)]),r("div",za,g(f.message),1),r("div",Pa,[r("div",null,"ÂèëÈÄÅÊó∂Èó¥Ôºö"+g(l.formatTime(f.timestamp)),1),r("div",null,"‰∫ã‰ª∂IDÔºö"+g(f.id),1),r("div",null,"ÈÄöÁü•IDÔºö"+g(f.notificationId),1)])]),_:2},1024)]),_:2},1032,["color"]),l.hasAnyReceipts(f.receipts)?(m(),p("div",Fa,[(m(!0),p(V,null,R(f.receipts.read,h=>(m(),x(I,{key:`${h.senderId}-read`,color:"success",class:"mb-1",size:"small"},{default:a(()=>[s(z,{class:"pa-2"},{default:a(()=>[r("div",Ma,[r("span",$a,g(h.deviceName),1),e[20]||(e[20]=r("br",null,null,-1)),c(" "+g(h.deviceType),1)]),r("div",Ra," Â∑≤ËØª‰∫é "+g(l.formatDeviceTime(h.timestamp)),1)]),_:2},1024)]),_:2},1024))),128)),(m(!0),p(V,null,R(l.getDisplayedOnlyDevices(f.receipts),h=>(m(),x(I,{key:`${h.senderId}-displayed`,color:"info-lighten-4",variant:"outlined",class:"mb-1",size:"small"},{default:a(()=>[s(z,{class:"pa-2"},{default:a(()=>[r("div",La,[r("span",Oa,g(h.deviceName),1),s(H),r("span",Ba,g(h.deviceType=="classroom"?"ÊïôÂÆ§ËÆæÂ§á‰∏äÁöÑÂ∫îÁî®":h.deviceType),1)]),r("div",ja," Â∑≤ÊòæÁ§∫‰∫é "+g(l.formatDeviceTime(h.timestamp)),1)]),_:2},1024)]),_:2},1024))),128))])):(m(),p("div",Ha,[s(I,{color:"info-lighten-4",variant:"outlined",class:"mb-1",size:"small",title:"Êó†ËÆæÂ§áÂú®Á∫ø"},{default:a(()=>[s(z,null,{default:a(()=>[...e[21]||(e[21]=[c(" Â¶ÇÊûúÊï∞ÁßíÂêé‰ªªÁÑ∂ÊòæÁ§∫Ëøô‰∏™ÊèêÁ§∫ÔºåÂàôÂèØËÉΩÊ≤°Êúâ‰ªª‰ΩïËÆæÂ§áÂú®Á∫øÊé•Êî∂ÈÄöÁü•„ÄÇ ",-1)])]),_:1})]),_:1})]))]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(d),s(u,{ref:"eventSender"},null,512),s(de,{modelValue:n.editDialog,"onUpdate:modelValue":e[8]||(e[8]=f=>n.editDialog=f),"max-width":"500",fullscreen:t.$vuetify.display.xs},{default:a(()=>[s(I,null,{default:a(()=>[s(Ft,{flat:"",density:"compact"},{default:a(()=>[s(Mt,null,{default:a(()=>[...e[22]||(e[22]=[c("ÁºñËæëÂ∏∏È©ªÈÄöÁü•",-1)])]),_:1}),s(H),s(y,{icon:"mdi-close",onClick:e[3]||(e[3]=f=>n.editDialog=!1)})]),_:1}),s(z,null,{default:a(()=>[s($t,null,{default:a(()=>[s(Xe,{modelValue:n.editForm.message,"onUpdate:modelValue":e[4]||(e[4]=f=>n.editForm.message=f),label:"ÈÄöÁü•ÂÜÖÂÆπ",rows:"3","auto-grow":""},null,8,["modelValue"]),s(ft,{modelValue:n.editForm.isUrgent,"onUpdate:modelValue":e[5]||(e[5]=f=>n.editForm.isUrgent=f),label:"Âº∫Ë∞ÉÈÄöÁü•",color:"error","hide-details":""},null,8,["modelValue"]),s(Pt,{modelValue:n.editForm.resend,"onUpdate:modelValue":e[6]||(e[6]=f=>n.editForm.resend=f),label:"‰øùÂ≠òÂπ∂ÈáçÊñ∞ÂèëÈÄÅÈÄöÁü•",hint:"ÂãæÈÄâÂêéÂ∞Ü‰Ωú‰∏∫Êñ∞ÈÄöÁü•ÂèëÈÄÅÁªôÊâÄÊúâÂú®Á∫øËÆæÂ§á","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{variant:"text",onClick:e[7]||(e[7]=f=>n.editDialog=!1)},{default:a(()=>[...e[23]||(e[23]=[c("ÂèñÊ∂à",-1)])]),_:1}),s(y,{color:"primary",loading:n.savingEdit,onClick:l.saveEdit},{default:a(()=>[...e[24]||(e[24]=[c("‰øùÂ≠ò",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","fullscreen"]),s(de,{modelValue:n.deleteConfirmDialog,"onUpdate:modelValue":e[10]||(e[10]=f=>n.deleteConfirmDialog=f),"max-width":"400"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"text-h5"},{default:a(()=>[...e[25]||(e[25]=[c("Á°ÆËÆ§Âà†Èô§",-1)])]),_:1}),s(z,null,{default:a(()=>[...e[26]||(e[26]=[c("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Â∏∏È©ªÈÄöÁü•ÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ",-1)])]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=f=>n.deleteConfirmDialog=!1)},{default:a(()=>[...e[27]||(e[27]=[c("ÂèñÊ∂à",-1)])]),_:1}),s(y,{color:"error",variant:"text",onClick:l.executeDelete},{default:a(()=>[...e[28]||(e[28]=[c("Âà†Èô§",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}const as=ie(Ia,[["render",Ka],["__scopeId","data-v-c6850940"]]),qa={name:"FloatingICP"},Wa={"aria-label":"xICPÂ§áxÂè∑",class:"floating-icp-link",href:"https://beian.miit.gov.cn/",rel:"noopener noreferrer",target:"_blank",style:{display:"none"}};function Ga(t,e,i,o,n,l){return m(),p("a",Wa," xICPÂ§áxÂè∑ ")}const is=ie(qa,[["render",Ga],["__scopeId","data-v-fa73670f"]]),Qa={name:"FloatingToolbar",props:{loading:{type:Boolean,default:!1},unreadCount:{type:Number,default:0},selectedDate:{type:[String,Date],required:!0},isToday:{type:Boolean,required:!0},copyToTodayLoading:{type:Boolean,default:!1}},data(){return{isExpanded:!1}},methods:{handleDateSelect(t){this.$emit("date-select",t)}}},Ja={class:"floating-toolbar-container"};function Ya(t,e,i,o,n,l){return m(),p("div",Ja,[s(Ns,null,{default:a(()=>[s(I,{class:De([{"toolbar-expanded":n.isExpanded},"floating-toolbar"]),elevation:"4",rounded:"xl"},{default:a(()=>[s(ht,{class:"toolbar-buttons",variant:"text"},{default:a(()=>[ve(s(y,{title:"Êü•ÁúãÊò®Â§©",class:"toolbar-btn",icon:"mdi-chevron-left",variant:"text",onClick:e[0]||(e[0]=d=>t.$emit("prev-day"))},null,512),[[Le]]),ve(s(y,{title:"Áº©Â∞èÂ≠ó‰Ωì",class:"toolbar-btn",icon:"mdi-format-font-size-decrease",variant:"text",onClick:e[1]||(e[1]=d=>t.$emit("zoom","out"))},null,512),[[Le]]),ve(s(y,{title:"ÊîæÂ§ßÂ≠ó‰Ωì",class:"toolbar-btn",icon:"mdi-format-font-size-increase",variant:"text",onClick:e[2]||(e[2]=d=>t.$emit("zoom","up"))},null,512),[[Le]]),s(ts,{"close-on-content-click":!1,location:"top"},{activator:a(({props:d})=>[ve(s(y,ke({title:"ÈÄâÊã©Êó•Êúü",class:"toolbar-btn",icon:"mdi-calendar"},d,{variant:"text"}),null,16),[[Le]])]),default:a(()=>[s(I,{border:"",class:"date-picker-card"},{default:a(()=>[s(Es,{"model-value":i.selectedDate,color:"primary","onUpdate:modelValue":l.handleDateSelect},null,8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1}),ve(s(y,{loading:i.loading,title:"Âà∑Êñ∞Êï∞ÊçÆ",class:"toolbar-btn",icon:"mdi-refresh",variant:"text",onClick:e[3]||(e[3]=d=>t.$emit("refresh"))},null,8,["loading"]),[[Le]]),i.isToday?S("",!0):ve((m(),x(y,{key:0,title:"Êü•ÁúãÊòéÂ§©",class:"toolbar-btn",icon:"mdi-chevron-right",variant:"text",onClick:e[4]||(e[4]=d=>t.$emit("next-day"))},null,512)),[[Le]])]),_:1})]),_:1},8,["class"])]),_:1}),s(As,null,{default:a(()=>[i.isToday?S("",!0):(m(),x(y,{key:0,loading:i.copyToTodayLoading,disabled:i.copyToTodayLoading,class:"side-action-btn",color:"primary",elevation:"4","prepend-icon":"mdi-content-copy",rounded:"xl",size:"large",text:"Â§çÂà∂‰Ωú‰∏öÂÜÖÂÆπÂà∞‰ªäÂ§©",onClick:e[5]||(e[5]=d=>t.$emit("copy-to-today"))},{default:a(()=>[...e[6]||(e[6]=[c("Â§çÂà∂Âà∞‰ªäÂ§©",-1)])]),_:1},8,["loading","disabled"]))]),_:1})])}const ls=ie(Qa,[["render",Ya],["__scopeId","data-v-7076d3aa"]]),Xa={name:"AttendanceManagementDialog",props:{modelValue:{type:Boolean,required:!0},studentList:{type:Array,required:!0},attendance:{type:Object,required:!0},dateString:{type:String,default:""}},emits:["update:modelValue","save","change"],setup(){const{mobile:t}=Ye();return{isMobile:t}},data(){return{attendanceSearch:"",attendanceFilter:[]}},computed:{filteredStudents(){let t=[...this.studentList];if(this.attendanceSearch){const e=this.attendanceSearch.toLowerCase();t=t.filter(i=>i.toLowerCase().includes(e))}return this.attendanceFilter&&this.attendanceFilter.length>0&&(t=t.filter(e=>!!(this.attendanceFilter.includes("present")&&this.isPresent(e)||this.attendanceFilter.includes("absent")&&this.isAbsent(e)||this.attendanceFilter.includes("late")&&this.isLate(e)||this.attendanceFilter.includes("exclude")&&this.isExclude(e)))),t},extractedSurnames(){if(!this.studentList||this.studentList.length===0)return[];const t=new Map;return this.studentList.forEach(e=>{if(e&&e.length>0){const i=e.charAt(0);t.set(i,(t.get(i)||0)+1)}}),Array.from(t.entries()).map(([e,i])=>({name:e,count:i})).sort((e,i)=>{const o=zt(e.name,{toneType:"none"}),n=zt(i.name,{toneType:"none"});return o.localeCompare(n)})}},methods:{toggleFilter(t){const e=this.attendanceFilter.indexOf(t);e===-1?this.attendanceFilter.push(t):this.attendanceFilter.splice(e,1)},isPresent(t){const{absent:e,late:i,exclude:o}=this.attendance;return!e.includes(t)&&!i.includes(t)&&!o.includes(t)},isAbsent(t){return this.attendance.absent.includes(t)},isLate(t){return this.attendance.late.includes(t)},isExclude(t){return this.attendance.exclude.includes(t)},getStudentStatusColor(t){return this.attendance.absent.includes(t)?"error":this.attendance.late.includes(t)?"warning":this.attendance.exclude.includes(t)?"grey":"success"},getStudentStatusIcon(t){return this.attendance.absent.includes(t)?"mdi-account-off":this.attendance.late.includes(t)?"mdi-clock-alert":this.attendance.exclude.includes(t)?"mdi-account-cancel":"mdi-account-check"},removeFromAll(t){const e=this.attendance.absent.indexOf(t);e>-1&&this.attendance.absent.splice(e,1);const i=this.attendance.late.indexOf(t);i>-1&&this.attendance.late.splice(i,1);const o=this.attendance.exclude.indexOf(t);o>-1&&this.attendance.exclude.splice(o,1)},setPresent(t){this.removeFromAll(t),this.$emit("change")},setAbsent(t){this.removeFromAll(t),this.attendance.absent.push(t),this.$emit("change")},setLate(t){this.removeFromAll(t),this.attendance.late.push(t),this.$emit("change")},setExclude(t){this.removeFromAll(t),this.attendance.exclude.push(t),this.$emit("change")},setAllPresent(){this.attendance.absent.splice(0,this.attendance.absent.length),this.attendance.late.splice(0,this.attendance.late.length),this.attendance.exclude.splice(0,this.attendance.exclude.length),this.$emit("change")},setAllAbsent(){this.setAllPresent(),this.attendance.absent.push(...this.studentList),this.$emit("change")},setAllLate(){this.setAllPresent(),this.attendance.late.push(...this.studentList),this.$emit("change")},setAllExclude(){this.setAllPresent(),this.attendance.exclude.push(...this.studentList),this.$emit("change")}}},Za={class:"d-flex flex-wrap mt-2 gap-1"},ei={class:"d-flex flex-wrap mb-4 gap-2"},ti={class:"flex-grow-1"},si={class:"d-flex align-center"},ni={class:"text-subtitle-1"},ai={class:"attendance-actions"},ii={class:"d-flex flex-wrap gap-2"};function li(t,e,i,o,n,l){return m(),x(de,{"model-value":i.modelValue,fullscreen:o.isMobile,"fullscreen-breakpoint":"sm","max-width":"900","onUpdate:modelValue":e[7]||(e[7]=d=>t.$emit("update:modelValue",d))},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"d-flex align-center"},{default:a(()=>[s(E,{class:"mr-2",icon:"mdi-account-group"}),e[8]||(e[8]=c(" Âá∫Âã§Áä∂ÊÄÅÁÆ°ÁêÜ ",-1)),s(H),o.isMobile?S("",!0):(m(),x(G,{key:0,class:"ml-2",color:"primary",size:"small"},{default:a(()=>[c(g(i.dateString),1)]),_:1})),o.isMobile?(m(),x(y,{key:1,icon:"mdi-close",variant:"text",onClick:e[0]||(e[0]=d=>t.$emit("update:modelValue",!1))})):S("",!0)]),_:1}),s(z,null,{default:a(()=>[s(Ce,{class:"mb-4"},{default:a(()=>[s(fe,{cols:"12",md:"12"},{default:a(()=>[s(Fe,{modelValue:n.attendanceSearch,"onUpdate:modelValue":e[1]||(e[1]=d=>n.attendanceSearch=d),clearable:"",hint:"ÊîØÊåÅÁ≠õÈÄâÂßìÊ∞èÔºåÂ¶ÇËæìÂÖ•'Â≠ô'ÂèØÁ≠õÈÄâÊâÄÊúâÂßìÂ≠ôÁöÑÂ≠¶Áîü",label:"ÊêúÁ¥¢Â≠¶Áîü","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"]),r("div",Za,[(m(!0),p(V,null,R(l.extractedSurnames,d=>(m(),x(y,{key:d.name,color:n.attendanceSearch===d.name?"primary":"",variant:n.attendanceSearch===d.name?"elevated":"text",onClick:u=>n.attendanceSearch=n.attendanceSearch===d.name?"":d.name},{default:a(()=>[c(g(d.name)+" ("+g(d.count)+") ",1)]),_:2},1032,["color","variant","onClick"]))),128))])]),_:1})]),_:1}),r("div",ei,[r("div",null,[s(G,{"append-icon":n.attendanceFilter.includes("present")?"mdi-check":"",color:n.attendanceFilter.includes("present")?"success":"",variant:n.attendanceFilter.includes("present")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-check",value:"present",onClick:e[2]||(e[2]=d=>l.toggleFilter("present"))},{default:a(()=>[...e[9]||(e[9]=[c(" Âà∞ËØæ ",-1)])]),_:1},8,["append-icon","color","variant"]),s(G,{"append-icon":n.attendanceFilter.includes("absent")?"mdi-check":"",color:n.attendanceFilter.includes("absent")?"error":"",variant:n.attendanceFilter.includes("absent")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-off",value:"absent",onClick:e[3]||(e[3]=d=>l.toggleFilter("absent"))},{default:a(()=>[...e[10]||(e[10]=[c(" ËØ∑ÂÅá ",-1)])]),_:1},8,["append-icon","color","variant"]),s(G,{"append-icon":n.attendanceFilter.includes("late")?"mdi-check":"",color:n.attendanceFilter.includes("late")?"warning":"",variant:n.attendanceFilter.includes("late")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-clock-alert",value:"late",onClick:e[4]||(e[4]=d=>l.toggleFilter("late"))},{default:a(()=>[...e[11]||(e[11]=[c(" ËøüÂà∞ ",-1)])]),_:1},8,["append-icon","color","variant"]),s(G,{"append-icon":n.attendanceFilter.includes("exclude")?"mdi-check":"",color:n.attendanceFilter.includes("exclude")?"grey":"",variant:n.attendanceFilter.includes("exclude")?"elevated":"tonal",class:"px-2 filter-chip","prepend-icon":"mdi-account-cancel",value:"exclude",onClick:e[5]||(e[5]=d=>l.toggleFilter("exclude"))},{default:a(()=>[...e[12]||(e[12]=[c(" ‰∏çÂèÇ‰∏é ",-1)])]),_:1},8,["append-icon","color","variant"])])]),s(Ce,null,{default:a(()=>[(m(!0),p(V,null,R(l.filteredStudents,d=>(m(),x(fe,{key:d,cols:"12",lg:"4",md:"6",sm:"6"},{default:a(()=>[s(I,{border:"",class:"student-card"},{default:a(()=>[s(z,{class:"d-flex align-center pa-2"},{default:a(()=>[r("div",ti,[r("div",si,[s(Oe,{color:l.getStudentStatusColor(d),class:"mr-2",size:"24"},{default:a(()=>[s(E,{size:"small"},{default:a(()=>[c(g(l.getStudentStatusIcon(d)),1)]),_:2},1024)]),_:2},1032,["color"]),r("div",ni,g(d),1)])]),r("div",ai,[s(y,{color:l.isPresent(d)?"success":"",title:"ËÆæ‰∏∫Âà∞ËØæ",icon:"mdi-account-check",size:o.isMobile?"default":"small",variant:"text",onClick:u=>l.setPresent(d)},null,8,["color","size","onClick"]),s(y,{color:l.isAbsent(d)?"error":"",title:"ËÆæ‰∏∫ËØ∑ÂÅá",icon:"mdi-account-off",size:o.isMobile?"default":"small",variant:"text",onClick:u=>l.setAbsent(d)},null,8,["color","size","onClick"]),s(y,{color:l.isLate(d)?"warning":"",title:"ËÆæ‰∏∫ËøüÂà∞",icon:"mdi-clock-alert",size:o.isMobile?"default":"small",variant:"text",onClick:u=>l.setLate(d)},null,8,["color","size","onClick"]),s(y,{color:l.isExclude(d)?"grey":"",title:"ËÆæ‰∏∫‰∏çÂèÇ‰∏é",icon:"mdi-account-cancel",size:o.isMobile?"default":"small",variant:"text",onClick:u=>l.setExclude(d)},null,8,["color","size","onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(Ce,null,{default:a(()=>[s(fe,{cols:"12",md:"12"},{default:a(()=>[s(I,{class:"mb-4",color:"primary",variant:"tonal"},{default:a(()=>[s(z,null,{default:a(()=>[e[17]||(e[17]=r("div",{class:"text-subtitle-2 mb-2"},"ÊâπÈáèÊìç‰Ωú",-1)),r("div",ii,[s(y,{class:"flex-grow-1",color:"success","prepend-icon":"mdi-account-check",onClick:l.setAllPresent},{default:a(()=>[...e[13]||(e[13]=[c(" ÂÖ®ÈÉ®Âà∞ÈΩê ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"error","prepend-icon":"mdi-account-off",onClick:l.setAllAbsent},{default:a(()=>[...e[14]||(e[14]=[c(" ÂÖ®ÈÉ®ËØ∑ÂÅá ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"warning","prepend-icon":"mdi-clock-alert",onClick:l.setAllLate},{default:a(()=>[...e[15]||(e[15]=[c(" ÂÖ®ÈÉ®ËøüÂà∞ ",-1)])]),_:1},8,["onClick"]),s(y,{class:"flex-grow-1",color:"grey","prepend-icon":"mdi-account-cancel",onClick:l.setAllExclude},{default:a(()=>[...e[16]||(e[16]=[c(" ÂÖ®ÈÉ®‰∏çÂèÇ‰∏é ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(Ue),s(ue,null,{default:a(()=>[s(H),s(y,{color:"primary",onClick:e[6]||(e[6]=d=>t.$emit("save"))},{default:a(()=>[s(E,{start:""},{default:a(()=>[...e[18]||(e[18]=[c("mdi-content-save",-1)])]),_:1}),e[19]||(e[19]=c(" ‰øùÂ≠ò ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","fullscreen"])}const os=ie(Xa,[["render",li],["__scopeId","data-v-7f9de516"]]),oi={name:"HomeworkEditDialog",props:{modelValue:{type:Boolean,required:!0},title:{type:String,required:!0},initialContent:{type:String,default:""},autoSave:{type:Boolean,default:!1},isEditingPastData:{type:Boolean,default:!1},currentDateString:{type:String,default:""}},emits:["update:modelValue","save"],setup(){const{mobile:t}=Ye();return{isMobile:t}},data(){return{content:"",templateData:null,currentLine:"",currentLineStart:0,currentLineEnd:0,quickTexts:["ËØæ","È¢ò","‰æã","Âèò","T","P"]}},computed:{dialogVisible:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},subject(){return this.title},hasTemplates(){var t,e;return!!((e=(t=this.templateData)==null?void 0:t.actions)!=null&&e.length||this.subjectBooks||this.commonBooks)},subjectBooks(){var t,e,i;return!this.subject||!((i=(e=(t=this.templateData)==null?void 0:t.subjects)==null?void 0:e[this.subject])!=null&&i.books)?null:this.templateData.subjects[this.subject].books},commonBooks(){var t,e;return(e=(t=this.templateData)==null?void 0:t.commonSubject)!=null&&e.books?this.templateData.commonSubject.books:null},showQuickTools(){return _("display.showQuickTools")},autoSavePromptText(){return _("edit.autoSavePromptText")},manualSavePromptText(){return _("edit.manualSavePromptText")}},watch:{async modelValue(t){if(t){this.content=this.initialContent;try{this.templateData=await ce.loadData("classworks-config-homework-template")}catch(e){console.error("Failed to load homework templates:",e),this.templateData=null}this.$nextTick(()=>{this.$refs.inputRef&&(this.$refs.inputRef.focus(),this.updateCurrentLine())})}}},methods:{handleClose(){const t=this.content.trim();t!==this.initialContent.trim()&&this.$emit("save",t),this.dialogVisible=!1},updateCurrentLine(){const e=this.$refs.inputRef.$el.querySelector("textarea").selectionStart,i=this.content;let o=0;const n=i.split(`
`);for(let l=0;l<n.length;l++){const d=n[l].length,u=o+d;if(e<=u||l===n.length-1){this.currentLine=n[l],this.currentLineStart=o,this.currentLineEnd=u;break}o=u+1}this.currentLine||(this.currentLine="",this.currentLineStart=i.length,this.currentLineEnd=i.length)},isBookSelected(t){return this.currentLine.includes(t)},isPageSelected(t,e){return this.currentLine.includes(e)},handleBookClick(t){if(this.isBookSelected(t)){const e=this.content.split(`
`),i=e.findIndex(o=>o.includes(t));i!==-1&&(e.splice(i,1),this.content=e.join(`
`))}else{const e=this.content.trim().length>0;this.content=(e?this.content.trim()+`
`:"")+t}this.$nextTick(()=>{const e=this.$refs.inputRef.$el.querySelector("textarea");if(e.focus(),!this.isBookSelected(t)){const i=this.content.split(`
`);let o=0;for(let n=0;n<i.length;n++){if(i[n].includes(t)){o+=i[n].length;break}o+=i[n].length+1}e.setSelectionRange(o,o)}this.updateCurrentLine()})},handlePageClick(t,e){if(this.isPageSelected(t,e)){const i=this.currentLineStart,o=this.currentLineEnd,n=this.content.slice(i,o),l=n.lastIndexOf(e);if(l!==-1){const d=n.slice(0,l)+n.slice(l+e.length);this.content=this.content.slice(0,i)+d.trim()+this.content.slice(o)}}else{const i=this.currentLineStart,o=this.currentLineEnd,n=this.content.slice(i,o);this.content=this.content.slice(0,i)+n.trim()+(n.trim().length>0?" ":"")+e+this.content.slice(o)}this.$nextTick(()=>{const i=this.$refs.inputRef.$el.querySelector("textarea");i.focus();const o=this.content.split(`
`);let n=0;for(let l=0;l<o.length&&(n+=o[l].length,!(n>this.currentLineStart));l++)n+=1;i.setSelectionRange(n,n),this.updateCurrentLine()})},insertTemplate(t){const e=this.$refs.inputRef.$el.querySelector("textarea"),i=e.selectionStart,o=e.selectionEnd,n=i>0&&this.content[i-1]!==" "&&this.content[i-1]!==`
`;this.content=this.content.slice(0,i)+(n?" ":"")+t+this.content.slice(o),this.$nextTick(()=>{e.focus();const l=i+t.length+(n?1:0);e.setSelectionRange(l,l),this.updateCurrentLine()})},insertAtCursor(t){if(!t)return;const e=this.$refs.inputRef.$el.querySelector("textarea"),i=e.selectionStart,o=e.selectionEnd;this.content=this.content.slice(0,i)+t+this.content.slice(o),this.$nextTick(()=>{e.focus();const n=i+t.length;e.setSelectionRange(n,n),this.updateCurrentLine()})},deleteLastChar(){const t=this.$refs.inputRef.$el.querySelector("textarea"),e=t.selectionStart,i=t.selectionEnd;e===i?e>0&&(this.content=this.content.slice(0,e-1)+this.content.slice(e),this.$nextTick(()=>{t.focus(),t.setSelectionRange(e-1,e-1),this.updateCurrentLine()})):(this.content=this.content.slice(0,e)+this.content.slice(i),this.$nextTick(()=>{t.focus(),t.setSelectionRange(e,e),this.updateCurrentLine()}))}}},ri={class:"d-flex"},di={class:"flex-grow-1"},ui={key:0,class:"mt-4"},ci={key:0,class:"template-buttons"},mi={key:0,class:"pages-container mt-2"},fi={key:0,class:"pages-container mt-2"},hi={key:2,class:"button-group"},gi={key:1,class:"text-center text-body-2 text-disabled mt-2"},vi={key:0,class:"quick-tools ml-4",style:{"min-width":"180px"}},pi={class:"numeric-keypad mb-4"},yi={class:"keypad-row"},ki={class:"keypad-row"},bi={class:"keypad-row"},xi={class:"keypad-row"},wi={class:"keypad-row"},Si={class:"d-flex flex-wrap gap-1"},Ci={class:"d-flex flex-column"},Di={class:"text-body-2"};function _i(t,e,i,o,n,l){return m(),x(de,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=d=>l.dialogVisible=d),fullscreen:o.isMobile,"max-width":"900",width:"auto","onClick:outside":l.handleClose},{default:a(()=>[s(I,{border:""},{default:a(()=>[s(Z,{class:"d-flex align-center"},{default:a(()=>[c(g(i.title)+" ",1),s(H),s(y,{icon:"mdi-close",variant:"text",onClick:l.handleClose},null,8,["onClick"])]),_:1}),s(qt,null,{default:a(()=>[c(g(i.autoSave?l.autoSavePromptText:l.manualSavePromptText),1)]),_:1}),s(z,null,{default:a(()=>{var d;return[r("div",ri,[r("div",di,[s(Xe,{ref:"inputRef",modelValue:n.content,"onUpdate:modelValue":e[0]||(e[0]=u=>n.content=u),"auto-grow":"",placeholder:"‰ΩøÁî®Êç¢Ë°åË°®Á§∫ÂàÜÊù°",rows:"5",width:o.isMobile?"100%":"480",onClick:l.updateCurrentLine,onKeyup:l.updateCurrentLine},null,8,["modelValue","width","onClick","onKeyup"]),n.templateData?(m(),p("div",ui,[l.hasTemplates?(m(),p("div",ci,[l.subjectBooks?(m(!0),p(V,{key:0},R(l.subjectBooks,(u,f)=>(m(),p("div",{key:f,class:"button-group"},[s(G,{color:l.isBookSelected(f)?"success":"default",variant:l.isBookSelected(f)?"elevated":"flat",class:"ma-1 book-chip",onClick:h=>l.handleBookClick(f)},{default:a(()=>[c(g(f),1)]),_:2},1032,["color","variant","onClick"]),l.isBookSelected(f)?(m(),p("div",mi,[(m(!0),p(V,null,R(u,h=>(m(),x(G,{key:h,color:l.isPageSelected(f,h)?"info":"default",variant:l.isPageSelected(f,h)?"elevated":"flat",class:"ma-1",onClick:k=>l.handlePageClick(f,h)},{default:a(()=>[c(g(h),1)]),_:2},1032,["color","variant","onClick"]))),128))])):S("",!0)]))),128)):S("",!0),l.commonBooks?(m(!0),p(V,{key:1},R(l.commonBooks,(u,f)=>(m(),p("div",{key:f,class:"button-group"},[s(G,{color:l.isBookSelected(f)?"success":"default",variant:l.isBookSelected(f)?"elevated":"flat",class:"ma-1 book-chip",onClick:h=>l.handleBookClick(f)},{default:a(()=>[c(g(f),1)]),_:2},1032,["color","variant","onClick"]),l.isBookSelected(f)?(m(),p("div",fi,[(m(!0),p(V,null,R(u,h=>(m(),x(G,{key:h,color:l.isPageSelected(f,h)?"info":"default",variant:l.isPageSelected(f,h)?"elevated":"flat",class:"ma-1",onClick:k=>l.handlePageClick(f,h)},{default:a(()=>[c(g(h),1)]),_:2},1032,["color","variant","onClick"]))),128))])):S("",!0)]))),128)):S("",!0),(d=n.templateData.actions)!=null&&d.length?(m(),p("div",hi,[(m(!0),p(V,null,R(n.templateData.actions,u=>(m(),x(G,{key:u,class:"ma-1",color:"primary",variant:"flat",onClick:f=>l.insertTemplate(u)},{default:a(()=>[c(g(u),1)]),_:2},1032,["onClick"]))),128))])):S("",!0)])):(m(),p("div",gi," ÊöÇÊó†ÂèØÁî®ÁöÑÊ®°Êùø "))])):S("",!0)]),l.showQuickTools&&!o.isMobile?(m(),p("div",vi,[r("div",pi,[r("div",yi,[(m(),p(V,null,R(3,u=>s(y,{key:u,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>l.insertAtCursor(String(u))},{default:a(()=>[c(g(u),1)]),_:2},1032,["onClick"])),64))]),r("div",ki,[(m(),p(V,null,R(3,u=>s(y,{key:u,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>l.insertAtCursor(String(u+3))},{default:a(()=>[c(g(u+3),1)]),_:2},1032,["onClick"])),64))]),r("div",bi,[(m(),p(V,null,R(3,u=>s(y,{key:u,class:"keypad-btn",size:"small",variant:"tonal",onClick:f=>l.insertAtCursor(String(u+6))},{default:a(()=>[c(g(u+6),1)]),_:2},1032,["onClick"])),64))]),r("div",xi,[s(y,{class:"keypad-btn",size:"small",variant:"tonal",onClick:e[1]||(e[1]=u=>l.insertAtCursor("-"))},{default:a(()=>[...e[6]||(e[6]=[c(" - ",-1)])]),_:1}),s(y,{class:"keypad-btn",size:"small",variant:"tonal",onClick:e[2]||(e[2]=u=>l.insertAtCursor("0"))},{default:a(()=>[...e[7]||(e[7]=[c(" 0 ",-1)])]),_:1}),s(y,{class:"keypad-btn",color:"error",size:"small",variant:"tonal",onClick:l.deleteLastChar},{default:a(()=>[...e[8]||(e[8]=[c(" ‚Üê ",-1)])]),_:1},8,["onClick"])]),r("div",wi,[s(y,{class:"keypad-btn space-btn",size:"small",variant:"tonal",onClick:e[3]||(e[3]=u=>l.insertAtCursor(" "))},{default:a(()=>[...e[9]||(e[9]=[c(" Á©∫Ê†º ",-1)])]),_:1}),s(y,{class:"keypad-btn space-btn",size:"small",variant:"tonal",onClick:e[4]||(e[4]=u=>l.insertAtCursor(`
`))},{default:a(()=>[...e[10]||(e[10]=[c(" Êç¢Ë°å ",-1)])]),_:1})])]),r("div",Si,[(m(!0),p(V,null,R(n.quickTexts,u=>(m(),x(y,{key:u,size:"small",variant:"flat",onClick:f=>l.insertAtCursor(u)},{default:a(()=>[c(g(u),1)]),_:2},1032,["onClick"]))),128))])])):S("",!0)])]}),_:1}),i.isEditingPastData?(m(),x(Be,{key:0,type:"warning",variant:"tonal",class:"mx-4 mb-4",border:"start","border-color":"warning",prominent:""},{prepend:a(()=>[...e[11]||(e[11]=[])]),default:a(()=>[r("div",Ci,[e[12]||(e[12]=r("div",{class:"text-h6 mb-1"},"‰Ω†ÊâìÁÆó‰øÆÊîπÂéÜÂè≤Ôºü",-1)),r("div",Di," ËøôÊòØ "+g(new Date(i.currentDateString.slice(0,4),i.currentDateString.slice(4,6)-1,i.currentDateString.slice(6,8)).toLocaleDateString())+" ÁöÑ‰Ωú‰∏ö ‚Ä¢ ËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºåÁ°Æ‰øù‰∏ç‰ºöË¶ÜÁõñÈáçË¶ÅÊï∞ÊçÆ ",1)])]),_:1})):S("",!0),e[13]||(e[13]=r("div",{class:"text-center text-body-2 text-disabled mb-5"}," ÁÇπÂáªÁ©∫ÁôΩÂ§ÑÂÆåÊàêÁºñËæë ",-1))]),_:1})]),_:1},8,["modelValue","fullscreen","onClick:outside"])}const rs=ie(oi,[["render",_i],["__scopeId","data-v-b3e3018d"]]),Ti={name:"AttendanceSidebar",props:{studentList:{type:Array,required:!0},attendance:{type:Object,required:!0},isEditingDisabled:{type:Boolean,default:!1}},emits:["click","disabled-click"],setup(){return{display:Ye()}},methods:{handleClick(){this.isEditingDisabled?this.$emit("disabled-click"):this.$emit("click")}}},Ii={style:{"white-space":"nowrap"}},Ei={style:{"white-space":"nowrap"}},Vi={style:{"white-space":"nowrap"}},Ni={key:0},Ai={style:{"white-space":"nowrap"}},Ui={style:{"white-space":"nowrap"}},zi={key:0},Pi={style:{"white-space":"nowrap"}},Fi={style:{"white-space":"nowrap"}},Mi={key:0},$i={style:{"white-space":"nowrap"}};function Ri(t,e,i,o,n,l){return i.studentList&&i.studentList.length?ve((m(),x(fe,{key:0,class:De([{"cursor-not-allowed":i.isEditingDisabled},"attendance-area no-select"]),cols:"1",onClick:l.handleClick},{default:a(()=>[e[10]||(e[10]=r("h1",null,"Âá∫Âã§",-1)),r("h2",null,[e[0]||(e[0]=r("span",{style:{"white-space":"nowrap"}}," Â∫îÂà∞",-1)),e[1]||(e[1]=c(" : ",-1)),r("span",Ii,g(i.studentList.length-i.attendance.exclude.length)+"‰∫∫ ",1)]),r("h2",null,[e[2]||(e[2]=r("span",{style:{"white-space":"nowrap"}}," ÂÆûÂà∞",-1)),e[3]||(e[3]=c(" : ",-1)),r("span",Ei,g(i.studentList.length-i.attendance.absent.length-i.attendance.late.length-i.attendance.exclude.length)+"‰∫∫ ",1)]),r("h2",null,[e[4]||(e[4]=r("span",{style:{"white-space":"nowrap"}}," ËØ∑ÂÅá",-1)),e[5]||(e[5]=c(" : ",-1)),r("span",Vi,g(i.attendance.absent.length)+"‰∫∫ ",1)]),(m(!0),p(V,null,R(i.attendance.absent,(d,u)=>(m(),p("h3",{key:"absent-"+u,class:"gray-text"},[o.display.lgAndUp.value?(m(),p("span",Ni,g(`${u+1}. `),1)):S("",!0),r("span",Ai,g(d),1)]))),128)),r("h2",null,[e[6]||(e[6]=r("span",{style:{"white-space":"nowrap"}},"ËøüÂà∞",-1)),e[7]||(e[7]=c(" : ",-1)),r("span",Ui,g(i.attendance.late.length)+"‰∫∫ ",1)]),(m(!0),p(V,null,R(i.attendance.late,(d,u)=>(m(),p("h3",{key:"late-"+u,class:"gray-text"},[o.display.lgAndUp.value?(m(),p("span",zi,g(`${u+1}. `),1)):S("",!0),r("span",Pi,g(d),1)]))),128)),r("h2",null,[e[8]||(e[8]=r("span",{style:{"white-space":"nowrap"}},"‰∏çÂèÇ‰∏é",-1)),e[9]||(e[9]=c(" : ",-1)),r("span",Fi,g(i.attendance.exclude.length)+"‰∫∫ ",1)]),(m(!0),p(V,null,R(i.attendance.exclude,(d,u)=>(m(),p("h3",{key:"exclude-"+u,class:"gray-text"},[o.display.lgAndUp.value?(m(),p("span",Mi,g(`${u+1}. `),1)):S("",!0),r("span",$i,g(d),1)]))),128))]),_:1},8,["class","onClick"])),[[Le,i.isEditingDisabled?!1:{class:`text-${["primary","secondary","info","success","warning","error"][Math.floor(Math.random()*6)]}`}]]):S("",!0)}const ds=ie(Ti,[["render",Ri],["__scopeId","data-v-8dbe204a"]]),Li={class:"d-flex flex-no-wrap justify-space-between"},Oi={class:"pe-4"},Bi={class:"mb-3"},us={__name:"PwaInstallCard",setup(t){const e=L(!1),i=L(!1),o=L(!1),n=Tt({title:"",message:"",links:[]}),l={pending:"ÂæÖÊéàÊùÉ",granted:"Â∑≤ÂÆåÊàê",denied:"Â∑≤ÊãíÁªù",unavailable:"‰∏çÂèØÁî®"},d={pending:"mdi-progress-clock",granted:"mdi-check-circle",denied:"mdi-close-circle",unavailable:"mdi-help-circle"},u={pending:"primary",granted:"success",denied:"error",unavailable:"surface-variant"},f=Tt({pwa:{label:"ÂÆâË£ÖÂ∫îÁî®",description:"Â∞ÜÁΩëÁ´ôÂÆâË£Ö‰∏∫Áã¨Á´ãÂ∫îÁî®Ôºå‰æø‰∫éÂø´ÈÄüÂêØÂä®",status:"pending"},notification:{label:"ÈÄöÁü•ÊùÉÈôê",description:"ÂÖÅËÆ∏Êé•Êî∂‰Ωú‰∏ö„ÄÅËÄÉËØïÁ≠âÈÄöÁü•ÊèêÈÜí",status:"pending"},storage:{label:"Á¶ªÁ∫øÂ≠òÂÇ®",description:"ÂêØÁî®ÊåÅ‰πÖÂåñÂ≠òÂÇ®‰ª•Ëé∑ÂæóÊõ¥Á®≥ÂÅ•ÁöÑÁ¶ªÁ∫ø‰ΩìÈ™å",status:"pending"}}),h=K(()=>[{key:"pwa",...f.pwa},{key:"notification",...f.notification},{key:"storage",...f.storage}]),k=K(()=>h.value.some(b=>b.status==="pending")),C={pwa:[{text:"MDN - ÂÆâË£Ö PWA ÊåáÂçó",desc:"Ê£ÄÊü•ÊµèËßàÂô®ÊòØÂê¶ÊîØÊåÅÂπ∂ÊâãÂä®Ëß¶ÂèëÂÆâË£Ö",href:"https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps/Guides/Installing"},{text:"Microsoft Edge - PWA ‰ΩìÈ™å",desc:"Edge ÊµèËßàÂô®ÂÆâË£Ö‰∏é UX ËØ¥Êòé",href:"https://learn.microsoft.com/zh-cn/microsoft-edge/progressive-web-apps/ux"}],notification:[{text:"MDN - ÈÄöÁü•ÊùÉÈôê‰∏éÁî®Ê≥ï",desc:"ÊµèËßàÂô®ÈÄöÁü•ÊùÉÈôêÁöÑÂ∑•‰ΩúÊñπÂºè‰∏éË∞ÉËØï",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/notification"}],storage:[{text:"MDN - Storage ÊåÅ‰πÖÂåñËØ¥Êòé",desc:"‰∫ÜËß£ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÁöÑÂèØÁî®ÊÄß‰∏éÁî≥ËØ∑ÊñπÂºè",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/persist"}]};let B;const Q=async()=>{var q;if(_("pwa.hideInstallCard")){e.value=!1;return}if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0?f.pwa.status="granted":(window.deferredPwaPrompt,f.pwa.status="pending"),typeof Notification>"u")f.notification.status="unavailable";else{const he=Notification.permission;f.notification.status=he==="granted"?"granted":he==="denied"?"denied":"pending"}if((q=navigator.storage)!=null&&q.persisted){const he=await navigator.storage.persisted();f.storage.status=he?"granted":"pending"}else f.storage.status="unavailable";const O=h.value.some(he=>he.status!=="granted");e.value=O},A=async()=>{const b=window.deferredPwaPrompt;if(!b){f.pwa.status="pending",U("pwa","ÊµèËßàÂô®Ê≤°ÊúâÊèê‰æõÂÆâË£ÖÊèêÁ§∫ÔºåÂèØÊåâÊñáÊ°£ÊâãÂä®ÂÆâË£Ö„ÄÇ");return}b.prompt();const{outcome:N}=await b.userChoice;f.pwa.status=N==="accepted"?"granted":"denied",N!=="accepted"&&U("pwa","Â¶ÇÊûúÊú™Âá∫Áé∞ÂÆâË£ÖÂºπÁ™óÔºåÊàñË¢´ÊãíÁªùÔºåËØ∑ÊåâËØ¥ÊòéÊâãÂä®ÂÆâË£Ö„ÄÇ"),window.deferredPwaPrompt=null},Y=async()=>{if(typeof Notification>"u"){f.notification.status="unavailable",U("notification","ÂΩìÂâçÁéØÂ¢É‰∏çÊîØÊåÅÈÄöÁü• APIÔºåÂèØÊü•ÁúãËØ¥ÊòéÊâãÂä®ÂºÄÂêØÊàñÊõ¥Êç¢ÊµèËßàÂô®„ÄÇ");return}const b=await zs();f.notification.status=b?"granted":"denied",b||U("notification","ÈÄöÁü•ËØ∑Ê±ÇÊú™Ë¢´Êéà‰∫àÔºåËØ∑ÊåâËØ¥ÊòéÊ£ÄÊü•ÊµèËßàÂô®ÊàñÁ≥ªÁªüËÆæÁΩÆ„ÄÇ")},ae=async()=>{var N;if(!((N=navigator.storage)!=null&&N.persist)){f.storage.status="unavailable",U("storage","ÂΩìÂâçÊµèËßàÂô®‰∏çÊîØÊåÅÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºåÂèØÊü•ÁúãËØ¥ÊòéÊàñÊõ¥Êç¢ÊµèËßàÂô®„ÄÇ");return}const b=await Ps();f.storage.status=b?"granted":"denied",b||U("storage","Êú™ËÉΩÂêØÁî®ÊåÅ‰πÖÂåñÂ≠òÂÇ®ÔºåÂèØÊåâËØ¥ÊòéÊ£ÄÊü•ÊµèËßàÂô®ÊàñÁ≥ªÁªüËÆæÁΩÆ„ÄÇ")},xe=async()=>{if(!(!k.value||i.value)){i.value=!0;try{await A(),await Y(),await ae()}finally{i.value=!1,await Q()}}},we=async b=>{if(!i.value){i.value=!0;try{b==="pwa"?await A():b==="notification"?await Y():b==="storage"&&await ae()}finally{i.value=!1,await Q()}}},U=(b,N="")=>{b==="pwa"?n.title="Â¶Ç‰ΩïÂÆâË£Ö‰∏∫Â∫îÁî®":b==="notification"?n.title="Â¶Ç‰ΩïÂºÄÂêØÈÄöÁü•":n.title="Â¶Ç‰ΩïÂêØÁî®Á¶ªÁ∫øÂ≠òÂÇ®",n.message=N||"Êü•Áúã‰ª•‰∏ãÊ≠•È™§Ëé∑ÂèñÊõ¥Â§öËØ¥Êòé„ÄÇ",n.links=C[b]||[],o.value=!0},te=()=>{be("pwa.hideInstallCard",!0),e.value=!1},D=()=>{f.pwa.status!=="granted"&&(f.pwa.status="pending"),Q()},P=()=>{Q()};return gt(()=>{Q(),window.addEventListener("pwa-prompt-ready",D),B=window.matchMedia("(display-mode: standalone)"),B.addEventListener("change",P)}),Us(()=>{window.removeEventListener("pwa-prompt-ready",D),B&&B.removeEventListener("change",P)}),(b,N)=>e.value?(m(),x(I,{key:0,class:"mb-4",color:"surface-variant",variant:"tonal"},{default:a(()=>[r("div",Li,[r("div",Oi,[s(Z,{class:"text-h6"},{default:a(()=>[...N[2]||(N[2]=[c(" ÂÆâË£ÖÂ∫îÁî®‰∏éÊéàÊùÉ ",-1)])]),_:1}),s(qt,{class:"pb-1"},{default:a(()=>[...N[3]||(N[3]=[c(" ÊâãÂä®ÁÇπÈÄâ‰∏ãÊñπÈ°πÁõÆËØ∑Ê±ÇÂÆâË£ÖÂíåÊùÉÈôêÔºå‰πüÂèØ‰ª•Áõ¥Êé•ÂÖ≥Èó≠ ",-1)])]),_:1}),s(z,{class:"pt-0 pb-1"},{default:a(()=>[s($e,{density:"comfortable",lines:"two"},{default:a(()=>[(m(!0),p(V,null,R(h.value,O=>(m(),x(Pe,{key:O.key,disabled:i.value,onClick:()=>we(O.key)},{prepend:a(()=>[s(Oe,{color:u[O.status],size:"32",variant:"tonal"},{default:a(()=>[s(E,{icon:d[O.status]},null,8,["icon"])]),_:2},1032,["color"])]),append:a(()=>[s(G,{color:u[O.status],size:"small",variant:"tonal",class:"me-2"},{default:a(()=>[c(g(l[O.status]),1)]),_:2},1032,["color"]),s(y,{variant:"text",icon:"mdi-information",size:"small",disabled:i.value,onClick:ct(()=>U(O.key),["stop"])},null,8,["disabled","onClick"])]),default:a(()=>[s(st,null,{default:a(()=>[c(g(O.label),1)]),_:2},1024),s(nt,null,{default:a(()=>[c(g(O.description),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"]))),128))]),_:1})]),_:1}),s(ue,null,{default:a(()=>[s(y,{class:"ms-2",variant:"outlined",size:"small",onClick:te},{default:a(()=>[...N[4]||(N[4]=[c(" ÂÖ≥Èó≠ ",-1)])]),_:1}),s(y,{class:"ms-2",variant:"elevated",color:"primary",size:"small","prepend-icon":i.value?"mdi-timer-sand":"mdi-shield-check",disabled:!k.value||i.value,onClick:xe},{default:a(()=>[c(g(i.value?"Â§ÑÁêÜ‰∏≠":"‰∏ÄÊ¨°Â§ÑÁêÜÂÖ®ÈÉ®"),1)]),_:1},8,["prepend-icon","disabled"])]),_:1})]),s(Oe,{class:"ma-3",size:"100",rounded:"0"},{default:a(()=>[s(E,{icon:"mdi-monitor-cellphone",size:"80"})]),_:1})]),s(de,{modelValue:o.value,"onUpdate:modelValue":N[1]||(N[1]=O=>o.value=O),"max-width":"520"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"text-h6"},{default:a(()=>[c(g(n.title),1)]),_:1}),s(z,null,{default:a(()=>[r("p",Bi,g(n.message),1),s($e,{density:"comfortable"},{default:a(()=>[(m(!0),p(V,null,R(n.links,(O,q)=>(m(),x(Pe,{key:q,href:O.href,target:"_blank",rel:"noopener"},{default:a(()=>[s(st,null,{default:a(()=>[c(g(O.text),1)]),_:2},1024),s(nt,null,{default:a(()=>[c(g(O.desc),1)]),_:2},1024)]),_:2},1032,["href"]))),128))]),_:1})]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{variant:"text",onClick:N[0]||(N[0]=O=>o.value=!1)},{default:a(()=>[...N[5]||(N[5]=[c("ÊàëÁü•ÈÅì‰∫Ü",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):S("",!0)}},ji={name:"HomeActions",props:{synced:Boolean,loadingUpload:Boolean,showRandomPickerButton:Boolean,showExamScheduleButton:Boolean,showListCardButton:Boolean,showFullscreenButton:Boolean,isFullscreen:Boolean,showAntiScreenBurnCard:Boolean,showTestCardButton:Boolean},emits:["upload","show-sync-message","open-random-picker","toggle-fullscreen","add-test-card"]},Hi={class:"d-flex flex-wrap align-center mt-4"};function Ki(t,e,i,o,n,l){return m(),p(V,null,[r("div",Hi,[i.synced?(m(),x(y,{key:1,color:"success",size:"large",onClick:e[1]||(e[1]=d=>t.$emit("show-sync-message"))},{default:a(()=>[...e[9]||(e[9]=[c(" ÂêåÊ≠•ÂÆåÊàê ",-1)])]),_:1})):(m(),x(y,{key:0,loading:i.loadingUpload,class:"ml-2",color:"error",size:"large",onClick:e[0]||(e[0]=d=>t.$emit("upload"))},{default:a(()=>[...e[8]||(e[8]=[c(" ‰∏ä‰º† ",-1)])]),_:1},8,["loading"])),i.showRandomPickerButton?(m(),x(y,{key:2,"append-icon":"mdi-dice-multiple",class:"ml-2",color:"amber","prepend-icon":"mdi-account-question",size:"large",onClick:e[2]||(e[2]=d=>t.$emit("open-random-picker"))},{default:a(()=>[...e[10]||(e[10]=[c(" ÈöèÊú∫ÁÇπÂêç ",-1)])]),_:1})):S("",!0),i.showExamScheduleButton?(m(),x(ht,{key:3,class:"ml-2",color:"green",variant:"elevated",divided:""},{default:a(()=>[s(y,{"prepend-icon":"mdi-calendar-check",size:"large",onClick:e[3]||(e[3]=d=>t.$router.push("/examschedule"))},{default:a(()=>[...e[11]||(e[11]=[c(" ËÄÉËØïÁúãÊùø ",-1)])]),_:1}),s(y,{icon:"mdi-plus",size:"large",onClick:e[4]||(e[4]=d=>t.$emit("add-exam-card"))})]),_:1})):S("",!0),i.showListCardButton?(m(),x(y,{key:4,class:"ml-2",color:"primary-darken-1","prepend-icon":"mdi-list-box",size:"large",onClick:e[5]||(e[5]=d=>t.$router.push("/list"))},{default:a(()=>[...e[12]||(e[12]=[c(" ÂàóË°® ",-1)])]),_:1})):S("",!0),i.showFullscreenButton?(m(),x(y,{key:5,color:i.isFullscreen?"blue-grey":"blue","prepend-icon":i.isFullscreen?"mdi-fullscreen-exit":"mdi-fullscreen",class:"ml-2",size:"large",onClick:e[6]||(e[6]=d=>t.$emit("toggle-fullscreen"))},{default:a(()=>[c(g(i.isFullscreen?"ÈÄÄÂá∫ÂÖ®Â±è":"ÂÖ®Â±èÊòæÁ§∫"),1)]),_:1},8,["color","prepend-icon"])):S("",!0),i.showTestCardButton?(m(),x(y,{key:6,class:"ml-2",color:"purple","prepend-icon":"mdi-test-tube",size:"large",onClick:e[7]||(e[7]=d=>t.$emit("add-test-card"))},{default:a(()=>[...e[13]||(e[13]=[c(" Ê∑ªÂä†ÊµãËØïÂç°Áâá ",-1)])]),_:1})):S("",!0)]),i.showAntiScreenBurnCard?(m(),x(I,{key:0,border:"",class:"mt-4 anti-burn-card",color:"primary",variant:"tonal"},{default:a(()=>[s(Z,{class:"text-subtitle-1"},{default:a(()=>[s(E,{icon:"mdi-shield-check",size:"small",start:""}),e[14]||(e[14]=c(" Â±èÂπï‰øùÊä§ÊäÄÊúØÂ∑≤ÂêØÁî® ",-1))]),_:1}),s(z,{class:"text-body-2"},{default:a(()=>[...e[15]||(e[15]=[r("p",null," ‰∏∫Èò≤Ê≠¢OLED/LCDÂ±èÂπïÁÉßÂ±èÔºåÁïåÈù¢ÂÖÉÁ¥†‰ºöÂÆöÊúüÂæÆË∞É‰ΩçÁΩÆ„ÄÇ ",-1),r("p",{class:"text-caption text-grey"}," Ê≠§ÂäüËÉΩ‰∏ç‰ºöÂΩ±ÂìçÊ≠£Â∏∏‰ΩøÁî®Ôºå‰ªÖÂú®ÈïøÊó∂Èó¥ÈùôÊ≠¢ÊòæÁ§∫Êó∂ÁîüÊïà„ÄÇ ",-1),r("p",{class:"text-caption text-grey"}," Âª∫ËÆÆÂú®ÊîæÂ≠¶ÂêéÂÖ≥Èó≠ÊòæÁ§∫Âô®‰ª•ËäÇÁ∫¶ËÉΩÊ∫ê„ÄÇ ",-1)])]),_:1})]),_:1})):S("",!0)],64)}const cs=ie(ji,[["render",Ki]]),qi={name:"RelativeTimeDisplay",props:{time:{type:[String,Date,Number],required:!0}},computed:{displayTime(){if(!this.time)return"";const t=new Date(this.time),e=new Date,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=i.getTime()-o.getTime(),l=Math.round(n/(1e3*60*60*24));if(l===0)return"‰ªäÂ§©";if(l===1)return"ÊòéÂ§©";if(l===2)return"ÂêéÂ§©";if(l===-1)return"Êò®Â§©";if(l===-2)return"ÂâçÂ§©";const d=o.getDay()||7,u=new Date(o);u.setDate(o.getDate()-d+1);const f=new Date(o);if(f.setDate(o.getDate()+(7-d)),i>=u&&i<=f)return["Âë®Êó•","Âë®‰∏Ä","Âë®‰∫å","Âë®‰∏â","Âë®Âõõ","Âë®‰∫î","Âë®ÂÖ≠"][t.getDay()];const h=t.getMonth()+1,k=t.getDate();return`${h}Êúà${k}Êó•`}}};function Wi(t,e,i,o,n,l){return m(),p("span",null,g(l.displayTime),1)}const ms=ie(qi,[["render",Wi]]),Ze=Fs("exam",{state:()=>({examList:[],exams:{},loadingList:!1,loadingDetails:{}}),actions:{async fetchExamList(){if(!this.loadingList){this.loadingList=!0;try{const t=await ce.loadData("es_list");Array.isArray(t)?this.examList=t:this.examList=[]}catch(t){console.error("Failed to load exam list:",t)}finally{this.loadingList=!1}}},async fetchExam(t){if(this.exams[t])return this.exams[t];if(!this.loadingDetails[t]){this.loadingDetails[t]=!0;try{const e=await ce.loadData(`es_${t}`);return e&&(this.exams[t]=e),e}catch(e){console.error(`Failed to load exam details for ${t}:`,e)}finally{this.loadingDetails[t]=!1}}},async getUpcomingExams(t=25){await this.fetchExamList();const e=[],i=new Date,o=new Date(i.getTime()+2*24*60*60*1e3),n=this.examList.slice(0,t);for(const l of n){let d=this.exams[l.id];d||(d=await this.fetchExam(l.id)),d&&d.examInfos&&Array.isArray(d.examInfos)&&d.examInfos.some(f=>{const h=new Date(f.start);return h>=i&&h<=o})&&e.push({id:l.id,...d})}return e}}}),Gi={name:"ConciseExamCard",components:{RelativeTimeDisplay:ms},props:{examId:{type:String,required:!0},contentStyle:{type:Object,default:()=>({})},readonly:{type:Boolean,default:!1}},computed:{...Gt(Ze,["exams","loadingDetails"]),exam(){return this.exams[this.examId]},loading(){return this.loadingDetails[this.examId]},groupedExamInfos(){if(!this.exam||!this.exam.examInfos)return[];const t=[...this.exam.examInfos].sort((o,n)=>new Date(o.start)-new Date(n.start)),e=[];let i=null;return t.forEach(o=>{const l=new Date(o.start).toDateString();(!i||i.key!==l)&&(i={key:l,date:o.start,infos:[]},e.push(i)),i.infos.push(o)}),e}},mounted(){this.fetchExam(this.examId)},methods:{...Wt(Ze,["fetchExam"]),formatTimeOnly(t){if(!t)return"";try{const e=new Date(t),i=e.getHours().toString().padStart(2,"0"),o=e.getMinutes().toString().padStart(2,"0");return`${i}:${o}`}catch{return""}},isPast(t){return t?new Date(t)<new Date:!1}}},Qi={class:"text-truncate"},Ji={key:0,class:"d-flex justify-center align-center py-4"},Yi={key:1,class:"d-flex flex-column"},Xi={class:"text-subtitle-2 font-weight-bold text-primary mb-1"},Zi={class:"font-weight-bold mr-2",style:{"font-size":"1.1em"}},el={class:"font-weight-medium text-grey-darken-2",style:{"font-size":"0.85em"}},tl={key:2,class:"text-center text-caption text-grey py-2"};function sl(t,e,i,o,n,l){const d=ms;return m(),x(I,{border:"",class:"fill-height d-flex flex-column cursor-pointer hover-elevation",elevation:"0",onClick:e[0]||(e[0]=u=>t.$emit("click"))},{default:a(()=>[s(Z,{class:"d-flex align-center py-2 px-3 bg-primary-lighten-5 text-subtitle-1 font-weight-bold"},{default:a(()=>{var u;return[r("span",Qi,g(((u=l.exam)==null?void 0:u.examName)||"Âä†ËΩΩ‰∏≠..."),1)]}),_:1}),s(z,{class:"flex-grow-1 pa-4 overflow-y-auto",style:_e(i.contentStyle)},{default:a(()=>[l.loading?(m(),p("div",Ji,[s(Qt,{indeterminate:"",size:"24",color:"primary"})])):l.exam?(m(),p("div",Yi,[(m(!0),p(V,null,R(l.groupedExamInfos,(u,f)=>(m(),p("div",{key:f,class:"mb-3"},[r("div",Xi,[s(d,{time:u.date},null,8,["time"])]),(m(!0),p(V,null,R(u.infos,(h,k)=>(m(),p("div",{key:k,class:De(["d-flex align-center justify-space-between py-1 border-b-sm",{"border-none":k===u.infos.length-1,"text-grey":l.isPast(h.end)}])},[r("div",Zi,g(h.name),1),r("div",el,g(l.formatTimeOnly(h.start))+" - "+g(l.formatTimeOnly(h.end)),1)],2))),128))]))),128))])):(m(),p("div",tl,"Êó†Ê≥ïÂä†ËΩΩ"))]),_:1},8,["style"])]),_:1})}const fs=ie(Gi,[["render",sl],["__scopeId","data-v-33424f55"]]),nl=["6IO4","5Lmz","6JCd6I6J","5rer","5aW4"],al=nl.map(t=>Zt.decode(t)),Bt=.75,il={name:"HitokotoCard",data(){return{enabled:!1,refreshInterval:60,kvConfig:{sources:["zhaoyu"],sensitiveWords:[]},sentence:"",author:"",origin:"",loading:!1,timer:null,unwatch:null,fontSize:28}},computed:{contentStyle(){return{"font-size":`${this.fontSize*Bt}px`,"white-space":"pre-wrap","line-height":"1.6","text-align":"left"}},authorStyle(){return{"font-size":`${this.fontSize*Bt*.6}px`,"text-align":"left"}}},async mounted(){this.loadLocalSettings(),await this.loadKvSettings(),this.fetchSentence(),this.startTimer(),this.unwatch=vt(()=>{this.loadLocalSettings(),this.startTimer()})},beforeUnmount(){this.stopTimer(),this.unwatch&&this.unwatch()},methods:{loadLocalSettings(){this.enabled=lt.getSetting("hitokoto.enabled"),this.refreshInterval=lt.getSetting("hitokoto.refreshInterval"),this.fontSize=lt.getSetting("font.size")},async loadKvSettings(){try{const t=await ce.loadData("sentence-info");let e=t;t&&t.data&&(e=t.data),e&&(this.kvConfig={sources:Array.isArray(e.sources)&&e.sources.length>0?e.sources:["zhaoyu"],sensitiveWords:e.sensitiveWords?e.sensitiveWords.split(/[,Ôºå]/).map(i=>i.trim()).filter(i=>i):[],jinrishiciToken:e.jinrishiciToken})}catch(t){console.error("Failed to load sentence-info",t)}},startTimer(){this.timer&&clearInterval(this.timer),this.refreshInterval>0&&(this.timer=setInterval(this.fetchSentence,this.refreshInterval*1e3))},stopTimer(){this.timer&&clearInterval(this.timer)},async fetchSentence(){if(!this.loading){this.loading=!0;try{const t=this.kvConfig.sources,e=t[Math.floor(Math.random()*t.length)];let i=null,o="",n="",l="";if(e==="hitokoto")i=(await ot.get("https://v1.hitokoto.cn/")).data,o=i.hitokoto,n=i.from_who,l=i.from;else if(e==="zhaoyu"){const d=await ot.get("https://hub.saintic.com/openservice/sentence/all.json");d.data.success&&(i=d.data.data,o=i.sentence||i.content||i.name,n=i.author,l=i.name||i.origin)}else if(e==="jinrishici")if(this.kvConfig.jinrishiciToken){const d=await ot.get("https://v2.jinrishici.com/one.json?client=npm-sdk/1.0&X-User-Token="+encodeURIComponent(this.kvConfig.jinrishiciToken),{});d.data.status==="success"&&(i=d.data.data,o=i.content,n=i.origin.author,l=i.origin.title)}else return console.warn("Jinrishici token missing. Please enable it in settings to generate a token."),this.loading=!1,this.fetchSentence();if(o){if([...al,...this.kvConfig.sensitiveWords].some(f=>f&&o.includes(f)))return this.loading=!1,this.fetchSentence();this.sentence=o,this.author=n||"",this.origin=l||"Êú™Áü•"}}catch(t){console.error("Failed to fetch sentence",t),this.sentence="Ëé∑ÂèñÂ§±Ë¥•",this.author="",this.origin=""}finally{this.loading=!1}}}}},ll={key:0,class:"mr-2"},ol={key:1};function rl(t,e,i,o,n,l){return m(),x(I,{class:"hitokoto-card",elevation:"2",border:"",rounded:"xl",loading:n.loading,height:"100%",onClick:l.fetchSentence},{default:a(()=>[s(z,{class:"pa-6 d-flex flex-column justify-center",style:{height:"100%"}},{default:a(()=>[r("div",{class:"font-weight-medium mb-4 serif-font",style:_e(l.contentStyle)},g(n.sentence),5),r("div",{class:"text-medium-emphasis serif-font",style:_e(l.authorStyle)},[n.author?(m(),p("span",ll,g(n.author),1)):S("",!0),n.origin?(m(),p("span",ol,"„Ää"+g(n.origin)+"„Äã",1)):S("",!0)],4)]),_:1})]),_:1},8,["loading","onClick"])}const hs=ie(il,[["render",rl],["__scopeId","data-v-de957b7d"]]),dl={name:"HomeworkGrid",components:{HitokotoCard:hs,ConciseExamCard:fs},props:{sortedItems:{type:Array,required:!0},unusedSubjects:{type:Array,required:!0},emptySubjectDisplay:{type:String,default:"button"},isMobile:{type:Boolean,default:!1},isEditingDisabled:{type:Boolean,default:!1},contentStyle:{type:Object,default:()=>({})},highlightedCards:{type:Object,default:()=>({})}},emits:["open-dialog","open-attendance","disabled-click"],data(){return{isReadOnlyToken:!1}},async mounted(){this.resizeObserver=new ResizeObserver(()=>{this.resizeAllGridItems()}),this.$refs.gridContainer&&this.resizeObserver.observe(this.$refs.gridContainer),this.$nextTick(()=>{this.resizeAllGridItems(),this.$refs.items&&this.$refs.items.forEach(t=>{t.firstElementChild&&this.resizeObserver.observe(t.firstElementChild)})}),await this.checkReadOnlyStatus()},updated(){this.$nextTick(()=>{this.resizeAllGridItems(),this.$refs.items&&this.$refs.items.forEach(t=>{t.firstElementChild&&this.resizeObserver.observe(t.firstElementChild)})})},beforeUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{async checkReadOnlyStatus(){try{let t=null;if(this.$parent&&this.$parent.$refs&&this.$parent.$refs.studentNameManager?t=this.$parent.$refs.studentNameManager:this.$root&&this.$root.$refs&&this.$root.$refs.studentNameManager&&(t=this.$root.$refs.studentNameManager),t&&typeof t.isReadOnly<"u")this.isReadOnlyToken=t.isReadOnly;else{const{getSetting:e}=await It(async()=>{const{getSetting:o}=await import("./index-1qA4vOSi.js").then(n=>n.cL);return{getSetting:o}},__vite__mapDeps([0,1]),import.meta.url),i=e("server.kvToken");if(i){const{default:o}=await It(async()=>{const{default:l}=await import("./dataProvider-CQZWL-q1.js").then(d=>d.e);return{default:l}},__vite__mapDeps([2,0,1]),import.meta.url),n=e("server.domain");if(n)try{const l=await o.get(`${n}/kv/_token`,{headers:{Authorization:`Bearer ${i}`}});l.data&&typeof l.data.isReadOnly<"u"&&(this.isReadOnlyToken=l.data.isReadOnly)}catch(l){console.error("Ëé∑ÂèñToken‰ø°ÊÅØÂ§±Ë¥•:",l)}}}}catch(t){console.error("Ê£ÄÊü•Âè™ËØªÁä∂ÊÄÅÂ§±Ë¥•:",t)}},resizeGridItem(t){const e=this.$refs.gridContainer;if(!e)return;const i=parseInt(window.getComputedStyle(e).getPropertyValue("grid-auto-rows")),o=parseInt(window.getComputedStyle(e).getPropertyValue("gap")),n=t.firstElementChild;if(!n)return;const l=n.getBoundingClientRect().height,d=Math.ceil((l+o)/(i+o));t.style.gridRowEnd=`span ${d}`},resizeAllGridItems(){const t=this.$refs.items;t&&t.forEach(e=>this.resizeGridItem(e))},handleCardClick(t,e){if(this.isEditingDisabled){this.$emit("disabled-click");return}t==="attendance"?this.$emit("open-attendance"):t==="dialog"&&this.$emit("open-dialog",e)},splitPoint(t){return t.split(`
`).filter(e=>e.trim())},handleMouseMove(t){const e=t.currentTarget,i=e.getBoundingClientRect(),o=(t.clientX-i.left)/i.width*100,n=(t.clientY-i.top)/i.height*100;e.style.setProperty("--x",`${o}%`),e.style.setProperty("--y",`${n}%`)},handleTouchMove(t){if(t.touches.length===1){const e=t.touches[0],i=t.currentTarget,o=i.getBoundingClientRect(),n=(e.clientX-o.left)/o.width*100,l=(e.clientY-o.top)/o.height*100;i.style.setProperty("--x",`${n}%`),i.style.setProperty("--y",`${l}%`)}}}},ul={ref:"gridContainer",class:"grid-masonry"},cl=["data-key"],ml={key:0,style:{height:"100%"}},fl={key:1,style:{height:"100%"}},hl={class:"d-flex justify-space-between align-center mb-2"},gl={class:"text-h6"},vl={key:0,class:"mb-2"},pl={class:"text-error text-caption mb-1"},yl={class:"d-flex flex-wrap",style:{gap:"4px"}},kl={key:1,class:"mb-2"},bl={class:"text-warning text-caption mb-1"},xl={class:"d-flex flex-wrap",style:{gap:"4px"}},wl={key:2,class:"mb-2"},Sl={class:"text-grey text-caption mb-1"},Cl={class:"d-flex flex-wrap",style:{gap:"4px"}},Dl={key:3,class:"text-success text-center mt-2"},_l={class:"empty-subjects mt-4"},Tl={key:0,class:"d-flex flex-wrap justify-center"},Il={key:2,class:"empty-subjects-grid"};function El(t,e,i,o,n,l){const d=hs,u=fs;return m(),p(V,null,[r("div",ul,[s(ut,{name:"grid"},{default:a(()=>[(m(!0),p(V,null,R(i.sortedItems,f=>(m(),p("div",{key:f.key,ref_for:!0,ref:"items","data-key":f.key,style:_e({order:f.order}),class:"grid-item"},[f.type==="hitokoto"?(m(),p("div",ml,[s(d)])):f.type==="exam"?(m(),p("div",fl,[s(u,{"exam-id":f.data.examId,"content-style":i.contentStyle,onClick:h=>t.$emit("open-exam-detail",f.data.examId)},null,8,["exam-id","content-style","onClick"])])):f.type==="attendance"?(m(),x(I,{key:2,class:De([{"glow-highlight":i.highlightedCards[f.key],"cursor-not-allowed":i.isEditingDisabled,"cursor-pointer":!i.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:e[0]||(e[0]=h=>l.handleCardClick("attendance",null)),onMousemove:l.handleMouseMove,onTouchmove:l.handleTouchMove},{default:a(()=>[s(Z,{class:"d-flex align-center"},{default:a(()=>[s(E,{class:"mr-2",color:"primary",icon:"mdi-account-group"}),e[1]||(e[1]=c(" Âá∫Âã§ÁªüËÆ° ",-1))]),_:1}),s(z,null,{default:a(()=>[r("div",hl,[e[2]||(e[2]=r("span",null,"Â∫îÂà∞/ÂÆûÂà∞",-1)),r("span",gl,g(f.data.total-f.data.exclude.length)+"/"+g(f.data.total-f.data.absent.length-f.data.late.length-f.data.exclude.length),1)]),s(Ue,{class:"mb-2"}),f.data.absent.length>0?(m(),p("div",vl,[r("div",pl,"ËØ∑ÂÅá ("+g(f.data.absent.length)+")",1),r("div",yl,[(m(!0),p(V,null,R(f.data.absent,h=>(m(),x(G,{key:h,color:"error",size:"x-small",variant:"flat"},{default:a(()=>[c(g(h),1)]),_:2},1024))),128))])])):S("",!0),f.data.late.length>0?(m(),p("div",kl,[r("div",bl,"ËøüÂà∞ ("+g(f.data.late.length)+")",1),r("div",xl,[(m(!0),p(V,null,R(f.data.late,h=>(m(),x(G,{key:h,color:"warning",size:"x-small",variant:"flat"},{default:a(()=>[c(g(h),1)]),_:2},1024))),128))])])):S("",!0),f.data.exclude.length>0?(m(),p("div",wl,[r("div",Sl,"‰∏çÂèÇ‰∏é ("+g(f.data.exclude.length)+")",1),r("div",Cl,[(m(!0),p(V,null,R(f.data.exclude,h=>(m(),x(G,{key:h,color:"grey",size:"x-small",variant:"flat"},{default:a(()=>[c(g(h),1)]),_:2},1024))),128))])])):S("",!0),f.data.absent.length===0&&f.data.late.length===0&&f.data.exclude.length===0?(m(),p("div",Dl," ÂÖ®Âã§ ")):S("",!0)]),_:2},1024)]),_:2},1032,["class","onMousemove","onTouchmove"])):f.type==="custom"?(m(),x(I,{key:3,class:De([{"glow-highlight":i.highlightedCards[f.key],"cursor-not-allowed":i.isEditingDisabled,"cursor-pointer":!i.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:h=>l.handleCardClick("dialog",f.key),onMousemove:l.handleMouseMove,onTouchmove:l.handleTouchMove},{default:a(()=>[s(Z,{class:"text-primary"},{default:a(()=>[s(E,{class:"mr-2",icon:"mdi-card-text-outline",size:"small"}),c(" "+g(f.name),1)]),_:2},1024),s(z,{style:_e(i.contentStyle)},{default:a(()=>[c(g(f.content),1)]),_:2},1032,["style"])]),_:2},1032,["class","onClick","onMousemove","onTouchmove"])):(m(),x(I,{key:4,class:De([{"glow-highlight":i.highlightedCards[f.key],"cursor-not-allowed":i.isEditingDisabled,"cursor-pointer":!i.isEditingDisabled},"glow-track"]),border:"",height:"100%",onClick:h=>l.handleCardClick("dialog",f.key),onMousemove:l.handleMouseMove,onTouchmove:l.handleTouchMove},{default:a(()=>[s(Z,null,{default:a(()=>[c(g(f.name),1)]),_:2},1024),s(z,{style:_e(i.contentStyle)},{default:a(()=>[s($e,null,{default:a(()=>[(m(!0),p(V,null,R(l.splitPoint(f.content),h=>(m(),x(Pe,{key:h},{default:a(()=>[c(g(h),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["style"])]),_:2},1032,["class","onClick","onMousemove","onTouchmove"]))],12,cl))),128))]),_:1})],512),r("div",_l,[i.isMobile?(m(),p("div",Tl,[(m(!0),p(V,null,R(i.unusedSubjects,f=>(m(),x(G,{key:f.name,class:"ma-1",color:"primary",variant:"tonal",onClick:h=>l.handleCardClick("dialog",f.name)},{default:a(()=>[s(E,{start:"",size:"small"},{default:a(()=>[c(g(n.isReadOnlyToken?"mdi-cancel":"mdi-plus"),1)]),_:1}),c(" "+g(f.name),1)]),_:2},1032,["onClick"]))),128))])):i.emptySubjectDisplay==="button"?(m(),x(ht,{key:1,divided:"",variant:"tonal"},{default:a(()=>[(m(!0),p(V,null,R(i.unusedSubjects,f=>(m(),x(y,{key:f.name,onClick:h=>l.handleCardClick("dialog",f.name)},{default:a(()=>[s(E,{start:""},{default:a(()=>[c(g(n.isReadOnlyToken?"mdi-cancel":"mdi-plus"),1)]),_:1}),c(" "+g(f.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):(m(),p("div",Il,[s(ut,{name:"v-list"},{default:a(()=>[(m(!0),p(V,null,R(i.unusedSubjects,f=>(m(),x(I,{key:f.name,border:"",class:"empty-subject-card",onClick:h=>l.handleCardClick("dialog",f.name)},{default:a(()=>[s(Z,{class:"text-subtitle-1"},{default:a(()=>[c(g(f.name),1)]),_:2},1024),s(z,{class:"text-center"},{default:a(()=>[n.isReadOnlyToken?(m(),p(V,{key:0},[s(E,{color:"grey",size:"small"},{default:a(()=>[...e[3]||(e[3]=[c(" mdi-cancel ",-1)])]),_:1}),e[4]||(e[4]=r("div",{class:"text-caption text-grey"}," ÂΩìÊó•Êó†‰Ωú‰∏ö ",-1))],64)):(m(),p(V,{key:1},[s(E,{color:"grey",size:"small"},{default:a(()=>[...e[5]||(e[5]=[c(" mdi-plus ",-1)])]),_:1}),e[6]||(e[6]=r("div",{class:"text-caption text-grey"}," ÁÇπÂáªÊ∑ªÂä†‰Ωú‰∏ö ",-1))],64))]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]))])],64)}const gs=ie(dl,[["render",El],["__scopeId","data-v-0923e219"]]),Vl=$s({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Sn({filterKeys:["title"]}),...wn({hideNoData:!0,returnObject:!0}),...Ys(an({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VCombobox"),Nl=Ms()({name:"VCombobox",props:Vl(),emits:{"update:focused":t=>!0,"update:modelValue":t=>!0,"update:search":t=>!0,"update:menu":t=>!0},setup(t,e){var xt;let{emit:i,slots:o}=e;const{t:n}=Rs(),l=L(),d=Ke(!1),u=Ke(!0),f=Ke(!1),h=L(),k=L(),C=Ke(-1);let B=!1;const{items:Q,transformIn:A,transformOut:Y}=Ls(t),{textColorClasses:ae,textColorStyles:xe}=Os(()=>{var w;return(w=l.value)==null?void 0:w.color}),{InputIcon:we}=sn(t),U=Et(t,"modelValue",[],w=>A(Bs(w)),w=>{const M=Y(w);return t.multiple?M:M[0]??null}),te=nn(t),D=js(()=>t.closableChips&&!te.isReadonly.value&&!te.isDisabled.value),P=K(()=>!!(t.chips||o.chip)),b=K(()=>P.value||!!o.selection),N=Ke(!t.multiple&&!b.value?((xt=U.value[0])==null?void 0:xt.title)??"":""),O=Ke(null),q=K({get:()=>N.value,set:async w=>{var M;if(N.value=w??"",w===null||w===""&&!t.multiple&&!b.value?U.value=[]:!t.multiple&&!b.value&&(U.value=[qe(t,w)],We(()=>{var J;return(J=k.value)==null?void 0:J.scrollToIndex(0)})),w&&t.multiple&&((M=t.delimiters)!=null&&M.length)){const J=kt(w);J.length>1&&(bt(J),N.value="")}w||(C.value=-1),u.value=!w}}),he=K(()=>typeof t.counterValue=="function"?t.counterValue(U.value):typeof t.counterValue=="number"?t.counterValue:t.multiple?U.value.length:q.value.length),{filteredItems:oe,getMatches:v}=pn(t,Q,()=>O.value??(t.alwaysFilter||!u.value?q.value:"")),se=K(()=>t.hideSelected&&O.value===null?oe.value.filter(w=>!U.value.some(M=>M.value===w.value)):oe.value),T=K(()=>t.hideNoData&&!se.value.length||te.isReadonly.value||te.isDisabled.value),$=Et(t,"menu"),F=K({get:()=>$.value,set:w=>{var M;$.value&&!w&&((M=h.value)!=null&&M.Œ®openChildren.size)||w&&T.value||($.value=w)}}),{menuId:le,ariaExpanded:j,ariaControls:ee}=yn(t,F);ze(N,w=>{B?We(()=>B=!1):d.value&&!F.value&&(F.value=!0),i("update:search",w)}),ze(U,w=>{var M;!t.multiple&&!b.value&&(N.value=((M=w[0])==null?void 0:M.title)??"")});const Te=K(()=>U.value.map(w=>w.value)),pe=K(()=>se.value.find(w=>w.type==="item"&&!w.props.disabled)),je=K(()=>{var M;return(t.autoSelectFirst===!0||t.autoSelectFirst==="exact"&&q.value===((M=pe.value)==null?void 0:M.title))&&se.value.length>0&&!u.value&&!f.value}),Ie=L(),yt=kn(Ie,l);function Me(w){B=!0,We(()=>B=!1),t.openOnClear&&(F.value=!0)}function ys(){T.value||(F.value=!0)}function ks(w){T.value||(d.value&&(w.preventDefault(),w.stopPropagation()),F.value=!F.value)}function bs(w){var M;(Nt(w)||w.key==="Backspace")&&((M=l.value)==null||M.focus())}function xs(w){var X,Se,W,ge;if(Zs(w)||te.isReadonly.value)return;const M=(X=l.value)==null?void 0:X.selectionStart,J=U.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(w.key)&&w.preventDefault(),["Enter","ArrowDown"].includes(w.key)&&(F.value=!0),["Escape"].includes(w.key)&&(F.value=!1),je.value&&["Enter","Tab"].includes(w.key)&&pe.value&&!U.value.some(re=>{let{value:He}=re;return He===pe.value.value})&&Ee(pe.value),w.key==="ArrowDown"&&je.value&&((Se=Ie.value)==null||Se.focus("next")),w.key==="Enter"&&q.value&&(Ee(qe(t,q.value),!0,!0),b.value&&(N.value="")),["Backspace","Delete"].includes(w.key)){if(!t.multiple&&b.value&&U.value.length>0&&!q.value)return Ee(U.value[0],!1);if(~C.value){w.preventDefault();const re=C.value;Ee(U.value[C.value],!1),C.value=re>=J-1?J-2:re}else w.key==="Backspace"&&!q.value&&(C.value=J-1);return}if(t.multiple)if(w.key==="ArrowLeft"){if(C.value<0&&M&&M>0)return;const re=C.value>-1?C.value-1:J-1;U.value[re]?C.value=re:(C.value=-1,(W=l.value)==null||W.setSelectionRange(q.value.length,q.value.length))}else if(w.key==="ArrowRight"){if(C.value<0)return;const re=C.value+1;U.value[re]?C.value=re:(C.value=-1,(ge=l.value)==null||ge.setSelectionRange(0,0))}else~C.value&&Nt(w)&&(C.value=-1)}function ws(w){var X;const M=((X=w==null?void 0:w.clipboardData)==null?void 0:X.getData("Text"))??"",J=kt(M);J.length>1&&t.multiple&&(w.preventDefault(),bt(J))}function Ss(){var w;t.eager&&((w=k.value)==null||w.calculateVisibleItems())}function Cs(){var w;d.value&&((w=l.value)==null||w.focus()),u.value=!0,O.value=null}function Ee(w){let M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!w||w.props.disabled))if(t.multiple){const X=U.value.findIndex(W=>(t.valueComparator||Vt)(W.value,w.value)),Se=M??!~X;if(~X){const W=Se?[...U.value,w]:[...U.value];W.splice(X,1),U.value=W}else Se&&(U.value=[...U.value,w]);t.clearOnSelect&&(q.value="")}else{const X=M!==!1;U.value=X?[w]:[],(!u.value||t.alwaysFilter)&&N.value&&(O.value=N.value),N.value=X&&!b.value?w.title:"",We(()=>{F.value=J,u.value=!0})}}function kt(w){const J=[`
`,...t.delimiters??[]].map(Xs).join("|");return w.split(new RegExp(`(?:${J})+`))}async function bt(w){for(let M of w)M=M.trim(),M&&(Ee(qe(t,M)),await We())}function Ds(w){d.value=!0,setTimeout(()=>{f.value=!0})}function _s(w){f.value=!1}return ze(d,(w,M)=>{if(!(w||w===M)&&(C.value=-1,F.value=!1,q.value)){if(t.multiple){Ee(qe(t,q.value));return}if(!b.value)return;U.value.some(J=>{let{title:X}=J;return X===q.value})?N.value="":Ee(qe(t,q.value))}}),ze(F,w=>{if(!t.hideSelected&&w&&U.value.length&&u.value){const M=se.value.findIndex(J=>U.value.some(X=>(t.valueComparator||Vt)(X.value,J.value)));Hs&&window.requestAnimationFrame(()=>{var J;M>=0&&((J=k.value)==null||J.scrollToIndex(M))})}w&&(O.value=null)}),ze(Q,(w,M)=>{F.value||d.value&&!M.length&&w.length&&(F.value=!0)}),Ks(()=>{const w=!!(!t.hideNoData||se.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),M=U.value.length>0,J=Fe.filterProps(t);return s(Fe,ke({ref:l},J,{modelValue:q.value,"onUpdate:modelValue":X=>q.value=X,focused:d.value,"onUpdate:focused":X=>d.value=X,validationValue:U.externalValue,counterValue:he.value,dirty:M,class:["v-combobox",{"v-combobox--active-menu":F.value,"v-combobox--chips":!!t.chips,"v-combobox--selection-slot":!!b.value,"v-combobox--selecting-index":C.value>-1,[`v-combobox--${t.multiple?"multiple":"single"}`]:!0},t.class],style:t.style,readonly:te.isReadonly.value,placeholder:M?void 0:t.placeholder,"onClick:clear":Me,"onMousedown:control":ys,onKeydown:xs,onPaste:ws,"aria-expanded":j.value,"aria-controls":ee.value}),{...o,default:X=>{let{id:Se}=X;return r(V,null,[s(ts,ke({id:le.value,ref:h,modelValue:F.value,"onUpdate:modelValue":W=>F.value=W,activator:"parent",contentClass:"v-combobox__content",disabled:T.value,eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Ss,onAfterLeave:Cs},t.menuProps),{default:()=>[w&&s($e,ke({ref:Ie,filterable:!0,selected:Te.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:W=>W.preventDefault(),selectable:!0,onKeydown:bs,onFocusin:Ds,onFocusout:_s,tabindex:"-1","aria-live":"polite","aria-labelledby":`${Se.value}-label`,"aria-multiselectable":t.multiple,color:t.itemColor??t.color},yt,t.listProps),{default:()=>{var W,ge,re;return[(W=o["prepend-item"])==null?void 0:W.call(o),!se.value.length&&!t.hideNoData&&(((ge=o["no-data"])==null?void 0:ge.call(o))??s(Pe,{key:"no-data",title:n(t.noDataText)},null)),s(bn,{ref:k,renderless:!0,items:se.value,itemKey:"value"},{default:He=>{var St,Ct,Dt;let{item:ne,index:Ve,itemRef:ye}=He;const wt=ke(ne.props,{ref:ye,key:ne.value,active:je.value&&ne===pe.value?!0:void 0,onClick:()=>Ee(ne,null),"aria-posinset":Ve+1,"aria-setsize":se.value.length});return ne.type==="divider"?((St=o.divider)==null?void 0:St.call(o,{props:ne.raw,index:Ve}))??s(Ue,ke(ne.props,{key:`divider-${Ve}`}),null):ne.type==="subheader"?((Ct=o.subheader)==null?void 0:Ct.call(o,{props:ne.raw,index:Ve}))??s(Ws,ke(ne.props,{key:`subheader-${Ve}`}),null):((Dt=o.item)==null?void 0:Dt.call(o,{item:ne,index:Ve,props:wt}))??s(Pe,ke(wt,{role:"option"}),{prepend:et=>{let{isSelected:Ts}=et;return r(V,null,[t.multiple&&!t.hideSelected?s(Cn,{key:ne.value,modelValue:Ts,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Is=>Is.preventDefault()},null):void 0,ne.props.prependAvatar&&s(Oe,{image:ne.props.prependAvatar},null),ne.props.prependIcon&&s(E,{icon:ne.props.prependIcon},null)])},title:()=>{var et;return u.value?ne.title:xn("v-combobox",ne.title,(et=v(ne))==null?void 0:et.title)}})}}),(re=o["append-item"])==null?void 0:re.call(o)]}})]}),U.value.map((W,ge)=>{function re(ye){ye.stopPropagation(),ye.preventDefault(),Ee(W,!1)}const He=ke(G.filterProps(W.props),{"onClick:close":re,onKeydown(ye){ye.key!=="Enter"&&ye.key!==" "||(ye.preventDefault(),ye.stopPropagation(),re(ye))},onMousedown(ye){ye.preventDefault(),ye.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),ne=P.value?!!o.chip:!!o.selection,Ve=ne?Gs(P.value?o.chip({item:W,index:ge,props:He}):o.selection({item:W,index:ge})):void 0;if(!(ne&&!Ve))return r("div",{key:W.value,class:De(["v-combobox__selection",ge===C.value&&["v-combobox__selection--selected",ae.value]]),style:_e(ge===C.value?xe.value:{})},[P.value?o.chip?s(Qs,{key:"chip-defaults",defaults:{VChip:{closable:D.value,size:"small",text:W.title}}},{default:()=>[Ve]}):s(G,ke({key:"chip",closable:D.value,size:"small",text:W.title,disabled:W.props.disabled},He),null):Ve??r("span",{class:"v-combobox__selection-text"},[W.title,t.multiple&&ge<U.value.length-1&&r("span",{class:"v-combobox__selection-comma"},[c(",")])])])})])},"append-inner":function(){var ge,re;for(var X=arguments.length,Se=new Array(X),W=0;W<X;W++)Se[W]=arguments[W];return r(V,null,[(ge=o["append-inner"])==null?void 0:ge.call(o,...Se),(!t.hideNoData||t.items.length)&&t.menuIcon?s(E,{class:"v-combobox__menu-icon",color:(re=l.value)==null?void 0:re.fieldIconColor,icon:t.menuIcon,onMousedown:ks,onClick:qs,"aria-hidden":!0,tabindex:"-1"},null):void 0,t.appendInnerIcon&&s(we,{key:"append-icon",name:"appendInner",color:Se[0].iconColor.value},null)])}})}),Js({isFocused:d,isPristine:u,menu:F,search:q,selectionIndex:C,filteredItems:oe,select:Ee},l)}}),Al={key:0,class:"mt-2 text-caption text-medium-emphasis"},Ul={class:"mt-2 mb-4"},zl={class:"d-flex flex-wrap gap-2"},Pl={key:0,class:"ms-1 text-error"},Fl={__name:"StudentNameManager",emits:["token-info-updated"],setup(t,{expose:e,emit:i}){const o=i,n=L(!1),l=L(""),d=L([]),u=L(""),f=L(!1),h=L(""),k=L(null),C=L([]),B=L(""),Q=L(""),A=L({name:"",isHeadTeacher:!1,subjects:[]}),Y=K(()=>{var T;return((T=k.value)==null?void 0:T.deviceType)==="student"}),ae=K(()=>{var T;return((T=k.value)==null?void 0:T.deviceType)==="teacher"}),xe=K(()=>{var T;return((T=k.value)==null?void 0:T.isReadOnly)===!0}),we=K(()=>{var T;return((T=k.value)==null?void 0:T.note)||"ËÆæÁΩÆÂêçÁß∞"}),U=K(()=>!!te.value),te=K(()=>_("server.kvToken")),D=K(()=>_("server.provider")),P=K(()=>D.value==="kv-server"||D.value==="classworkscloud"),b=K(()=>Y.value?"ËÆæÁΩÆÂ≠¶ÁîüÂßìÂêç":ae.value?"ËÆæÁΩÆÊïôÂ∏àÂßìÂêç":"ËÆæÁΩÆÂßìÂêç"),N=K(()=>C.value),O=async()=>{var T;if(!(!P.value||!te.value))try{const $=_("server.domain");if(!$)return;const F=await Ae.get(`${$}/kv/_token`,{headers:{Authorization:`Bearer ${te.value}`}});if(k.value=F.data,k.value.deviceType==="student"){u.value=k.value.note||"";const j=(await Ae.get(`${$}/kv/classworks-list-main`,{headers:{Authorization:`Bearer ${te.value}`}})).data.value||[];if(d.value=Array.isArray(j)?j:[],d.value.length>0){const ee=k.value.note||"",Te=d.value.some(pe=>pe.name===ee);(!ee||!Te)&&(n.value=!0,l.value="")}return}if(k.value.deviceType==="teacher"){Q.value=k.value.note||"";try{const j=(await Ae.get(`${$}/kv/classworks-list-teacher`,{headers:{Authorization:`Bearer ${te.value}`}})).data.value||[];C.value=Array.isArray(j)?j:[]}catch(le){((T=le==null?void 0:le.response)==null?void 0:T.status)===404?(console.log("ÊïôÂ∏àÂàóË°®‰∏çÂ≠òÂú®ÔºåÂàùÂßãÂåñ‰∏∫Á©∫"),C.value=[]):(console.error("Âä†ËΩΩÊïôÂ∏àÂàóË°®Â§±Ë¥•:",le),C.value=[])}if(C.value.length>0){const le=k.value.note||"",j=C.value.some(ee=>ee.name===le);(!le||!j)&&(n.value=!0,B.value="")}return}}catch($){console.error("Ê£ÄÊü•Â≠¶ÁîüÂßìÂêçÁä∂ÊÄÅÂ§±Ë¥•:",$)}},q=async()=>{var T,$,F,le;if(!(!l.value||f.value)){h.value="",f.value=!0;try{const j=_("server.domain"),ee=te.value;(await Ae.post(`${j}/apps/tokens/${ee}/set-student-name`,{name:l.value})).data.success&&(u.value=l.value,n.value=!1,await O(),o("token-info-updated"))}catch(j){const ee=(T=j==null?void 0:j.response)==null?void 0:T.status;ee===400?h.value="ËØ•ÂêçÁß∞‰∏çÂú®Â≠¶ÁîüÂàóË°®‰∏≠ÔºåËØ∑ÈÄâÊã©Ê≠£Á°ÆÁöÑÂßìÂêç":ee===403?h.value="Âè™ÊúâÂ≠¶ÁîüÁ±ªÂûãÁöÑ Token ÂèØ‰ª•ËÆæÁΩÆÂßìÂêç":ee===404?h.value="ËÆæÂ§áÊú™ËÆæÁΩÆÂ≠¶ÁîüÂàóË°®Êàñ Token ‰∏çÂ≠òÂú®":h.value=((le=(F=($=j==null?void 0:j.response)==null?void 0:$.data)==null?void 0:F.error)==null?void 0:le.message)||(j==null?void 0:j.message)||"ËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï"}finally{f.value=!1}}},he=async()=>{var T,$,F,le,j;if(!(!A.value.name||f.value)){h.value="",f.value=!0;try{const ee=_("server.domain"),Te=te.value,pe={name:A.value.name.trim(),isHeadTeacher:!!A.value.isHeadTeacher,subjects:Array.isArray(A.value.subjects)?A.value.subjects.filter(Me=>Me&&String(Me).trim()).map(Me=>String(Me).trim()):[]},je=C.value.findIndex(Me=>Me.name===pe.name);je>=0?C.value[je]=pe:C.value.push(pe);const Ie=await ce.saveData("classworks-list-teacher",C.value);if((Ie==null?void 0:Ie.success)===!1)throw new Error(((T=Ie==null?void 0:Ie.error)==null?void 0:T.message)||"‰øùÂ≠òÂàóË°®Â§±Ë¥•");(await Ae.post(`${ee}/apps/tokens/${Te}/set-teacher-name`,{name:pe.name})).data.success&&(Q.value=pe.name,n.value=!1,await O(),o("token-info-updated"))}catch(ee){const Te=($=ee==null?void 0:ee.response)==null?void 0:$.status;Te===400?h.value="ËØ•ÂêçÁß∞‰∏çÂú®ÊïôÂ∏àÂàóË°®‰∏≠ÔºåËØ∑ÈÄâÊã©Ê≠£Á°ÆÁöÑÂßìÂêç":Te===403?h.value="Âè™ÊúâÊïôÂ∏àÁ±ªÂûãÁöÑ Token ÂèØ‰ª•ËÆæÁΩÆÂßìÂêç":Te===404?h.value="ËÆæÂ§áÊú™ËÆæÁΩÆÊïôÂ∏àÂàóË°®Êàñ Token ‰∏çÂ≠òÂú®":h.value=((j=(le=(F=ee==null?void 0:ee.response)==null?void 0:F.data)==null?void 0:le.error)==null?void 0:j.message)||(ee==null?void 0:ee.message)||"ËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï"}finally{f.value=!1}}},oe=T=>{A.value.name=T.name,A.value.isHeadTeacher=T.isHeadTeacher||!1,A.value.subjects=Array.isArray(T.subjects)?[...T.subjects]:[]},v=()=>{n.value=!1},se=async()=>{if(console.log("StudentNameManager.openDialog called"),console.log("isStudentToken:",Y.value),console.log("studentList.length:",d.value.length),console.log("currentStudentName:",u.value),Y.value){const T=await ce.loadData("classworks-list-main");d.value=Array.isArray(T==null?void 0:T.value)?T.value:Array.isArray(T)?T:[],d.value.length===0?(console.log("Student list is empty, trying to load..."),await O(),l.value=u.value,n.value=!0):(l.value=u.value,n.value=!0);return}if(ae.value){try{const T=await ce.loadData("classworks-list-teacher");C.value=Array.isArray(T==null?void 0:T.value)?T.value:Array.isArray(T)?T:[]}catch{console.log("ÊïôÂ∏àÂàóË°®‰∏çÂ≠òÂú®ÊàñÂä†ËΩΩÂ§±Ë¥•ÔºåÂÖÅËÆ∏ÊâãÂä®ÂàõÂª∫"),C.value=[]}if(A.value={name:Q.value,isHeadTeacher:!1,subjects:[]},Q.value){const T=C.value.find($=>$.name===Q.value);T&&(A.value.isHeadTeacher=T.isHeadTeacher||!1,A.value.subjects=Array.isArray(T.subjects)?[...T.subjects]:[])}n.value=!0,console.log("Dialog opened (teacher), showDialog:",n.value);return}console.log("Not a student/teacher token, cannot open dialog")};return ze(te,()=>{O()}),vt(()=>{O()}),ze(k,()=>{o("token-info-updated")},{deep:!0}),gt(()=>{O()}),e({checkStudentNameStatus:O,openDialog:se,currentStudentName:u,currentTeacherName:Q,isStudentToken:Y,isTeacherToken:ae,isReadOnly:xe,displayName:we,hasToken:U,tokenInfo:k}),(T,$)=>(m(),p(V,null,[s(de,{modelValue:n.value,"onUpdate:modelValue":$[4]||($[4]=F=>n.value=F),"max-width":"720",persistent:""},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,null,{default:a(()=>[c(g(b.value),1)]),_:1}),s(z,null,{default:a(()=>[Y.value?(m(),p(V,{key:0},[$[5]||($[5]=r("div",{class:"mb-2"}," ËØ∑‰ªéÂàóË°®‰∏≠ÈÄâÊã©ÊÇ®ÁöÑÂßìÂêçÔºö ",-1)),s(Vs,{modelValue:l.value,"onUpdate:modelValue":$[0]||($[0]=F=>l.value=F),items:d.value,clearable:"","hide-details":"","item-title":"name","item-value":"name",label:"Â≠¶ÁîüÂßìÂêç",placeholder:"ÈÄâÊã©ÊÇ®ÁöÑÂßìÂêç"},null,8,["modelValue","items"]),d.value.length>0?(m(),p("div",Al," ÂÖ± "+g(d.value.length)+" ‰ΩçÂ≠¶Áîü ",1)):S("",!0)],64)):ae.value?(m(),p(V,{key:1},[s(Fe,{modelValue:A.value.name,"onUpdate:modelValue":$[1]||($[1]=F=>A.value.name=F),label:"ÊïôÂ∏àÂßìÂêç",placeholder:"ËæìÂÖ•ÂßìÂêçÊàñ‰ªé‰∏ãÊñπÂª∫ËÆÆ‰∏≠ÈÄâÊã©",clearable:""},null,8,["modelValue"]),r("div",Ul,[r("div",zl,[(m(!0),p(V,null,R(N.value,F=>(m(),x(G,{key:F.name,size:"small",onClick:le=>oe(F)},{default:a(()=>[c(g(F.name)+" ",1),F.isHeadTeacher?(m(),p("span",Pl," üë®‚Äçüè´ ")):S("",!0)]),_:2},1032,["onClick"]))),128))])]),s(ft,{modelValue:A.value.isHeadTeacher,"onUpdate:modelValue":$[2]||($[2]=F=>A.value.isHeadTeacher=F),inset:"",color:"primary",label:A.value.isHeadTeacher?"Áè≠‰∏ª‰ªª":"ÈùûÁè≠‰∏ª‰ªª"},null,8,["modelValue","label"]),s(Nl,{modelValue:A.value.subjects,"onUpdate:modelValue":$[3]||($[3]=F=>A.value.subjects=F),multiple:"",chips:"",clearable:"",label:"‰ªªÊïôÁßëÁõÆ",hint:"ÂèØÁõ¥Êé•ËæìÂÖ•Âπ∂ÂõûËΩ¶Ê∑ªÂä†Â§ö‰∏™ÁßëÁõÆ","persistent-hint":""},null,8,["modelValue"])],64)):S("",!0),h.value?(m(),x(Be,{key:2,class:"mt-3",type:"error",variant:"tonal"},{default:a(()=>[c(g(h.value),1)]),_:1})):S("",!0)]),_:1}),s(ue,null,{default:a(()=>[s(y,{variant:"text",onClick:v},{default:a(()=>[...$[6]||($[6]=[c(" Á®çÂêéËÆæÁΩÆ ",-1)])]),_:1}),s(H),Y.value?(m(),x(y,{key:0,disabled:!l.value||f.value,loading:f.value,color:"primary",onClick:q},{default:a(()=>[...$[7]||($[7]=[c(" Á°ÆËÆ§ ",-1)])]),_:1},8,["disabled","loading"])):ae.value?(m(),x(y,{key:1,disabled:!A.value.name||f.value,loading:f.value,color:"primary",onClick:he},{default:a(()=>[...$[8]||($[8]=[c(" Á°ÆËÆ§ ",-1)])]),_:1},8,["disabled","loading"])):S("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),en(T.$slots,"header-display",{isStudent:Y.value,openDialog:se,studentName:u.value,teacherName:Q.value},void 0)],64))}},vs=ie(Fl,[["__scopeId","data-v-cebbe710"]]),Ml={class:"text-center mb-6"},$l={class:"text-body-2"},Rl={class:"form-section"},Ll={__name:"DeviceAuthDialog",props:{showCancel:{type:Boolean,default:!1},preconfig:{type:Object,default:null}},emits:["success","cancel"],setup(t,{expose:e,emit:i}){const o=t,n=i,l=L({namespace:"",password:""}),d=L(!1),u=L("");ze(()=>o.preconfig,h=>{h&&(console.log("Â∫îÁî®È¢ÑÈÖçÁΩÆÊï∞ÊçÆ:",h),l.value.namespace=h.namespace||"",l.value.password=h.password||"",h.autoExecute&&h.namespace?(console.log("Ê£ÄÊµãÂà∞Ëá™Âä®ÊâßË°åÊ†áÂøó‰∏îÊúâÂëΩÂêçÁ©∫Èó¥ÔºåËá™Âä®ÊâßË°åËÆ§ËØÅ"),setTimeout(()=>{f()},300)):h.namespace&&console.log("È¢ÑÈÖçÁΩÆÊï∞ÊçÆÂ∑≤Â°´ÂÖ•ÔºåÁ≠âÂæÖÊâãÂä®ËÆ§ËØÅ"))},{immediate:!0,deep:!0});const f=async()=>{var h,k,C,B,Q;if(!(!l.value.namespace||d.value)){u.value="",d.value=!0;try{const A=_("server.domain");if(!A)throw new Error("Êú™ÈÖçÁΩÆÊúçÂä°Âô®ÂüüÂêç");const Y=await Ae.post(`${A}/apps/auth/token`,{namespace:l.value.namespace,password:l.value.password||void 0,appId:"d158067f53627d2b98babe8bffd2fd7d"});if(!Y.data.success)throw new Error("ËÆæÂ§áÈ™åËØÅÂ§±Ë¥•");const ae=Y.data;be("server.kvToken",ae.token),(h=ae.device)!=null&&h.uuid&&be("device.uuid",ae.device.uuid),n("success",ae)}catch(A){const Y=(k=A==null?void 0:A.response)==null?void 0:k.status;Y===401||Y===403?u.value="ÂØÜÁ†ÅÈîôËØØÊàñÊó†ÊùÉÈôêËÆøÈóÆ":Y===404?u.value="ËÆæÂ§á‰∏çÂ≠òÂú®,ËØ∑Ê£ÄÊü• namespace ÊòØÂê¶Ê≠£Á°Æ":u.value=((Q=(B=(C=A==null?void 0:A.response)==null?void 0:C.data)==null?void 0:B.error)==null?void 0:Q.message)||(A==null?void 0:A.message)||"ËÆ§ËØÅÂ§±Ë¥•,ËØ∑Á®çÂêéÈáçËØï"}finally{d.value=!1}}};return e({reset:()=>{l.value={namespace:"",password:""},u.value=""}}),(h,k)=>(m(),x(I,{class:"auth-card"},{default:a(()=>[s(z,{class:"pa-8"},{default:a(()=>[r("div",Ml,[s(E,{class:"mb-4",color:"success",size:"80"},{default:a(()=>[...k[4]||(k[4]=[c(" mdi-account-key ",-1)])]),_:1}),k[5]||(k[5]=r("h2",{class:"text-h4 mb-3"}," ËÆæÂ§áËÆ§ËØÅ ",-1)),k[6]||(k[6]=r("p",{class:"text-body-1 text-medium-emphasis"}," ËæìÂÖ•‰Ω†Âú® Classworks KV Ëé∑ÂèñÁöÑËÆ§ËØÅ‰ø°ÊÅØ ",-1))]),s(I,{class:"pa-4 mb-6",color:"info",variant:"tonal"},{default:a(()=>[r("div",$l,[s(E,{class:"mr-2",size:"20"},{default:a(()=>[...k[7]||(k[7]=[c(" mdi-information ",-1)])]),_:1}),k[8]||(k[8]=c(" ÂØπ‰∫éÂ∑≤ÊúâUUIDÁöÑÁî®Êà∑ÔºåÊÇ®Â∫îÂΩì‰ΩøÁî®UUID‰∏éÊÇ®ÁöÑÂØÜÁ†ÅÁôªÂΩï„ÄÇ ",-1))])]),_:1}),r("div",Rl,[s(Fe,{modelValue:l.value.namespace,"onUpdate:modelValue":k[0]||(k[0]=C=>l.value.namespace=C),class:"mb-4","hide-details":"auto",label:"ÂëΩÂêçÁ©∫Èó¥","prepend-inner-icon":"mdi-identifier",variant:"outlined"},null,8,["modelValue"]),s(Fe,{modelValue:l.value.password,"onUpdate:modelValue":k[1]||(k[1]=C=>l.value.password=C),label:"ËÆ§ËØÅÁ†Å","prepend-inner-icon":"mdi-lock-outline",type:"text",variant:"outlined"},null,8,["modelValue"]),u.value?(m(),x(Be,{key:0,class:"mt-4",closable:"",type:"error",variant:"tonal","onClick:close":k[2]||(k[2]=C=>u.value="")},{default:a(()=>[c(g(u.value),1)]),_:1})):S("",!0)])]),_:1}),s(ue,{class:"pa-6 pt-0"},{default:a(()=>[t.showCancel?(m(),x(y,{key:0,size:"large",variant:"text",onClick:k[3]||(k[3]=C=>h.$emit("cancel"))},{default:a(()=>[...k[9]||(k[9]=[c(" ÂèñÊ∂à ",-1)])]),_:1})):S("",!0),s(H),s(y,{disabled:!l.value.namespace||d.value,loading:d.value,class:"px-8",color:"primary",size:"x-large",variant:"elevated",onClick:f},{default:a(()=>[s(E,{size:"24",start:""},{default:a(()=>[...k[10]||(k[10]=[c(" mdi-login ",-1)])]),_:1}),k[11]||(k[11]=r("span",{class:"text-h6"},"ËÆ§ËØÅÂπ∂ÁôªÂΩï",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}},Ol=ie(Ll,[["__scopeId","data-v-9e8d02e4"]]),Bl={__name:"TokenInputDialog",props:{showCancel:{type:Boolean,default:!1}},emits:["success","cancel"],setup(t,{expose:e,emit:i}){const o=i,n=L(""),l=L(!1),d=L(""),u=async()=>{var f,h,k;if(!(!n.value||l.value)){d.value="",l.value=!0;try{const C=_("server.domain");if(!C)throw new Error("Êú™ÈÖçÁΩÆÊúçÂä°Âô®ÂüüÂêç");await Ae.get(`${C}/kv/_info`,{headers:{Accept:"application/json","x-app-token":n.value}}),be("server.kvToken",n.value),o("success")}catch(C){const B=(f=C==null?void 0:C.response)==null?void 0:f.status;B===401||B===403?d.value="Token Êó†ÊïàÊàñÊó†ÊùÉÈôê,ËØ∑Á°ÆËÆ§ÂêéÈáçËØï":B===404?d.value="ÂëΩÂêçÁ©∫Èó¥‰∏çÂ≠òÂú®ÊàñÊúçÂä°Âô®Êú™Â∞±Áª™":d.value=((k=(h=C==null?void 0:C.response)==null?void 0:h.data)==null?void 0:k.message)||(C==null?void 0:C.message)||"È™åËØÅÂ§±Ë¥•,ËØ∑Á®çÂêéÈáçËØï"}finally{l.value=!1}}};return e({reset:()=>{n.value="",d.value=""}}),(f,h)=>(m(),x(I,null,{default:a(()=>[s(Z,null,{default:a(()=>[...h[2]||(h[2]=[c("ËæìÂÖ•ÊéàÊùÉ Token",-1)])]),_:1}),s(z,null,{default:a(()=>[s(Fe,{modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=k=>n.value=k),clearable:"",density:"comfortable","hide-details":"auto",label:"KV ÊéàÊùÉ Token",placeholder:"Á≤òË¥¥‰ªéÊéàÊùÉÈ°µÈù¢Ëé∑ÂèñÁöÑ Token",variant:"outlined"},null,8,["modelValue"]),d.value?(m(),x(Be,{key:0,class:"mt-3",type:"error",variant:"tonal"},{default:a(()=>[c(g(d.value),1)]),_:1})):S("",!0)]),_:1}),s(ue,null,{default:a(()=>[s(H),t.showCancel?(m(),x(y,{key:0,variant:"text",onClick:h[1]||(h[1]=k=>f.$emit("cancel"))},{default:a(()=>[...h[3]||(h[3]=[c(" ÂèñÊ∂à ",-1)])]),_:1})):S("",!0),s(y,{disabled:!n.value||l.value,loading:l.value,color:"primary",onClick:u},{default:a(()=>[...h[4]||(h[4]=[c(" ‰øùÂ≠ò Token ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}},jl={__name:"AlternativeCodeDialog",props:{showCancel:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{expose:e,emit:i}){const o=i,n=L(""),l=()=>{n.value&&o("submit",n.value)};return e({reset:()=>{n.value=""}}),(d,u)=>(m(),x(I,null,{default:a(()=>[s(Z,null,{default:a(()=>[...u[2]||(u[2]=[c("ËæìÂÖ•Êõø‰ª£‰ª£Á†Å",-1)])]),_:1}),s(z,null,{default:a(()=>[s(Xe,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=f=>n.value=f),density:"comfortable","hide-details":"auto",label:"Êõø‰ª£‰ª£Á†Å",placeholder:"ËØ∑ËæìÂÖ•Êõø‰ª£‰ª£Á†Å",rows:"5",variant:"outlined"},null,8,["modelValue"]),s(Be,{class:"mt-3",type:"info",variant:"tonal"},{default:a(()=>[...u[3]||(u[3]=[c(" Êõø‰ª£‰ª£Á†ÅÂäüËÉΩÊöÇÊú™ÂÆûÁé∞ÔºåÊï¨ËØ∑ÊúüÂæÖ ",-1)])]),_:1})]),_:1}),s(ue,null,{default:a(()=>[s(H),t.showCancel?(m(),x(y,{key:0,variant:"text",onClick:u[1]||(u[1]=f=>d.$emit("cancel"))},{default:a(()=>[...u[4]||(u[4]=[c(" ÂèñÊ∂à ",-1)])]),_:1})):S("",!0),s(y,{disabled:!n.value,color:"primary",onClick:l},{default:a(()=>[...u[5]||(u[5]=[c(" Êèê‰∫§ ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}))}},me=[];for(let t=0;t<256;++t)me.push((t+256).toString(16).slice(1));function Hl(t,e=0){return(me[t[e+0]]+me[t[e+1]]+me[t[e+2]]+me[t[e+3]]+"-"+me[t[e+4]]+me[t[e+5]]+"-"+me[t[e+6]]+me[t[e+7]]+"-"+me[t[e+8]]+me[t[e+9]]+"-"+me[t[e+10]]+me[t[e+11]]+me[t[e+12]]+me[t[e+13]]+me[t[e+14]]+me[t[e+15]]).toLowerCase()}let rt;const Kl=new Uint8Array(16);function ql(){if(!rt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");rt=crypto.getRandomValues.bind(crypto)}return rt(Kl)}const Wl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),jt={randomUUID:Wl};function Gl(t,e,i){var n;t=t||{};const o=t.random??((n=t.rng)==null?void 0:n.call(t))??ql();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Hl(o)}function Ql(t,e,i){return jt.randomUUID&&!t?jt.randomUUID():Gl(t)}const Jl={class:"step-content"},Yl={class:"text-center mb-6"},Xl={class:"step-content"},Zl={class:"relationship-diagram"},eo={class:"diagram-item"},to={class:"text-center"},so={class:"diagram-description mt-3"},no={class:"diagram-connector"},ao={class:"diagram-item"},io={class:"text-center"},lo={class:"diagram-description mt-3"},oo={class:"step-content"},ro={class:"button-group"},uo={class:"d-flex flex-column align-center py-2"},co={class:"d-flex flex-column align-center py-2"},mo={class:"step-content"},fo={class:"text-center mb-6"},ho={class:"step-content"},go={class:"text-center mb-6"},vo={class:"d-flex flex-column flex-sm-row align-center"},po={class:"flex-grow-1"},yo={class:"text-h6 font-weight-bold"},ko={class:"text-h5 mb-6"},bo={class:"text-subtitle-2"},xo={class:"d-flex align-center"},wo={class:"d-flex align-center"},So={class:"step-content"},Co={class:"text-center mb-6"},Do={class:"d-flex align-center mb-3"},_o={class:"text-h6 font-weight-medium"},To={key:0,class:"text-body-2 mb-2"},Io={class:"mb-2"},Eo={class:"device-code"},Vo={key:1,class:"text-body-2 text-error"},No={class:"log-box"},Ao={key:0,class:"text-caption text-medium-emphasis"},Uo={class:"d-flex flex-wrap gap-2 mt-4"},tt=5,zo={__name:"FirstTimeGuide",emits:["close","success"],setup(t,{emit:e}){const i=e,o=_("server.authDomain"),n=L(1),l=L(""),d=L("idle"),u=L(""),f=L(null),h=L(null),k=L([]),C=L({1:!1,2:!1,3:!1,4:!1}),B=()=>{n.value<tt&&n.value++},Q=()=>{n.value>1&&n.value--},A=oe=>{l.value=oe,B()},Y=()=>{i("close")},ae=()=>{window.open(o,"_blank")},xe=()=>{n.value=5},we=K(()=>Object.values(C.value).filter(Boolean).length/4*100),U=K(()=>d.value==="success"?"success":d.value==="error"?"error":"primary"),te=K(()=>d.value==="success"?"mdi-check-circle":d.value==="error"?"mdi-alert-circle":d.value==="registering"?"mdi-progress-clock":"mdi-rocket-launch"),D=K(()=>d.value==="success"?"ÂÆåÊàêÔºÅËÆæÂ§áÂ∑≤ÂàõÂª∫":d.value==="error"?"ÂàõÂª∫Â§±Ë¥•":d.value==="registering"?"Ê≠£Âú®ÊâßË°å‚Ä¶":"ÂáÜÂ§áÂºÄÂßã"),P=oe=>{const v=new Date,se=String(v.getHours()).padStart(2,"0"),T=String(v.getMinutes()).padStart(2,"0"),$=String(v.getSeconds()).padStart(2,"0");k.value.push({time:`${se}:${T}:${$}`,message:oe})},b=()=>"Classworks",N=async()=>{var oe,v,se;if(d.value!=="registering"){d.value="registering",u.value="",k.value=[],C.value={1:!1,2:!1,3:!1,4:!1};try{P("Ê≠£Âú®ÁîüÊàêËÆæÂ§á‰ø°ÊÅØ‚Ä¶");const T=Ql(),$=b(),F=_("server.domain");C.value[1]=!0,P("ÂêëÊúçÂä°Âô®Ê≥®ÂÜåËÆæÂ§á‚Ä¶");const le=await Ae.post(`${F}/devices`,{uuid:T,deviceName:$});C.value[2]=!0,f.value={uuid:T,deviceName:$,createdAt:new Date().toISOString(),registered:!0},localStorage.setItem("Classworks_progressive_device",JSON.stringify(f.value)),P("Ëé∑ÂèñËÆøÈóÆ‰ª§Áâå‚Ä¶");try{const j=await Ae.post(`${F}/apps/auth/token`,{namespace:T,password:"",appId:"d158067f53627d2b98babe8bffd2fd7d"});j.data&&j.data.token?(h.value=j.data,be("server.kvToken",j.data.token),(oe=j.data.device)!=null&&oe.uuid&&be("device.uuid",j.data.device.uuid),P("Â∑≤Ëé∑Âèñ Token Âπ∂ÂÜôÂÖ•ÈÖçÁΩÆ")):P("Êú™ËøîÂõû TokenÔºåÊÇ®ÂèØ‰ª•Á®çÂêéÂú®ÊéàÊùÉÈ°µÂÆåÊàêÈÖçÁΩÆ")}catch(j){console.warn("Ëá™Âä®Ëé∑Âèñ Token Â§±Ë¥•:",j),P("Ëá™Âä®Ëé∑Âèñ Token Â§±Ë¥•ÔºåÂèØÂú®ÊéàÊùÉÈ°µÊâãÂä®ÂÆåÊàê")}C.value[3]=!0,P("ÂÆåÊàêÔºÅÊÇ®ÂèØ‰ª•Â∫îÁî®‰ª§ÁâåÊàñÂâçÂæÄÊéàÊùÉÈ°µÈù¢ÁªßÁª≠ÈÖçÁΩÆ"),C.value[4]=!0,d.value="success"}catch(T){console.error("ËÆæÂ§áÊ≥®ÂÜåÂ§±Ë¥•:",T),u.value=((se=(v=T.response)==null?void 0:v.data)==null?void 0:se.message)||T.message||"ÁΩëÁªúËøûÊé•Â§±Ë¥•",P("Â§±Ë¥•Ôºö"+u.value),d.value="error"}}},O=()=>{d.value="idle",u.value="",k.value=[],C.value={1:!1,2:!1,3:!1,4:!1}},q=()=>{const oe=f.value;if(!(oe!=null&&oe.uuid))return;const se=`${_("server.authDomain")}/?uuid=${encodeURIComponent(oe.uuid)}&tolinktoaccount=true`;window.open(se,"_blank")},he=()=>{h.value&&i("success",h.value),i("close")};return(oe,v)=>(m(),x(I,{class:"guide-card"},{default:a(()=>[s(At,{"model-value":n.value/tt*100,color:"primary",height:"6"},null,8,["model-value"]),s(z,{class:"pa-8"},{default:a(()=>[ve(r("div",Jl,[r("div",Yl,[s(E,{class:"mb-4",color:"primary",size:"80"},{default:a(()=>[...v[2]||(v[2]=[c(" mdi-hand-wave ",-1)])]),_:1}),v[3]||(v[3]=r("h2",{class:"text-h4 mb-3"}," Ê¨¢Ëøé‰ΩøÁî® Classworks ",-1)),v[4]||(v[4]=r("p",{class:"text-body-1 text-medium-emphasis"}," ÈÄÇÁî®‰∫éÁè≠Á∫ßÂ§ßÂ±èÁöÑ‰Ωú‰∏öÊùøÂ∞èÂ∑•ÂÖ∑ ",-1))])],512),[[Re,n.value===1]]),ve(r("div",Xl,[v[17]||(v[17]=r("h3",{class:"text-h5 mb-6 text-center"}," Classworks Âíå Classworks KV ÁöÑÂÖ≥Á≥ª ",-1)),s(I,{class:"pa-6 mb-6",color:"primary",variant:"tonal"},{default:a(()=>[r("div",Zl,[r("div",eo,[s(I,{class:"pa-4",color:"blue-darken-1",elevation:"8"},{default:a(()=>[r("div",to,[s(E,{color:"white",size:"60"},{default:a(()=>[...v[5]||(v[5]=[c(" mdi-laptop ",-1)])]),_:1}),v[6]||(v[6]=r("h4",{class:"text-h6 text-white mt-2"}," Classworks ",-1)),v[7]||(v[7]=r("p",{class:"text-caption text-white mt-1"}," ‰Ωú‰∏öÊùøÂ∫îÁî® ",-1))])]),_:1}),r("div",so,[s(G,{class:"mb-2",color:"blue",size:"small",variant:"flat"},{default:a(()=>[...v[8]||(v[8]=[c(" ÂâçÁ´ØÂ∫îÁî® ",-1)])]),_:1}),v[9]||(v[9]=r("div",{class:"text-body-2"},[c(" ‚Ä¢ ÊòæÁ§∫‰Ωú‰∏öÂÜÖÂÆπ"),r("br"),c(" ‚Ä¢ ÁÆ°ÁêÜÁè≠Á∫ß‰ø°ÊÅØ"),r("br"),c(" ‚Ä¢ Êèê‰æõÁî®Êà∑ÁïåÈù¢ ")],-1))])]),r("div",no,[s(E,{color:"primary",size:"40"},{default:a(()=>[...v[10]||(v[10]=[c(" mdi-swap-horizontal ",-1)])]),_:1}),v[11]||(v[11]=r("div",{class:"text-caption font-weight-bold mt-2"}," Êï∞ÊçÆÂêåÊ≠• ",-1))]),r("div",ao,[s(I,{class:"pa-4",color:"green-darken-1",elevation:"8"},{default:a(()=>[r("div",io,[s(E,{color:"white",size:"60"},{default:a(()=>[...v[12]||(v[12]=[c(" mdi-cloud-sync ",-1)])]),_:1}),v[13]||(v[13]=r("h4",{class:"text-h6 text-white mt-2"}," Classworks KV ",-1)),v[14]||(v[14]=r("p",{class:"text-caption text-white mt-1"}," ‰∫ëÁ´ØÊï∞ÊçÆÂ∫ì ",-1))])]),_:1}),r("div",lo,[s(G,{class:"mb-2",color:"green",size:"small",variant:"flat"},{default:a(()=>[...v[15]||(v[15]=[c(" ÂêéÁ´ØÊúçÂä° ",-1)])]),_:1}),v[16]||(v[16]=r("div",{class:"text-body-2"},[c(" ‚Ä¢ Â≠òÂÇ®‰Ωú‰∏öÊï∞ÊçÆ"),r("br"),c(" ‚Ä¢ Â§öËÆæÂ§áÂêåÊ≠•"),r("br"),c(" ‚Ä¢ ÊùÉÈôêÁÆ°ÁêÜ ")],-1))])])])]),_:1})],512),[[Re,n.value===2]]),ve(r("div",oo,[v[25]||(v[25]=r("h3",{class:"text-h5 mb-6 text-center"}," ‰Ω†ÈúÄË¶ÅÂú®Â§ö‰∏™ËÆæÂ§á‰∏äÊü•Áúã‰Ωú‰∏öÂêóÔºü ",-1)),s(I,{class:"mb-6 pa-4",color:"info",variant:"tonal"},{default:a(()=>[...v[18]||(v[18]=[r("div",{class:"text-body-2"}," ÊØîÂ¶ÇÔºöÂú®ÂÆ∂ÈáåÁîµËÑë„ÄÅÊâãÊú∫‰∏äÊü•ÁúãÔºåÊàñËÄÖÂ§ö‰∏™ÊïôÂÆ§ËÆæÂ§áÂÖ±‰∫´Êï∞ÊçÆ ",-1)])]),_:1}),r("div",ro,[s(y,{block:"",class:"mb-4 py-6",color:"primary",size:"x-large",variant:"elevated",onClick:v[0]||(v[0]=se=>A("cloud"))},{default:a(()=>[r("div",uo,[s(E,{class:"mb-2",size:"40"},{default:a(()=>[...v[19]||(v[19]=[c(" mdi-cloud-check ",-1)])]),_:1}),v[20]||(v[20]=r("span",{class:"text-h6"},"ÈúÄË¶ÅÔºå‰ΩøÁî®‰∫ëÂêåÊ≠•",-1)),v[21]||(v[21]=r("span",{class:"text-caption mt-1"},"Â§öËÆæÂ§áËÆøÈóÆ",-1))])]),_:1}),s(y,{block:"",class:"py-6",size:"x-large",variant:"outlined",onClick:v[1]||(v[1]=se=>A("local"))},{default:a(()=>[r("div",co,[s(E,{class:"mb-2",size:"40"},{default:a(()=>[...v[22]||(v[22]=[c(" mdi-laptop ",-1)])]),_:1}),v[23]||(v[23]=r("span",{class:"text-h6"},"‰∏çÈúÄË¶ÅÔºåÂè™Áî®ËøôÂè∞ËÆæÂ§á",-1)),v[24]||(v[24]=r("span",{class:"text-caption mt-1"},"Êú¨Âú∞Â≠òÂÇ®",-1))])]),_:1})])],512),[[Re,n.value===3]]),ve(r("div",mo,[r("div",fo,[s(E,{class:"mb-4",color:"success",size:"80"},{default:a(()=>[...v[26]||(v[26]=[c(" mdi-check-circle ",-1)])]),_:1}),v[28]||(v[28]=r("h3",{class:"text-h5 mb-4"}," ÊÇ®ÂèØ‰ª•‰ΩøÁî®Êú¨Âú∞Ê®°Âºè ",-1)),s(I,{class:"pa-4 text-left",variant:"tonal"},{default:a(()=>[...v[27]||(v[27]=[r("div",{class:"text-body-1 mb-2"}," Ê≠§Êï∞ÊçÆÂ∞ÜÂ≠òÂÇ®Âú®ÊÇ®ÁöÑÊµèËßàÂô®‰∏≠ÔºåÂ¶ÇÊûúÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅIndexedDBÔºåÂèØËÉΩ‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇÂ¶ÇÊûúÊÇ®ÁªèÂ∏∏Ê∏ÖÈô§ÊµèËßàÂô®Êï∞ÊçÆÔºåËØ∑Ë∞®ÊÖé‰ΩøÁî®Êú¨Âú∞Ê®°Âºè„ÄÇ ",-1),r("div",{class:"text-body-1 mb-2"}," Âú®ÂàöÊâçÂú∞ÊñπÁÇπÂáª‰ΩøÁî®Êú¨Âú∞Ê®°ÂºèÁöÑÊåâÈíÆ‰ΩøÁî®„ÄÇ ",-1)])]),_:1})])],512),[[Re,n.value===4&&l.value==="local"]]),ve(r("div",ho,[r("div",go,[s(E,{class:"mb-4",color:"primary",size:"80"},{default:a(()=>[...v[29]||(v[29]=[c(" mdi-cloud-cog ",-1)])]),_:1}),v[30]||(v[30]=r("h3",{class:"text-h5 mb-4"}," ÈúÄË¶ÅÂÖàËÆæÁΩÆ‰∫ëÁ´ØË¥¶Âè∑ ",-1))]),s(I,{class:"pa-6 mb-6",variant:"tonal"},{default:a(()=>[r("div",vo,[r("div",po,[v[32]||(v[32]=r("h4",{class:"text-h6 font-weight-bold mb-2"}," Ëá™Âä®Ê≥®ÂÜåËÆæÂ§á ",-1)),v[33]||(v[33]=r("p",{class:"text-body-2 mb-3 text-medium-emphasis"}," ÈÄöËøáÂºïÂØºÂºèÊµÅÁ®ãËá™Âä®ÂàõÂª∫ËÆæÂ§á„ÄÅËé∑Âèñ‰ª§ÁâåÂπ∂ÂÆåÊàêÂàùÂßãÂåñ„ÄÇÈÄÇÂêàÈ¶ñÊ¨°‰ΩìÈ™åÊàñÂø´ÈÄüÈÉ®ÁΩ≤Â§öÁªàÁ´Ø„ÄÇ ",-1)),s(y,{color:"primary","prepend-icon":"mdi-flash",size:"large",variant:"elevated",onClick:xe},{default:a(()=>[...v[31]||(v[31]=[c(" Ëá™Âä®Ê≥®ÂÜå ",-1)])]),_:1})])])]),_:1}),v[41]||(v[41]=r("div",{class:"mb-6"}," ‰πüÂèØ‰ª•ÊâãÂä®ÂâçÂæÄ Classworks KV ÊéßÂà∂Âè∞Ëé∑ÂèñËÆ§ËØÅ‰ø°ÊÅØÔºö ",-1)),s(I,{color:Ge(o)=="https://kv.houlang.cloud"?"primary":"error",variant:Ge(o)=="https://kv.houlang.cloud"?"elevated":"outlined",class:"pa-6 mb-6",onClick:ae},{default:a(()=>[s(E,{class:"mb-3",size:"48"},{default:a(()=>[...v[34]||(v[34]=[c(" mdi-open-in-new ",-1)])]),_:1}),r("h4",yo," ËØ∑ËÆøÈóÆ "+g(Ge(o)=="https://kv.houlang.cloud"?"Classworks KV":"Ëá™ÂÆö‰πâÁöÑ Classworks KV ÂÆû‰æã ")+" ÊéßÂà∂Âè∞ ",1),r("div",ko,g(Ge(o)),1),r("h6",bo,g(Ge(o)=="https://kv.houlang.cloud"?"Ê≠§ÂÆû‰æãÁî± Classworks KV ÂÆòÊñπÊèê‰æõ":"Ê≠§ÈìæÊé•Áî±ÊÇ®ÁöÑÂÆû‰æã„ÄÅÈ¢ÑÈÖç‰ª£Á†ÅÊàñÁÆ°ÁêÜÂëòÁÆ°ÁêÜÔºåÂΩìÂâçÂèØËÉΩ‰∏çÊòØ Classworks KV ÂÆòÊñπÁöÑÂÆû‰æãÂú∞ÂùÄ„ÄÇ"),1)]),_:1},8,["color","variant"]),s(Dn,{class:"mt-6",variant:"accordion"},{default:a(()=>[s(Rt,null,{default:a(()=>[s(Lt,null,{default:a(()=>[r("div",xo,[s(E,{class:"mr-3",color:"warning"},{default:a(()=>[...v[35]||(v[35]=[c(" mdi-help-circle ",-1)])]),_:1}),v[36]||(v[36]=r("span",{class:"text-subtitle-1 font-weight-medium"},"Êàë‰ª•ÂâçÂ∑≤Áªè‰ΩøÁî®Ëøá Classworks KVÔºü",-1))])]),_:1}),s(Ot,null,{default:a(()=>[s(I,{class:"pa-4",color:"success",variant:"tonal"},{default:a(()=>[...v[37]||(v[37]=[r("div",{class:"text-body-2 mb-2"},[c(" Â¶ÇÊûúÊÇ®‰πãÂâçÂ∑≤Áªè‰ΩøÁî®Ëøá Classworks KVÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÊÇ®ÁöÑ "),r("strong",null,"UUIDÔºàÂëΩÂêçÁ©∫Èó¥Ôºâ"),c(" Âíå "),r("strong",null,"ËÆæÁΩÆÁöÑÂØÜÁ†Å"),c(" ËøõË°åËÆ§ËØÅ„ÄÇ ")],-1),r("div",{class:"text-body-2"},' ËøîÂõû‰∏ä‰∏ÄÈ°µÔºåÁÇπÂáª"Â∑≤Ê≥®ÂÜå"ÊåâÈíÆÔºåËæìÂÖ•ÊÇ®ÁöÑËÆ§ËØÅ‰ø°ÊÅØÂç≥ÂèØÁôªÂΩï„ÄÇ ',-1)])]),_:1})]),_:1})]),_:1}),s(Rt,null,{default:a(()=>[s(Lt,null,{default:a(()=>[r("div",wo,[s(E,{class:"mr-3",color:"info"},{default:a(()=>[...v[38]||(v[38]=[c(" mdi-help-circle ",-1)])]),_:1}),v[39]||(v[39]=r("span",{class:"text-subtitle-1 font-weight-medium"},"ÊàëÂ¶Ç‰ΩïÈÖçÁΩÆ‰∏çÂêåÁ±ªÂûãÁöÑËÆæÂ§áÔºü",-1))])]),_:1}),s(Ot,null,{default:a(()=>[s(I,{class:"pa-4",color:"info",variant:"tonal"},{default:a(()=>[...v[40]||(v[40]=[r("div",{class:"text-body-2 mb-2"},[c(" ‰∏çÂêåÁöÑÂØÜÁ†ÅÂØπÂ∫î‰∏çÂêåÁöÑËÆæÂ§áÁ±ªÂûãÔºåËøôÂ∞ÜÁî± "),r("strong",null,"ÁÆ°ÁêÜÂëòÁÆ°ÁêÜ"),c("„ÄÇ ")],-1),r("div",{class:"text-body-2 mb-2"}," ‰æãÂ¶ÇÔºö ",-1),r("ul",{class:"text-body-2 ml-4"},[r("li",{class:"mb-1"}," Áè≠Á∫ßÂ§ßÂ±è‰ΩøÁî®‰∏Ä‰∏™ÂØÜÁ†Å "),r("li",{class:"mb-1"}," ÊïôÂ∏àËÆæÂ§á‰ΩøÁî®Âè¶‰∏Ä‰∏™ÂØÜÁ†Å "),r("li",null,"Â≠¶ÁîüËÆæÂ§á‰ΩøÁî®‰∏çÂêåÁöÑÂØÜÁ†Å")],-1),r("div",{class:"text-body-2 mt-3"}," ËØ∑ËÅîÁ≥ªÊÇ®ÁöÑÁÆ°ÁêÜÂëòËé∑ÂèñÂØπÂ∫îËÆæÂ§áÁ±ªÂûãÁöÑÂØÜÁ†Å„ÄÇ ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[Re,n.value===4&&l.value==="cloud"]]),ve(r("div",So,[r("div",Co,[s(Oe,{class:"mb-4",color:"primary",size:"80",variant:"tonal"},{default:a(()=>[s(E,{size:"48"},{default:a(()=>[...v[42]||(v[42]=[c(" mdi-rocket-launch ",-1)])]),_:1})]),_:1}),v[43]||(v[43]=r("h3",{class:"text-h5 font-weight-bold mb-2"}," Ê∏êËøõÂºèÊ≥®ÂÜå ",-1)),v[44]||(v[44]=r("p",{class:"text-body-2 text-medium-emphasis"}," ÊÇ®ÂèØ‰ª•ÊöÇÊó∂‰∏çÈÖçÁΩÆ Classworks KV ",-1))]),s(At,{"model-value":we.value,class:"mb-6",color:"primary",height:"8",rounded:""},null,8,["model-value"]),s(Ce,null,{default:a(()=>[s(fe,{cols:"12"},{default:a(()=>[s(I,{color:U.value,variant:"tonal"},{default:a(()=>[s(Je,null,{default:a(()=>[r("div",Do,[s(E,{color:U.value,class:"mr-2",size:"32"},{default:a(()=>[c(g(te.value),1)]),_:1},8,["color"]),r("div",_o,g(D.value),1)]),f.value?(m(),p("div",To,[r("div",Io,[v[45]||(v[45]=r("strong",null,"ËÆæÂ§áÂêçÁß∞Ôºö",-1)),c(g(f.value.deviceName),1)]),r("div",null,[v[46]||(v[46]=r("strong",null,"ËÆæÂ§á UUIDÔºö",-1)),r("code",Eo,g(f.value.uuid),1)])])):S("",!0),d.value==="error"?(m(),p("div",Vo,g(u.value),1)):S("",!0)]),_:1})]),_:1},8,["color"])]),_:1}),s(fe,{cols:"12"},{default:a(()=>[s(I,{variant:"outlined"},{default:a(()=>[s(Je,null,{default:a(()=>[v[47]||(v[47]=r("div",{class:"text-subtitle-2 font-weight-medium mb-3"}," ËøáÁ®ãÊó•Âøó ",-1)),r("div",No,[(m(!0),p(V,null,R(k.value,(se,T)=>(m(),p("div",{key:T,class:"text-caption log-line"},g(se.time)+" ¬∑ "+g(se.message),1))),128)),k.value.length?S("",!0):(m(),p("div",Ao," Á≠âÂæÖÂºÄÂßã‚Ä¶ "))])]),_:1})]),_:1})]),_:1})]),_:1}),r("div",Uo,[d.value==="idle"?(m(),x(y,{key:0,color:"primary","prepend-icon":"mdi-play",size:"large",onClick:N},{default:a(()=>[...v[48]||(v[48]=[c(" ÂºÄÂßãÂàõÂª∫ ",-1)])]),_:1})):S("",!0),d.value==="error"?(m(),x(y,{key:1,color:"error","prepend-icon":"mdi-refresh",variant:"outlined",onClick:O},{default:a(()=>[...v[49]||(v[49]=[c(" ÈáçËØï ",-1)])]),_:1})):S("",!0),d.value==="registering"?(m(),x(y,{key:2,loading:!0,color:"primary","prepend-icon":"mdi-progress-clock",variant:"tonal"},{default:a(()=>[...v[50]||(v[50]=[c(" Ê≠£Âú®ÊâßË°å‚Ä¶ ",-1)])]),_:1})):S("",!0),d.value==="success"?(m(),x(y,{key:3,color:"success","prepend-icon":"mdi-check-circle",size:"large",variant:"elevated",onClick:he},{default:a(()=>[...v[51]||(v[51]=[c(" Â∫îÁî®‰ª§ÁâåÂπ∂ÂÖ≥Èó≠ ",-1)])]),_:1})):S("",!0),d.value==="success"?(m(),x(y,{key:4,color:"primary","prepend-icon":"mdi-open-in-new",size:"large",variant:"outlined",onClick:q},{default:a(()=>[...v[52]||(v[52]=[c(" ÂâçÂæÄÁªëÂÆöË¥¶Êà∑ ",-1)])]),_:1})):S("",!0)])],512),[[Re,n.value===5]])]),_:1}),s(ue,{class:"pa-6 pt-0"},{default:a(()=>[n.value>1?(m(),x(y,{key:0,size:"large",variant:"text",onClick:Q},{default:a(()=>[s(E,{start:""},{default:a(()=>[...v[53]||(v[53]=[c(" mdi-chevron-left ",-1)])]),_:1}),v[54]||(v[54]=c(" ‰∏ä‰∏ÄÊ≠• ",-1))]),_:1})):S("",!0),s(H),n.value<tt&&n.value!==4?(m(),x(y,{key:1,disabled:n.value===3&&!l.value,color:"primary",size:"large",variant:"elevated",onClick:B},{default:a(()=>[v[56]||(v[56]=c(" ‰∏ã‰∏ÄÊ≠• ",-1)),s(E,{end:""},{default:a(()=>[...v[55]||(v[55]=[c(" mdi-chevron-right ",-1)])]),_:1})]),_:1},8,["disabled"])):S("",!0),n.value===tt||n.value===4?(m(),x(y,{key:2,color:"primary",size:"large",variant:"elevated",onClick:Y},{default:a(()=>[...v[57]||(v[57]=[c(" ÂÖ≥Èó≠ ",-1)])]),_:1})):S("",!0)]),_:1})]),_:1}))}},Po=ie(zo,[["__scopeId","data-v-817c6e0e"]]),Fo={key:0,class:"init-overlay"},Mo={class:"init-container"},$o={class:"main-card-row"},Ro={class:"card-horizontal-layout"},Lo={class:"card-icon-wrapper"},Oo={class:"card-horizontal-layout"},Bo={class:"card-icon-wrapper"},jo={class:"card-horizontal-layout"},Ho={class:"card-icon-wrapper"},Ko={class:"options-buttons"},qo={__name:"InitServiceChooser",props:{preconfig:{type:Object,default:()=>({namespace:null,authCode:null,autoOpen:!1,autoExecute:!1})}},emits:["done"],setup(t,{emit:e}){const i=t,o=e,n=L(!1),l=L(!1),d=L(!1),u=L(!1),f=L(!1),h=L(null),k=K(()=>_("server.provider")),C=K(()=>k.value==="kv-server"||k.value==="classworkscloud"),B=K(()=>_("server.kvToken")),Q=K(()=>{var P;return(P=i.preconfig)!=null&&P.namespace?{namespace:i.preconfig.namespace,password:i.preconfig.authCode||"",autoExecute:i.preconfig.autoExecute||!1}:null}),A=()=>{const P=window.location.pathname,b=P==="/"||P==="/index"||P==="/index.html",N=C.value&&(!B.value||B.value==="");n.value=b&&N};ze(()=>i.preconfig,P=>{P!=null&&P.autoOpen&&(P!=null&&P.namespace)&&n.value&&(console.log("Ê£ÄÊµãÂà∞È¢ÑÈÖçÊï∞ÊçÆÔºåËá™Âä®ÊâìÂºÄËÆæÂ§áËÆ§ËØÅÂØπËØùÊ°Ü"),setTimeout(()=>{d.value=!0},500))},{immediate:!0,deep:!0}),gt(()=>{A()});const Y=()=>{const P=_("server.authDomain"),b="d158067f53627d2b98babe8bffd2fd7d",N=window.location.origin,O=encodeURIComponent(`${N}/authorizecallback`),q=_("device.uuid")||"00000000-0000-4000-8000-000000000000";let he=`${P}/authorize?app_id=${b}&mode=callback&callback_url=${O}&remark=Classworks Ëá™Âä®ÊéàÊùÉ Êù•Ëá™${window.location.hostname} ${new Date().toLocaleString()}`;q!=="00000000-0000-4000-8000-000000000000"&&(he+=`&uuid=${encodeURIComponent(q)}`),window.location.href=he},ae=P=>{l.value=!1,console.log("Ê∏êËøõÂºèÊ≥®ÂÜåÊàêÂäü:",P),A(),o("done")},xe=P=>{var b;d.value=!1,console.log("ËÆ§ËØÅÊàêÂäü:",P),(b=i.preconfig)!=null&&b.namespace&&console.log(`È¢ÑÈÖçÊï∞ÊçÆËÆ§ËØÅÊàêÂäü: ${i.preconfig.namespace}`),A(),o("done")},we=()=>{u.value=!1,A(),o("done")},U=P=>{console.log("Êõø‰ª£‰ª£Á†Å:",P),f.value=!1},te=()=>{be("server.provider","kv-local"),n.value=!1,window.location.reload(),o("done")},D=()=>{window.open(_("server.authDomain"),"_blank")};return(P,b)=>n.value?(m(),p("div",Fo,[r("div",Mo,[b[22]||(b[22]=r("div",{class:"init-header"},[r("div",{class:"title"}," Ê¨¢Ëøé‰ΩøÁî® Classworks "),r("div",{class:"subtitle"}," ËØ∑ÈÄâÊã©‰Ω†ÁöÑ‰ΩøÁî®ÊñπÂºè ")],-1)),r("div",$o,[s(I,{class:"main-service-card gradient-new clickable",elevation:"4",onClick:b[0]||(b[0]=N=>l.value=!0)},{default:a(()=>[s(Je,null,{default:a(()=>[r("div",Ro,[r("div",Lo,[s(E,{color:"primary",size:"48"},{default:a(()=>[...b[12]||(b[12]=[c(" mdi-new-box ",-1)])]),_:1})]),b[13]||(b[13]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," ÂàùÊ¨°‰ΩøÁî® "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ‰∫ÜËß£ Classworks KV Âπ∂ÂºÄÂßã‰ΩøÁî® ")],-1))])]),_:1})]),_:1}),s(I,{class:"main-service-card gradient-registered clickable",elevation:"4",onClick:b[1]||(b[1]=N=>d.value=!0)},{default:a(()=>[s(Je,null,{default:a(()=>[r("div",Oo,[r("div",Bo,[s(E,{color:"success",size:"48"},{default:a(()=>[...b[14]||(b[14]=[c(" mdi-account-check ",-1)])]),_:1})]),b[15]||(b[15]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," Â∑≤Ê≥®ÂÜå "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ‰ΩøÁî®ËÆæÂ§á Namespace ÁôªÂΩï ")],-1))])]),_:1})]),_:1}),s(I,{class:"main-service-card clickable",elevation:"4",onClick:D},{default:a(()=>[s(Je,null,{default:a(()=>[r("div",jo,[r("div",Ho,[s(E,{color:"info",size:"48"},{default:a(()=>[...b[16]||(b[16]=[c(" mdi-database-cog ",-1)])]),_:1})]),b[17]||(b[17]=r("div",{class:"card-content"},[r("div",{class:"text-h6 font-weight-bold"}," Classworks KV "),r("div",{class:"text-body-2 text-medium-emphasis mt-1"}," ÊâìÂºÄ‰∫ëÁ´ØÊéßÂà∂Âè∞ÁÆ°ÁêÜÊï∞ÊçÆ ")],-1))])]),_:1})]),_:1})]),r("div",Ko,[s(y,{"prepend-icon":"mdi-laptop",size:"small",variant:"tonal",onClick:te},{default:a(()=>[...b[18]||(b[18]=[c(" ‰ΩøÁî®Êú¨Âú∞Ê®°Âºè ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-flash",size:"small",variant:"tonal",onClick:Y},{default:a(()=>[...b[19]||(b[19]=[c(" ÊéàÊùÉÁ†ÅÂºèÊéàÊùÉÔºàÂºÉÁî®Ôºâ ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-key",size:"small",variant:"tonal",onClick:b[2]||(b[2]=N=>u.value=!0)},{default:a(()=>[...b[20]||(b[20]=[c(" ËæìÂÖ• Token ",-1)])]),_:1}),s(y,{"prepend-icon":"mdi-code-tags",size:"small",variant:"tonal",onClick:b[3]||(b[3]=N=>f.value=!0)},{default:a(()=>[...b[21]||(b[21]=[c(" ËæìÂÖ•Êõø‰ª£‰ª£Á†Å ",-1)])]),_:1})]),b[23]||(b[23]=r("div",{class:"footer-hint"}," ÂÆåÊàêÊéàÊùÉÂêéÂèØ‰ΩøÁî®‰Ωú‰∏öÂêåÊ≠•„ÄÅËÄÉËØïÁúãÊùøÁ≠âÂú®Á∫øÂäüËÉΩ„ÄÇ ",-1))]),s(de,{modelValue:l.value,"onUpdate:modelValue":b[5]||(b[5]=N=>l.value=N),"max-width":"600"},{default:a(()=>[s(Po,{onClose:b[4]||(b[4]=N=>l.value=!1),onSuccess:ae})]),_:1},8,["modelValue"]),s(de,{modelValue:d.value,"onUpdate:modelValue":b[7]||(b[7]=N=>d.value=N),"max-width":"500"},{default:a(()=>[s(Ol,{ref_key:"deviceAuthDialog",ref:h,preconfig:Q.value,"show-cancel":!0,onCancel:b[6]||(b[6]=N=>d.value=!1),onSuccess:xe},null,8,["preconfig"])]),_:1},8,["modelValue"]),s(de,{modelValue:u.value,"onUpdate:modelValue":b[9]||(b[9]=N=>u.value=N),"max-width":"500"},{default:a(()=>[s(Bl,{"show-cancel":!0,onCancel:b[8]||(b[8]=N=>u.value=!1),onSuccess:we})]),_:1},8,["modelValue"]),s(de,{modelValue:f.value,"onUpdate:modelValue":b[11]||(b[11]=N=>f.value=N),"max-width":"500"},{default:a(()=>[s(jl,{"show-cancel":!0,onCancel:b[10]||(b[10]=N=>f.value=!1),onSubmit:U})]),_:1},8,["modelValue"])])):S("",!0)}},ps=ie(qo,[["__scopeId","data-v-cbfbc6db"]]),Wo={name:"ExamScheduleCard",props:{examId:{type:String,required:!0},contentStyle:{type:Object,default:()=>({})}},computed:{...Gt(Ze,["exams","loadingDetails"]),exam(){return this.exams[this.examId]},loading(){return this.loadingDetails[this.examId]}},mounted(){this.fetchExam(this.examId)},methods:{...Wt(Ze,["fetchExam"]),formatTime(t){if(!t)return"";try{const e=new Date(t),i=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0"),n=e.getHours().toString().padStart(2,"0"),l=e.getMinutes().toString().padStart(2,"0");return`${i}-${o} ${n}:${l}`}catch{return t}}}},Go={class:"text-truncate"},Qo={key:0,class:"d-flex justify-center align-center fill-height",style:{"min-height":"200px"}},Jo={class:"d-flex align-center mb-1"},Yo={class:"font-weight-medium"},Xo={class:"d-flex align-center"},Zo={class:"font-weight-medium"},er={key:2,class:"d-flex flex-column align-center justify-center fill-height text-grey mt-4"};function tr(t,e,i,o,n,l){return m(),x(I,{class:"fill-height d-flex flex-column rounded-xl",elevation:"2"},{default:a(()=>[s(Z,{class:"d-flex align-center py-3 px-4 bg-primary text-white"},{default:a(()=>{var d;return[s(E,{class:"mr-2"},{default:a(()=>[...e[1]||(e[1]=[c("mdi-calendar-clock",-1)])]),_:1}),r("span",Go,g(((d=l.exam)==null?void 0:d.examName)||"Âä†ËΩΩ‰∏≠..."),1),s(H),s(y,{icon:"mdi-close",variant:"text",density:"comfortable",onClick:e[0]||(e[0]=u=>t.$emit("close"))})]}),_:1}),s(z,{class:"flex-grow-1 pa-4 overflow-y-auto",style:_e(i.contentStyle)},{default:a(()=>[l.loading?(m(),p("div",Qo,[s(Qt,{indeterminate:"",color:"primary"})])):l.exam?(m(),p(V,{key:1},[l.exam.message?(m(),x(Be,{key:0,color:"info",variant:"tonal",class:"mb-4 text-body-1",border:"start",density:"compact"},{default:a(()=>[c(g(l.exam.message),1)]),_:1})):S("",!0),s($e,{density:"comfortable",class:"pa-0 bg-transparent"},{default:a(()=>[(m(!0),p(V,null,R(l.exam.examInfos,(d,u)=>(m(),x(Pe,{key:u,class:"px-0 mb-3"},{prepend:a(()=>[s(Oe,{color:"primary",variant:"tonal",size:"large",class:"mr-3 font-weight-bold elevation-1"},{default:a(()=>[c(g(d.name.charAt(0)),1)]),_:2},1024)]),default:a(()=>[s(st,{class:"font-weight-bold text-h6 mb-1"},{default:a(()=>[c(g(d.name),1)]),_:2},1024),s(nt,{class:"text-body-1"},{default:a(()=>[r("div",Jo,[s(E,{size:"small",color:"success",class:"mr-2"},{default:a(()=>[...e[2]||(e[2]=[c("mdi-clock-start",-1)])]),_:1}),r("span",Yo,g(l.formatTime(d.start)),1)]),r("div",Xo,[s(E,{size:"small",color:"error",class:"mr-2"},{default:a(()=>[...e[3]||(e[3]=[c("mdi-clock-end",-1)])]),_:1}),r("span",Zo,g(l.formatTime(d.end)),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})],64)):(m(),p("div",er,[s(E,{size:"large",class:"mb-2"},{default:a(()=>[...e[4]||(e[4]=[c("mdi-alert-circle-outline",-1)])]),_:1}),e[5]||(e[5]=c(" Êó†Ê≥ïÂä†ËΩΩËÄÉËØï‰ø°ÊÅØ ",-1))]))]),_:1},8,["style"])]),_:1})}const sr=ie(Wo,[["render",tr],["__scopeId","data-v-52dc8ca5"]]);function dt(t,e){let i=null;return function(...o){i&&clearTimeout(i),i=setTimeout(()=>{t.apply(this,o)},e)}}function nr(t,e){let i=null,o=0;return function(...n){const l=Date.now();l-o<e?(i&&clearTimeout(i),i=setTimeout(()=>{o=l,t.apply(this,n)},e)):(o=l,t.apply(this,n))}}const ar={name:"Classworks ‰Ωú‰∏öÊùø",components:{MessageLog:Yt,RandomPicker:ss,FloatingToolbar:ls,FloatingICP:is,HomeworkEditDialog:rs,InitServiceChooser:ps,ChatWidget:it,StudentNameManager:vs,UrgentTestDialog:as,AttendanceSidebar:ds,AttendanceManagementDialog:os,HomeworkGrid:gs,HomeActions:cs,PwaInstallCard:us,ExamScheduleCard:sr,ExamConfigEditor:Ht},setup(){const{mobile:t}=Ye(),e=Ze();return{mobile:t,examStore:e}},data(){const t=[{name:"ËØ≠Êñá",order:0},{name:"Êï∞Â≠¶",order:1},{name:"Ëã±ËØ≠",order:2},{name:"Áâ©ÁêÜ",order:3},{name:"ÂåñÂ≠¶",order:4},{name:"ÁîüÁâ©",order:5},{name:"ÊîøÊ≤ª",order:6},{name:"ÂéÜÂè≤",order:7},{name:"Âú∞ÁêÜ",order:8},{name:"ÂÖ∂‰ªñ",order:9}];return{showAddExamDialog:!1,showExamDetailDialog:!1,selectedExamId:null,upcomingExams:[],dataKey:"",provider:"",useDisplay:Ye,state:{classNumber:"",namespaceInfo:null,deviceName:"",studentList:[],boardData:{homework:{},attendance:{absent:[],late:[],exclude:[]}},dialogVisible:!1,dialogTitle:"",textarea:"",dateString:"",synced:!1,attendDialogVisible:!1,contentStyle:{"font-size":`${_("font.size")}px`},uploadLoading:!1,downloadLoading:!1,snackbar:!1,snackbarText:"",fontSize:_("font.size"),datePickerDialog:!1,selectedDate:new Date().toISOString().split("T")[0].replace(/-/g,""),selectedDateObj:new Date,refreshInterval:null,showNoDataMessage:!1,noDataMessage:"",isToday:!1,attendanceDialog:!1,availableSubjects:t,isFullscreen:!1},loading:{download:!1,upload:!1,students:!1,copyToToday:!1},debouncedUpload:null,debouncedAttendanceSave:null,throttledReflow:null,sortedItemsCache:{key:"",value:[]},confirmDialog:{show:!1,resolve:null,reject:null},urlConfigDialog:{show:!1,config:null,changes:[],validSettings:{},confirmHandler:null,cancelHandler:null,icons:{}},settingsTick:0,isChatOpen:!1,highlightedCards:{},tokenDisplayInfo:{show:!1,readonly:!1,text:"",color:"primary",variant:"tonal",icon:"mdi-account",disabled:!1},realtimeInfo:{show:!1,time:"",key:""},$offKvChanged:null,$offConnect:null,debouncedRealtimeRefresh:null,preconfigData:{namespace:null,authCode:null,autoOpen:!1,autoExecute:!1},urgentTestDialog:!1,tokenInfo:null,persistentNotifications:[],notificationDetailDialog:!1,currentNotification:null}},computed:{isMobile(){return _("display.forceDesktopMode")?!1:this.mobile},titleText(){var d,u;const t=((u=(d=this.state.namespaceInfo)==null?void 0:d.device)==null?void 0:u.name)||this.state.classNumber||"È´ò‰∏âÂÖ´Áè≠",e=this.getToday(),i=new Date(e);i.setDate(i.getDate()-1);const o=this.state.dateString,n=this.formatDate(e),l=this.formatDate(i);return o===n?t+" - ‰ªäÂ§©ÁöÑ‰Ωú‰∏ö":o===l?t+" - Êò®Â§©ÁöÑ‰Ωú‰∏ö":`${t} - ${o}ÁöÑ‰Ωú‰∏ö`},sortedItems(){const t=[];this.isMobile&&t.push({key:"attendance-card",name:"Âá∫Âã§ÁªüËÆ°",type:"attendance",data:{total:this.state.studentList.length,absent:this.state.boardData.attendance.absent,late:this.state.boardData.attendance.late,exclude:this.state.boardData.attendance.exclude}});for(const e in this.state.boardData.homework)if(e.startsWith("exam-")){const i=this.state.boardData.homework[e];t.push({key:e,name:"ËÄÉËØïÂÆâÊéí",type:"exam",data:{examId:i.examId},order:-100,rowSpan:200})}for(const e of this.state.availableSubjects){const i=e.name,o=this.state.boardData.homework[i];if(o&&o.content){const l=100+o.content.split(`
`).filter(d=>d.trim()).length*24;t.push({key:i,name:i,type:"homework",content:o.content,order:e.order,rowSpan:l})}}_("hitokoto.enabled")&&t.push({key:"hitokoto-card",name:"‰∏ÄË®Ä",type:"hitokoto",order:9998,rowSpan:150});for(const e in this.state.boardData.homework)if(e.startsWith("custom-")){const i=this.state.boardData.homework[e],n=100+i.content.split(`
`).filter(l=>l.trim()).length*24;t.push({key:e,name:i.name,type:"custom",content:i.content,order:9999,rowSpan:n})}return t.sort((e,i)=>e.order-i.order),t},unusedSubjects(){const t=Object.keys(this.state.boardData.homework).filter(e=>{var i;return(i=this.state.boardData.homework[e].content)==null?void 0:i.trim()});return this.state.availableSubjects.filter(e=>!t.includes(e.name)).sort((e,i)=>e.order-i.order)},emptySubjects(){return this.emptySubjectDisplay!=="button"?[]:this.unusedSubjects},autoSave(){return _("edit.autoSave")},blockNonTodayAutoSave(){return _("edit.blockNonTodayAutoSave")},isToday(){const t=(()=>{const e=new Date,i=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${i}${o}${n}`})();return this.state.dateString===t},canAutoSave(){return this.autoSave&&(!this.blockNonTodayAutoSave||this.isToday)},needConfirmSave(){return!this.isToday&&this.confirmNonTodaySave},shouldShowBlockedMessage(){return!this.isToday&&this.autoSave&&this.blockNonTodayAutoSave},refreshBeforeEdit(){return _("edit.refreshBeforeEdit")},emptySubjectDisplay(){return _("display.emptySubjectDisplay")},dynamicSort(){return _("display.dynamicSort")},isEditingDisabled(){if(this.state.uploadLoading||this.state.downloadLoading)return!0;const t=this.$refs.studentNameManager;return!!(t!=null&&t.isReadOnly||!this.canEditCurrentDate)},unreadCount(){var t;return((t=this.$refs.messageLog)==null?void 0:t.unreadCount)||0},showRandomPickerButton(){return _("randomPicker.enabled")},showListCardButton(){return _("display.showListCard")},confirmNonTodaySave(){return _("edit.confirmNonTodaySave")},blockPastDataEdit(){return _("edit.blockPastDataEdit")},shouldShowSaveConfirm(){return!this.isToday&&this.confirmNonTodaySave},shouldBlockAutoSave(){return!this.isToday&&this.autoSave&&this.blockNonTodayAutoSave},canEditCurrentDate(){return this.isToday?!0:!this.blockPastDataEdit},isEditingPastData(){return!this.isToday},showFullscreenButton(){return _("display.showFullscreenButton")},showExamScheduleButton(){return _("display.showExamScheduleButton")},showAntiScreenBurnCard(){return _("display.showAntiScreenBurnCard")},showTestCardButton(){return _("developer.enabled")},shouldShowInit(){var n;const t=_("server.provider"),e=t==="kv-server"||t==="classworkscloud",i=_("server.kvToken"),o=((n=this.$route)==null?void 0:n.path)==="/";return this.settingsTick,o&&e&&(!i||i==="")},hasExamCard(){for(const t in this.state.boardData.homework)if(t.startsWith("exam-"))return!0;return!1},shouldShowUrgentTestButton(){const t=_("server.provider");return!(t==="kv-server"||t==="classworkscloud")||!_("server.kvToken")||!this.tokenInfo?!1:this.tokenInfo.deviceType==="teacher"||this.tokenInfo.deviceType==="classroom"},subjectOrder(){return[...this.state.availableSubjects].sort((t,e)=>t.order-e.order).map(t=>t.name)}},watch:{homeworkData:{handler(){this.$nextTick(()=>{this.$refs.waterfall&&this.$refs.waterfall.reflow()})},deep:!0},"$vuetify.display.width":{handler(){this.throttledReflow()},deep:!0},"state.attendanceDialog":{handler(t){this.handleAttendanceDialogClose(t)}}},created(){this.debouncedUpload=dt(this.uploadData,2e3),this.debouncedAttendanceSave=dt(async()=>{this.autoSave&&await this.trySave(!0)},2e3),this.throttledReflow=nr(()=>{this.$refs.gridContainer&&this.optimizeGridLayout(this.sortedItems)},200)},async mounted(){try{this.updateBackendUrl(),await this.initializeData(),await this.loadDeviceInfo(),this.setupAutoRefresh(),this.unwatchSettings=vt(()=>{this.updateSettings()}),this.$nextTick(()=>{const t=this.$refs.studentNameManager;t&&(this.studentNameInfo.name=t.currentStudentName||t.currentTeacherName||"",this.studentNameInfo.isStudent=t.isStudentToken,this.studentNameInfo.isTeacher=t.isTeacherToken,this.studentNameInfo.openDialog=()=>t.openDialog(),this.$watch(()=>t.currentStudentName,e=>{this.studentNameInfo.name=e,this.updateTokenDisplayInfo()}),this.$watch(()=>t.currentTeacherName,e=>{t.isTeacherToken&&(this.studentNameInfo.name=e,this.updateTokenDisplayInfo())}),this.$watch(()=>t.isStudentToken,e=>{this.studentNameInfo.isStudent=e,this.updateTokenDisplayInfo()}),this.$watch(()=>t.isTeacherToken,e=>{this.studentNameInfo.isTeacher=e,this.updateTokenDisplayInfo()}))}),document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.checkHashForRandomPicker(),window.addEventListener("hashchange",this.checkHashForRandomPicker),this.setupRealtimeChannel(),this.$nextTick(()=>{this.updateTokenDisplayInfo()}),await this.loadTokenInfo(),this.loadPersistentNotifications()}catch(t){console.error("ÂàùÂßãÂåñÂ§±Ë¥•:",t),this.showError("ÂàùÂßãÂåñÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï")}},beforeUnmount(){this.unwatchSettings&&this.unwatchSettings(),this.state.refreshInterval&&clearInterval(this.state.refreshInterval),document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),window.removeEventListener("hashchange",this.checkHashForRandomPicker);try{this.$offKvChanged&&typeof this.$offKvChanged=="function"&&(this.$offKvChanged(),this.$offKvChanged=null),this.$offDeviceEvent&&typeof this.$offDeviceEvent=="function"&&(this.$offDeviceEvent(),this.$offDeviceEvent=null),this.$offConnect&&typeof this.$offConnect=="function"&&(this.$offConnect(),this.$offConnect=null),dn()}catch(t){console.warn("‰∏ªÈ°µÈù¢‰∫ã‰ª∂Ê∏ÖÁêÜÂ§±Ë¥•:",t)}},methods:{async loadDeviceInfo(){var t;try{const e=_("server.provider");if(!(e==="kv-server"||e==="classworkscloud"))return;const o=await hn.loadNamespaceInfo();if(o&&o.success===!1)return;this.state.namespaceInfo=o||null,this.state.deviceName=((t=o==null?void 0:o.account)==null?void 0:t.deviceName)||""}catch(e){console.warn("Âä†ËΩΩËÆæÂ§á‰ø°ÊÅØÂ§±Ë¥•:",e)}},async loadTokenInfo(){try{const t=_("server.provider");if(!(t==="kv-server"||t==="classworkscloud"))return;const i=_("server.kvToken");if(!i)return;const o=_("server.domain");if(!o)return;const n=await Ae.get(`${o}/kv/_token`,{headers:{Authorization:`Bearer ${i}`}});this.tokenInfo=n.data,console.log("Token info loaded:",this.tokenInfo)}catch(t){console.warn("Failed to load token info:",t),this.tokenInfo=null}},updateTokenDisplayInfo(){const t=this.$refs.studentNameManager;if(!t||!t.hasToken){this.tokenDisplayInfo.show=!1,this.tokenDisplayInfo.readonly=!1;return}const e=t.displayName,i=t.isReadOnly,o=t.isStudentToken,n=t.isTeacherToken;if(this.tokenDisplayInfo.readonly=i,!o&&!n){this.tokenDisplayInfo.show=!1;return}this.tokenDisplayInfo.text=e,this.tokenDisplayInfo.color="primary",this.tokenDisplayInfo.icon=n?"mdi-school":"mdi-account",this.tokenDisplayInfo.disabled=i,this.tokenDisplayInfo.show=!0},handleTokenChipClick(){console.log("Token chip clicked");const t=this.$refs.studentNameManager;console.log("Manager:",t),console.log("Is student token:",t==null?void 0:t.isStudentToken),console.log("Is teacher token:",t==null?void 0:t.isTeacherToken),t&&(t.isStudentToken||t.isTeacherToken)?(console.log("Opening dialog..."),t.openDialog()):console.log("Cannot open dialog - conditions not met")},ensureDate(t){if(t instanceof Date)return t;if(typeof t=="string"){const e=new Date(t);if(!isNaN(e.getTime()))return e}return new Date},formatDate(t){const e=this.ensureDate(t),i=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${i}${o}${n}`},formatTime(t){return t?new Date(t).toLocaleString():""},getToday(){return new Date},async initializeData(){this.parsePreconfigData();const t=await this.parseUrlConfig(),i=new URLSearchParams(window.location.search).get("date"),o=this.getToday();let n=o;if(i){if(/^\d{8}$/.test(i)){const l=i.substring(0,4),d=i.substring(4,6),u=i.substring(6,8);n=new Date(`${l}-${d}-${u}`)}else n=new Date(i);isNaN(n.getTime())&&(n=o)}if(this.state.dateString=this.formatDate(n),this.state.selectedDate=this.state.dateString,this.state.selectedDateObj=n,this.state.isToday=this.formatDate(n)===this.formatDate(o),!t){this.provider=_("server.provider");const l=_("server.classNumber");this.state.classNumber=l}await Promise.all([this.downloadData(),this.loadConfig()]),await this.examStore.fetchExamList();for(const l of this.examStore.examList)this.examStore.fetchExam(l.id);this.checkUpcomingExams()},async checkUpcomingExams(){this.upcomingExams=await this.examStore.getUpcomingExams()},loadExamCards(){},saveExamCards(){},addExamCard(t,e=!1,i=!1){const o=`exam-${t}`;!e&&this.state.boardData.homework[o]?delete this.state.boardData.homework[o]:this.state.boardData.homework[o]={type:"exam",examId:t,name:"ËÄÉËØïÂÆâÊéí",content:""},this.state.synced=!1,i||this.trySave(!0)},openExamDetail(t){this.selectedExamId=t,this.showExamDetailDialog=!0},removeCurrentExamCard(){this.selectedExamId&&(this.addExamCard(this.selectedExamId),this.showExamDetailDialog=!1)},async onExamConfigSaved(){this.selectedExamId&&(delete this.examStore.exams[this.selectedExamId],await this.examStore.fetchExam(this.selectedExamId),this.$message.success("‰øùÂ≠òÊàêÂäü","ËÄÉËØïÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞"))},onExamConfigDeleted(){this.removeCurrentExamCard(),this.$message.success("Âà†Èô§ÊàêÂäü","ËÄÉËØïÈÖçÁΩÆÂ∑≤Âà†Èô§")},isExamCardAdded(t){return!!this.state.boardData.homework[`exam-${t}`]},removeExamCard(t){},addAllUpcomingExams(){let t=0;for(const e of this.upcomingExams)this.isExamCardAdded(e.id)||(this.addExamCard(e.id,!0,!0),t++);t>0?(this.trySave(!0),this.$message.success("Ê∑ªÂä†ÊàêÂäü",`Â∑≤Ê∑ªÂä† ${t} ‰∏™ËÄÉËØïÂÆâÊéí`)):this.$message.info("ÊèêÁ§∫","ÊâÄÊúâËÄÉËØïÂ∑≤Ê∑ªÂä†")},async downloadData(t=!1){var e,i,o;if(!this.loading.download)try{this.loading.download=!0;const n=await ce.loadData("classworks-data-"+this.state.dateString);if(n.success==!1)if(n.error.code==="NOT_FOUND")this.state.showNoDataMessage=!0,this.state.noDataMessage=n.error.message,(t||!this.state.boardData||!this.state.boardData.homework&&!this.state.boardData.attendance)&&(this.state.boardData={homework:{},attendance:{absent:[],late:[],exclude:[]}});else throw new Error(n.error.message);else this.state.boardData={homework:n.homework||{},attendance:{absent:((e=n.attendance)==null?void 0:e.absent)||[],late:((i=n.attendance)==null?void 0:i.late)||[],exclude:((o=n.attendance)==null?void 0:o.exclude)||[]}},this.state.synced=!0,this.state.showNoDataMessage=!1,this.$message.success("‰∏ãËΩΩÊàêÂäü","Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞")}catch(n){console.error("Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:",n),this.$message.error("‰∏ãËΩΩÂ§±Ë¥•",n.message),(t||!this.state.boardData||!this.state.boardData.homework&&!this.state.boardData.attendance)&&(this.state.boardData={homework:{},attendance:{absent:[],late:[],exclude:[]}})}finally{this.loading.download=!1}},async trySave(t=!1){if(t&&!this.canAutoSave)return this.shouldShowBlockedMessage&&this.showMessage("ÈúÄË¶ÅÊâãÂä®‰øùÂ≠ò","Â∑≤Á¶ÅÊ≠¢Ëá™Âä®‰øùÂ≠òÈùûÂΩìÂ§©Êï∞ÊçÆ","warning"),!1;if(!t&&this.needConfirmSave)try{await this.showConfirmDialog()}catch{return!1}try{return await this.uploadData(),!0}catch(e){return this.$message.error("‰øùÂ≠òÂ§±Ë¥•",e.message||"ËØ∑ÈáçËØï"),!1}},async handleClose(){var i;if(!this.currentEditSubject)return;const t=this.state.textarea.trim(),e=((i=this.state.boardData.homework[this.currentEditSubject])==null?void 0:i.content)||"";if(t!==e.trim()){if(!t&&this.currentEditSubject.startsWith("custom-")){delete this.state.boardData.homework[this.currentEditSubject],this.state.synced=!1,this.autoSave&&await this.trySave(!0),this.state.dialogVisible=!1;return}this.state.boardData.homework[this.currentEditSubject].type==="custom"?this.state.boardData.homework[this.currentEditSubject].content=t:this.state.boardData.homework[this.currentEditSubject]={content:t},this.state.synced=!1,this.autoSave&&await this.trySave(!0)}this.state.dialogVisible=!1},async uploadData(){if(!this.loading.upload)try{this.loading.upload=!0;const t=await ce.saveData("classworks-data-"+this.state.dateString,this.state.boardData);if(t.success==!1)throw new Error(t.error.message);this.state.synced=!0,this.$message.success(t.message||"‰øùÂ≠òÊàêÂäü")}finally{this.loading.upload=!1}},async loadConfig(){try{try{const t=await ce.loadData("classworks-list-main");t.success!=!1&&Array.isArray(t)&&(this.state.studentList=t.map(e=>e.name))}catch(t){console.warn("Failed to load student list from dedicated key, falling back to config",t)}await this.loadSubjects()}catch(t){console.error("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•:",t),this.$message.error("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•",t.message)}},async loadSubjects(){try{const t=await ce.loadData("classworks-config-subject");t&&Array.isArray(t)&&(this.state.availableSubjects=t)}catch(t){console.warn("Failed to load subject configuration:",t)}},showSyncMessage(){this.$message.success("Êï∞ÊçÆÂ∑≤ÂêåÊ≠•","Êï∞ÊçÆÂ∑≤ÂÆåÊàê‰∏éÊúçÂä°Âô®ÂêåÊ≠•")},async openDialog(t){var e;if(this.isEditingDisabled){const i=this.$refs.studentNameManager;i!=null&&i.isReadOnly?this.$message.warning("Êó†Ê≥ïÁºñËæë","ÂΩìÂâç‰ΩøÁî®ÁöÑÊòØÂè™ËØª‰ª§Áâå"):this.canEditCurrentDate?this.$message.warning("Êó†Ê≥ïÁºñËæë","Êï∞ÊçÆÂä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô"):this.$message.warning("Êó†Ê≥ïÁºñËæë","Â∑≤Á¶ÅÊ≠¢ÁºñËæëËøáÂæÄÊï∞ÊçÆ");return}if(t.startsWith("custom-")){this.currentEditSubject=t,this.state.dialogTitle=this.state.boardData.homework[t].name,this.state.textarea=this.state.boardData.homework[t].content,this.state.dialogVisible=!0;return}if(this.refreshBeforeEdit)try{await this.downloadData()}catch(i){console.error("Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:",i),this.$message.error("Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•ÔºåÂèØËÉΩÊòæÁ§∫ÁöÑ‰∏çÊòØÊúÄÊñ∞Êï∞ÊçÆ")}this.currentEditSubject=t,this.state.boardData.homework[t]||(this.state.boardData.homework[t]={content:""}),this.state.dialogTitle=((e=this.state.availableSubjects.find(i=>i.name===t))==null?void 0:e.name)||t,this.state.textarea=this.state.boardData.homework[t].content,this.state.dialogVisible=!0},async handleHomeworkSave(t){this.currentEditSubject&&(this.state.boardData.homework[this.currentEditSubject].type==="custom"?this.state.boardData.homework[this.currentEditSubject].content=t:this.state.boardData.homework[this.currentEditSubject]={content:t},this.state.synced=!1,this.autoSave&&await this.trySave(!0))},setAttendanceArea(){if(this.isEditingDisabled){this.handleDisabledClick();return}this.state.attendanceDialog=!0},handleDisabledClick(){const t=this.$refs.studentNameManager;t!=null&&t.isReadOnly?this.$message.warning("Êó†Ê≥ïÁºñËæë","ÂΩìÂâç‰ΩøÁî®ÁöÑÊòØÂè™ËØª‰ª§Áâå"):this.canEditCurrentDate?this.$message.warning("Êó†Ê≥ïÁºñËæë","Êï∞ÊçÆÂä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô"):this.$message.warning("Êó†Ê≥ïÁºñËæë","Â∑≤Á¶ÅÊ≠¢ÁºñËæëËøáÂæÄÊï∞ÊçÆ")},zoom(t){t==="up"&&this.state.fontSize<100?this.state.fontSize+=2:t==="out"&&this.state.fontSize>16&&(this.state.fontSize-=2),this.state.contentStyle={"font-size":`${this.state.fontSize}px`},be("font.size",this.state.fontSize)},updateBackendUrl(){const t=_("server.provider"),e=_("server.classNumber");this.provider=t,this.state.classNumber=e},setupAutoRefresh(){const t=_("refresh.auto"),e=_("refresh.interval");this.state.refreshInterval&&clearInterval(this.state.refreshInterval),t&&(this.state.refreshInterval=setInterval(()=>{this.shouldSkipRefresh()||(this.downloadData(),this.loadPersistentNotifications())},e*1e3))},shouldSkipRefresh(){return!!(this.state.dialogVisible||this.state.attendanceDialog||this.confirmDialog.show||this.state.datePickerDialog||this.loading.upload||this.loading.download||!this.state.synced)},updateSettings(){this.state.fontSize=_("font.size"),this.state.contentStyle={"font-size":`${this.state.fontSize}px`},this.setupAutoRefresh(),this.updateBackendUrl(),this.loadDeviceInfo(),this.loadTokenInfo(),this.settingsTick++},async handleDateSelect(t){if(t)try{const e=this.ensureDate(t),i=this.formatDate(e);if(i===this.state.dateString)return;this.state.dateString=i,this.state.selectedDate=i,this.state.selectedDateObj=e,this.state.isToday=i===this.formatDate(this.getToday()),await Promise.all([this.downloadData(!0),this.loadSubjects()])}catch(e){console.error("Date processing error:",e),this.$message.error("Êó•ÊúüÂ§ÑÁêÜÈîôËØØ","ËØ∑ÈáçÊñ∞ÈÄâÊã©Êó•Êúü")}},setupRealtimeChannel(){try{const t=_("server.kvToken");if(!t){console.warn("Êú™ÈÖçÁΩÆ KV TokenÔºåÊó†Ê≥ïÂä†ÂÖ•ÂÆûÊó∂È¢ëÈÅì");return}Jt(),mt(t),this.$offConnect=rn(()=>mt(t)),this.debouncedRealtimeRefresh||(this.debouncedRealtimeRefresh=dt(async()=>{var h,k,C;const o=JSON.parse(JSON.stringify(this.state.boardData.homework));await this.downloadData();const n=new Date,l=String(n.getHours()).padStart(2,"0"),d=String(n.getMinutes()).padStart(2,"0"),u=String(n.getSeconds()).padStart(2,"0");(h=this.$message)==null||h.info("Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞",`Â∑≤‰∫é ${l}:${d}:${u} Ëá™Âä®Âà∑Êñ∞`);const f={};for(const B in this.state.boardData.homework){const Q=((k=o[B])==null?void 0:k.content)||"",A=((C=this.state.boardData.homework[B])==null?void 0:C.content)||"";Q!==A&&(f[B]=!0)}for(const B in o)this.state.boardData.homework[B]||(f[B]=!0);this.highlightedCards=f,setTimeout(()=>{this.highlightedCards={}},1e4)},800));const e=o=>{var l;if(!o)return;if(o.key==="notification-list"){this.loadPersistentNotifications();return}const n=`classworks-data-${this.state.dateString}`;o.key===n&&(o.action!=="upsert"&&o.action!=="delete"||(l=this.debouncedRealtimeRefresh)==null||l.call(this,o.key))},i=o=>{let n=o;o.content&&o.timestamp&&(n={uuid:o.senderId||"realtime",key:o.content.key,action:o.content.action,created:o.content.created,updatedAt:o.content.updatedAt||o.timestamp,deletedAt:o.content.deletedAt,batch:o.content.batch}),e(n)};this.$offKvChanged=Ne("kv-key-changed",i),this.deviceEventHandler=Xt({onKvChanged:e,enableLegacySupport:!0}),this.$offDeviceEvent=Ne("device-event",this.deviceEventHandler)}catch(t){console.warn("ÂÆûÊó∂È¢ëÈÅìÂàùÂßãÂåñÂ§±Ë¥•",t)}},async saveAttendance(){try{await this.trySave(!0),this.state.attendanceDialog=!1}catch(t){console.error("‰øùÂ≠òÂá∫Âã§Áä∂ÊÄÅÂ§±Ë¥•:",t),this.$message.error("‰øùÂ≠òÂ§±Ë¥•","ËØ∑ÈáçËØï")}},showMessage(t,e="",i="success"){this.$message[i](t,e)},updateSortedItemsCache(t,e){this._sortedItemsCache={key:t,value:e}},addTestCard(){const t=Date.now().toString();this.state.boardData.homework[`custom-${t}`]={name:"ÊµãËØïÂç°Áâá",content:`ËøôÊòØ‰∏Ä‰∏™ÊµãËØïÂç°Áâá
ÂèØ‰ª•Áî®Êù•ÊµãËØïÂ∏ÉÂ±Ä`,type:"custom"},this.state.synced=!1},showConfirmDialog(){return new Promise((t,e)=>{this.confirmDialog={show:!0,resolve:()=>{this.confirmDialog.show=!1,t()},reject:()=>{this.confirmDialog.show=!1,e(new Error("Áî®Êà∑ÂèñÊ∂à‰øùÂ≠ò"))}}})},confirmSave(){this.confirmDialog.show=!1,this.confirmDialog.resolve&&this.confirmDialog.resolve(!0)},cancelSave(){this.confirmDialog.show=!1,this.confirmDialog.reject&&this.confirmDialog.reject(new Error("Áî®Êà∑ÂèñÊ∂à‰øùÂ≠ò"))},async manualUpload(){return this.trySave(!1)},handleAttendanceChange(){this.state.synced=!1,this.debouncedAttendanceSave()},async handleAttendanceDialogClose(t){!t&&!this.state.synced&&await this.trySave(!0)},toggleFullscreen(){this.state.isFullscreen?this.exitFullscreen():this.enterFullscreen()},enterFullscreen(){const t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},fullscreenChangeHandler(){this.state.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)},openRandomPicker(){this.$refs.randomPicker&&this.$refs.randomPicker.open()},checkHashForRandomPicker(){window.location.hash==="#random-picker"&&this.$nextTick(()=>{console.log("ÊâìÂºÄÈöèÊú∫ÁÇπÂêç"),window.location.hash="",this.openRandomPicker()})},parseUrlConfig(){try{const e=new URLSearchParams(window.location.search).get("config");if(!e)return!1;try{const i=atob(e),o=Uint8Array.from(i,h=>h.charCodeAt(0)),n=new TextDecoder().decode(o),l=JSON.parse(n);console.log("‰ªéURLËØªÂèñÈÖçÁΩÆ:",l);const d=[],u={},f={};return this.processSpecialSettings(l,d,u),this.processStandardSettings(l,d,u,f),Object.keys(u).length===0?(console.log("URLÈÖçÁΩÆ‰∏éÂΩìÂâçÈÖçÁΩÆÁõ∏ÂêåÔºåÊó†ÈúÄÂ∫îÁî®"),!1):new Promise(h=>{this.urlConfigDialog={show:!0,config:l,changes:d,validSettings:u,icons:f,confirmHandler:()=>{this.urlConfigDialog.show=!1,this.applyUrlConfig(u),h(!0)},cancelHandler:()=>{this.urlConfigDialog.show=!1,h(!1)}}})}catch(i){return console.error("Ëß£ÊûêURLÈÖçÁΩÆÈîôËØØ:",i),this.$message.error("URLÈÖçÁΩÆÈîôËØØ","Êó†Ê≥ïËß£ÊûêÈÖçÁΩÆÊï∞ÊçÆ"),!1}}catch(t){return console.error("Â§ÑÁêÜURLÈÖçÁΩÆÈîôËØØ:",t),!1}},processSpecialSettings(t,e,i){var o,n;if(t.classNumber!==void 0){const l=_("server.classNumber");t.classNumber!==l&&(e.push({key:"server.classNumber",name:"Áè≠Á∫ß",oldValue:l,newValue:t.classNumber,description:((o=Qe["server.classNumber"])==null?void 0:o.description)||"Áè≠Á∫ßÁºñÂè∑",icon:((n=Qe["server.classNumber"])==null?void 0:n.icon)||"mdi-account-group"}),i["server.classNumber"]=t.classNumber)}t.date!==void 0&&t.date!==this.state.dateString&&(e.push({key:"date",name:"Êó•Êúü",oldValue:this.state.dateString,newValue:t.date,description:"Êü•ÁúãÁöÑÊó•Êúü",icon:"mdi-calendar"}),i.date=t.date),t.subjects&&Array.isArray(t.subjects)&&(e.push({key:"subjects",name:"ÁßëÁõÆÂàóË°®",oldValue:`${this.state.availableSubjects.length}‰∏™ÁßëÁõÆ`,newValue:`${t.subjects.length}‰∏™ÁßëÁõÆ`,description:"ÂèØÁî®ÁßëÁõÆÂàóË°®",icon:"mdi-notebook"}),i.subjects=t.subjects)},processStandardSettings(t,e,i,o){Object.entries(t).forEach(([n,l])=>{if(["classNumber","date","subjects"].includes(n))return;let d=n,u=Qe[n];if(!u&&!n.includes(".")){const f=["server.","display.","theme.","edit.","refresh.","font.","randomPicker."];for(const h of f){const k=`${h}${n}`;if(Qe[k]){d=k,u=Qe[k];break}}}if(u){let f=this.convertValueToCorrectType(l,u.type);if(u.validate&&!u.validate(f)){console.warn(`URLÈÖçÁΩÆÈ°π ${d} ÁöÑÂÄºÊó†Êïà: ${l}`);return}const h=_(d);f!==h&&(e.push({key:d,name:this.getSettingDisplayName(d),oldValue:this.formatSettingValue(h),newValue:this.formatSettingValue(f),description:u.description||d,icon:u.icon||"mdi-cog"}),i[d]=f,o[d]=u.icon||"mdi-cog")}else e.push({key:n,name:this.getSettingDisplayName(n),oldValue:"Êú™Áü•",newValue:this.formatSettingValue(l),description:"Ëá™ÂÆö‰πâÈÖçÁΩÆÈ°π",icon:"mdi-cog-outline"}),i[n]=l,o[n]="mdi-cog-outline"})},convertValueToCorrectType(t,e){return e==="boolean"?!!t:e==="number"?Number(t):String(t)},formatSettingValue(t){return typeof t=="boolean"?t?"ÂºÄÂêØ":"ÂÖ≥Èó≠":t===""||t===null||t===void 0?"Á©∫":t.toString()},getSettingDisplayName(t){const e=t.split("."),i=e[e.length-1];return{provider:"Êï∞ÊçÆÊèê‰æõÊñπ",domain:"ÊúçÂä°Âô®ÂüüÂêç",classNumber:"Áè≠Á∫ßÁºñÂè∑",emptySubjectDisplay:"Á©∫ÁßëÁõÆÊòæÁ§∫ÊñπÂºè",dynamicSort:"Âä®ÊÄÅÊéíÂ∫è",showRandomButton:"ÈöèÊú∫ÊåâÈíÆ",showFullscreenButton:"ÂÖ®Â±èÊåâÈíÆ",cardHoverEffect:"Âç°ÁâáÊÇ¨ÊµÆÊïàÊûú",enhancedTouchMode:"Â¢ûÂº∫Ëß¶Êë∏Ê®°Âºè",showAntiScreenBurnCard:"Èò≤ÁÉßÂ±èÂç°Áâá",mode:"‰∏ªÈ¢òÊ®°Âºè",size:"Â≠ó‰ΩìÂ§ßÂ∞è",autoSave:"Ëá™Âä®‰øùÂ≠ò",blockNonTodayAutoSave:"Á¶ÅÊ≠¢Ëá™Âä®‰øùÂ≠òÈùûÂΩìÊó•",refreshBeforeEdit:"ÁºñËæëÂâçÂà∑Êñ∞",confirmNonTodaySave:"ÈùûÂΩìÊó•‰øùÂ≠òÁ°ÆËÆ§",auto:"Ëá™Âä®Âà∑Êñ∞",interval:"Âà∑Êñ∞Èó¥Èöî"}[i]||i},safeBase64Decode(t){try{return Zt.decode(t)}catch(e){throw console.error("Base64Ëß£Á†ÅÈîôËØØ:",e),new Error("Êó†Ê≥ïËß£Á†ÅÈÖçÁΩÆÊï∞ÊçÆ")}},applyUrlConfig(t){for(const[e,i]of Object.entries(t)){if(e==="date"){this.handleDateSelect(i);continue}if(e==="subjects"){this.state.availableSubjects=i;continue}be(e,i),e==="server.classNumber"&&(this.state.classNumber=i)}return this.updateBackendUrl(),this.$message.success("URLÈÖçÁΩÆÂ∑≤Â∫îÁî®","Â∑≤‰ªéURLÂä†ËΩΩÈÖçÁΩÆ"),!0},navigateDay(t){const e=new Date(this.state.selectedDateObj);e.setDate(e.getDate()+t),this.handleDateSelect(e)},async copyHomeworkToToday(){if(!this.loading.copyToToday)try{this.loading.copyToToday=!0;const t=this.state.dateString,e=JSON.parse(JSON.stringify(this.state.boardData.homework)),i=this.getToday(),o=this.formatDate(i);this.state.dateString=o,await this.downloadData();const n={};for(const d in e)e[d]&&e[d].content&&(e[d].type==="custom"?n[d]=JSON.parse(JSON.stringify(e[d])):n[d]={content:e[d].content});this.state.boardData.homework=n,this.state.synced=!1,await this.uploadData(),this.state.selectedDate=o,this.state.selectedDateObj=i,this.state.isToday=!0;const l=new URL(window.location);l.searchParams.delete("date"),window.history.pushState({},"",l),this.$message.success("Â§çÂà∂ÊàêÂäü",`Â∑≤Â∞Ü ${t} ÁöÑ‰Ωú‰∏öÂÜÖÂÆπÂ§çÂà∂Âà∞‰ªäÂ§©ÔºàÂ∑≤ÊõøÊç¢ÂéüÊúâ‰Ωú‰∏öÔºâ`)}catch(t){console.error("Â§çÂà∂‰Ωú‰∏öÂ§±Ë¥•:",t),this.$message.error("Â§çÂà∂Â§±Ë¥•",t.message||"ËØ∑ÈáçËØï")}finally{this.loading.copyToToday=!1}},parsePreconfigData(){try{const t=new URLSearchParams(window.location.search),e=t.get("namespace"),i=t.get("authCode")||t.get("auth_code"),o=t.get("autoExecute")||t.get("auto_execute");e&&(this.preconfigData.namespace=e,this.preconfigData.authCode=i,this.preconfigData.autoOpen=!0,this.preconfigData.autoExecute=this.parseBoolean(o),console.log("Ê£ÄÊµãÂà∞È¢ÑÈÖçÊï∞ÊçÆ:",{namespace:this.preconfigData.namespace,hasAuthCode:!!this.preconfigData.authCode,autoExecute:this.preconfigData.autoExecute}),this.cleanupUrlParams(["namespace","authCode","auth_code","autoExecute","auto_execute"]))}catch(t){console.error("Ëß£ÊûêÈ¢ÑÈÖçÊï∞ÊçÆÂ§±Ë¥•:",t)}},parseBoolean(t){if(!t)return!1;const e=t.toLowerCase();return e==="true"||e==="1"||e==="yes"},cleanupUrlParams(t){try{const e=new URL(window.location);let i=!1;t.forEach(o=>{e.searchParams.has(o)&&(e.searchParams.delete(o),i=!0)}),i&&window.history.replaceState({},document.title,e.toString())}catch(e){console.error("Ê∏ÖÁêÜURLÂèÇÊï∞Â§±Ë¥•:",e)}},async loadPersistentNotifications(){try{const t=await ce.loadData("notification-list");t&&Array.isArray(t)?this.persistentNotifications=t:t&&t.success!==!1&&Array.isArray(t.data)?this.persistentNotifications=t.data:this.persistentNotifications=[]}catch(t){console.error("Âä†ËΩΩÂ∏∏È©ªÈÄöÁü•Â§±Ë¥•",t)}},showNotificationDetail(t){this.currentNotification=t,this.notificationDetailDialog=!0},async removePersistentNotification(t){this.persistentNotifications=this.persistentNotifications.filter(i=>i.id!==t);const e=this.persistentNotifications.length>0?this.persistentNotifications:{};await ce.saveData("notification-list",e),this.notificationDetailDialog=!1}}},ir={key:2,class:"d-flex"},lr={class:"text-h6 text-truncate font-weight-bold"},or={class:"text-h4 font-weight-medium mb-4",style:{"line-height":"1.5"}},rr={class:"text-subtitle-1 text-grey"},dr={class:"d-flex align-center flex-wrap"},ur={class:"text-subtitle-1"},cr={class:"text-grey-darken-1"},mr={class:"text-primary font-weight-medium"},fr={key:1,class:"text-center py-4 text-grey"};function hr(t,e,i,o,n,l){const d=ps,u=vs,f=gs,h=cs,k=us,C=ds,B=rs,Q=os,A=Yt,Y=ls,ae=is,xe=it,we=as,U=ss,te=Ht;return m(),p(V,null,[s(vn,{class:"no-select"},{append:a(()=>[n.tokenDisplayInfo.readonly?(m(),x(G,{key:0,class:"mx-2",color:"warning","prepend-icon":"mdi-lock-alert",variant:"tonal"},{default:a(()=>[...e[29]||(e[29]=[c(" Âè™ËØª ",-1)])]),_:1})):S("",!0),n.tokenDisplayInfo.show?(m(),x(G,{key:1,style:_e({cursor:n.tokenDisplayInfo.disabled?"default":"pointer"}),class:"mx-2",color:"primary","prepend-icon":"mdi-account",variant:"tonal",onClick:l.handleTokenChipClick},{default:a(()=>[c(g(n.tokenDisplayInfo.text),1)]),_:1},8,["style","onClick"])):S("",!0),l.shouldShowUrgentTestButton?(m(),x(y,{key:2,"prepend-icon":"mdi-chat",onClick:e[0]||(e[0]=D=>n.urgentTestDialog=!0),variant:"tonal"},{default:a(()=>[...e[30]||(e[30]=[c("ÂèëÈÄÅÈÄöÁü•",-1)])]),_:1})):S("",!0),s(y,{icon:"mdi-chat",variant:"text",onClick:e[1]||(e[1]=D=>n.isChatOpen=!0)}),s(y,{badge:l.unreadCount||void 0,"badge-color":l.unreadCount?"error":void 0,icon:"mdi-bell",variant:"text",onClick:e[2]||(e[2]=D=>t.$refs.messageLog.drawer=!0)},null,8,["badge","badge-color"]),s(y,{icon:"mdi-cog",variant:"text",onClick:e[3]||(e[3]=D=>t.$router.push("/settings"))})]),default:a(()=>[s(gn,null,{default:a(()=>[c(g(l.titleText),1)]),_:1}),s(H)]),_:1}),l.shouldShowInit?(m(),x(d,{key:0,preconfig:n.preconfigData,onDone:e[4]||(e[4]=D=>n.settingsTick++)},null,8,["preconfig"])):S("",!0),l.shouldShowInit?S("",!0):(m(),x(u,{key:1,ref:"studentNameManager",onTokenInfoUpdated:l.updateTokenDisplayInfo},null,8,["onTokenInfoUpdated"])),l.shouldShowInit?S("",!0):(m(),p("div",ir,[s(es,{class:"main-window flex-grow-1 no-select bloom-container",fluid:""},{default:a(()=>[n.persistentNotifications.length>0?(m(),x(Ce,{key:0,class:"mb-4"},{default:a(()=>[s(fe,{cols:"12"},{default:a(()=>[(m(!0),p(V,null,R(n.persistentNotifications,D=>(m(),x(I,{key:D.id,color:D.isUrgent?"error":"primary",class:"mb-2 cursor-pointer",variant:"tonal",onClick:P=>l.showNotificationDetail(D)},{default:a(()=>[s(z,{class:"d-flex align-center py-3"},{default:a(()=>[r("span",lr,g(D.message),1),s(H),s(y,{icon:"mdi-chevron-right",variant:"text"})]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1})]),_:1})):S("",!0),s(de,{modelValue:n.notificationDetailDialog,"onUpdate:modelValue":e[8]||(e[8]=D=>n.notificationDetailDialog=D),"max-width":"700",scrollable:""},{default:a(()=>[n.currentNotification?(m(),x(I,{key:0,class:"rounded-xl"},{default:a(()=>[s(Z,{class:"d-flex align-center pa-4 text-h5"},{default:a(()=>[r("span",{class:De([n.currentNotification.isUrgent?"text-error":"","font-weight-bold"])},g(n.currentNotification.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•ËØ¶ÊÉÖ"),3),s(H),s(y,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=D=>n.notificationDetailDialog=!1)})]),_:1}),s(Ue),s(z,{class:"pa-6"},{default:a(()=>[r("div",or,g(n.currentNotification.message),1),r("div",rr," ÂèëÂ∏ÉÊó∂Èó¥Ôºö"+g(l.formatTime(n.currentNotification.timestamp)),1)]),_:1}),s(Ue),s(ue,{class:"pa-4"},{default:a(()=>[s(y,{color:"error","prepend-icon":"mdi-delete",size:"x-large",variant:"tonal",class:"px-6",onClick:e[6]||(e[6]=D=>l.removePersistentNotification(n.currentNotification.id))},{default:a(()=>[...e[31]||(e[31]=[c(" Âà†Èô§ÈÄöÁü• ",-1)])]),_:1}),s(H),s(y,{color:"primary",size:"x-large",variant:"elevated",class:"px-8",onClick:e[7]||(e[7]=D=>n.notificationDetailDialog=!1)},{default:a(()=>[...e[32]||(e[32]=[c(" ÂÖ≥Èó≠ ",-1)])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1},8,["modelValue"]),s(f,{"sorted-items":l.sortedItems,"unused-subjects":l.unusedSubjects,"empty-subject-display":l.emptySubjectDisplay,"is-mobile":l.isMobile,"is-editing-disabled":l.isEditingDisabled,"content-style":n.state.contentStyle,"highlighted-cards":n.highlightedCards,onOpenDialog:l.openDialog,onOpenAttendance:l.setAttendanceArea,onDisabledClick:l.handleDisabledClick,onOpenExamDetail:l.openExamDetail},null,8,["sorted-items","unused-subjects","empty-subject-display","is-mobile","is-editing-disabled","content-style","highlighted-cards","onOpenDialog","onOpenAttendance","onDisabledClick","onOpenExamDetail"]),s(h,{synced:n.state.synced,"loading-upload":n.loading.upload,"show-random-picker-button":l.showRandomPickerButton,"show-exam-schedule-button":l.showExamScheduleButton,"show-list-card-button":l.showListCardButton,"show-fullscreen-button":l.showFullscreenButton,"is-fullscreen":n.state.isFullscreen,"show-anti-screen-burn-card":l.showAntiScreenBurnCard,"show-test-card-button":l.showTestCardButton,onUpload:l.manualUpload,onShowSyncMessage:l.showSyncMessage,onOpenRandomPicker:l.openRandomPicker,onToggleFullscreen:l.toggleFullscreen,onAddTestCard:l.addTestCard,onAddExamCard:e[9]||(e[9]=D=>n.showAddExamDialog=!0)},null,8,["synced","loading-upload","show-random-picker-button","show-exam-schedule-button","show-list-card-button","show-fullscreen-button","is-fullscreen","show-anti-screen-burn-card","show-test-card-button","onUpload","onShowSyncMessage","onOpenRandomPicker","onToggleFullscreen","onAddTestCard"]),s(k),n.upcomingExams.length>0&&!l.hasExamCard?(m(),x(Be,{key:1,class:"mt-4",color:"info",variant:"tonal",closable:"",icon:"mdi-calendar-clock",title:"ËøëÊúüÊúâËÄÉËØïÂÆâÊéí"},{append:a(()=>[s(y,{color:"primary",variant:"text",onClick:l.addAllUpcomingExams},{default:a(()=>[...e[34]||(e[34]=[c(" ‰∏ÄÈîÆÊ∑ªÂä† ",-1)])]),_:1},8,["onClick"])]),default:a(()=>[r("div",dr,[e[33]||(e[33]=r("span",{class:"mr-2"},"Ê£ÄÊµãÂà∞Êú™Êù•‰∏§Â§©ÂÜÖÊúâ‰ª•‰∏ãËÄÉËØïÔºö",-1)),(m(!0),p(V,null,R(n.upcomingExams,D=>(m(),x(G,{key:D.id,size:"small",class:"mr-1 mb-1",color:"primary"},{default:a(()=>[c(g(D.examName),1)]),_:2},1024))),128))])]),_:1})):S("",!0)]),_:1}),l.isMobile?S("",!0):(m(),x(C,{key:0,"student-list":n.state.studentList,attendance:n.state.boardData.attendance,"is-editing-disabled":l.isEditingDisabled,onClick:l.setAttendanceArea,onDisabledClick:l.handleDisabledClick},null,8,["student-list","attendance","is-editing-disabled","onClick","onDisabledClick"]))])),s(B,{modelValue:n.state.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=D=>n.state.dialogVisible=D),"auto-save":l.autoSave,"initial-content":n.state.textarea,title:n.state.dialogTitle,"is-editing-past-data":l.isEditingPastData,"current-date-string":n.state.dateString,onSave:l.handleHomeworkSave},null,8,["modelValue","auto-save","initial-content","title","is-editing-past-data","current-date-string","onSave"]),s(tn,{modelValue:n.state.snackbar,"onUpdate:modelValue":e[11]||(e[11]=D=>n.state.snackbar=D),timeout:2e3},{default:a(()=>[c(g(n.state.snackbarText),1)]),_:1},8,["modelValue"]),s(Q,{modelValue:n.state.attendanceDialog,"onUpdate:modelValue":e[12]||(e[12]=D=>n.state.attendanceDialog=D),"student-list":n.state.studentList,attendance:n.state.boardData.attendance,"date-string":n.state.dateString,onSave:l.saveAttendance,onChange:l.handleAttendanceChange},null,8,["modelValue","student-list","attendance","date-string","onSave","onChange"]),s(A,{ref:"messageLog"},null,512),s(Y,{"is-today":l.isToday,loading:n.loading.download,"copy-to-today-loading":n.loading.copyToToday,"selected-date":n.state.selectedDateObj,"unread-count":l.unreadCount,onRefresh:l.downloadData,onZoom:l.zoom,onOpenMessages:e[13]||(e[13]=D=>t.$refs.messageLog.drawer=!0),onOpenSettings:e[14]||(e[14]=D=>t.$router.push("/settings")),onDateSelect:l.handleDateSelect,onPrevDay:e[15]||(e[15]=D=>l.navigateDay(-1)),onNextDay:e[16]||(e[16]=D=>l.navigateDay(1)),onCopyToToday:l.copyHomeworkToToday},null,8,["is-today","loading","copy-to-today-loading","selected-date","unread-count","onRefresh","onZoom","onDateSelect","onCopyToToday"]),s(ae),s(xe,{modelValue:n.isChatOpen,"onUpdate:modelValue":e[17]||(e[17]=D=>n.isChatOpen=D),"show-button":!1},null,8,["modelValue"]),s(we,{modelValue:n.urgentTestDialog,"onUpdate:modelValue":e[18]||(e[18]=D=>n.urgentTestDialog=D)},null,8,["modelValue"]),s(de,{modelValue:n.confirmDialog.show,"onUpdate:modelValue":e[19]||(e[19]=D=>n.confirmDialog.show=D),"max-width":"400"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"text-h6"},{default:a(()=>[...e[35]||(e[35]=[c(" Á°ÆËÆ§‰øùÂ≠ò",-1)])]),_:1}),s(z,null,{default:a(()=>[c(" ÊÇ®Ê≠£Âú®‰øÆÊîπ "+g(n.state.dateString)+" ÁöÑÊï∞ÊçÆÔºåÁ°ÆÂÆöË¶Å‰øùÂ≠òÂêóÔºü ",1)]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{color:"grey",variant:"text",onClick:n.confirmDialog.reject},{default:a(()=>[...e[36]||(e[36]=[c(" ÂèñÊ∂à ",-1)])]),_:1},8,["onClick"]),s(y,{color:"primary",onClick:n.confirmDialog.resolve},{default:a(()=>[...e[37]||(e[37]=[c(" Á°ÆËÆ§‰øùÂ≠ò",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(U,{ref:"randomPicker",attendance:n.state.boardData.attendance,"student-list":n.state.studentList},null,8,["attendance","student-list"]),s(de,{modelValue:n.urlConfigDialog.show,"onUpdate:modelValue":e[20]||(e[20]=D=>n.urlConfigDialog.show=D),"max-width":"500"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"text-h6"},{default:a(()=>[...e[38]||(e[38]=[c(" Á°ÆËÆ§Â∫îÁî®URLÈÖçÁΩÆ",-1)])]),_:1}),s(z,null,{default:a(()=>[e[39]||(e[39]=r("p",null,"‰ª•‰∏ãÈÖçÁΩÆÂ∞ÜÂ∫îÁî®‰∫éÂΩìÂâçÁè≠Á∫ßÔºö",-1)),s($e,{density:"compact"},{default:a(()=>[(m(!0),p(V,null,R(n.urlConfigDialog.changes,D=>(m(),x(Pe,{key:D.key},{prepend:a(()=>[s(E,{icon:D.icon,class:"mr-2",size:"small"},null,8,["icon"])]),default:a(()=>[s(st,{class:"d-flex align-center"},{default:a(()=>[r("span",ur,g(D.name),1),s(pt,{activator:"parent",location:"top"},{default:a(()=>[c(g(D.description||D.key),1)]),_:2},1024)]),_:2},1024),s(nt,null,{default:a(()=>[r("span",cr,g(D.oldValue),1),s(E,{class:"mx-1",icon:"mdi-arrow-right",size:"small"}),r("span",mr,g(D.newValue),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{color:"grey",variant:"text",onClick:n.urlConfigDialog.cancelHandler},{default:a(()=>[...e[40]||(e[40]=[c(" ÂèñÊ∂à ",-1)])]),_:1},8,["onClick"]),s(y,{color:"primary",onClick:n.urlConfigDialog.confirmHandler},{default:a(()=>[...e[41]||(e[41]=[c(" Á°ÆËÆ§Â∫îÁî® ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(de,{modelValue:n.showExamDetailDialog,"onUpdate:modelValue":e[23]||(e[23]=D=>n.showExamDetailDialog=D),persistent:"",fullscreen:""},{default:a(()=>[n.selectedExamId?(m(),x(I,{key:0},{default:a(()=>[s(Z,{class:"d-flex align-center pa-4"},{default:a(()=>[e[42]||(e[42]=c(" ÁºñËæëËÄÉËØïÈÖçÁΩÆ ",-1)),s(H),s(y,{icon:"mdi-close",variant:"text",onClick:e[21]||(e[21]=D=>n.showExamDetailDialog=!1)})]),_:1}),s(z,{class:"pa-4",style:{"max-height":"70vh","overflow-y":"auto"}},{default:a(()=>[s(te,{"config-id":n.selectedExamId,"dialog-mode":!0,onSaved:l.onExamConfigSaved,onDeleted:l.onExamConfigDeleted},null,8,["config-id","onSaved","onDeleted"])]),_:1}),s(Ue),s(ue,{class:"pa-4"},{default:a(()=>[s(y,{color:"error","prepend-icon":"mdi-delete",variant:"tonal",onClick:l.removeCurrentExamCard},{default:a(()=>[...e[43]||(e[43]=[c(" ÁßªÈô§Âç°Áâá ",-1)])]),_:1},8,["onClick"]),s(H),s(y,{color:"primary",variant:"text",onClick:e[22]||(e[22]=D=>n.showExamDetailDialog=!1)},{default:a(()=>[...e[44]||(e[44]=[c(" ÂÖ≥Èó≠ ",-1)])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1},8,["modelValue"]),s(de,{modelValue:n.showAddExamDialog,"onUpdate:modelValue":e[25]||(e[25]=D=>n.showAddExamDialog=D),"max-width":"500"},{default:a(()=>[s(I,null,{default:a(()=>[s(Z,{class:"text-h6"},{default:a(()=>[...e[45]||(e[45]=[c("È¢ÑËßàËÄÉËØïÁúãÊùø",-1)])]),_:1}),s(z,null,{default:a(()=>[o.examStore.examList.length>0?(m(),x($e,{key:0},{default:a(()=>[(m(!0),p(V,null,R(o.examStore.examList,D=>{var P;return m(),x(Pe,{key:D.id,title:((P=o.examStore.exams[D.id])==null?void 0:P.examName)||D.id,subtitle:D.id,onClick:b=>l.addExamCard(D.id)},{prepend:a(()=>[s(E,{color:"primary"},{default:a(()=>[...e[46]||(e[46]=[c("mdi-calendar-text",-1)])]),_:1})]),append:a(()=>[s(y,{icon:l.isExamCardAdded(D.id)?"mdi-check":"mdi-plus",color:l.isExamCardAdded(D.id)?"success":"grey",variant:"text"},null,8,["icon","color"])]),_:2},1032,["title","subtitle","onClick"])}),128))]),_:1})):(m(),p("div",fr," ÊöÇÊó†ËÄÉËØïÈÖçÁΩÆ "))]),_:1}),s(ue,null,{default:a(()=>[s(H),s(y,{color:"primary",variant:"text",onClick:e[24]||(e[24]=D=>n.showAddExamDialog=!1)},{default:a(()=>[...e[47]||(e[47]=[c("ÂÖ≥Èó≠",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(de,{modelValue:n.notificationDetailDialog,"onUpdate:modelValue":e[28]||(e[28]=D=>n.notificationDetailDialog=D),"max-width":"600"},{default:a(()=>[n.currentNotification?(m(),x(I,{key:0},{default:a(()=>[s(Z,{class:De(["headline",n.currentNotification.isUrgent?"text-error":"text-primary"])},{default:a(()=>[c(g(n.currentNotification.isUrgent?"Âº∫Ë∞ÉÈÄöÁü•":"ÈÄöÁü•ËØ¶ÊÉÖ"),1)]),_:1},8,["class"]),s(z,{class:"text-h5 py-4"},{default:a(()=>[c(g(n.currentNotification.message),1)]),_:1}),s(ue,null,{default:a(()=>[s(y,{color:"error",variant:"text",onClick:e[26]||(e[26]=D=>l.removePersistentNotification(n.currentNotification.id))},{default:a(()=>[...e[48]||(e[48]=[c("Âà†Èô§",-1)])]),_:1}),s(H),s(y,{color:"primary",onClick:e[27]||(e[27]=D=>n.notificationDetailDialog=!1)},{default:a(()=>[...e[49]||(e[49]=[c("ÂÖ≥Èó≠",-1)])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1},8,["modelValue"]),e[50]||(e[50]=r("br",null,null,-1)),e[51]||(e[51]=r("br",null,null,-1)),e[52]||(e[52]=r("br",null,null,-1))],64)}const Mr=ie(ar,[["render",hr]]);export{Mr as default};
